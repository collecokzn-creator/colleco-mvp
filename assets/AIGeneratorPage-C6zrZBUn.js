import{r as p,j as t,L as he,R as De}from"./index-BCXrhMbA.js";const Ie="http://127.0.0.1:4001";function ke(){try{if(typeof window<"u"&&window.__E2E__)return window.__E2E_API_BASE!=null?window.__E2E_API_BASE:""}catch{}return Ie}const G=ke();function q(r={}){return{...r}}async function Te(r){const o=await fetch(`${G}/api/ai/itinerary`,{method:"POST",headers:q({"Content-Type":"application/json"}),body:JSON.stringify({prompt:r})});if(!o.ok){let c="Request failed";try{c=(await o.json()).error||c}catch{}throw new Error(c)}return(await o.json()).data}function Re(r,{onEvent:o,onError:a,onDone:c,signal:s}={}){const h=new URL(`${G}/api/ai/itinerary/stream`);h.searchParams.set("prompt",r);const v=new AbortController;return s&&s.addEventListener("abort",()=>v.abort(),{once:!0}),fetch(h.toString(),{signal:v.signal,headers:q({Accept:"text/event-stream"})}).then(async S=>{if(!S.ok){let N="Stream request failed";try{N=(await S.json()).error||N}catch{}throw new Error(N)}const D=S.body.getReader(),m=new TextDecoder("utf-8");let g="";for(;;){const{done:N,value:R}=await D.read();if(N)break;g+=m.decode(R,{stream:!0});let E;for(;(E=g.indexOf(`

`))!==-1;){const i=g.slice(0,E).trim();if(g=g.slice(E+2),!i)continue;const y=i.split(`
`);let $="message",C="";for(const A of y)A.startsWith("event:")?$=A.slice(6).trim():A.startsWith("data:")&&(C+=A.slice(5).trim());if(C)try{const A=JSON.parse(C);o&&o({event:$,data:A}),$==="done"&&c&&c()}catch{}}}c&&c()}).catch(S=>{v.signal.aborted||a&&a(S)}),{cancel:()=>v.abort()}}async function Ee(r,o){const a=await fetch(`${G}/api/ai/itinerary/refine`,{method:"POST",headers:q({"Content-Type":"application/json"}),body:JSON.stringify({prompt:r,instructions:o})});if(!a.ok){let s="Refine failed";try{s=(await a.json()).error||s}catch{}throw new Error(s)}return(await a.json()).data}async function Oe(r){const o=await fetch(`${G}/api/ai/flight`,{method:"POST",headers:q({"Content-Type":"application/json"}),body:JSON.stringify({prompt:r})});if(!o.ok){let c="Flight intent failed";try{c=(await o.json()).error||c}catch{}throw new Error(c)}return(await o.json()).data}async function Pe(r){const o=await fetch(`${G}/api/ai/intent`,{method:"POST",headers:q({"Content-Type":"application/json"}),body:JSON.stringify({prompt:r})});if(!o.ok){let c="Intent parse failed";try{c=(await o.json()).error||c}catch{}throw new Error(c)}return(await o.json()).data}const W="http://127.0.0.1:4001";function Y(r={}){return{...r}}async function Ue(r){const o=await fetch(`${W}/api/ai/session`,{method:"POST",headers:Y({"Content-Type":"application/json"}),body:JSON.stringify({prompt:r})});if(!o.ok){let a="Session start failed";try{a=(await o.json()).error||a}catch{}throw new Error(a)}return o.json()}async function _e(r,o){const a=await fetch(`${W}/api/ai/session/${r}/refine`,{method:"POST",headers:Y({"Content-Type":"application/json"}),body:JSON.stringify({instructions:o})});if(!a.ok){let s="Session refine failed";try{s=(await a.json()).error||s}catch{}throw new Error(s)}return(await a.json()).data}async function Le(r,o){const a=await fetch(`${W}/api/ai/draft`,{method:"POST",headers:Y({"Content-Type":"application/json"}),body:JSON.stringify({prompt:r,data:o})});if(!a.ok){let c="Upload failed";try{c=(await a.json()).error||c}catch{}throw new Error(c)}return a.json()}async function Fe(r){const o=await fetch(`${W}/api/ai/session/${r}`,{headers:Y()});if(!o.ok){let a="Fetch session failed";try{a=(await o.json()).error||a}catch{}throw new Error(a)}return o.json()}function Me(){const[r,o]=p.useState("Family trip to Rome and Florence for 6 nights in June, 2 adults 1 child, budget $4000, love food and history"),[a,c]=p.useState("stream"),[s,h]=p.useState({}),[v,S]=p.useState(null),[D,m]=p.useState(""),[g,N]=p.useState(""),[R,E]=p.useState(!1),[i,y]=p.useState(!1),[$,C]=p.useState(null),[A,ne]=p.useState(!1),[L,B]=p.useState(!1),[O,U]=p.useState(!1),[me,se]=p.useState(!1),[H,re]=p.useState(null),[ue,ae]=p.useState(!1),[k,z]=p.useState([]),[ie,oe]=p.useState(!1),[x,Q]=p.useState(null),[K,ce]=p.useState([]),[,le]=p.useState(null),[xe,F]=p.useState([]),V=p.useRef(null),b=p.useRef(null);p.useEffect(()=>{b.current&&(b.current.textContent=fe())},[s,D,L,O]);function fe(){return D?`Error: ${D}`:L&&a==="single"?"Generating draft":O&&a==="stream"?s.done?"Generation complete":s.pricing?"Pricing phase received":s.plan?"Plan phase received":s.parse?"Parse phase received":"Preparing draft…":""}function X(){h({}),S(null),m(""),B(!1),U(!1),V.current?.cancel(),V.current=null,y(!1),C(null),re(null),z([]),oe(!1),Q(null),ce([]),le(null),F([])}async function ge(){if(X(),!r.trim()){m("Prompt required");return}B(!0);try{console.log("[AIGEN] handleSingle: sending generate request",{prompt:r&&r.slice(0,80)});const e=await Te(r.trim());console.log("[AIGEN] handleSingle: received data",e),S(e);const n=ee(e);console.log("[AIGEN] handleSingle: parsePhase",n),h({parse:n,plan:{itinerary:e.itinerary},pricing:{pricing:e.pricing},done:!0}),U(!1)}catch(e){m(e.message||"Generation failed")}finally{B(!1)}}function be(){if(X(),!r.trim()){m("Prompt required");return}Pe(r.trim()).then(n=>{n&&Array.isArray(n.intents)&&ce(n.intents)}).catch(()=>{}),Oe(r.trim()).then(Q).catch(()=>{}),U(!0);const e=Re(r.trim(),{onEvent:({event:n,data:l})=>{h(w=>{const f={...w};return n==="parse"?f.parse=l:n==="plan"?f.plan=l:n==="pricing"?f.pricing=l:n==="done"&&(f.done=!0),f}),n==="done"&&U(!1)},onError:n=>{m(n.message||"Stream failed"),U(!1)},onDone:()=>{U(!1)}});V.current=e}function _(e){try{return JSON.parse(JSON.stringify(e))}catch{return{...e}}}function de(e){h(n=>{if(!n||!n.plan||!n.plan.itinerary)return n;const l=_(n);F(I=>[...I,l]);const w=_(n),f=w.parse?.nights||w.plan.itinerary.length;let u=Math.max(1,f+e);w.parse&&(w.parse.nights=u);const d=[...w.plan.itinerary];if(u>d.length){const I=u-d.length,T=d[d.length-1]||{destination:w.parse?.destinations?.[0]||"Destination",activities:["Leisure & exploration"]};for(let te=0;te<I;te++){const J=d.length+1,pe=T.destination||T.title?.replace(/^.*-\s*/,"")||"Destination";d.push({day:J,title:`Day ${J} - ${pe}`,destination:pe,activities:[...T.activities||["Leisure & exploration"]]})}}else u<d.length&&(d.length=u);return w.plan.itinerary=d.map((I,T)=>({...I,day:T+1,title:`Day ${T+1} - ${I.destination||I.title?.replace(/^.*-\s*/,"")||"Destination"}`})),w})}function ye(e){h(n=>{if(!n||!n.pricing||!n.pricing.pricing)return n;const l=_(n);F(d=>[...d,l]);const w=_(n),f=1+e/100,u=w.pricing.pricing;return u.total!=null&&(u.total=Math.round(u.total*f)),u.breakdown&&Object.keys(u.breakdown).forEach(d=>{u.breakdown[d]=Math.round(u.breakdown[d]*f)}),u.note&&(u.note+=e>=0?` · increased by ${e}%`:` · decreased by ${Math.abs(e)}%`),w})}function je(e,n){h(l=>{if(!l||!l.plan||!l.plan.itinerary)return l;const w=_(l);F(d=>[...d,w]);const f=_(l);f.parse&&Array.isArray(f.parse.destinations)&&(f.parse.destinations=f.parse.destinations.map(d=>d.toLowerCase()===String(e).toLowerCase()?n:d));const u=String(e).toLowerCase();return f.plan.itinerary=f.plan.itinerary.map((d,I)=>{const T=(d.destination||d.title||"").toString(),J=T.toLowerCase()===u||/-\s*.+$/.test(d.title||"")&&d.title.replace(/^.*-\s*/,"").toLowerCase()===u?n:d.destination||d.title?.replace(/^.*-\s*/,"")||T;return{...d,day:I+1,destination:J,title:`Day ${I+1} - ${J}`}}),f})}function we(e){if(!(!e||e.length===0)){le(e);for(const n of e)n.op==="extend"?de(+Math.abs(n.nightsDelta||1)):n.op==="shorten"?de(-Math.abs(n.nightsDelta||1)):n.op==="adjustBudget"?ye(n.percent||0):n.op==="swapDestination"&&n.from&&n.to&&je(n.from,n.to);b.current&&(b.current.textContent=`Applied ${e.length} itinerary change${e.length>1?"s":""}.`,setTimeout(()=>{b.current&&(b.current.textContent="")},2500))}}function Ne(){F(e=>{if(!e||e.length===0)return e;const n=e.slice(0,-1),l=e[e.length-1];return h(l),b.current&&(b.current.textContent="Reverted last itinerary changes.",setTimeout(()=>{b.current&&(b.current.textContent="")},2e3)),n})}function ve(){V.current?.cancel(),U(!1),B(!1)}async function Se(){if(!v&&!s.parse){m("Generate first");return}if(!g.trim()){m("Refine instructions required");return}E(!0),m("");try{let e;if(A&&$){e=await _e($,g.trim());try{const n=await Fe($);z(n.history||[])}catch{}}else{const n=r.trim();e=await Ee(n,g.trim())}S(e),h({parse:ee(e),plan:{itinerary:e.itinerary},pricing:{pricing:e.pricing},done:!0}),N("")}catch(e){m(e.message||"Refine failed")}finally{E(!1)}}async function $e(){if(!r.trim()){m("Prompt required");return}try{const e=await Ue(r.trim());C(e.id),ne(!0),S(e.data),h({parse:ee(e.data),plan:{itinerary:e.data.itinerary},pricing:{pricing:e.data.pricing},done:!0}),ae(!!e.scoped),z([{type:"parse",data:e.data,at:Date.now()}]),b.current&&(b.current.textContent="Session started",setTimeout(()=>{b.current&&(b.current.textContent="")},1500))}catch(e){m(e.message||"Session failed")}}async function Ce(){const e=v||s.parse&&s.plan&&s.pricing&&{...s.parse,itinerary:s.plan.itinerary,pricing:s.pricing.pricing};if(!e){m("Nothing to upload");return}se(!0),m("");try{const n=await Le(r.trim(),e);re(n.id),n.scoped&&ae(!0)}catch(n){m(n.message||"Upload failed")}finally{se(!1)}}function Ae(){const e=v||s.parse&&s.plan&&s.pricing&&{...s.parse,itinerary:s.plan.itinerary,pricing:s.pricing.pricing};if(!e){m("Nothing to apply yet");return}try{const n={appliedAt:Date.now(),sourcePrompt:r.trim(),itinerary:e.itinerary,meta:{nights:e.nights,destinations:e.destinations,interests:e.interests,budget:e.budget}};localStorage.setItem("aiItineraryDraft:v1",JSON.stringify(n)),y(!0),b.current&&(b.current.textContent="AI draft stored. Open Itinerary page to import.",setTimeout(()=>{b.current&&(b.current.textContent="")},3e3))}catch{m("Failed to store draft")}}function Z(e,n){return new Intl.NumberFormat(void 0,{style:"currency",currency:n||"USD"}).format(e)}function ee(e){if(!e||typeof e!="object")return{};const n=e.nights??(Array.isArray(e.itinerary)?e.itinerary.length:void 0),l=Array.isArray(e.destinations)?e.destinations:Array.isArray(e.itinerary)?e.itinerary.map(u=>u.destination||u.title?.replace(/^.*-\s*/,"")).filter(Boolean):[],w=Array.isArray(e.interests)?e.interests:[],f=e.budget??(e.pricing&&e.pricing.total?{amount:e.pricing.total,currency:e.pricing.currency||"USD"}:void 0);return{nights:n,destinations:l,interests:w,budget:f}}const j=s.parse,M=s.plan,P=s.pricing;return t.jsxs("div",{className:"ai-panel max-w-4xl mx-auto flex flex-col gap-4","aria-labelledby":"aiGenHeading",children:[t.jsx("h1",{id:"aiGenHeading",className:"text-2xl font-bold text-brand-brown",children:"Trip Assist"}),t.jsx("p",{className:"text-sm text-brand-brown/80 leading-snug",children:"Describe your trip — budget, vibe, pace, must‑dos. You’ll get a draft with an outline and rough costs. See it build in steps or generate a single draft, then refine until it feels right."}),t.jsxs("div",{className:"rounded border border-cream-border bg-cream p-3",children:[t.jsx("div",{className:"text-xs font-semibold text-brand-brown mb-2",children:"Quick start ideas"}),t.jsx("div",{className:"flex gap-2 overflow-x-auto pb-1 pr-1",children:["Family-friendly Cape Town long weekend in June, 2 adults 2 kids, budget $2000, nature + beaches + penguins","Romantic Italy 7 nights: Rome, Florence, Amalfi; foodie + history; mid-range; September","Safari + beach 10 days: Kruger + Mauritius; 2 adults; July; budget $5000; photography + relaxation","Backpacking Southeast Asia 14 days: Thailand + Vietnam; budget; nightlife + street food; hostels","Wine and wildlife 5 nights: Stellenbosch + Cape Town; 4 adults; September; wineries + Table Mountain"].map((e,n)=>t.jsx("button",{type:"button",onClick:()=>o(e),className:"shrink-0 max-w-[22rem] text-left px-2 py-1 rounded border border-cream-border bg-cream-sand hover:bg-cream-hover text-[11px]",title:"Use this idea",children:e},n))})]}),t.jsxs("label",{className:"flex flex-col gap-1 text-sm font-medium text-brand-brown",children:["Prompt",t.jsx("textarea",{value:r,onChange:e=>o(e.target.value),rows:4,className:"w-full p-2 rounded border border-cream-border bg-cream focus:outline-none focus:ring-2 focus:ring-brand-orange/40 text-sm resize-y"})]}),K&&K.length>0&&t.jsxs("div",{className:"rounded border border-cream-border bg-cream-sand/60 p-3 text-xs",children:[t.jsxs("div",{className:"font-semibold mb-1",children:["Detected request",K.length>1?"s":""]}),t.jsx("div",{className:"flex flex-col gap-2",children:K.filter(e=>e.type!=="flight_search").map((e,n)=>{if(e.type==="hotel_search"){const l=`/plan-trip?category=Lodging${e.city?`&city=${encodeURIComponent(e.city)}`:""}${e.budget?.amount?`&budget=${encodeURIComponent(e.budget.amount)}`:""}${e.stars?`&stars=${e.stars}`:""}`;return t.jsxs("div",{className:"flex items-center justify-between gap-2",children:[t.jsxs("div",{children:["Hotel search ",e.city?`in ${e.city}`:""," ",e.nights?`· ${e.nights} nights`:""]}),t.jsx("a",{href:l,className:"inline-flex items-center px-2 py-1 rounded bg-brand-orange text-white",children:"Find hotels"})]},n)}if(e.type==="car_rental"){const l=`/plan-trip?category=Transport${e.pickupCity?`&city=${encodeURIComponent(e.pickupCity)}`:""}`;return t.jsxs("div",{className:"flex items-center justify-between gap-2",children:[t.jsxs("div",{children:["Car hire ",e.pickupCity?`in ${e.pickupCity}`:""," ",e.pickupDate?`· ${e.pickupDate}`:""]}),t.jsx("a",{href:l,className:"inline-flex items-center px-2 py-1 rounded bg-brand-orange text-white",children:"Find cars"})]},n)}if(e.type==="activity_search"){const l=`/plan-trip?category=Activity${e.city?`&city=${encodeURIComponent(e.city)}`:""}`;return t.jsxs("div",{className:"flex items-center justify-between gap-2",children:[t.jsxs("div",{children:["Activities ",e.city?`in ${e.city}`:""," ",e.startDate?`· ${e.startDate}`:""]}),t.jsx("a",{href:l,className:"inline-flex items-center px-2 py-1 rounded bg-brand-orange text-white",children:"Find activities"})]},n)}if(e.type==="dining_search"){const l=`/plan-trip?category=Dining${e.city?`&city=${encodeURIComponent(e.city)}`:""}${e.nearMe?"&setLocation=1":""}`;return t.jsxs("div",{className:"flex items-center justify-between gap-2",children:[t.jsxs("div",{children:["Dining ",e.city?`in ${e.city}`:e.nearMe?"near you":""," ",e.time?`· ${e.time}`:""]}),t.jsx("a",{href:l,className:"inline-flex items-center px-2 py-1 rounded bg-brand-orange text-white",children:"Find dining"})]},n)}if(e.type==="transfer_request"){const l=`/plan-trip?category=Transport${e.city?`&city=${encodeURIComponent(e.city)}`:""}${e.nearMe?"&setLocation=1":""}`;return t.jsxs("div",{className:"flex items-center justify-between gap-2",children:[t.jsxs("div",{children:["Transfers ",e.city?`in ${e.city}`:e.nearMe?"near you":""," ",e.time?`· ${e.time}`:""]}),t.jsx("a",{href:l,className:"inline-flex items-center px-2 py-1 rounded bg-brand-orange text-white",children:"Find transfers"})]},n)}if(e.type==="event_search"){const l=`/plan-trip?tab=events${e.city?`&city=${encodeURIComponent(e.city)}`:""}${e.nearMe?"&setLocation=1":""}`;return t.jsxs("div",{className:"flex items-center justify-between gap-2",children:[t.jsxs("div",{children:["Events ",e.city?`in ${e.city}`:e.nearMe?"near you":""," ",e.startDate?`· from ${e.startDate}`:""]}),t.jsx("a",{href:l,className:"inline-flex items-center px-2 py-1 rounded bg-brand-orange text-white",children:"Browse events"})]},n)}if(e.type==="visa_help")return t.jsxs("div",{className:"flex items-center justify-between gap-2",children:[t.jsx("div",{children:"Visa help detected"}),t.jsx("a",{href:"/compliance",className:"inline-flex items-center px-2 py-1 rounded bg-brand-brown text-white",children:"Open Compliance"})]},n);if(e.type==="insurance_help")return t.jsxs("div",{className:"flex items-center justify-between gap-2",children:[t.jsx("div",{children:"Insurance help detected"}),t.jsx("a",{href:"/compliance",className:"inline-flex items-center px-2 py-1 rounded bg-brand-brown text-white",children:"Open Compliance"})]},n);if(e.type==="itinerary_ops"){const l=xe.length>0;return t.jsxs("div",{className:"flex items-center justify-between gap-2",children:[t.jsxs("div",{children:["Itinerary adjustments detected (",e.ops?.length||0,")"]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{type:"button",onClick:()=>we(e.ops||[]),className:"inline-flex items-center px-2 py-1 rounded bg-brand-brown text-white",children:"Apply now"}),l&&t.jsx("button",{type:"button",onClick:Ne,className:"text-brand-brown underline",children:"Undo"})]})]},n)}return e.type==="quote_ops"?t.jsxs("div",{className:"flex items-center justify-between gap-2",children:[t.jsx("div",{children:"Quote action detected"}),t.jsx("a",{href:"/quotes/new",className:"inline-flex items-center px-2 py-1 rounded bg-brand-brown text-white",children:"Open quotes"})]},n):null})})]}),x&&t.jsxs("div",{className:"rounded border border-cream-border bg-cream-sand/60 p-3 text-xs",children:[t.jsx("div",{className:"font-semibold mb-1",children:"Detected flight request"}),t.jsxs("div",{children:["From: ",x.from?.city," ",x.from?.code?`(${x.from.code})`:""]}),t.jsxs("div",{children:["To: ",x.to?.city," ",x.to?.code?`(${x.to.code})`:""]}),t.jsxs("div",{children:["Date: ",x.date||"—"," ",x.time?`at ${x.time}`:""]}),t.jsxs("div",{children:["Passengers: ",x.pax," · Cabin: ",x.cabin]}),t.jsxs("div",{className:"mt-2 flex gap-2",children:[t.jsx("a",{href:`/plan-trip?category=Flights&from=${encodeURIComponent(x.from?.code||x.from?.city||"")}&to=${encodeURIComponent(x.to?.code||x.to?.city||"")}&date=${encodeURIComponent(x.date||"")}&time=${encodeURIComponent(x.time||"")}&pax=${x.pax}&cabin=${encodeURIComponent(x.cabin)}`,className:"inline-flex items-center px-3 py-1.5 rounded bg-brand-orange text-white",children:"Search flights"}),t.jsx("button",{onClick:()=>Q(null),className:"text-brand-brown underline",children:"Dismiss"})]})]}),t.jsxs("div",{className:"flex flex-wrap gap-3 items-center",children:[t.jsxs("div",{className:"inline-flex items-center gap-2 bg-cream-sand px-3 py-1 rounded border border-cream-border text-sm",children:[t.jsx("span",{className:"font-semibold",children:"Mode:"}),t.jsxs("label",{className:"flex items-center gap-1 cursor-pointer",children:[t.jsx("input",{type:"radio",name:"aimode",value:"stream",checked:a==="stream",onChange:()=>c("stream")})," ",t.jsx("span",{children:"Stream"})]}),t.jsxs("label",{className:"flex items-center gap-1 cursor-pointer",children:[t.jsx("input",{type:"radio",name:"aimode",value:"single",checked:a==="single",onChange:()=>c("single")})," ",t.jsx("span",{children:"Single"})]})]}),a==="single"&&t.jsx("button",{onClick:ge,disabled:L,className:"px-4 py-2 rounded bg-brand-orange text-white text-sm font-semibold hover:bg-brand-highlight disabled:opacity-50",children:L?"Generating…":"Generate"}),a==="stream"&&t.jsx("button",{onClick:be,disabled:O,className:"px-4 py-2 rounded bg-brand-orange text-white text-sm font-semibold hover:bg-brand-highlight disabled:opacity-50",children:O?"Streaming…":"Start Stream"}),(O||L)&&t.jsx("button",{onClick:ve,className:"px-3 py-2 rounded bg-brand-brown text-white text-xs font-semibold hover:bg-brand-brown/80",children:"Cancel"}),t.jsx("button",{onClick:X,className:"px-3 py-2 rounded border border-brand-brown text-brand-brown text-xs font-semibold hover:bg-cream-hover",children:"Clear"}),t.jsx("button",{onClick:Ae,disabled:i||!(s.plan&&s.pricing),className:"px-3 py-2 rounded bg-brand-brown text-white text-xs font-semibold disabled:opacity-40",children:i?"Saved":"Save draft for Itinerary"}),t.jsx("button",{onClick:Ce,disabled:me||H||!(s.plan&&s.pricing),className:"px-3 py-2 rounded bg-brand-orange text-white text-xs font-semibold disabled:opacity-40",children:H?"Uploaded":"Upload Draft"}),t.jsxs("div",{className:"flex items-center gap-1 ml-2 text-[11px]",children:[t.jsxs("label",{className:"flex items-center gap-1 cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:A,onChange:e=>{e.target.checked?$e():(ne(!1),C(null))}})," Session"]}),$&&t.jsxs("span",{className:"text-green-700 flex items-center gap-1",children:["#",$.slice(0,6)," ",ue&&t.jsx("span",{title:"Scoped to token",className:"inline-block text-[10px] px-1 py-0.5 rounded bg-brand-orange text-white",children:"LOCK"})]})]})]}),t.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-[11px] text-brand-brown/70",children:[t.jsx("span",{className:"mr-1",children:"Next:"}),t.jsx(he,{to:"/itinerary",className:"underline hover:text-brand-brown",children:"Open Itinerary to import draft"}),t.jsx("span",{"aria-hidden":!0,children:"•"}),t.jsx(he,{to:"/plan-trip",className:"underline hover:text-brand-brown",children:"Open Trip Planner"})]}),t.jsxs("div",{className:"mt-2 w-full flex flex-col gap-2 bg-cream-sand/50 border border-cream-border rounded p-3",children:[t.jsxs("label",{className:"text-xs font-semibold text-brand-brown flex items-center gap-2",children:["Refine plan",R&&t.jsx("span",{className:"animate-pulse text-[10px] font-normal",children:"Refining…"}),A&&$&&t.jsx("span",{className:"text-[10px] bg-brand-brown text-white px-1.5 py-0.5 rounded",children:"Session"})]}),t.jsx("textarea",{value:g,onChange:e=>N(e.target.value),placeholder:"e.g. slow the pace; add beach and 2 more nights; swap Florence for Venice",rows:2,className:"w-full p-2 rounded border border-cream-border bg-cream focus:outline-none focus:ring-1 focus:ring-brand-orange/40 text-xs resize-y"}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{onClick:Se,disabled:R||!g.trim(),className:"px-3 py-1.5 rounded bg-brand-orange text-white text-xs font-semibold disabled:opacity-40",children:"Refine"}),i&&t.jsx("span",{className:"text-[11px] text-green-700",children:"Stored draft ready to import."})]}),t.jsx("p",{className:"text-[10px] text-brand-brown/60",children:'Tips: Keep it short and actionable — e.g., "add museum", "add 2 more nights", "swap to family‑friendly", "reduce budget by 10%".'}),H&&t.jsxs("p",{className:"text-[10px] text-green-700",children:["Draft stored on server (id ",H,")."]})]}),t.jsx("div",{"aria-live":"polite","aria-atomic":"true",className:"sr-only",ref:b}),D&&t.jsx("div",{role:"alert",className:"bg-red-100 border border-red-300 text-red-800 px-3 py-2 rounded text-sm",children:D}),t.jsxs("div",{className:"grid md:grid-cols-3 gap-4",children:[t.jsxs("section",{className:"p-3 rounded border border-cream-border bg-cream-sand/40 flex flex-col",children:[t.jsxs("h2",{className:"font-semibold text-sm mb-2 flex items-center gap-2",children:["Parse ",j?t.jsx("span",{className:"text-green-600",children:"✓"}):O&&a==="stream"?t.jsx("span",{className:"animate-pulse",children:"…"}):null]}),!j&&t.jsx("p",{className:"text-xs text-brand-brown/60",children:"Destinations, dates, travelers, budget, interests."}),j&&t.jsxs("div",{className:"text-xs space-y-1",children:[t.jsxs("div",{children:[t.jsx("span",{className:"font-semibold",children:"Destinations:"})," ",j.destinations.join(", ")||"—"]}),t.jsxs("div",{children:[t.jsx("span",{className:"font-semibold",children:"Dates:"})," ",j.startDate||"?"," → ",j.endDate||"?"," (",j.nights," nights)"]}),t.jsxs("div",{children:[t.jsx("span",{className:"font-semibold",children:"Travelers:"}),j.travelers?.adults!=null?`${j.travelers.adults} adults`:"—",j.travelers?.children?`, ${j.travelers.children} children`:""]}),t.jsxs("div",{children:[t.jsx("span",{className:"font-semibold",children:"Budget:"})," ",j.budget.amount?Z(j.budget.amount,j.budget.currency):"n/a"," ",j.budget.perPerson?"(per person)":""]}),t.jsxs("div",{children:[t.jsx("span",{className:"font-semibold",children:"Interests:"})," ",j.interests.join(", ")||"—"]})]})]}),t.jsxs("section",{className:"p-3 rounded border border-cream-border bg-cream-sand/40 flex flex-col",children:[t.jsxs("h2",{className:"font-semibold text-sm mb-2 flex items-center gap-2",children:["Plan ",M?t.jsx("span",{className:"text-green-600",children:"✓"}):j&&O&&a==="stream"?t.jsx("span",{className:"animate-pulse",children:"…"}):null]}),!M&&t.jsx("p",{className:"text-xs text-brand-brown/60",children:"Skeleton itinerary days & activities."}),M&&t.jsx("ol",{className:"text-xs list-decimal ml-4 space-y-1 max-h-60 overflow-auto pr-2",children:M.itinerary.map(e=>t.jsxs("li",{children:[t.jsxs("span",{className:"font-semibold",children:[e.title,":"]})," ",e.activities.join("; ")]},e.day))})]}),t.jsxs("section",{className:"p-3 rounded border border-cream-border bg-cream-sand/40 flex flex-col",children:[t.jsxs("h2",{className:"font-semibold text-sm mb-2 flex items-center gap-2",children:["Pricing ",P?t.jsx("span",{className:"text-green-600",children:"✓"}):M&&O&&a==="stream"?t.jsx("span",{className:"animate-pulse",children:"…"}):null]}),!P&&t.jsx("p",{className:"text-xs text-brand-brown/60",children:"Rough heuristic estimate with scaling."}),P&&t.jsxs("div",{className:"text-xs space-y-1",children:[t.jsxs("div",{children:[t.jsx("span",{className:"font-semibold",children:"Total:"})," ",Z(P.pricing.total,P.pricing.currency)]}),t.jsx("div",{className:"grid grid-cols-3 gap-2",children:Object.entries(P.pricing.breakdown).map(([e,n])=>t.jsxs("div",{children:[e,": ",Z(n,P.pricing.currency)]},e))}),t.jsx("div",{className:"italic text-[10px] text-brand-brown/70",children:P.pricing.note})]})]})]}),v&&a==="single"&&t.jsxs("details",{className:"mt-2 text-xs",children:[t.jsx("summary",{className:"cursor-pointer font-semibold",children:"Full JSON"}),t.jsx("pre",{className:"bg-cream-sand border border-cream-border rounded p-2 overflow-auto max-h-72 whitespace-pre-wrap break-all",children:JSON.stringify(v,null,2)})]}),A&&$&&k.length>0&&t.jsxs("div",{className:"mt-4 border border-cream-border rounded p-3 bg-cream-sand/40",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsxs("h2",{className:"text-sm font-semibold flex items-center gap-2",children:["Session History ",t.jsxs("span",{className:"text-[10px] font-normal text-brand-brown/60",children:[k.length," snapshot",k.length>1?"s":""]})]}),t.jsx("button",{onClick:()=>oe(e=>!e),className:"text-[11px] underline",children:ie?"Hide Diff":"Show Diff"})]}),t.jsx("ol",{className:"text-[11px] space-y-1 max-h-48 overflow-auto pr-2",children:k.map((e,n)=>t.jsxs("li",{className:"flex flex-col gap-0.5",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"px-1.5 py-0.5 rounded bg-brand-brown text-white text-[10px] uppercase",children:e.type}),t.jsx("span",{className:"text-brand-brown/70",children:new Date(e.at).toLocaleTimeString()})]}),t.jsxs("div",{className:"grid grid-cols-3 gap-2 text-[10px]",children:[t.jsxs("span",{children:["Nights: ",e.data.nights]}),t.jsxs("span",{children:["Dests: ",e.data.destinations.length]}),t.jsxs("span",{children:["Interests: ",e.data.interests.length]})]})]},n))}),ie&&k.length>1&&t.jsx(Je,{prev:k[k.length-2].data,curr:k[k.length-1].data})]})]})}function Je({prev:r,curr:o}){const a=o.interests.filter(i=>!r.interests.includes(i)),c=o.nights-r.nights,s=o.destinations.length-r.destinations.length,h=i=>t.jsx("span",{className:"inline-block px-1.5 py-0.5 rounded bg-brand-orange text-white text-[10px] mr-1",children:i}),v=(r.itinerary||[]).reduce((i,y)=>(i[y.day]=y,i),{}),S=(o.itinerary||[]).reduce((i,y)=>(i[y.day]=y,i),{}),D=Object.keys(S).filter(i=>!v[i]),m=Object.keys(v).filter(i=>!S[i]),g=[],N=[];Object.keys(S).forEach(i=>{if(v[i]){const y=new Set(v[i].activities||[]),$=new Set(S[i].activities||[]);for(const C of $)y.has(C)||g.push({day:i,a:C});for(const C of y)$.has(C)||N.push({day:i,a:C})}});const[R,E]=De.useState(!1);return t.jsxs("div",{className:"mt-3 text-[11px] border-t border-cream-border pt-2",children:[t.jsx("h3",{className:"font-semibold mb-1 flex items-center gap-2",children:"Last Change"}),t.jsxs("div",{className:"space-y-1",children:[c!==0&&t.jsxs("div",{children:[h("NIGHTS")," ",c>0?`+${c}`:c," nights (prev ",r.nights," → ",o.nights,")"]}),a.length>0&&t.jsxs("div",{children:[h("INTERESTS")," Added: ",a.join(", ")]}),s!==0&&t.jsxs("div",{children:[h("DESTS")," ",s>0?`+${s}`:s," destinations (count)"]}),D.length>0&&t.jsxs("div",{children:[h("DAY+")," Added day(s): ",D.join(", ")]}),m.length>0&&t.jsxs("div",{children:[h("DAY-")," Removed day(s): ",m.join(", ")]}),g.length>0&&t.jsxs("div",{children:[h("ACT+")," ",g.slice(0,4).map(i=>`D${i.day}:${i.a}`).join(", "),g.length>4?"…":""]}),N.length>0&&t.jsxs("div",{children:[h("ACT-")," ",N.slice(0,4).map(i=>`D${i.day}:${i.a}`).join(", "),N.length>4?"…":""]}),c===0&&a.length===0&&s===0&&t.jsx("div",{className:"italic text-brand-brown/60",children:"No core field changes detected."})]}),(g.length>4||N.length>4)&&t.jsx("button",{onClick:()=>E(i=>!i),className:"mt-2 underline text-[10px]",children:R?"Hide full activity diff":"Show full activity diff"}),R&&t.jsxs("div",{className:"mt-2 grid sm:grid-cols-2 gap-3",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"font-semibold text-[10px] mb-1",children:["Added Activities (",g.length,")"]}),t.jsx("ul",{className:"space-y-0.5 max-h-40 overflow-auto pr-1",children:g.map((i,y)=>t.jsxs("li",{className:"truncate",children:["D",i.day,": ",i.a]},y))})]}),t.jsxs("div",{children:[t.jsxs("div",{className:"font-semibold text-[10px] mb-1",children:["Removed Activities (",N.length,")"]}),t.jsx("ul",{className:"space-y-0.5 max-h-40 overflow-auto pr-1",children:N.map((i,y)=>t.jsxs("li",{className:"truncate",children:["D",i.day,": ",i.a]},y))})]})]})]})}function qe(){return p.useEffect(()=>{const r=document.title;return document.title="Trip Assist | CollEco Travel",()=>{document.title=r}},[]),t.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:t.jsx(Me,{})})}export{qe as default};
