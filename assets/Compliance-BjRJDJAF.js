import{r as p,j as e}from"./index-BCXrhMbA.js";import{A as D}from"./AutoSyncBanner-DqNHLe4-.js";import{C}from"./ComplianceStatusCard-DZKLNJDw.js";import{V as T}from"./VerifiedBadge-BsM4-vEb.js";import{l as b,u as V,v as I}from"./providersApi-HoWWQ-2N.js";function y(i){return i?Number(i)<Date.now():!1}function g(i,o=30){if(!i)return!1;const f=Date.now(),a=Number(i)-f;return a>0&&a<=o*24*60*60*1e3}function L(){const[i,o]=p.useState([]),[f,a]=p.useState(!1),[h,t]=p.useState(""),[j,N]=p.useState(!1),w=["license","insurance","permit"];p.useEffect(()=>{(async()=>{try{a(!0),t("");const s=await b();o(s)}catch(s){t(s.message||"Failed to load providers")}finally{a(!1)}})()},[]);function A(s){let r=0,c=0,m=0;for(const l of s){const u=Array.isArray(l.documents)?l.documents:[],x=new Set(u.map(d=>d.docType));for(const d of w)x.has(d)||(m+=1);for(const d of u)y(d.expiresAt)||(g(d.expiresAt)?c+=1:r+=1)}return{valid:r,expiring:c,missing:m}}const v=j?(i||[]).filter(s=>s.verified):i||[],n=A(v);async function S(s){s.preventDefault();const r=s.currentTarget,c=r.providerId.value,m=r.docType.value,l=r.file.files?.[0],u=r.expiresAt.value?new Date(r.expiresAt.value).getTime():void 0;if(!(!c||!m||!l))try{a(!0),t(""),await V({providerId:c,docType:m,fileName:l.name,fileSize:l.size,expiresAt:u});const x=await b();o(x),r.reset()}catch(x){t(x.message||"Upload failed")}finally{a(!1)}}async function E(s){try{a(!0),t(""),await I(s,!0);const r=await b();o(r)}catch(r){t(r.message||"Verify failed")}finally{a(!1)}}return e.jsxs("div",{className:"text-brand-brown",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"ðŸ›¡ï¸ Compliance Center"}),e.jsx("div",{className:"mb-3",children:e.jsx(D,{message:"Documents are validated automatically; expiry reminders are sent before deadlines."})}),e.jsx("div",{className:"mb-4",children:e.jsx(C,{valid:n.valid,expiring:n.expiring,missing:n.missing})}),e.jsxs("div",{className:"bg-cream-sand p-4 border border-cream-border rounded",children:[e.jsx("p",{className:"mb-2",children:"Upload and manage licenses, permits, and insurance documents."}),e.jsx("p",{className:"text-brand-brown/70 text-sm",children:"Automation-ready placeholder â€” upload tools and live validation results will appear here."}),e.jsxs("form",{className:"mt-3 flex flex-col sm:flex-row gap-2",onSubmit:S,children:[e.jsx("input",{name:"providerId",className:"border rounded px-2 py-1 flex-1",placeholder:"Provider ID (e.g., hotel-123)",required:!0}),e.jsxs("select",{name:"docType",className:"border rounded px-2 py-1",children:[e.jsx("option",{value:"license",children:"Business license"}),e.jsx("option",{value:"insurance",children:"Insurance certificate"}),e.jsx("option",{value:"permit",children:"Operating permit"})]}),e.jsx("input",{name:"file",type:"file",className:"border rounded px-2 py-1"}),e.jsx("input",{name:"expiresAt",type:"date",className:"border rounded px-2 py-1","aria-label":"Expiry date"}),e.jsx("button",{className:"px-3 py-1.5 bg-brand-orange text-white rounded",children:"Upload"})]}),h?e.jsx("div",{className:"text-sm text-red-600 mt-2",children:h}):null,f?e.jsx("div",{className:"text-sm text-brand-brown/70 mt-2",children:"Loadingâ€¦"}):null,e.jsxs("div",{className:"mt-4",children:[n.expiring>0?e.jsxs("div",{className:"mb-2 text-sm flex items-center gap-2 bg-amber-50 border border-amber-200 text-amber-800 px-2 py-1 rounded",children:[e.jsx("span",{className:"font-medium",children:"Heads up:"}),e.jsxs("span",{children:[n.expiring," document",n.expiring>1?"s":""," expiring soon."]})]}):null,e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("div",{className:"font-semibold",children:"Providers"}),e.jsxs("label",{className:"text-sm flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",className:"accent-brand-orange",checked:j,onChange:s=>N(s.target.checked)}),e.jsx("span",{children:"Verified only"})]})]}),e.jsx("ul",{className:"space-y-2",children:(v||[]).map(s=>e.jsxs("li",{className:"border border-cream-border rounded p-2 bg-cream",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"font-semibold",children:[s.name||s.id," ",e.jsx(T,{verified:s.verified})]}),e.jsxs("div",{className:"text-xs text-brand-brown/70",children:["ID: ",s.id]})]}),s.verified?null:e.jsx("button",{onClick:()=>E(s.id),className:"text-xs px-2 py-1 rounded bg-emerald-600 text-white",children:"Mark Verified"})]}),(s.documents||[]).length?e.jsx("ul",{className:"text-sm mt-2",children:s.documents.map(r=>e.jsxs("li",{className:"flex items-center justify-between border-t border-cream-border py-1",children:[e.jsxs("span",{children:[r.docType," â€” ",r.fileName," ",e.jsxs("span",{className:"text-xs text-brand-brown/60",children:["(",Math.ceil((r.fileSize||0)/1024)," KB)"]}),r.expiresAt?e.jsxs("span",{className:"ml-2 text-xs text-brand-brown/70",children:["Exp: ",new Date(r.expiresAt).toLocaleDateString()]}):null]}),e.jsxs("span",{className:"text-xs text-brand-brown/70 flex items-center gap-2",children:[y(r.expiresAt)?e.jsx("span",{className:"px-1.5 py-0.5 rounded bg-red-100 text-red-700 border border-red-200",children:"Expired"}):g(r.expiresAt)?e.jsx("span",{className:"px-1.5 py-0.5 rounded bg-amber-100 text-amber-800 border border-amber-200",children:"Expiring soon"}):null,r.status||"pending"]})]},r.id))}):null]},s.id))})]})]})]})}export{L as default};
