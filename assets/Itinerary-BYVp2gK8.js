import{j as e,c as O,r as d,R as be}from"./index-BCXrhMbA.js";import{A as Ce}from"./AutoSyncBanner-DqNHLe4-.js";import{u as De,L as Ee,c as Ie,s as Re,a as Ae}from"./useClickOutside-BFntQg3a.js";import{E as Oe}from"./jspdf.es.min-C6ZdERfm.js";import{u as Me}from"./useBasketState-zQ4Hh54l.js";import{F as Fe,P as _e}from"./PaymentButton-Bhbv8eCk.js";import"./unsupportedIterableToArray-4EWRbQKi.js";import"./payments-B5qOTW8F.js";import"./client-DmVibFEL.js";function Le({title:l,children:u,onClose:p,actions:j}){return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:p}),e.jsxs("div",{className:"relative bg-white rounded shadow-lg w-full max-w-md mx-4 p-5 animate-fadeIn border border-brand-gold text-brand-orange",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-brand-orange",children:l}),e.jsx("button",{onClick:p,className:"text-sm px-2 py-1 rounded hover:bg-brand-gold/10 text-brand-gold",children:"✕"})]}),e.jsx("div",{className:"mb-4 max-h-[60vh] overflow-y-auto pr-1",children:u}),e.jsx("div",{className:"flex justify-end gap-2",children:j})]})]})}function Te({day:l,date:u,children:p}){return e.jsxs("div",{className:"rounded border border-cream-border bg-cream p-4 text-brand-brown",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("h4",{className:"font-semibold",children:["Day ",l]}),u?e.jsx("span",{className:"text-sm text-brand-brown/70",children:u}):null]}),e.jsx("div",{className:"space-y-3",role:"list","aria-label":`Itinerary items for day ${l}`,children:p})]})}function Be({title:l,subtitle:u,time:p,notes:j,onAdd:w,onRemove:k}){return e.jsxs("div",{className:"rounded border border-cream-border bg-cream-sand p-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-brand-brown",children:l}),u?e.jsx("div",{className:"text-sm text-brand-brown/70",children:u}):null,p?e.jsx("div",{className:"text-xs text-brand-brown/60 mt-0.5",children:p}):null]}),e.jsxs("div",{className:"flex gap-2",children:[w?e.jsx("button",{className:"px-2 py-1 text-sm rounded border border-brand-brown text-brand-brown hover:bg-brand-brown/10",onClick:w,children:"Add"}):null,k?e.jsx("button",{className:"px-2 py-1 text-sm rounded border border-cream-border text-brand-brown hover:bg-cream-hover",onClick:k,children:"Remove"}):null]})]}),j?e.jsx("p",{className:"text-sm text-brand-brown/80 mt-2",children:j}):null]})}function Pe({value:l,onChange:u,placeholder:p="Capture a memory… (this saves automatically)",rows:j=2}){return e.jsxs("div",{className:"rounded border border-cream-border bg-cream p-2",children:[e.jsx("textarea",{className:"w-full resize-none bg-transparent outline-none text-sm text-brand-brown placeholder:text-brand-brown/50",rows:j,value:l,onChange:w=>u?.(w.target.value),placeholder:p}),e.jsx("div",{className:"text-[11px] text-brand-brown/60",children:"Memories sync to your itinerary and can be exported to PDF later."})]})}function Ye(){const[l,u]=De(),[p,j]=O("basketAutoSync:v1",!0),{basket:w,updateDay:k,removeFromBasket:E,reorderWithin:C}=Me(),c=d.useRef(null),f=d.useRef(null),[h,m]=O("itineraryReorderDay:v1",null),[y,N]=O("itineraryBulkModeDay:v1",null),[I,S]=d.useState({}),[P,$]=d.useState(null),[Y,z]=d.useState(""),M=d.useRef(null),[G,me]=O("itineraryHighContrastFocus:v1",!1),[J,xe]=O("itineraryEnableToasts:v1",!0),[X,U]=d.useState([]),[ee,he]=O("itineraryAnimations:v1",!0),[re,pe]=O("itineraryHideAI:v1",!1),[K,q]=d.useState(null),[fe,V]=d.useState(!1),[T,Q]=d.useState(""),b=d.useRef([]),g=d.useRef([]),[ze,B]=d.useState(0),[te,ne]=d.useState(!1);d.useRef({active:!1,timer:null,baseSnapshot:null});const se=d.useRef(()=>{}),ae=d.useRef(()=>{});function F(r,t){const n=JSON.parse(JSON.stringify(r));b.current.push({trip:n,label:t}),g.current=[],b.current.length>50&&b.current.shift(),B(a=>a+1)}function oe(){if(!b.current.length)return;const r=JSON.parse(JSON.stringify(l)),t=b.current.pop();g.current.push({trip:r,label:"redo-of-"+(t.label||"change")}),u(t.trip),B(n=>n+1)}function ie(){if(!g.current.length)return;const r=JSON.parse(JSON.stringify(l)),t=g.current.pop();b.current.push({trip:r,label:"undo-of-"+(t.label||"change")}),u(t.trip),B(n=>n+1)}se.current=oe,ae.current=ie,d.useEffect(()=>{const r=t=>{const n=t.key.toLowerCase();(t.ctrlKey||t.metaKey)&&n==="z"&&!t.shiftKey?(t.preventDefault(),se.current()):(t.ctrlKey||t.metaKey)&&n==="z"&&t.shiftKey&&(t.preventDefault(),ae.current())};return window.addEventListener("keydown",r),()=>window.removeEventListener("keydown",r)},[]),d.useEffect(()=>{try{const r=localStorage.getItem("aiItineraryDraft:v1");if(r){const t=JSON.parse(r);q(t)}}catch{}},[l.days]);const R=T.trim().length>0;d.useEffect(()=>{R&&(m(null),N(null))},[R,m,N]);function le(r){if(!K)return;const t={};(K.itinerary||[]).forEach(n=>{const a=String(n.day||n.dayNumber||n.dayIndex||n.day||n.day===0?n.day:n.day||n.dayNumber||1);t[a]||(t[a]=[]),t[a].push({id:"ai-"+n.day+"-"+Math.random().toString(36).slice(2),title:n.title||`Day ${n.day}`,time:"Flexible",subtitle:(n.activities||[]).join(", "),_aiSource:!0})}),r==="replace"?(F(l,"ai-replace"),u(n=>({...n,days:t}))):r==="merge"&&(F(l,"ai-merge"),u(n=>{const a={...n.days};return Object.keys(t).forEach(o=>{a[o]=[...a[o]||[],...t[o]]}),{...n,days:a}}));try{localStorage.removeItem("aiItineraryDraft:v1")}catch{}q(null),V(!1),_("Draft imported")}function A(r,t){u(n=>(F(n,t),r(n)))}function ye(r,t){if(!I[r]||!I[r].size)return;const n=I[r],a=(l.days[r]||[]).filter(o=>n.has(o.id));a.length&&(A(o=>{const s=(o.days[r]||[]).filter(x=>!n.has(x.id)),i=[...o.days[t]||[],...a];return{...o,days:{...o.days,[r]:s,[t]:i}}},"bulkMove"),a.forEach(o=>{o._basketSource&&k(o.id,Number(t))}),S(o=>({...o,[r]:new Set})),N(null))}function ge(r){if(y===r){N(null);return}N(r),m(null),S(t=>({...t,[r]:new Set(t[r]||[])}))}function ve(r,t){S(n=>{const a=new Set(n[r]||[]);return a.has(t)?a.delete(t):a.add(t),{...n,[r]:a}})}function je(r){m(h===r?null:r)}d.useEffect(()=>{h&&!l.days[h]&&m(null),y&&!l.days[y]&&N(null)},[l.days,h,y,m,N]);function we(r,t,n){c.current={day:t,index:n},r.dataTransfer.effectAllowed="move"}function Ne(r,t,n){f.current={day:t,index:n}}const ce=()=>{const r=c.current,t=f.current;if(!r||!t||r.day!==t.day||r.index===t.index){c.current=f.current=null;return}let n=[];A(a=>{const o=[...a.days[r.day]||[]],[s]=o.splice(r.index,1);return o.splice(t.index,0,s),n=o.filter(i=>i._basketSource).map(i=>i.id),{...a,days:{...a.days,[r.day]:o}}},"reorder"),n.length&&C(n),_(`Reordered to position ${t.index+1} in day ${t.day}`),c.current=f.current=null};function _(r){if(M.current&&(M.current.textContent=r,setTimeout(()=>{M.current&&M.current.textContent===r&&(M.current.textContent="")},2e3)),J){const t=Date.now()+Math.random().toString(36).slice(2);U(n=>{const a=[...n,{id:t,msg:r}];return a.length>4&&a.shift(),a}),setTimeout(()=>{U(n=>n.filter(a=>a.id!==t))},3500)}}d.useEffect(()=>{p&&u(r=>{let t={...r,days:{...r.days}},n=!1;const a=new Set(w.map(o=>o.id));return Object.keys(t.days).forEach(o=>{const s=(t.days[o]||[]).filter(i=>!(i._basketSource&&!a.has(i.id)));s.length!==(t.days[o]||[]).length&&(t.days[o]=s,n=!0)}),w.forEach(o=>{const s=String(o.day||1),i=(t.days[s]||[]).find(x=>x.id===o.id);if(Object.keys(t.days).forEach(x=>{x!==s&&(t.days[x]||[]).some(v=>v.id===o.id&&v._basketSource)&&(t.days[x]=t.days[x].filter(v=>v.id!==o.id),n=!0)}),!i){const x=t.days[s]||[];t.days[s]=[...x,{...o,time:o.time||"Flexible",_basketSource:!0}],n=!0}}),n?t:r})},[w,p,u]);const de=d.useMemo(()=>{const r=[];return Object.keys(l.days).forEach(t=>{(l.days[t]||[]).forEach(n=>r.push({name:n.title,amount:50}))}),r.length?r:[{name:"Itinerary deposit",amount:100}]},[l]),ke=()=>{const r=new Oe;r.setFontSize(16),r.text("Your CollEco Itinerary",14,20),r.setFontSize(11),r.text("This PDF export includes your day plan and memories.",14,28);let t=40;Object.keys(l.days).sort((a,o)=>Number(a)-Number(o)).forEach(a=>{r.setFont(void 0,"bold"),r.text(`Day ${a}`,14,t),t+=8,r.setFont(void 0,"normal"),(l.days[a]||[]).forEach(s=>{r.text(`• ${s.title}${s.subtitle?" — "+s.subtitle:""}`,18,t),t+=6});const o=l.memories?.[a];o&&(r.text(`Notes: ${o}`,18,t),t+=8),t+=4,t>270&&(r.addPage(),t=20)}),r.save("itinerary.pdf")};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"px-6 py-8 text-brand-brown "+(G?"focus-visible:outline-none [&_*:focus-visible]:outline [&_*:focus-visible]:outline-2 [&_*:focus-visible]:outline-offset-2 [&_*:focus-visible]:outline-brand-brown":""),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Itinerary"}),e.jsxs("div",{className:"flex items-center gap-2 relative",children:[e.jsxs("div",{className:"hidden sm:flex items-center gap-2 mr-2",children:[e.jsx("input",{value:T,onChange:r=>Q(r.target.value),placeholder:"Search itinerary…","aria-label":"Search itinerary items",className:"px-2 py-1 text-sm border border-cream-border rounded bg-white w-48"}),R&&e.jsx("button",{onClick:()=>Q(""),className:"text-xs underline text-brand-brown/70 hover:text-brand-brown",children:"Clear"})]}),(b.current.length>0||g.current.length>0)&&e.jsxs("div",{className:"flex items-center gap-1 bg-white border border-cream-border rounded-lg px-2 py-1 shadow-sm",children:[e.jsx("button",{disabled:!b.current.length,onClick:oe,className:"px-2 py-1 rounded text-xs font-medium transition-colors "+(b.current.length?"text-brand-brown hover:bg-cream":"text-gray-400 cursor-not-allowed"),title:b.current.length?`Undo (${b.current[b.current.length-1].label||"change"}) – Ctrl/Cmd+Z`:"Nothing to undo",children:"↶"}),e.jsx("div",{className:"w-px h-4 bg-cream-border"}),e.jsx("button",{disabled:!g.current.length,onClick:ie,className:"px-2 py-1 rounded text-xs font-medium transition-colors "+(g.current.length?"text-brand-brown hover:bg-cream":"text-gray-400 cursor-not-allowed"),title:g.current.length?`Redo (${g.current[g.current.length-1].label||"change"}) – Ctrl/Cmd+Shift+Z`:"Nothing to redo",children:"↷"}),e.jsx("div",{className:"w-px h-4 bg-cream-border"}),e.jsx("button",{onClick:()=>ne(r=>!r),className:"px-2 py-1 rounded text-xs font-medium text-brand-brown hover:bg-cream",title:"View change history",children:"📋"})]}),te&&e.jsxs("div",{className:"absolute right-0 top-full mt-2 w-56 max-h-60 overflow-auto bg-white border border-cream-border rounded shadow text-xs p-2 space-y-1 z-50",children:[e.jsx("div",{className:"font-semibold mb-1",children:"Undo Stack (latest first)"}),b.current.slice().reverse().slice(0,10).map((r,t)=>{const n=b.current.length-1-t;return e.jsxs("button",{onClick:()=>{const a=JSON.parse(JSON.stringify(l));g.current.push({trip:a,label:"jump-from-history"});const o=b.current[n];b.current=b.current.slice(0,n),u(o.trip),B(s=>s+1),ne(!1)},className:"w-full text-left px-2 py-1 rounded hover:bg-cream focus:outline-none focus:ring-1 focus:ring-brand-brown",children:[n+1,". ",r.label||"change"]},n)}),!b.current.length&&e.jsx("div",{className:"text-brand-brown/60 italic",children:"Empty"})]}),K&&e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>V(r=>!r),className:"px-3 py-2 rounded bg-brand-brown text-white text-sm font-medium hover:bg-brand-brown/90",children:"Draft"}),fe&&e.jsxs("div",{className:"absolute right-0 mt-2 w-72 bg-white border border-cream-border rounded shadow p-3 text-xs space-y-2 z-50",children:[e.jsx("div",{className:"font-semibold text-brand-brown mb-1",children:"Draft detected"}),e.jsx("p",{className:"text-brand-brown/70",children:"A stored draft is available. Import it into your current itinerary."}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>le("merge"),className:"px-2 py-1 rounded bg-brand-orange text-white hover:bg-brand-highlight",children:"Merge"}),e.jsx("button",{onClick:()=>le("replace"),className:"px-2 py-1 rounded bg-red-600 text-white hover:bg-red-500",children:"Replace"}),e.jsx("button",{onClick:()=>{try{localStorage.removeItem("aiItineraryDraft:v1")}catch{}q(null),V(!1)},className:"px-2 py-1 rounded border border-cream-border hover:bg-cream-sand",children:"Dismiss"})]}),e.jsx("p",{className:"text-[10px] text-brand-brown/50",children:"Merge appends new days/items. Replace discards current days."})]})]}),e.jsx($e,{highContrastFocus:G,setHighContrastFocus:me,enableToasts:J,setEnableToasts:xe,animationsEnabled:ee,setAnimationsEnabled:he}),e.jsx("button",{onClick:ke,className:"px-3 py-2 rounded border border-brand-brown text-brand-brown hover:bg-brand-brown/10",children:"Export PDF"})]})]}),e.jsx("p",{className:"mb-2 text-brand-brown/80",children:"Plan each day and capture memories — everything stays in sync."}),e.jsx("div",{className:"sm:hidden mb-3",children:e.jsx("input",{value:T,onChange:r=>Q(r.target.value),placeholder:"Search itinerary…","aria-label":"Search itinerary items",className:"w-full px-2 py-1 text-sm border border-cream-border rounded bg-white"})}),R&&e.jsxs("div",{className:"mb-3 text-xs bg-white/60 border border-cream-border rounded p-2 text-brand-brown/70",role:"status","aria-live":"polite",children:["Filtering items by “",T,"”. Reorder and bulk select are disabled while searching."]}),h&&e.jsx("div",{className:"mb-4 text-xs bg-white/60 border border-cream-border rounded p-2 text-brand-brown/70",role:"status","aria-live":"polite",children:"Reorder mode: Use the drag handles with mouse, or keyboard – Tab to item, Space to pick up, Arrow Up/Down to move, Enter to drop, Esc to cancel."}),e.jsx("div",{className:"mb-4",children:e.jsx(Ce,{message:"Itinerary updates will reflect in quotes and bookings automatically."})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsx(Ee,{steps:Ie(l,p?w.length:0)}),e.jsx("div",{className:"md:col-span-2 rounded border border-cream-border bg-cream p-4",children:e.jsx("div",{className:"grid grid-cols-1 gap-4",children:Object.keys(l.days).length===0?e.jsxs("div",{className:"text-brand-brown/70",children:["No items yet. ",p?"Add products to your basket on Trip Planner.":"Basket auto-sync disabled."]}):Object.keys(l.days).sort((r,t)=>Number(r)-Number(t)).map(r=>e.jsxs(Te,{day:r,onDragOver:t=>{h&&t.preventDefault()},onDrop:t=>{if(!h)return;const n=c.current;n&&n.day!==r&&(A(a=>{const o=[...a.days[n.day]||[]],[s]=o.splice(n.index,1),i=[...a.days[r]||[],s];return{...a,days:{...a.days,[n.day]:o,[r]:i}}},"move-day"),l.days[n.day]?.[n.index]?._basketSource&&k(l.days[n.day][n.index].id,Number(r)),c.current=f.current=null)},children:[e.jsxs("div",{className:"flex justify-between gap-3 mb-1 text-xs",children:[y===r&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-brand-brown/70",children:"Move selected to:"}),e.jsxs("select",{className:"border border-cream-border rounded px-1 py-0.5",onChange:t=>{const n=t.target.value;n&&ye(r,n)},defaultValue:"",children:[e.jsx("option",{value:"",disabled:!0,children:"Day..."}),Object.keys(l.days).sort((t,n)=>Number(t)-Number(n)).filter(t=>t!==r).map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsxs("div",{className:"flex gap-3",children:[!R&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>ge(r),className:"underline text-brand-brown/70 hover:text-brand-brown",children:y===r?"Exit bulk select":"Bulk select"}),e.jsx("button",{onClick:()=>je(r),className:"underline text-brand-brown/70 hover:text-brand-brown",children:h===r?"Finish reorder":"Reorder"})]}),R&&e.jsx("span",{className:"text-brand-brown/50",children:"Actions disabled in search"})]})]}),(l.days[r]||[]).filter(t=>!(re&&t._aiSource)).filter(t=>{if(!R)return!0;const n=T.trim().toLowerCase();return(t.title||"").toLowerCase().includes(n)||(t.subtitle||"").toLowerCase().includes(n)}).map((t,n)=>{const a=t._basketSource,o=h===r&&c.current&&c.current.day===r&&c.current.index===n;return e.jsxs("div",{role:"listitem","aria-label":t.title,"aria-grabbed":h===r?o:void 0,tabIndex:h===r?0:-1,className:"relative group outline-none "+(h===r?"ring-1 ring-transparent ":"")+(o?" opacity-40":""),onKeyDown:s=>{if(h!==r)return;const i=s.key;if(i===" "){if(s.preventDefault(),c.current&&c.current.day===r&&c.current.index===n){c.current=null,_("Cancelled drag");return}c.current={day:r,index:n},_(`Picked up ${t.title}`)}else if(i==="Escape")c.current&&(c.current=null,_("Cancelled drag"),s.preventDefault());else if(i==="Enter")c.current&&f.current&&f.current.day===r&&(ce(),s.preventDefault());else if(i==="ArrowUp"||i==="ArrowDown"){if(!c.current||c.current.day!==r)return;s.preventDefault();const x=c.current.index,v=(l.days[r]||[]).length,L=x+(i==="ArrowUp"?-1:1);if(L<0||L>=v)return;f.current={day:r,index:L},A(Z=>{const H=[...Z.days[r]||[]],[Se]=H.splice(x,1);H.splice(L,0,Se),c.current={day:r,index:L};const ue=H.filter(W=>W._basketSource).map(W=>W.id);return ue.length&&C(ue),{...Z,days:{...Z.days,[r]:H}}},"keyboard-drag"),_(`Moved to position ${L+1} in day ${r}`)}},onDragEnter:s=>Ne(s,r,n),onDragEnd:ce,children:[h===r&&e.jsx("div",{draggable:!0,onDragStart:s=>we(s,r,n),className:"absolute -left-5 top-2 w-3 h-3 cursor-grab active:cursor-grabbing flex items-center justify-center text-[9px] text-brand-brown/60",title:"Drag to reorder",children:"☰"}),y===r&&e.jsx("div",{className:"absolute -left-6 top-2",children:e.jsx("input",{type:"checkbox",checked:I[r]?.has(t.id)||!1,onChange:()=>ve(r,t.id)})}),e.jsx(Be,{title:t.title,subtitle:t.subtitle,time:t.time}),t._aiSource&&e.jsx("span",{className:"absolute right-1 bottom-1 text-[9px] tracking-wide px-1.5 py-0.5 rounded bg-brand-orange text-white/95 font-semibold uppercase shadow-sm",children:"Suggested"}),c.current&&h===r&&f.current&&f.current.day===r&&f.current.index===n&&c.current.index!==n&&e.jsx("div",{className:"absolute -inset-1 border-2 border-dashed border-brand-brown rounded pointer-events-none","aria-hidden":"true"}),e.jsx("div",{className:"absolute left-1 top-1 text-[10px] px-1 py-0.5 rounded bg-white/80 border border-cream-border text-brand-brown/70",children:t.price>0?"PAID":"INCLUDED"}),h===r&&e.jsxs("div",{className:"absolute right-1 top-1 flex flex-col gap-1 opacity-70 group-hover:opacity-100",children:[e.jsx("button",{"aria-label":"Move up",className:"text-[10px] px-1 py-0.5 rounded bg-white border border-cream-border",onClick:()=>{A(s=>{const i=[...s.days[r]||[]];if(n===0)return s;const x=i[n-1];i[n-1]=i[n],i[n]=x;const v=i.filter(D=>D._basketSource).map(D=>D.id);return C(v),{...s,days:{...s.days,[r]:i}}},"keyboard-reorder-up")},children:"↑"}),e.jsx("button",{"aria-label":"Move down",className:"text-[10px] px-1 py-0.5 rounded bg-white border border-cream-border",onClick:()=>{A(s=>{const i=[...s.days[r]||[]];if(n===i.length-1)return s;const x=i[n+1];i[n+1]=i[n],i[n]=x;const v=i.filter(D=>D._basketSource).map(D=>D.id);return C(v),{...s,days:{...s.days,[r]:i}}},"keyboard-reorder-down")},children:"↓"})]}),a&&e.jsxs("div",{className:"mt-1 flex items-center gap-2 text-xs text-brand-brown/70",children:[e.jsx("label",{children:"Day:"}),e.jsx("select",{className:"border border-cream-border rounded px-1 py-0.5 bg-white",value:t.day||r,onChange:s=>{const i=s.target.value;F(l,"change-item-day"),k(t.id,Number(i))},children:Object.keys(l.days).sort((s,i)=>Number(s)-Number(i)).map(s=>e.jsx("option",{value:s,children:s},s))}),e.jsx("button",{className:"ml-2 text-red-600 hover:underline",onClick:()=>{F(l,"remove-linked"),E(t.id)},title:"Remove from itinerary (removes from basket)",children:"Remove"})]}),!a&&e.jsx("div",{className:"mt-1 flex items-center gap-2 text-[11px] text-brand-brown/60",children:e.jsx("button",{className:"underline",onClick:()=>$({item:t,originDay:r}),children:"Repeat on days…"})})]},n)}),e.jsx(Pe,{value:l.memories?.[r]||"",onChange:t=>{u(n=>(F(n,"memory-edit"),Re(n,r,t)))}})]},r))})})]}),e.jsxs("div",{className:"mb-8 mt-4 bg-cream rounded border border-cream-border p-4 text-sm flex items-start gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{id:"toggleLink",type:"checkbox",checked:p,onChange:r=>j(r.target.checked)}),e.jsx("label",{htmlFor:"toggleLink",className:"cursor-pointer select-none",children:"Automatically reflect selected quote experiences in itinerary progress"})]}),e.jsxs("div",{className:"flex items-center gap-2 ml-auto",children:[e.jsx("input",{id:"toggleAIHide",type:"checkbox",checked:re,onChange:r=>pe(r.target.checked)}),e.jsx("label",{htmlFor:"toggleAIHide",className:"cursor-pointer select-none text-xs",children:"Hide suggested items"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsx("div",{className:"md:col-span-2",children:e.jsx(Fe,{items:de,currency:"USD"})}),e.jsx("div",{className:"flex items-start",children:e.jsx(_e,{items:de,currency:"USD"})})]})]}),e.jsx("div",{"aria-live":"polite","aria-atomic":"true",className:"sr-only",ref:M}),J&&X.length>0&&e.jsx("div",{className:"fixed bottom-4 left-1/2 -translate-x-1/2 z-50 flex flex-col gap-2 w-[90%] max-w-sm",children:X.map(r=>e.jsxs("div",{className:"pointer-events-auto bg-brand-brown text-white text-sm rounded shadow px-3 py-2 flex items-start gap-3 "+(ee?"toast-fade":""),"aria-live":"off","aria-hidden":"true",children:[e.jsx("div",{className:"flex-1 break-words",children:r.msg}),e.jsx("button",{onClick:()=>U(t=>t.filter(n=>n.id!==r.id)),className:"text-white/70 hover:text-white focus:outline-none focus:ring-1 focus:ring-white rounded","aria-label":"Dismiss notification",children:"×"})]},r.id))}),te&&e.jsxs("div",{className:"mt-1 w-56 max-h-60 overflow-auto bg-white border border-cream-border rounded shadow text-xs p-2 space-y-1",children:[e.jsx("div",{className:"font-semibold mb-1",children:"Undo Stack (latest first)"}),b.current.slice().reverse().slice(0,10).map((r,t)=>{const n=b.current.length-1-t;return e.jsxs("button",{onClick:()=>{const a=JSON.parse(JSON.stringify(l));g.current.push({trip:a,label:"jump-from-history"});const o=b.current[n];b.current=b.current.slice(0,n),u(o.trip),B(s=>s+1)},className:"w-full text-left px-2 py-1 rounded hover:bg-cream focus:outline-none focus:ring-1 focus:ring-brand-brown",children:[n+1,". ",r.label||"change"]},n)})]}),P&&e.jsxs(Le,{title:"Repeat Item on Additional Days",onClose:()=>{$(null),z("")},actions:[e.jsx("button",{onClick:()=>{$(null),z("")},className:"px-3 py-1 rounded border border-cream-border hover:bg-cream-sand text-sm",children:"Cancel"},"cancel"),e.jsx("button",{onClick:()=>{const r=Y.split(/[,\s]+/).map(n=>n.trim()).filter(Boolean),t=Array.from(new Set(r));t.length&&(A(n=>{const a={...n,days:{...n.days}};return t.forEach(o=>{const s=Number(o);if(!Number.isFinite(s)||s<=0)return;const i=String(s),x=a.days[i]||[];x.some(v=>v.id===P.item.id)||(a.days[i]=[...x,{...P.item}])}),a},"repeat-multi-day"),$(null),z(""))},className:"px-3 py-1 rounded bg-brand-brown text-white text-sm hover:bg-brand-brown/90",children:"Apply"},"apply")],children:[e.jsx("p",{className:"text-sm mb-3",children:"Enter additional day numbers (comma or space separated). Existing occurrences are skipped."}),e.jsx("input",{autoFocus:!0,value:Y,onChange:r=>z(r.target.value),placeholder:"e.g. 2, 4 5",className:"w-full border border-cream-border rounded px-2 py-1 text-sm mb-3"}),e.jsxs("p",{className:"text-xs text-brand-brown/60",children:["Invalid or duplicate day values are ignored. Original day: ",P.originDay]})]})]})}function $e({highContrastFocus:l,setHighContrastFocus:u,enableToasts:p,setEnableToasts:j,animationsEnabled:w,setAnimationsEnabled:k}){const[E,C]=be.useState(!1),c=be.useRef(null),f=Ae(()=>{C(!1),c.current?.focus()},E);function h(){try{localStorage.removeItem("itineraryHighContrastFocus:v1"),localStorage.removeItem("itineraryEnableToasts:v1"),localStorage.removeItem("itineraryReorderDay:v1"),localStorage.removeItem("itineraryBulkModeDay:v1"),localStorage.removeItem("itineraryAnimations:v1"),u(!1),j(!0),k(!0)}catch{}}return d.useEffect(()=>{if(E&&f.current){const m=f.current.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'),y=m?.[0],N=m?.[m.length-1];y&&y.focus();const I=S=>{S.key==="Tab"&&m&&m.length&&(S.shiftKey&&document.activeElement===y?(S.preventDefault(),N.focus()):!S.shiftKey&&document.activeElement===N&&(S.preventDefault(),y.focus()))};return document.addEventListener("keydown",I),()=>document.removeEventListener("keydown",I)}},[E]),e.jsxs("div",{className:"relative",children:[e.jsx("button",{ref:c,onClick:()=>C(m=>!m),"aria-haspopup":"dialog","aria-expanded":E,className:"px-3 py-2 rounded border border-brand-brown text-brand-brown hover:bg-brand-brown/10 text-sm",children:"Preferences"}),E&&e.jsxs("div",{ref:f,role:"dialog","aria-label":"Itinerary preferences",className:"absolute right-0 mt-2 w-64 bg-white border border-cream-border rounded shadow p-3 z-50 text-sm space-y-3",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:l,onChange:m=>u(m.target.checked)}),e.jsx("span",{children:"High contrast focus outlines"})]}),e.jsx("p",{className:"text-[11px] text-brand-brown/60 mt-1",children:"Improves keyboard navigability."})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:p,onChange:m=>j(m.target.checked)}),e.jsx("span",{children:"Enable visual toasts"})]}),e.jsx("p",{className:"text-[11px] text-brand-brown/60 mt-1",children:"Mirrors screen reader announcements."})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:w,onChange:m=>k(m.target.checked)}),e.jsx("span",{children:"Motion animations"})]}),e.jsx("p",{className:"text-[11px] text-brand-brown/60 mt-1",children:"Disable to reduce visual motion."})]}),e.jsxs("div",{className:"flex justify-end",children:[e.jsx("button",{onClick:h,className:"mr-auto text-[10px] underline text-brand-brown/60 hover:text-brand-brown",title:"Reset all itinerary preferences to defaults",children:"Reset"}),e.jsx("button",{onClick:()=>C(!1),className:"text-xs underline text-brand-brown/70 hover:text-brand-brown",children:"Close"})]})]})]})}export{Ye as default};
