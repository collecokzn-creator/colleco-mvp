import{j as e,r as x}from"./index-BCXrhMbA.js";import{a as j}from"./payments-B5qOTW8F.js";import{e as v}from"./client-DmVibFEL.js";function B({items:a=[],currency:t="USD",fees:r}){a.reduce((c,l)=>c+Math.max(0,Number(l.amount||0)),0);const i=r||C(a);return e.jsxs("div",{className:"border border-cream-border rounded p-3 bg-cream text-brand-brown text-sm",children:[e.jsx("div",{className:"font-semibold mb-2",children:"Price breakdown"}),e.jsx(m,{label:"Subtotal",value:i.subtotal,currency:t}),e.jsx(m,{label:"Payment processing",value:i.paymentProcessor,currency:t}),e.jsx(m,{label:"Platform fee",value:i.platformFee,currency:t}),e.jsx(m,{label:"Taxes",value:i.taxes,currency:t}),e.jsx("div",{className:"border-t border-cream-border mt-2 pt-2 font-semibold",children:e.jsx(m,{label:"Total",value:i.total,currency:t})})]})}function m({label:a,value:t,currency:r}){return e.jsxs("div",{className:"flex items-center justify-between py-0.5",children:[e.jsx("span",{children:a}),e.jsx("span",{children:N(t,r)})]})}function N(a,t){try{return new Intl.NumberFormat(void 0,{style:"currency",currency:t}).format(a)}catch{return`${t} ${a.toFixed(2)}`}}function C(a=[]){const t=a.reduce((o,u)=>o+Math.max(0,Number(u.amount||0)),0),r=Math.round(t*.029*100)/100+.3,i=Math.round(t*.05*100)/100,c=Math.round(t*.15*100)/100,l=Math.round((t+r+i+c)*100)/100;return{subtotal:t,paymentProcessor:r,platformFee:i,taxes:c,total:l}}function F({items:a=[],currency:t="USD"}){const[r,i]=x.useState(!1),[c,l]=x.useState(""),[o,u]=x.useState(null),[g,f]=x.useState(!1);function b(n,s={}){try{window&&window.dataLayer&&typeof window.dataLayer.push=="function"&&window.dataLayer.push({event:n,...s})}catch{}}async function h(){l(""),i(!0),u(null),f(!1);try{if("http://127.0.0.1:4001"){const d=await v({items:a,customer:{},currency:t,metadata:{source:"itinerary"}});if(!d||!d.booking)throw new Error("Booking creation failed");u({booking:d.booking,checkoutUrl:d.checkout?.checkoutUrl,fees:d.fees}),b("booking:created",{id:d.booking.id,ref:d.booking.ref});return}const s=j({items:a,currency:t,metadata:{source:"itinerary"}});u({sessionId:s.sessionId,checkoutUrl:s.checkoutUrl}),b("booking:created:mock",{sessionId:s.sessionId})}catch(n){l(n.message||"Payment failed")}finally{i(!1)}}function p(){if(!o)return;const n=o.checkoutUrl;if(n){const s=n.startsWith("/")?`${window.location.origin}${n}`:n;b("booking:proceed_to_payment",{bookingRef:o.booking?.ref||o.sessionId}),window.location.assign(s);return}if(o.booking&&o.booking.id){window.location.assign(`/payment-success?bookingId=${o.booking.id}`);return}window.location.assign("/bookings")}function k(){if(o&&o.booking&&o.booking.id){window.location.assign(`/payment-success?bookingId=${o.booking.id}`);return}window.location.assign("/bookings")}async function y(){const n=o?.booking?.ref||o?.sessionId||"";if(n)try{if(navigator.clipboard&&navigator.clipboard.writeText)await navigator.clipboard.writeText(n);else{const s=document.createElement("textarea");s.value=n,document.body.appendChild(s),s.select(),document.execCommand("copy"),s.remove()}f(!0),setTimeout(()=>f(!1),2e3),b("booking:ref_copied",{ref:n})}catch{}}return e.jsx("div",{children:o?e.jsxs("div",{className:"p-3 border rounded bg-gray-50 mt-2",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Booking"}),e.jsx("div",{className:"font-medium text-sm",children:o.booking?o.booking.ref:`Session ${o.sessionId}`}),o.booking&&o.booking.status?e.jsxs("div",{className:"text-xs text-gray-500",children:["Status: ",o.booking.status]}):null]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{onClick:y,className:"text-sm text-gray-600 hover:text-gray-800",children:g?"Copied!":"Copy ref"})})]}),o.fees?e.jsxs("div",{className:"mt-2 text-sm text-gray-700",children:["Total: ",o.fees.currency," ",o.fees.total]}):null,e.jsxs("div",{className:"mt-3 flex gap-2",children:[e.jsx("button",{onClick:p,className:"px-3 py-1 bg-brand-orange text-white rounded",children:"Proceed to payment"}),e.jsx("button",{onClick:k,className:"px-3 py-1 border rounded",children:"View booking"})]})]}):e.jsxs("div",{children:[e.jsx("button",{onClick:h,disabled:r,className:"px-4 py-2 bg-brand-orange text-white rounded hover:opacity-95 disabled:opacity-60",children:r?"Creating bookingâ€¦":"Pay securely"}),c?e.jsx("div",{className:"text-sm text-red-600 mt-1",children:c}):null]})})}export{B as F,F as P};
