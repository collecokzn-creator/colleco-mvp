import{r as d,j as e,L as x}from"./index-BCXrhMbA.js";import{c as g,g as p}from"./payments-B5qOTW8F.js";import{d as h}from"./client-DmVibFEL.js";function j(){const l=new URLSearchParams(window.location.search),o=l.get("sessionId"),[c,r]=d.useState("processing"),[s,a]=d.useState(null),m=l.get("bookingId");return d.useEffect(()=>{if(m){(async()=>{try{const i=await h(m);if(i&&i.booking){if(i.booking.pricing){const n=i.booking.pricing;a({id:i.booking.id,amount:n.total||0,currency:n.currency||"ZAR",items:n.items||[],pricing:n})}else{const n=i.booking.items?{total:i.booking.items.reduce((b,u)=>b+(Number(u.amount||u.price||0)||0),0)}:null;a({id:i.booking.id,amount:Number(n?.total||0),currency:"USD",items:i.booking.items||[]})}r("ok");return}r("error")}catch{r("error")}})();return}if(!o){r("error");return}const t=g(o)||p(o);t?(a(t),r("ok")):r("error")},[o,m]),e.jsxs("div",{className:"px-6 py-8 text-brand-brown",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Payment success"}),c==="processing"&&e.jsx("p",{className:"text-brand-brown/80",children:"Finalizing your payment…"}),c==="ok"&&e.jsxs("div",{className:"bg-cream-sand p-4 border border-cream-border rounded",children:[e.jsx("div",{className:"font-semibold mb-1",children:"Thank you! Your payment is confirmed."}),e.jsxs("div",{className:"text-sm text-brand-brown/80",children:["Reference: ",s?.id]}),s?.pricing?e.jsxs("div",{className:"mt-3 text-sm text-brand-brown/80",children:[e.jsx("div",{className:"font-semibold",children:"Pricing breakdown"}),e.jsxs("div",{className:"mt-1",children:["Subtotal: ",s.pricing.currency," ",Number(s.pricing.subtotal||0).toFixed(2)]}),e.jsxs("div",{children:["CollEco service fees: ",s.pricing.currency," ",Number(s.pricing.totalServiceFees||0).toFixed(2)]}),e.jsxs("div",{children:["Partner commission (",s.pricing.commissionTier||""," @ ",Math.round((s.pricing.commissionRate||0)*100),"%): ",s.pricing.currency," ",Number(s.pricing.commission||0).toFixed(2)]}),e.jsxs("div",{className:"font-semibold mt-1",children:["Partner receives: ",s.pricing.currency," ",Number(s.pricing.partnerReceives||0).toFixed(2)]}),e.jsxs("div",{className:"mt-1",children:["Total charged: ",s.pricing.currency," ",Number(s.pricing.total||0).toFixed(2)]})]}):s?.items?.length?e.jsxs("div",{className:"mt-3",children:[e.jsx("div",{className:"text-sm font-semibold mb-1",children:"Summary"}),e.jsx("ul",{className:"text-sm list-disc list-inside",children:s.items.map((t,i)=>e.jsxs("li",{children:[t.name," — $",Number(t.amount||0).toFixed(2)]},i))})]}):null,e.jsx("div",{className:"mt-4",children:e.jsx(x,{to:"/bookings",className:"px-3 py-2 bg-brand-orange text-white rounded",children:"Back to Bookings"})})]}),c==="error"&&e.jsx("p",{className:"text-red-600",children:"We couldn't find your session."})]})}export{j as default};
