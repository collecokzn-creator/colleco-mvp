import{r as c,j as t,e as _t,u as Rt,q as k,t as Ze,v as Ft,w as Xe,x as et,y as Bt,L as I,z as It,A as Ut,C as qt,D as zt}from"./index-BCXrhMbA.js";import{A as Ht}from"./AutoSyncBanner-DqNHLe4-.js";import{u as Wt,a as tt,L as Kt,c as Jt}from"./useClickOutside-BFntQg3a.js";import{u as Gt}from"./useBasketState-zQ4Hh54l.js";import{f as be}from"./currency-SRo7-frQ.js";function Me(d=[],u="dateAsc"){const j=Array.isArray(d)?d.slice():[],y=b=>{const m=Date.parse(b);return Number.isFinite(m)?m:NaN},g=u!=="dateDesc";return j.map(b=>({e:b,t:y(b?.date)})).sort((b,m)=>{const x=b.t,f=m.t,w=Number.isNaN(x),N=Number.isNaN(f);return w&&N?0:w?1:N?-1:g?x-f:f-x}).map(b=>b.e)}function Qt(d=[],u=[],j="dateAsc"){return Me([...d||[],...u||[]],j)}function Vt({open:d,onClose:u,onSave:j,initial:y={}}){const[g,b]=c.useState(y.city||""),[m,x]=c.useState(y.province||""),[f,w]=c.useState(y.country||"");return d?t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/30",children:t.jsxs("div",{className:"bg-white rounded shadow-lg border border-cream-border w-[min(28rem,92vw)] p-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("h3",{className:"font-semibold",children:"Set My Location"}),t.jsx("button",{onClick:u,"aria-label":"Close",className:"text-brand-brown/70 hover:text-brand-brown",children:"âœ•"})]}),t.jsx("p",{className:"text-sm text-brand-brown/70 mb-3",children:"This helps us apply â€œNear meâ€ filters quickly."}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2 mb-3",children:[t.jsx("input",{value:g,onChange:N=>b(N.target.value),placeholder:"City",className:"px-2 py-1 border border-cream-border rounded"}),t.jsx("input",{value:m,onChange:N=>x(N.target.value),placeholder:"Province/State",className:"px-2 py-1 border border-cream-border rounded"}),t.jsx("input",{value:f,onChange:N=>w(N.target.value),placeholder:"Country",className:"px-2 py-1 border border-cream-border rounded"})]}),t.jsxs("div",{className:"flex items-center justify-end gap-2",children:[t.jsx("button",{onClick:u,className:"text-sm px-3 py-1 rounded border border-cream-border bg-white hover:bg-cream-hover",children:"Cancel"}),t.jsx("button",{onClick:()=>j({city:g.trim(),province:m.trim(),country:f.trim()}),className:"text-sm px-3 py-1 rounded border border-brand-brown bg-brand-brown text-cream hover:bg-brand-brown/90",children:"Save"})]})]})}):null}const Yt={0:{text:"Clear",icon:"â˜€ï¸"},1:{text:"Mainly clear",icon:"ğŸŒ¤ï¸"},2:{text:"Partly cloudy",icon:"â›…"},3:{text:"Overcast",icon:"â˜ï¸"},45:{text:"Fog",icon:"ğŸŒ«ï¸"},48:{text:"Depositing rime fog",icon:"ğŸŒ«ï¸"},51:{text:"Light drizzle",icon:"ğŸŒ¦ï¸"},53:{text:"Moderate drizzle",icon:"ğŸŒ¦ï¸"},55:{text:"Dense drizzle",icon:"ğŸŒ§ï¸"},56:{text:"Light freezing drizzle",icon:"ğŸŒ§ï¸"},57:{text:"Dense freezing drizzle",icon:"ğŸŒ§ï¸"},61:{text:"Slight rain",icon:"ğŸŒ¦ï¸"},63:{text:"Moderate rain",icon:"ğŸŒ§ï¸"},65:{text:"Heavy rain",icon:"ğŸŒ§ï¸"},66:{text:"Light freezing rain",icon:"ğŸŒ§ï¸"},67:{text:"Heavy freezing rain",icon:"ğŸŒ§ï¸"},71:{text:"Slight snow",icon:"ğŸŒ¨ï¸"},73:{text:"Moderate snow",icon:"ğŸŒ¨ï¸"},75:{text:"Heavy snow",icon:"â„ï¸"},77:{text:"Snow grains",icon:"â„ï¸"},80:{text:"Rain showers (slight)",icon:"ğŸŒ¦ï¸"},81:{text:"Rain showers (moderate)",icon:"ğŸŒ§ï¸"},82:{text:"Rain showers (violent)",icon:"â›ˆï¸"},85:{text:"Snow showers (slight)",icon:"ğŸŒ¨ï¸"},86:{text:"Snow showers (heavy)",icon:"â„ï¸"},95:{text:"Thunderstorm",icon:"â›ˆï¸"},96:{text:"Thunderstorm with hail (slight)",icon:"â›ˆï¸"},99:{text:"Thunderstorm with hail (heavy)",icon:"â›ˆï¸"}};function rt(d){return Yt[d]||{text:"Unknown",icon:"â˜ï¸"}}const st=600*1e3,at=new Map,nt=new Map;async function Zt(d,u){const j=`${(d||"").toLowerCase()}|${(u||"").toLowerCase()}`,y=at.get(j);if(y&&Date.now()-y.ts<st)return y.data;const g=new URL("https://geocoding-api.open-meteo.com/v1/search");g.searchParams.set("name",d),g.searchParams.set("count","1"),g.searchParams.set("language","en"),g.searchParams.set("format","json"),u&&g.searchParams.set("country",u);const b=await fetch(g.toString());if(!b.ok)throw new Error("Failed to geocode");const m=await b.json(),x=Array.isArray(m.results)&&m.results[0];if(!x)throw new Error("Location not found");const f={lat:x.latitude,lon:x.longitude,name:x.name,country_code:x.country_code};return at.set(j,{data:f,ts:Date.now()}),f}async function Xt(d,u,j=5){const y=`${d}|${u}|${j}`,g=nt.get(y);if(g&&Date.now()-g.ts<st)return g.data;const b=new URL("https://api.open-meteo.com/v1/forecast");b.searchParams.set("latitude",String(d)),b.searchParams.set("longitude",String(u)),b.searchParams.set("current","temperature_2m,apparent_temperature,relative_humidity_2m,weather_code,wind_speed_10m"),b.searchParams.set("daily","weather_code,temperature_2m_max,temperature_2m_min,uv_index_max,precipitation_probability_max,precipitation_sum"),b.searchParams.set("forecast_days",String(j)),b.searchParams.set("timezone","auto");const m=await fetch(b.toString());if(!m.ok)throw new Error("Failed to fetch weather");const x=await m.json(),f=x.current||{},w=x.daily||{},N={current:{temp:f.temperature_2m,feelsLike:f.apparent_temperature,humidity:f.relative_humidity_2m,wind:f.wind_speed_10m,code:f.weather_code,...rt(f.weather_code)},forecast:[]},C=Math.min((w.time||[]).length,j);for(let L=0;L<C;L++){const R=(w.weather_code||[])[L];N.forecast.push({date:w.time[L],tmin:(w.temperature_2m_min||[])[L],tmax:(w.temperature_2m_max||[])[L],uvMax:(w.uv_index_max||[])[L],popMax:(w.precipitation_probability_max||[])[L],precipSum:(w.precipitation_sum||[])[L],code:R,...rt(R)})}return nt.set(y,{data:N,ts:Date.now()}),N}async function er(d,u){const{lat:j,lon:y,name:g}=await Zt(d,u),b=await Xt(j,y,5);return{locationName:g,...b}}function tr({city:d,country:u}){const[j,y]=c.useState({loading:!1,error:"",data:null});if(c.useEffect(()=>{let x=!0;async function f(){if(!d&&!u){y({loading:!1,error:"",data:null});return}y(w=>({...w,loading:!0,error:""}));try{const w=d||"",N=u||"",C=await er(w||N,N||void 0);if(!x)return;y({loading:!1,error:"",data:C})}catch{if(!x)return;y({loading:!1,error:"Could not load weather",data:null})}}return f(),()=>{x=!1}},[d,u]),!d&&!u)return null;const{loading:g,error:b,data:m}=j;return t.jsxs("div",{className:"mb-4 p-3 rounded border border-cream-border bg-cream flex items-center justify-between gap-3",children:[t.jsxs("div",{className:"min-w-0",children:[t.jsxs("div",{className:"text-sm font-semibold",children:["Weather ",m?.locationName?`â€¢ ${m.locationName}`:d||u||""]}),g&&t.jsx("div",{className:"text-[12px] text-brand-brown/60",children:"Loadingâ€¦"}),b&&t.jsx("div",{role:"alert",className:"text-[12px] text-red-600",children:b}),m&&t.jsxs("div",{className:"text-[12px] text-brand-brown/80 flex items-center gap-2 flex-wrap",children:[t.jsxs("span",{className:"px-1 py-0.5 rounded bg-white border border-cream-border",children:[m.current.icon," ",Math.round(m.current.temp),"Â°C"]}),t.jsxs("span",{className:"hidden sm:inline",children:[m.current.text," â€¢ wind ",Math.round(m.current.wind)," km/h"]}),Number.isFinite(m.current.feelsLike)&&t.jsxs("span",{className:"px-1 py-0.5 rounded bg-white border border-cream-border",children:["feels ",Math.round(m.current.feelsLike),"Â°C"]}),Number.isFinite(m.current.humidity)&&t.jsxs("span",{className:"px-1 py-0.5 rounded bg-white border border-cream-border",children:["humidity ",Math.round(m.current.humidity),"%"]})]})]}),m&&t.jsx("div",{className:"flex items-center gap-2 overflow-x-auto",children:m.forecast.map(x=>t.jsxs("div",{className:"text-center px-2 py-1 rounded bg-white border border-cream-border min-w-[72px]",children:[t.jsx("div",{className:"text-[10px] text-brand-brown/60",children:new Date(x.date).toLocaleDateString(void 0,{weekday:"short"})}),t.jsx("div",{className:"text-[16px]",children:x.icon}),t.jsxs("div",{className:"text-[11px] text-brand-brown/70",children:[Math.round(x.tmin),"â€“",Math.round(x.tmax),"Â°C"]}),t.jsxs("div",{className:"mt-0.5 flex items-center justify-center gap-1",children:[Number.isFinite(x.popMax)&&t.jsxs("span",{className:"text-[10px] text-brand-brown/60 px-1 py-0.5 rounded bg-cream-sand border border-cream-border",title:"Max precipitation probability",children:[Math.round(x.popMax),"%"]}),Number.isFinite(x.uvMax)&&t.jsxs("span",{className:"text-[10px] text-brand-brown/60 px-1 py-0.5 rounded bg-cream-sand border border-cream-border",title:"Max UV index",children:["UV ",Math.round(x.uvMax)]})]})]},x.date))})]})}function cr(){c.useEffect(()=>{window.scrollTo({top:0,behavior:"smooth"})},[]);const d=_t(),u=Rt(),[j,y]=c.useState(!1);c.useEffect(()=>{try{new URLSearchParams(d.search).get("direct")==="1"&&y(!0)}catch{}},[d.search]);const[g,b]=c.useState(""),[m,x]=c.useState(null),[f,w]=c.useState(()=>{try{return localStorage.getItem("directBooking:lastDate")||""}catch{return""}}),[N]=Wt(),[C,L]=c.useState(""),[R,ot]=c.useState(null),{basket:D,addToBasket:ae,removeFromBasket:ct,updateQuantity:it,updateDay:lt,paidItems:ne,clearBasket:dt}=Gt(),[ke,se]=c.useState(""),ut=()=>{const e=c.useRef(null),r=c.useRef(null);return tt(e,()=>y(!1)),c.useEffect(()=>{const n=setTimeout(()=>{try{m||r.current?.focus()}catch{}},0);return()=>clearTimeout(n)},[]),c.useEffect(()=>{function n(o){if(o.key==="Tab"&&e.current){const s=e.current.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');if(s.length){const i=s[0],h=s[s.length-1];o.shiftKey&&document.activeElement===i?(o.preventDefault(),h.focus()):!o.shiftKey&&document.activeElement===h&&(o.preventDefault(),i.focus())}}}return document.addEventListener("keydown",n),()=>document.removeEventListener("keydown",n)},[]),t.jsxs("div",{ref:e,role:"dialog","aria-modal":"true","aria-labelledby":"direct-booking-title",className:"bg-white rounded-lg shadow-lg p-6 w-full max-w-md relative",tabIndex:-1,children:[t.jsx("button",{className:"absolute top-2 right-2 text-brand-russty",onClick:()=>y(!1),"aria-label":"Close",children:"Ã—"}),t.jsx("h2",{id:"direct-booking-title",className:"text-xl font-bold text-brand-rusty mb-3",children:"Direct Booking"}),m?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"mb-2 font-semibold text-brand-russty",children:m.title}),t.jsx("div",{className:"mb-2 text-sm text-brand-russty/80",children:m.category}),t.jsx("input",{type:"date",value:f,onChange:n=>{const o=n.target.value;w(o);try{localStorage.setItem("directBooking:lastDate",o)}catch{}},className:"w-full border rounded px-3 py-2 mb-3"}),t.jsx("button",{className:"w-full bg-brand-orange text-white font-bold py-2 rounded mb-2",onClick:()=>{try{S("Payment initiated","success")}catch{}const n=new URLSearchParams({item:m.title,date:f});u(`/payment-success?${n.toString()}`)},disabled:!f||!m,children:"Proceed to Payment"}),t.jsx("button",{className:"w-full text-xs text-brand-russty underline",onClick:()=>x(null),children:"â† Back to search"})]}):t.jsxs(t.Fragment,{children:[t.jsx("input",{type:"text",value:g,onChange:n=>b(n.target.value),placeholder:"Search products (e.g. flights, hotels...)",ref:r,className:"w-full border rounded px-3 py-2 mb-3"}),t.jsx("div",{className:"max-h-40 overflow-y-auto mb-3",children:k.filter(n=>n.title.toLowerCase().includes(g.toLowerCase())||n.category.toLowerCase().includes(g.toLowerCase())).slice(0,10).map(n=>t.jsxs("button",{className:"block w-full text-left px-3 py-2 rounded hover:bg-cream-hover",onClick:()=>x(n),children:[t.jsx("span",{className:"font-semibold text-brand-russty",children:n.title}),t.jsx("span",{className:"ml-2 text-xs text-brand-russty/70",children:n.category})]},n.title))})]})]})},[Pe,oe]=c.useState(""),[Oe,he]=c.useState(!1),[mt,ye]=c.useState([]),U=c.useRef(null),[ge,ce]=c.useState(""),[fe,q]=c.useState(""),[ie,ve]=c.useState(""),[$e,Ee]=c.useState(()=>{try{return JSON.parse(localStorage.getItem("planTripPresets:v1")||"[]")}catch{return[]}}),[Te,pt]=c.useState(""),[Ae,De]=c.useState(()=>{try{return JSON.parse(localStorage.getItem("planTripRecentFilters:v1")||"[]")}catch{return[]}}),[we,_e]=c.useState([]),[M,xt]=c.useState(()=>{try{return localStorage.getItem("tripSimpleMode")==="1"}catch{return!1}}),[F,bt]=c.useState(()=>{try{return localStorage.getItem("catalogSort:v1")||"relevance"}catch{return"relevance"}});c.useEffect(()=>{try{localStorage.setItem("catalogSort:v1",F)}catch{}},[F]);const[ht,yt]=c.useState(()=>{try{return localStorage.getItem("showWeather")!=="0"}catch{return!0}}),[le,gt]=c.useState(()=>{try{return localStorage.getItem("weatherCollapsed")==="1"}catch{return!1}}),[E,Re]=c.useState(()=>{try{return localStorage.getItem("planTrip:showAdvanced:v2")==="1"}catch{return!1}}),ft=tt(()=>{if(E){Re(!1);try{localStorage.setItem("planTrip:showAdvanced:v2","0")}catch{}}},E);c.useEffect(()=>{function e(r){r&&r.key==="showWeather"&&yt(r.newValue!=="0")}return window.addEventListener("storage",e),()=>window.removeEventListener("storage",e)},[]);function vt(){const e=!M;xt(e);try{localStorage.setItem("tripSimpleMode",e?"1":"0")}catch{}}function S(e,r="info",n=2e3){const o=Math.random().toString(36).slice(2);_e(s=>[...s,{id:o,text:e,type:r}]),setTimeout(()=>_e(s=>s.filter(i=>i.id!==o)),n)}c.useEffect(()=>{const r=new URLSearchParams(d.search).get("q");r&&L(r)},[d.search]);const a=c.useMemo(()=>{const e=new URLSearchParams(d.search);return{continent:e.get("continent")||"",country:e.get("country")||"",province:e.get("province")||"",city:e.get("city")||"",area:e.get("area")||"",category:e.get("category")||"",priceMin:e.get("priceMin")||"",priceMax:e.get("priceMax")||"",paidOnly:e.get("paidOnly")==="1",freeOnly:e.get("freeOnly")==="1"}},[d.search]);c.useEffect(()=>{try{localStorage.setItem("lastLocFilters",JSON.stringify(a))}catch{}},[a]),c.useEffect(()=>{const{continent:e,country:r,province:n,city:o,area:s,category:i,priceMin:h,priceMax:v,paidOnly:l,freeOnly:P}=a,J=["continent","country","province","city","area","category","priceMin","priceMax","paidOnly","freeOnly"],A={continent:e,country:r,province:n,city:o,area:s,category:i,priceMin:h,priceMax:v,paidOnly:l,freeOnly:P};if(!J.some(G=>{const _=A[G];return(typeof _=="boolean"?_?"1":"":String(_||"").trim())!==""}))return;const B=J.map(G=>{const _=A[G],re=typeof _=="boolean"?_?"1":"":String(_||"").trim().toLowerCase();return`${G}=${encodeURIComponent(re)}`}).join("&");De(G=>{const re=[B,...G.map(Q=>Q.signature)].filter((Q,Se,Le)=>Le.indexOf(Q)===Se).slice(0,6).map(Q=>({signature:Q,filters:Object.fromEntries(Q.split("&").map(Se=>{const[Le,Ye]=Se.split("=");return[Le,Ye?decodeURIComponent(Ye):""]}))}));try{localStorage.setItem("planTripRecentFilters:v1",JSON.stringify(re))}catch{}return re})},[a.continent,a.country,a.province,a.city,a.area,a.category,a.priceMin,a.priceMax,a.paidOnly,a.freeOnly,a]);function Fe(e){const r=["continent","country","province","city","area","category","priceMin","priceMax","paidOnly","freeOnly"],n=new URLSearchParams(d.search);r.forEach(o=>{let s=e?.[o];o==="paidOnly"?s=e?.paidOnly?"1":"":o==="freeOnly"?s=e?.freeOnly?"1":"":s=(s||"").trim(),s?n.set(o,s):n.delete(o)}),u({search:n.toString()?`?${n.toString()}`:""},{replace:!0})}function wt(){const e=(Te||"").trim();if(!e){S("Enter a preset name","warn");return}const r={name:e,filters:a};Ee(n=>{const s=[...n.filter(i=>i.name!==e),r].sort((i,h)=>i.name.localeCompare(h.name));try{localStorage.setItem("planTripPresets:v1",JSON.stringify(s))}catch{}return q("saved"),setTimeout(()=>q(""),1500),ve(e),S(`Preset "${e}" saved`,"success"),s})}function jt(e){Ee(r=>{const n=r.filter(o=>o.name!==e);try{localStorage.setItem("planTripPresets:v1",JSON.stringify(n))}catch{}return q("deleted"),setTimeout(()=>q(""),1500),ie===e&&ve(""),S(`Preset "${e}" deleted`,"info"),n})}function Nt(e){const r=$e.find(n=>n.name===e);r&&(Fe(r.filters),q("applied"),setTimeout(()=>q(""),1200),S(`Applied preset "${e}"`,"success"))}c.useEffect(()=>{const e=new URLSearchParams(d.search);if(!["continent","country","province","city","area","category","priceMin","priceMax","paidOnly","freeOnly"].some(n=>e.get(n)))try{const n=localStorage.getItem("lastLocFilters");if(!n)return;const o=JSON.parse(n);if(!o||typeof o!="object")return;const s=new URLSearchParams;["continent","country","province","city","area","category","priceMin","priceMax"].forEach(i=>{o[i]&&s.set(i,o[i])}),o.paidOnly&&s.set("paidOnly","1"),o.freeOnly&&s.set("freeOnly","1"),[...s.keys()].length&&u({search:`?${s.toString()}`},{replace:!0})}catch{}},[]),c.useEffect(()=>{const e=new URLSearchParams(d.search),r=["continent","country","province","city","area","category","priceMin","priceMax","paidOnly","freeOnly"].some(o=>e.get(o));e.get("tab")==="events"?ee("events"):r&&ee("catalog")},[d.search]),c.useEffect(()=>{function e(r){if(r.key!=="/")return;const n=r.target&&r.target.tagName?r.target.tagName.toLowerCase():"";n==="input"||n==="textarea"||r.metaKey||r.ctrlKey||r.altKey||(r.preventDefault(),R&&typeof R.focus=="function"&&R.focus())}return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[R]);const z=e=>Array.from(new Set(e.filter(Boolean))),H=e=>[...e].sort((r,n)=>String(r).localeCompare(String(n),void 0,{sensitivity:"base"})),Ct=c.useMemo(()=>H(z(k.map(e=>e.continent))),[]),Be=c.useMemo(()=>H(z(k.filter(e=>!a.continent||(e.continent||"").toLowerCase()===a.continent.toLowerCase()).map(e=>e.country))),[a.continent]),Ie=c.useMemo(()=>H(z(k.filter(e=>(!a.continent||(e.continent||"").toLowerCase()===a.continent.toLowerCase())&&(!a.country||(e.country||"").toLowerCase()===a.country.toLowerCase())).map(e=>e.province))),[a.continent,a.country]),Ue=c.useMemo(()=>H(z(k.filter(e=>(!a.continent||(e.continent||"").toLowerCase()===a.continent.toLowerCase())&&(!a.country||(e.country||"").toLowerCase()===a.country.toLowerCase())&&(!a.province||(e.province||"").toLowerCase()===a.province.toLowerCase())).map(e=>e.city))),[a.continent,a.country,a.province]),qe=c.useMemo(()=>H(z(k.filter(e=>(!a.continent||(e.continent||"").toLowerCase()===a.continent.toLowerCase())&&(!a.country||(e.country||"").toLowerCase()===a.country.toLowerCase())&&(!a.province||(e.province||"").toLowerCase()===a.province.toLowerCase())&&(!a.city||(e.city||"").toLowerCase()===a.city.toLowerCase())).map(e=>e.area))),[a.continent,a.country,a.province,a.city]),ze=c.useMemo(()=>H(z(k.filter(e=>(!a.continent||(e.continent||"").toLowerCase()===a.continent.toLowerCase())&&(!a.country||(e.country||"").toLowerCase()===a.country.toLowerCase())&&(!a.province||(e.province||"").toLowerCase()===a.province.toLowerCase())&&(!a.city||(e.city||"").toLowerCase()===a.city.toLowerCase())&&(!a.area||(e.area||"").toLowerCase()===a.area.toLowerCase())).map(e=>e.category))),[a.continent,a.country,a.province,a.city,a.area]),O=c.useMemo(()=>{const e=(l,P)=>String(l||"").toLowerCase()===String(P||"").toLowerCase(),r=k,n={continent:{},country:{},province:{},city:{},area:{},category:{}};for(const l of r)l.continent&&(n.continent[l.continent]=(n.continent[l.continent]||0)+1);const o=r.filter(l=>!a.continent||e(l.continent,a.continent));for(const l of o)l.country&&(n.country[l.country]=(n.country[l.country]||0)+1);const s=o.filter(l=>!a.country||e(l.country,a.country));for(const l of s)l.province&&(n.province[l.province]=(n.province[l.province]||0)+1);const i=s.filter(l=>!a.province||e(l.province,a.province));for(const l of i)l.city&&(n.city[l.city]=(n.city[l.city]||0)+1);const h=i.filter(l=>!a.city||e(l.city,a.city));for(const l of h)l.area&&(n.area[l.area]=(n.area[l.area]||0)+1);const v=h.filter(l=>!a.area||e(l.area,a.area));for(const l of v)l.category&&(n.category[l.category]=(n.category[l.category]||0)+1);return n},[a.continent,a.country,a.province,a.city,a.area]),[de,W]=c.useState([]),[je,ue]=c.useState(!1),[Ne,V]=c.useState(""),[St,Y]=c.useState(1),[Lt,Z]=c.useState(!1),[He,Mt]=c.useState({}),[X,kt]=c.useState(()=>{try{return localStorage.getItem("includePastEvents")==="1"}catch{return!1}}),[me,Pt]=c.useState(()=>{try{return localStorage.getItem("eventsSort")||"dateAsc"}catch{return"dateAsc"}});function Ot(){const e=!X;kt(e);try{localStorage.setItem("includePastEvents",e?"1":"0")}catch{}}const[pe,$t]=c.useState(()=>{try{return localStorage.getItem("eventsGroupByMonth")==="1"}catch{return!1}});function Et(e){Pt(e);try{localStorage.setItem("eventsSort",e)}catch{}W(r=>Me(r,e))}function Tt(){const e=!pe;$t(e);try{localStorage.setItem("eventsGroupByMonth",e?"1":"0")}catch{}}const[T,ee]=c.useState(()=>{try{return localStorage.getItem("planTripTab")||"catalog"}catch{return"catalog"}});c.useEffect(()=>{try{localStorage.setItem("planTripTab",T)}catch{}},[T]),c.useEffect(()=>{M&&T!=="catalog"&&ee("catalog")},[M,T]),c.useEffect(()=>{const e=C.trim(),r=a.city.trim(),n=a.country.trim();if(M){W([]),V(""),Y(1),Z(!1);return}if(!n&&!r&&e.length<3){W([]),V(""),Y(1),Z(!1);return}let o=!0;ue(!0),V("");const s=setTimeout(async()=>{try{const{events:i,page:h,hasMore:v,countsBySource:l}=await Ze({q:e||"",city:r,country:n,page:1,limit:8,includePast:X});if(!o)return;W(Me(Array.isArray(i)?i:[],me)),Y(h||1),Z(!!v),Mt(l||{})}catch{if(!o)return;W([]),V("Could not load events right now."),Y(1),Z(!1)}finally{o&&ue(!1)}},350);return()=>{o=!1,clearTimeout(s)}},[a.city,a.country,C,X,M,me]);function K(e,r){const n=["continent","country","province","city","area"],o=new URLSearchParams(d.search);r?o.set(e,r):o.delete(e);const s=n.indexOf(e);for(let i=s+1;i<n.length;i++)o.delete(n[i]);u({search:o.toString()?`?${o.toString()}`:""},{replace:!0})}function $(e,r){const n=new URLSearchParams(d.search);r?n.set(e,r):n.delete(e),u({search:n.toString()?`?${n.toString()}`:""},{replace:!0})}function We(){const e=new URLSearchParams(d.search);["continent","country","province","city","area"].forEach(r=>e.delete(r)),u({search:e.toString()?`?${e.toString()}`:""},{replace:!0})}const Ke=c.useMemo(()=>{const e=C.trim().toLowerCase();let r=k;const{continent:n,country:o,province:s,city:i,area:h,category:v}=a;(n||o||s||i||h)&&(r=r.filter(p=>(!n||(p.continent||"").toLowerCase()===n.toLowerCase())&&(!o||(p.country||"").toLowerCase()===o.toLowerCase())&&(!s||(p.province||"").toLowerCase()===s.toLowerCase())&&(!i||(p.city||"").toLowerCase()===i.toLowerCase())&&(!h||(p.area||"").toLowerCase()===h.toLowerCase()))),v&&(r=r.filter(p=>(p.category||"").toLowerCase()===v.toLowerCase()));const l=Number(a.priceMin||""),P=Number(a.priceMax||""),J=!Number.isNaN(l)&&a.priceMin!=="",A=!Number.isNaN(P)&&a.priceMax!=="";return J&&(r=r.filter(p=>(Number(p.price)||0)>=l)),A&&(r=r.filter(p=>(Number(p.price)||0)<=P)),a.freeOnly?r=r.filter(p=>(Number(p.price)||0)===0):a.paidOnly&&(r=r.filter(p=>(Number(p.price)||0)>0)),e?r.filter(p=>p.title.toLowerCase().includes(e)||p.description.toLowerCase().includes(e)||p.category.toLowerCase().includes(e)||(p.continent||"").toLowerCase().includes(e)||(p.country||"").toLowerCase().includes(e)||(p.province||"").toLowerCase().includes(e)||(p.city||"").toLowerCase().includes(e)||(p.area||"").toLowerCase().includes(e)):r},[C,a]),te=c.useMemo(()=>{const e=[...Ke],r=C.trim().toLowerCase();if(F==="alpha")return e.sort((o,s)=>String(o.title).localeCompare(String(s.title)));if(F==="priceAsc")return e.sort((o,s)=>(Number(o.price)||0)-(Number(s.price)||0));if(F==="priceDesc")return e.sort((o,s)=>(Number(s.price)||0)-(Number(o.price)||0));if(!r)return e;const n=o=>{let s=0;const i=String(o.title||"").toLowerCase(),h=String(o.description||"").toLowerCase(),v=String(o.category||"").toLowerCase();return i.includes(r)&&(s+=5+Math.max(0,20-i.indexOf(r))),h.includes(r)&&(s+=2+Math.max(0,10-h.indexOf(r))),v.includes(r)&&(s+=3),s};return e.sort((o,s)=>n(s)-n(o))},[Ke,F,C]);function At(e){const r=C.trim();if(!r)return e;const n=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),o=new RegExp(`(${n})`,"ig");return String(e).split(o).map((i,h)=>o.test(i)?t.jsx("mark",{className:"bg-yellow-100 text-inherit p-0 rounded",children:i},h):t.jsx("span",{children:i},h))}const Je=c.useMemo(()=>Ft(k),[]),Ce=c.useMemo(()=>Xe(),[]),[Dt,xe]=c.useState(!1);c.useEffect(()=>{const e=new URLSearchParams(d.search);e.get("setLocation")==="1"&&(xe(!0),e.delete("setLocation"),u({search:e.toString()?`?${e.toString()}`:""},{replace:!0}))},[]);function Ge(){const e=C.trim();if(!e)return;const r=e.toLowerCase(),n=[" in "," near "," around "," at "];let o=-1,s="";for(const p of n){const B=r.lastIndexOf(p);B>o&&(o=B,s=p)}let i=e,h="";o>0&&(i=e.slice(0,o).trim(),h=e.slice(o+s.length).trim());const v=Ut(i||e),{smartAliases:l}=et();let P=qt(h,Je,l);if(Object.keys(P).length===0&&(P=zt(e,Je,l)),!v&&Object.keys(P).length===0)return;const J=["continent","country","province","city","area","category","q"],A=new URLSearchParams(d.search);J.forEach(p=>A.delete(p)),v&&A.set("category",v),Object.entries(P).forEach(([p,B])=>{B&&A.set(p,B)}),L(""),u({search:`?${A.toString()}`},{replace:!1});try{S&&S(`Applied smart filters${v?` â€¢ ${v}`:""}${Object.values(P).length?` â€¢ ${Object.values(P)[0]}`:""}`,"success")}catch{}}const Qe=c.useMemo(()=>{const e=(C||"").trim();if(!e)return null;const{smartAliases:r}=et(),n=Bt(e,{products:k,myLocation:Ce,enableAliases:r});if(!n)return null;const o={...n.params};return delete o.category,{text:n.label,count:n.count,cat:n.params.category,loc:o}},[C,Ce]),Ve=c.useMemo(()=>{if(!Array.isArray(k)||k.length===0)return[];const e=new Map;for(const s of k){const i=(s.city||"").trim();i&&e.set(i,(e.get(i)||0)+1)}const r=Array.from(e.entries()).sort((s,i)=>i[1]-s[1]).slice(0,4).map(([s,i])=>({city:s,count:i})),n=s=>k.filter(i=>!(s.category&&String(i.category||"")!==s.category||s.city&&String(i.city||"")!==s.city||s.province&&String(i.province||"")!==s.province||s.country&&String(i.country||"")!==s.country||s.continent&&String(i.continent||"")!==s.continent||s.area&&String(i.area||"")!==s.area)).length;return r.map(({city:s})=>{const i={category:"Lodging",city:s};return{label:`Hotels in ${s} (${n(i)})`,params:i}})},[]);return t.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 text-brand-russty",children:[t.jsxs("div",{className:"flex items-start justify-between gap-3",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-3xl font-bold mb-1",children:"Trip Planner"}),t.jsx("p",{className:"mb-4 text-brand-russty/80",children:"Plan your trip with simple, powerful filters."})]}),t.jsx("div",{className:"mt-1",children:t.jsxs("label",{className:"inline-flex items-center gap-2 text-sm",children:[t.jsx("input",{type:"checkbox",checked:M,onChange:vt}),t.jsx("span",{children:"Simple mode"})]})})]}),!M&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"mb-4",children:t.jsx(Ht,{message:"Your quotes, itinerary, and bookings stay in sync in real time."})}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[t.jsx(Kt,{steps:Jt(N,D.length)}),t.jsxs(I,{to:"/quotes",className:"p-4 bg-cream-sand border border-cream-border rounded-md hover:bg-cream-hover transition",children:[t.jsx("div",{className:"font-semibold",children:"Quotes"}),t.jsx("p",{className:"text-sm text-brand-brown/80",children:"Generate a proposal from paid basket items."})]}),t.jsxs(I,{to:"/itinerary",className:"p-4 bg-cream-sand border border-cream-border rounded-md hover:bg-cream-hover transition",children:[t.jsx("div",{className:"font-semibold",children:"Itinerary"}),t.jsx("p",{className:"text-sm text-brand-brown/80",children:"All basket items populate your day plan."})]}),t.jsx("div",{className:"relative p-4 bg-cream-sand border border-cream-border rounded-md hover:shadow-lg transition flex flex-col items-center text-center space-y-3",children:t.jsxs("div",{className:"w-full h-full flex flex-col justify-between text-left",children:[t.jsxs("div",{children:[t.jsx("div",{className:"font-semibold text-base text-brand-brown",children:"Book Direct"}),t.jsx("p",{className:"text-sm text-brand-brown/80 mt-2 mb-4",children:"Book and pay instantly for any product."})]}),t.jsx("button",{type:"button",className:"px-4 py-2 bg-brand-orange text-white rounded-lg font-semibold shadow hover:bg-brand-highlight transition relative z-10 self-start",onClick:()=>u("/plan-trip?direct=1"),"aria-label":"Open Direct Booking",style:{marginTop:"auto"},children:"Book Now"})]})}),t.jsx("div",{"aria-live":"polite","aria-atomic":"true",className:"sr-only",children:we.map(e=>e.text).join(" ")}),j&&t.jsx("div",{className:"fixed inset-0 bg-black/30 flex items-center justify-center z-50",children:t.jsx(ut,{})})]})]}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-10 min-w-0",children:[t.jsxs("div",{className:"lg:col-span-2",children:[ht&&t.jsxs("div",{className:"mb-2",children:[t.jsxs("div",{className:"flex items-center justify-between mb-1",children:[t.jsx("span",{className:"text-sm font-semibold text-brand-russty/80",children:"Weather"}),t.jsx("button",{type:"button",className:"text-[11px] px-2 py-0.5 rounded border border-cream-border bg-white hover:bg-cream-hover",onClick:()=>{const e=!le;gt(e);try{localStorage.setItem("weatherCollapsed",e?"1":"0")}catch{}},"aria-expanded":!le,children:le?"Expand":"Collapse"})]}),!le&&t.jsx(tr,{city:a.city,country:a.country})]}),!M&&t.jsxs("div",{role:"tablist","aria-label":"Plan Trip sections",className:"mb-3 flex border-b border-cream-border gap-2",children:[t.jsx("button",{role:"tab","aria-selected":T==="catalog",onClick:()=>ee("catalog"),className:`px-3 py-2 text-sm -mb-px border-b-2 ${T==="catalog"?"border-brand-brown text-brand-brown":"border-transparent text-brand-brown/60 hover:text-brand-brown"}`,children:"Catalog"}),t.jsx("button",{role:"tab","aria-selected":T==="events",onClick:()=>ee("events"),className:`px-3 py-2 text-sm -mb-px border-b-2 ${T==="events"?"border-brand-brown text-brand-brown":"border-transparent text-brand-brown/60 hover:text-brand-brown"}`,children:"Events"})]}),(M||T==="catalog")&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"flex flex-col gap-3 mb-3 sticky [top:calc(var(--header-h)+var(--banner-h))] z-[45] bg-cream/80 backdrop-blur supports-[backdrop-filter]:bg-cream/60 px-3 py-3 rounded border border-cream-border shadow-sm",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h3",{className:"font-semibold text-xl text-brand-russty",children:"Product Catalog"}),t.jsxs("div",{className:"flex items-center gap-2 text-sm text-brand-russty/60",children:[t.jsxs("span",{children:[te.length," results"]}),E&&t.jsxs("select",{"aria-label":"Sort catalog",className:"text-xs px-2 py-1 border border-cream-border rounded bg-white",value:F,onChange:e=>bt(e.target.value),children:[t.jsx("option",{value:"relevance",children:"Relevance"}),t.jsx("option",{value:"alpha",children:"A â†’ Z"}),t.jsx("option",{value:"priceAsc",children:"Price: Low to High"}),t.jsx("option",{value:"priceDesc",children:"Price: High to Low"})]})]})]}),t.jsxs("div",{className:"flex flex-col gap-3",children:[t.jsxs("div",{className:"relative",children:[t.jsx("input",{ref:ot,value:C,onChange:e=>{L(e.target.value);const r=new URLSearchParams(d.search);e.target.value?r.set("q",e.target.value):r.delete("q"),u({search:r.toString()?`?${r.toString()}`:""},{replace:!0})},placeholder:"Search products, destinations, activitiesâ€¦",title:"Press / to focus",className:"w-full text-sm pl-3 pr-24 py-2.5 border border-cream-border rounded-md bg-white focus:ring-2 focus:ring-brand-orange/30 focus:border-brand-orange outline-none","aria-label":"Search product catalog",onKeyDown:e=>{if(e.key==="Escape"){e.preventDefault();const r=new URLSearchParams(d.search);r.delete("q"),L(""),u({search:r.toString()?`?${r.toString()}`:""},{replace:!0})}else e.key==="Enter"&&(e.preventDefault(),Ge())}}),Qe&&t.jsxs("button",{type:"button",onClick:Ge,className:"absolute right-2 top-1/2 -translate-y-1/2 text-xs px-2 py-1 rounded bg-brand-orange text-white hover:bg-brand-orange/90 focus:outline-none focus:ring-2 focus:ring-brand-orange/30 inline-flex items-center gap-1","aria-label":"Apply smart filters suggestion",children:[t.jsx("span",{children:"ğŸ”"}),t.jsx("span",{className:"hidden sm:inline truncate max-w-[6rem]",children:Qe.text})]})]}),t.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{type:"button",className:"text-xs px-3 py-2 rounded-md border border-cream-border bg-white hover:bg-cream-hover flex items-center gap-1 whitespace-nowrap",title:"Use my location",onClick:()=>{const e=Xe();if(!e||!e.city&&!e.province&&!e.country){S("Set your location first","warn");return}const r=new URLSearchParams(d.search);["continent","country","province","city","area","category","q"].forEach(n=>r.delete(n)),e.city?r.set("city",e.city):e.province?r.set("province",e.province):e.country&&r.set("country",e.country),u({search:`?${r.toString()}`},{replace:!1}),S("Applied filters near your location","success")},children:"ğŸ“ Near me"}),t.jsxs("button",{type:"button",className:"text-xs px-3 py-2 rounded-md border border-cream-border bg-white hover:bg-cream-hover flex items-center gap-1 whitespace-nowrap",title:"More filters and tools","aria-expanded":E,onClick:()=>{const e=!E;Re(e);try{localStorage.setItem("planTrip:showAdvanced:v2",e?"1":"0")}catch{}},children:[t.jsx("span",{children:E?"ğŸ”¼":"ğŸ”½"}),t.jsx("span",{children:E?"Hide":"More"})]})]}),!M&&t.jsx("span",{className:"text-xs text-brand-russty/60 italic",children:'ğŸ’¡ Try "Hotels in Durban" or "Safari in Kruger"'})]})]}),!M&&t.jsx("span",{className:"hidden md:block text-[11px] text-brand-russty/60",children:"Tip: try â€œHotels in Durbanâ€, then press Enter"}),E&&t.jsxs("div",{className:"border-t border-cream-border pt-2 grid grid-cols-1 sm:grid-cols-2 gap-2",children:[Ve.length>0&&t.jsx("div",{className:"flex flex-wrap gap-2",role:"group","aria-label":"Quick actions",children:Ve.map((e,r)=>t.jsx("button",{type:"button",className:"text-xs px-2 py-1 rounded border border-cream-border hover:bg-cream-muted focus:outline-none focus:ring-2 focus:ring-brand-russty/30",onClick:()=>{const n=new URLSearchParams(d.search);["continent","country","province","city","area","category","q"].forEach(o=>n.delete(o)),Object.entries(e.params).forEach(([o,s])=>s&&n.set(o,s)),u({search:`?${n.toString()}`},{replace:!1});try{S&&S(`Applied ${e.label.replace(/ \(.*\)$/,"")}`,"success")}catch{}},children:e.label},r))}),!M&&t.jsxs("div",{className:"flex flex-wrap items-center gap-1",children:[t.jsxs("select",{value:ie,onChange:e=>{ve(e.target.value),e.target.value&&Nt(e.target.value)},className:"text-xs px-2 py-1 border border-cream-border rounded bg-white","aria-label":"Apply preset",title:"Apply preset",children:[t.jsx("option",{value:"",children:"Presetsâ€¦"}),$e.map(e=>t.jsx("option",{value:e.name,children:e.name},e.name))]}),t.jsx("input",{value:Te,onChange:e=>pt(e.target.value),placeholder:"Preset name",className:"text-xs px-2 py-1 border border-cream-border rounded bg-white","aria-label":"Preset name"}),t.jsx("button",{onClick:wt,className:"text-xs px-2 py-1 rounded border border-cream-border bg-white hover:bg-cream-hover",title:"Save current filters as preset",children:"Save"}),t.jsx("button",{disabled:!ie,onClick:()=>jt(ie),className:"text-xs px-2 py-1 rounded border border-cream-border bg-white hover:bg-cream-hover disabled:opacity-50",title:"Delete selected preset",children:"Delete"})]}),t.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[t.jsxs("label",{className:"text-[11px] text-brand-brown/70 inline-flex items-center gap-1",children:[t.jsx("span",{className:"hidden sm:inline",children:"Min"}),t.jsx("input",{type:"number",inputMode:"numeric",min:"0",value:a.priceMin,onChange:e=>$("priceMin",e.target.value),className:`w-20 text-[11px] px-2 py-1 border rounded bg-white ${(()=>{const e=Number(a.priceMin||""),r=Number(a.priceMax||""),n=!Number.isNaN(e)&&a.priceMin!=="",o=!Number.isNaN(r)&&a.priceMax!=="";return n&&o&&e>r?"border-red-400":"border-cream-border"})()}`,"aria-label":"Minimum price",placeholder:"Min"})]}),t.jsxs("label",{className:"text-[11px] text-brand-brown/70 inline-flex items-center gap-1",children:[t.jsx("span",{className:"hidden sm:inline",children:"Max"}),t.jsx("input",{type:"number",inputMode:"numeric",min:"0",value:a.priceMax,onChange:e=>$("priceMax",e.target.value),className:`w-20 text-[11px] px-2 py-1 border rounded bg-white ${(()=>{const e=Number(a.priceMin||""),r=Number(a.priceMax||""),n=!Number.isNaN(e)&&a.priceMin!=="",o=!Number.isNaN(r)&&a.priceMax!=="";return n&&o&&e>r?"border-red-400":"border-cream-border"})()}`,"aria-label":"Maximum price",placeholder:"Max"})]}),(()=>{const e=Number(a.priceMin||""),r=Number(a.priceMax||""),n=!Number.isNaN(e)&&a.priceMin!=="",o=!Number.isNaN(r)&&a.priceMax!=="";return n&&o&&e>r?t.jsx("span",{role:"alert",className:"text-[11px] text-red-600",children:"Min is greater than Max"}):null})(),t.jsxs("label",{className:"text-[11px] text-brand-brown/70 inline-flex items-center gap-1",children:[t.jsx("input",{type:"checkbox",checked:!!a.paidOnly,onChange:e=>{const r=e.target.checked;$("paidOnly",r?"1":""),r&&$("freeOnly","")},"aria-label":"Paid items only",disabled:!!a.freeOnly}),t.jsx("span",{children:"Paid only"})]}),t.jsxs("label",{className:"text-[11px] text-brand-brown/70 inline-flex items-center gap-1",children:[t.jsx("input",{type:"checkbox",checked:!!a.freeOnly,onChange:e=>{const r=e.target.checked;$("freeOnly",r?"1":""),r&&$("paidOnly","")},"aria-label":"Free items only",disabled:!!a.paidOnly}),t.jsx("span",{children:"Free only"})]})]}),t.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[t.jsx("button",{onClick:async()=>{try{const e=window.location.href;if(navigator.clipboard&&navigator.clipboard.writeText)await navigator.clipboard.writeText(e);else{const r=document.createElement("textarea");r.value=e,r.setAttribute("readonly",""),r.style.position="absolute",r.style.left="-9999px",document.body.appendChild(r),r.select(),document.execCommand("copy"),document.body.removeChild(r)}se("ok"),S("Link copied","success"),setTimeout(()=>se(""),1500)}catch{se("err"),S("Copy failed","error"),setTimeout(()=>se(""),2e3)}},className:"text-xs px-2 py-1 rounded border border-cream-border bg-white hover:bg-cream-hover",title:"Copy shareable link","aria-label":"Copy shareable link",children:"Copy link"}),t.jsx("button",{onClick:()=>{const e=new URLSearchParams(d.search);["continent","country","province","city","area","category","priceMin","priceMax","paidOnly","freeOnly","q"].forEach(r=>e.delete(r)),L(""),u({search:""},{replace:!0})},className:"text-xs px-2 py-1 rounded border border-cream-border bg-white hover:bg-cream-hover",title:"Reset filters and search",children:"Reset"}),t.jsx("button",{type:"button",className:"text-[11px] px-2 py-1 rounded border border-cream-border bg-white hover:bg-cream-hover",title:"Set my location",onClick:()=>xe(!0),children:"Set my location"}),t.jsx("span",{"aria-live":"polite",className:"sr-only",children:ke==="ok"?"Link copied":ke==="err"?"Copy failed":""})]})]})]}),t.jsxs("div",{"aria-live":"polite",role:"status",className:"sr-only",children:[te.length," results in catalog"]}),E&&t.jsxs("div",{ref:ft,className:"flex flex-wrap gap-2 sm:gap-2.5 md:gap-3 mb-3",children:[t.jsxs("select",{value:a.continent,onChange:e=>K("continent",e.target.value),className:"text-xs px-2 py-1 border border-cream-border rounded bg-white","aria-label":"Filter by continent",title:"Filter by continent",children:[t.jsx("option",{value:"",children:"All continents"}),Ct.map(e=>t.jsxs("option",{value:e,children:[e," ",O.continent[e]?`(${O.continent[e]})`:""]},e))]}),t.jsxs("select",{value:a.country,onChange:e=>K("country",e.target.value),className:"text-xs px-2 py-1 border border-cream-border rounded bg-white","aria-label":"Filter by country",title:"Filter by country",disabled:!Be.length,children:[t.jsx("option",{value:"",children:"All countries"}),Be.map(e=>t.jsxs("option",{value:e,children:[e," ",O.country[e]?`(${O.country[e]})`:""]},e))]}),t.jsxs("select",{value:a.province,onChange:e=>K("province",e.target.value),className:"text-xs px-2 py-1 border border-cream-border rounded bg-white","aria-label":"Filter by province",title:"Filter by province",disabled:!Ie.length,children:[t.jsx("option",{value:"",children:"All provinces"}),Ie.map(e=>t.jsxs("option",{value:e,children:[e," ",O.province[e]?`(${O.province[e]})`:""]},e))]}),t.jsxs("select",{value:a.city,onChange:e=>K("city",e.target.value),className:"text-xs px-2 py-1 border border-cream-border rounded bg-white","aria-label":"Filter by city",title:"Filter by city",disabled:!Ue.length,children:[t.jsx("option",{value:"",children:"All cities"}),Ue.map(e=>t.jsxs("option",{value:e,children:[e," ",O.city[e]?`(${O.city[e]})`:""]},e))]}),t.jsxs("select",{value:a.area,onChange:e=>K("area",e.target.value),className:"text-xs px-2 py-1 border border-cream-border rounded bg-white","aria-label":"Filter by area",title:"Filter by area",disabled:!qe.length,children:[t.jsx("option",{value:"",children:"All areas"}),qe.map(e=>t.jsxs("option",{value:e,children:[e," ",O.area[e]?`(${O.area[e]})`:""]},e))]}),t.jsxs("select",{value:a.category,onChange:e=>$("category",e.target.value),className:"text-xs px-2 py-1 border border-cream-border rounded bg-white","aria-label":"Filter by category",title:"Filter by category",disabled:!ze.length,children:[t.jsx("option",{value:"",children:"All categories"}),ze.map(e=>t.jsxs("option",{value:e,children:[e," ",O.category[e]?`(${O.category[e]})`:""]},e))]})]}),t.jsx("span",{"aria-live":"polite",className:"sr-only",children:fe==="saved"?"Preset saved":fe==="applied"?"Preset applied":fe==="deleted"?"Preset deleted":""}),!M&&E&&Ae.length>0&&t.jsxs("div",{className:"flex flex-wrap items-center gap-1.5 sm:gap-2 mb-3",children:[t.jsx("span",{className:"text-[11px] text-brand-brown/60 mr-1",children:"Recent:"}),Ae.map((e,r)=>{const n=e.filters||{},o=["city","province","country","area","category","continent"].map(i=>n[i]).filter(Boolean),s=o.join(" â€¢ ").slice(0,40)+(o.join(" â€¢ ").length>40?"â€¦":"");return t.jsx("button",{onClick:()=>Fe(n),className:"text-[11px] px-2 py-1 rounded-full border border-cream-border bg-white hover:bg-cream-hover",title:o.join(" â€¢ "),children:s||"Unnamed"},e.signature||r)}),t.jsx("button",{onClick:()=>{De([]);try{localStorage.setItem("planTripRecentFilters:v1","[]")}catch{}S("Recent filters cleared","info")},className:"text-[11px] px-2 py-1 rounded-full border border-cream-border bg-white hover:bg-cream-hover",title:"Clear recent filters",children:"Clear recents"})]}),(a.continent||a.country||a.province||a.city||a.area||a.category||a.priceMin||a.priceMax||a.paidOnly||a.freeOnly)&&t.jsxs("div",{className:"flex flex-wrap items-center gap-1.5 sm:gap-2 mb-4",children:[["continent","country","province","city","area"].map(e=>a[e]?t.jsxs("button",{onClick:()=>K(e,""),className:"text-xs px-2 py-1 rounded-full border border-cream-border bg-cream hover:bg-cream-hover focus:outline-none focus:ring-2 focus:ring-brand-russty/30 active:scale-[0.98] transition",title:`Clear ${e}`,"aria-label":`Clear ${e} filter: ${a[e]}`,children:[e,": ",a[e]," Ã—"]},e):null),a.category?t.jsxs("button",{onClick:()=>$("category",""),className:"text-xs px-2 py-1 rounded-full border border-cream-border bg-cream hover:bg-cream-hover focus:outline-none focus:ring-2 focus:ring-brand-russty/30 active:scale-[0.98] transition",title:"Clear category","aria-label":`Clear category filter: ${a.category}`,children:["category: ",a.category," Ã—"]}):null,a.priceMin?t.jsxs("button",{onClick:()=>$("priceMin",""),className:"text-xs px-2 py-1 rounded-full border border-cream-border bg-cream hover:bg-cream-hover focus:outline-none focus:ring-2 focus:ring-brand-russty/30 active:scale-[0.98] transition",title:"Clear minimum price","aria-label":`Clear minimum price filter: ${a.priceMin}`,children:["min: ",a.priceMin," Ã—"]}):null,a.priceMax?t.jsxs("button",{onClick:()=>$("priceMax",""),className:"text-xs px-2 py-1 rounded-full border border-cream-border bg-cream hover:bg-cream-hover focus:outline-none focus:ring-2 focus:ring-brand-russty/30 active:scale-[0.98] transition",title:"Clear maximum price","aria-label":`Clear maximum price filter: ${a.priceMax}`,children:["max: ",a.priceMax," Ã—"]}):null,a.paidOnly?t.jsx("button",{onClick:()=>$("paidOnly",""),className:"text-xs px-2 py-1 rounded-full border border-cream-border bg-cream hover:bg-cream-hover focus:outline-none focus:ring-2 focus:ring-brand-russty/30 active:scale-[0.98] transition",title:"Clear paid only","aria-label":"Clear paid only filter",children:"paid only Ã—"}):null,a.freeOnly?t.jsx("button",{onClick:()=>$("freeOnly",""),className:"text-xs px-2 py-1 rounded-full border border-cream-border bg-cream hover:bg-cream-hover focus:outline-none focus:ring-2 focus:ring-brand-brown/30 active:scale-[0.98] transition",title:"Clear free only","aria-label":"Clear free only filter",children:"free only Ã—"}):null,t.jsx("button",{onClick:We,className:"text-[11px] px-2 py-1 rounded-full border border-cream-border bg-white hover:bg-cream-hover text-brand-russty/80 focus:outline-none focus:ring-2 focus:ring-brand-russty/30 active:scale-[0.98] transition",title:"Clear all location filters","aria-label":"Clear all location filters",children:"Clear filters"})]}),t.jsxs("ul",{className:"space-y-3",children:[te.map(e=>t.jsxs("li",{className:"p-4 rounded border bg-cream-sand border-cream-border flex flex-col md:flex-row md:items-center gap-3",children:[t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("span",{children:[te.length," results"]}),t.jsx("div",{className:"text-sm text-brand-russty/70",children:At(e.description)}),t.jsxs("div",{className:"text-[11px] text-brand-russty/50",children:[e.category," â€¢ ",e.price>0?`Price: $${e.price}`:"Included / No charge"]}),t.jsx("div",{className:"text-[11px] text-brand-russty/60 mt-0.5",children:e.province||e.country||e.city?t.jsxs(t.Fragment,{children:[e.province?`${e.province}, `:"",e.city||e.country,e.area?` â€¢ ${e.area}`:""]}):null})]}),t.jsx("button",{onClick:()=>ae(e),className:"px-3 py-1.5 text-xs rounded border border-brand-russty hover:bg-cream-hover",children:"Add"})]},e.id)),te.length===0&&t.jsxs("li",{className:"text-sm text-brand-russty/60 flex items-center gap-2",children:[t.jsx("span",{children:"No results."}),t.jsx("button",{onClick:We,className:"text-brand-russty underline hover:no-underline",children:"Clear filters"}),t.jsx("span",{className:"hidden sm:inline",children:"or"}),t.jsx("button",{onClick:()=>{const e=new URLSearchParams(d.search);["continent","country","province","city","area","category","priceMin","priceMax","paidOnly","q"].forEach(r=>e.delete(r)),L(""),u({search:""},{replace:!0})},className:"text-brand-russty underline hover:no-underline",children:"Reset all"})]})]})]}),!M&&T==="events"&&(a.country||a.city||C.trim().length>=3)&&t.jsxs("div",{className:"mt-6",children:[t.jsxs("div",{className:"flex items-baseline justify-between mb-2",children:[t.jsxs("h4",{className:"font-semibold",children:["Events ",a.city?`â€¢ ${a.city}`:a.country?`â€¢ ${a.country}`:""]}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsxs("label",{className:"text-[12px] text-brand-brown/70 inline-flex items-center gap-1",children:[t.jsx("input",{type:"checkbox",checked:X,onChange:Ot}),t.jsx("span",{children:"Include past"})]}),t.jsxs("label",{className:"text-[12px] text-brand-brown/70 inline-flex items-center gap-1",children:[t.jsx("input",{type:"checkbox",checked:pe,onChange:Tt}),t.jsx("span",{children:"Group by month"})]}),t.jsxs("label",{className:"text-[12px] text-brand-brown/70 inline-flex items-center gap-1",children:[t.jsx("span",{className:"hidden sm:inline",children:"Sort"}),t.jsxs("select",{"aria-label":"Sort events by date",className:"text-[12px] px-1.5 py-0.5 border border-cream-border rounded bg-white",value:me,onChange:e=>Et(e.target.value),children:[t.jsx("option",{value:"dateAsc",children:"Soonest first"}),t.jsx("option",{value:"dateDesc",children:"Latest first"})]})]}),je&&t.jsx("span",{className:"text-xs text-brand-brown/60",children:"Loadingâ€¦"})]})]}),Ne&&t.jsx("div",{role:"alert",className:"text-xs text-red-600 mb-2",children:Ne}),!je&&de.length===0&&!Ne&&t.jsxs("div",{className:"text-sm text-brand-brown/70 bg-cream-sand border border-cream-border rounded p-3",children:[t.jsx("div",{className:"font-medium mb-1",children:"No events found."}),t.jsxs("ul",{className:"list-disc pl-4 space-y-1",children:[t.jsx("li",{children:"Try a broader search term or clear the search box."}),t.jsx("li",{children:"Select just a country (and remove city) to widen results."}),t.jsx("li",{children:"On Settings, enable â€œShow demo eventsâ€ to visualize the experience."})]}),t.jsx("div",{className:"mt-2",children:t.jsx(I,{to:"/settings",className:"inline-block px-2.5 py-1 text-xs rounded border border-cream-border bg-white hover:bg-cream-hover",children:"Open Settings"})})]}),!pe&&t.jsxs("ul",{className:"space-y-2",children:[je&&de.length===0&&Array.from({length:3}).map((e,r)=>t.jsxs("li",{className:"p-3 rounded border border-cream-border bg-white animate-pulse",children:[t.jsx("div",{className:"h-4 bg-cream-sand/80 rounded w-2/3 mb-2"}),t.jsx("div",{className:"h-3 bg-cream-sand/70 rounded w-1/2"})]},`skeleton_${r}`)),de.map(e=>t.jsxs("li",{className:"p-3 rounded border border-cream-border bg-white flex flex-col md:flex-row md:items-center gap-3",children:[t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"font-medium truncate",children:[e.name," ",e.source==="Demo"&&t.jsx("span",{className:"ml-2 text-[10px] px-1 py-0.5 rounded bg-cream-sand border border-cream-border align-middle",children:"Demo"})]}),t.jsxs("div",{className:"text-[12px] text-brand-brown/70 truncate",children:[[e.venue,e.city,e.country].filter(Boolean).length>0?t.jsxs(t.Fragment,{children:[[e.venue,e.city,e.country].filter(Boolean).join(", ")," ",e.date?`â€¢ ${new Date(e.date).toLocaleDateString()}`:""]}):t.jsx(t.Fragment,{children:e.date?t.jsx("span",{className:"px-1 py-0.5 mr-1 rounded bg-cream-sand border border-cream-border align-middle",children:new Date(e.date).toLocaleDateString()}):null})," ","â€¢ ",t.jsx("span",{className:"px-1 py-0.5 text-[10px] rounded bg-cream-sand border border-cream-border align-middle",children:e.source})]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[e.url&&t.jsx("a",{href:e.url,target:"_blank",rel:"noreferrer",className:"px-2 py-1 text-xs rounded border border-cream-border hover:bg-cream-hover",children:"Open"}),t.jsx("button",{onClick:()=>ae({id:`ev_${e.source}_${e.id}`,title:e.name,description:[e.venue,e.city,e.country,e.date&&new Date(e.date).toLocaleDateString()].filter(Boolean).join(" â€¢ "),category:"Event",price:0,url:e.url||"",source:e.source}),className:"px-3 py-1.5 text-xs rounded border border-brand-brown hover:bg-cream-hover",children:"Add"})]})]},`ev_${e.source}_${e.id}`))]}),pe&&t.jsx("div",{className:"space-y-4",children:(()=>{const e=new Map;for(const n of de){let o="Unknown date";if(n?.date){const s=new Date(n.date);Number.isNaN(s.valueOf())||(o=s.toLocaleString(void 0,{month:"long",year:"numeric"}))}e.has(o)||e.set(o,[]),e.get(o).push(n)}return Array.from(e.entries()).map(([n,o])=>t.jsxs("section",{children:[t.jsx("h5",{className:"text-sm font-semibold text-brand-brown/80 mb-2",children:n}),t.jsx("ul",{className:"space-y-2",children:o.map(s=>t.jsxs("li",{className:"p-3 rounded border border-cream-border bg-white flex flex-col md:flex-row md:items-center gap-3",children:[t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"font-medium truncate",children:[s.name," ",s.source==="Demo"&&t.jsx("span",{className:"ml-2 text-[10px] px-1 py-0.5 rounded bg-cream-sand border border-cream-border align-middle",children:"Demo"})]}),t.jsxs("div",{className:"text-[12px] text-brand-brown/70 truncate",children:[[s.venue,s.city,s.country].filter(Boolean).length>0?t.jsxs(t.Fragment,{children:[[s.venue,s.city,s.country].filter(Boolean).join(", ")," ",s.date?`â€¢ ${new Date(s.date).toLocaleDateString()}`:""]}):t.jsx(t.Fragment,{children:s.date?t.jsx("span",{className:"px-1 py-0.5 mr-1 rounded bg-cream-sand border border-cream-border align-middle",children:new Date(s.date).toLocaleDateString()}):null})," ","â€¢ ",t.jsx("span",{className:"px-1 py-0.5 text-[10px] rounded bg-cream-sand border border-cream-border align-middle",children:s.source})]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[s.url&&t.jsx("a",{href:s.url,target:"_blank",rel:"noreferrer",className:"px-2 py-1 text-xs rounded border border-cream-border hover:bg-cream-hover",children:"Open"}),t.jsx("button",{onClick:()=>ae({id:`ev_${s.source}_${s.id}`,title:s.name,description:[s.venue,s.city,s.country,s.date&&new Date(s.date).toLocaleDateString()].filter(Boolean).join(" â€¢ "),category:"Event",price:0,url:s.url||"",source:s.source}),className:"px-3 py-1.5 text-xs rounded border border-brand-brown hover:bg-cream-hover",children:"Add"})]})]},`ev_${s.source}_${s.id}`))})]},n))})()}),Lt&&t.jsx("div",{className:"mt-3",children:t.jsx("button",{onClick:async()=>{try{ue(!0);const e=C.trim(),r=a.city.trim(),n=a.country.trim(),o=(St||1)+1,{events:s,page:i,hasMore:h}=await Ze({q:e||"",city:r,country:n,page:o,limit:8,includePast:X});W(v=>Qt(v,s,me)),Y(i||o),Z(!!h)}catch{V("Could not load more events.")}finally{ue(!1)}},className:"px-3 py-1.5 text-xs rounded border border-cream-border bg-white hover:bg-cream-hover",children:"Load more"})}),Object.keys(He||{}).length>0&&t.jsxs("div",{className:"mt-3 text-[12px] text-brand-brown/60",children:["Sources: ",Object.entries(He).map(([e,r])=>t.jsxs("span",{className:"inline-flex items-center gap-1 mr-2",children:[t.jsx("span",{className:"px-1 py-0.5 rounded bg-cream-sand border border-cream-border",children:e}),t.jsx("span",{children:r})]},e))]})]})]}),!M&&t.jsxs("div",{className:"rounded border border-cream-border bg-cream p-4 h-fit sticky [top:calc(var(--header-h)+var(--banner-h)+2rem)]",children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsxs("h3",{className:"font-semibold",children:["Basket (",D.length,")"]}),!Oe&&t.jsx("button",{onClick:()=>he(!0),className:"text-[11px] px-2 py-1 rounded border border-cream-border bg-white hover:bg-cream-hover",children:"Clear basket"}),Oe&&t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("span",{className:"text-[11px] text-brand-brown/70",children:"Confirm?"}),t.jsx("button",{onClick:()=>{ye(D),dt(),he(!1),ce("Basket cleared. Undo available for 10 seconds."),U.current&&clearTimeout(U.current),U.current=setTimeout(()=>{ce(""),ye([])},1e4),S("Basket cleared","info")},className:"text-[11px] px-2 py-1 rounded border border-cream-border bg-white hover:bg-cream-hover",children:"Yes"}),t.jsx("button",{onClick:()=>he(!1),className:"text-[11px] px-2 py-1 rounded border border-cream-border bg-white hover:bg-cream-hover",children:"No"})]})]}),ge&&t.jsxs("div",{className:"mb-2 text-[12px] bg-cream-sand border border-cream-border rounded p-2 flex items-center justify-between",children:[t.jsx("span",{children:ge}),t.jsx("button",{onClick:()=>{U.current&&(clearTimeout(U.current),U.current=null),(mt||[]).forEach(r=>ae({...r})),ce("Restored basket"),setTimeout(()=>ce(""),1200),ye([]),S("Basket restored","success")},className:"text-[11px] px-2 py-1 rounded border border-cream-border bg-white hover:bg-cream-hover",children:"Undo"})]}),t.jsx("span",{"aria-live":"polite",className:"sr-only",children:ge}),we.length>0&&t.jsx("div",{className:"fixed right-4 bottom-4 z-50 space-y-2",children:we.map(e=>t.jsx("div",{className:`px-3 py-2 rounded shadow border text-sm ${e.type==="success"?"bg-green-50 border-green-200 text-green-800":e.type==="error"?"bg-red-50 border-red-200 text-red-800":e.type==="warn"?"bg-yellow-50 border-yellow-200 text-yellow-800":"bg-white border-cream-border text-brand-russty"}`,children:e.text},e.id))}),t.jsxs("div",{"aria-live":"polite",role:"status",className:"sr-only",children:["Basket has ",D.length," item",D.length===1?"":"s"]}),D.length===0&&t.jsx("p",{className:"text-sm text-brand-russty/60",children:"No items yet. Add from the catalog."}),t.jsx("ul",{className:"space-y-2 mb-4",children:D.map(e=>t.jsxs("li",{className:"bg-white rounded border border-cream-border p-2 text-sm flex flex-col gap-1",children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("span",{className:"font-medium truncate",children:e.title}),t.jsx("button",{onClick:()=>ct(e.id),className:"text-[10px] uppercase tracking-wide text-red-600 hover:text-red-500",children:"Remove"})]}),t.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-[11px] text-brand-russty/70",children:[t.jsx("span",{children:e.price>0?be(e.price,"USD"):"Included"}),t.jsx("span",{children:"â€¢ Qty"}),t.jsx("input",{type:"number",min:1,value:e.quantity,onChange:r=>it(e.id,Number(r.target.value)),className:"w-14 px-1 py-0.5 border border-cream-border rounded"}),t.jsx("span",{children:"â€¢ Day"}),t.jsx("input",{type:"number",min:1,value:e.day||1,onChange:r=>lt(e.id,r.target.value),className:"w-14 px-1 py-0.5 border border-cream-border rounded"})]})]},e.id))}),(()=>{const e=ne.reduce((r,n)=>r+(Number(n.price)||0)*(Number(n.quantity)||1),0);return t.jsxs("div",{className:"flex items-center justify-between text-xs text-brand-russty/80 mb-3",children:[t.jsx("span",{children:"All items appear in itinerary. Paid items appear in quotes."}),t.jsxs("span",{className:"font-semibold",children:["Paid total: ",be(e,"USD")]})]})})(),t.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[t.jsx("button",{onClick:async()=>{try{const e=[];e.push("Trip Basket Summary"),e.push(""),D.forEach(o=>{const s=Number(o.quantity)||1,i=Number(o.price)||0,h=i*s,v=[o.city,o.province,o.country].filter(Boolean).join(", ");e.push(`- ${s} x ${o.title}${i>0?` @ ${be(i,"USD")}`:" (Included)"}${v?` â€¢ ${v}`:""}`)});const r=ne.reduce((o,s)=>o+(Number(s.price)||0)*(Number(s.quantity)||1),0);e.push(""),e.push(`Paid total: ${be(r,"USD")}`);const n=e.join(`
`);if(navigator.clipboard&&navigator.clipboard.writeText)await navigator.clipboard.writeText(n);else{const o=document.createElement("textarea");o.value=n,o.setAttribute("readonly",""),o.style.position="absolute",o.style.left="-9999px",document.body.appendChild(o),o.select(),document.execCommand("copy"),document.body.removeChild(o)}oe("ok"),setTimeout(()=>oe(""),1500)}catch{oe("err"),setTimeout(()=>oe(""),2e3)}},className:"px-2 py-1 text-xs rounded border border-cream-border bg-white hover:bg-cream-hover",title:"Copy basket summary","aria-label":"Copy basket summary",children:"Copy summary"}),t.jsx("span",{"aria-live":"polite",className:"sr-only",children:Pe==="ok"?"Basket summary copied":Pe==="err"?"Copy failed":""})]}),t.jsxs(I,{to:"/quote/new",state:{fromBasket:!0},className:`block text-center px-3 py-2 rounded text-sm font-medium border ${ne.length?"bg-brand-orange text-cream border-brand-orange hover:bg-brand-orange/90":"bg-cream-sand text-brand-russty/50 border-cream-border cursor-not-allowed"}`,children:["Create Quote (",ne.length,")"]})]})]}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 pb-[calc(var(--footer-h)+1rem)]",children:[t.jsxs(I,{to:"/bookings",className:"p-4 bg-cream-sand border border-cream-border rounded-md hover:bg-cream-hover transition",children:[t.jsx("div",{className:"font-semibold",children:"Bookings"}),t.jsx("p",{className:"text-sm text-brand-russty/80",children:"See all confirmations and status in one place."})]}),t.jsxs(I,{to:"/terms",className:"p-4 bg-cream-sand border border-cream-border rounded-md hover:bg-cream-hover transition",children:[t.jsx("div",{className:"font-semibold",children:"Travel Safety & Terms"}),t.jsx("p",{className:"text-sm text-brand-russty/80",children:"Know-before-you-go and policies."})]}),t.jsxs(I,{to:"/contact",className:"p-4 bg-cream-sand border border-cream-border rounded-md hover:bg-cream-hover transition",children:[t.jsx("div",{className:"font-semibold",children:"Concierge"}),t.jsx("p",{className:"text-sm text-brand-russty/80",children:"Need help? Our team is here."})]})]}),t.jsx(Vt,{open:Dt,initial:Ce,onClose:()=>xe(!1),onSave:e=>{It(e),xe(!1),S("Location saved","success")}})]})}export{cr as default};
