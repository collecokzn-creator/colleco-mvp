import{r as a,j as e,l as U,s as P}from"./index-BCXrhMbA.js";function H(){const[h,m]=a.useState(null),[i,c]=a.useState(null),[u,l]=a.useState(null),[N,p]=a.useState(!1),[S,g]=a.useState(""),[x,k]=a.useState({health:0,providers:0,events:0}),[f,A]=a.useState(null);async function v(){p(!0),g("");try{const t=performance.now(),o=await fetch("/health").then(r=>r.ok?r.json():Promise.reject(new Error("health failed")));k(r=>({...r,health:Math.round(performance.now()-t)})),m(o)}catch(t){m(null),g(t.message||"health failed"),A({at:Date.now(),message:t.message})}try{const t=performance.now(),o=await fetch("/api/providers").then(r=>r.ok?r.json():Promise.reject(new Error("providers failed")));k(r=>({...r,providers:Math.round(performance.now()-t)})),c(o)}catch(t){c(null),g(o=>o||t.message||"providers failed"),A(o=>o||{at:Date.now(),message:t.message})}try{const t=performance.now(),o=await fetch("/api/events/search?country=ZA&demo=1").then(r=>r.ok?r.json():Promise.reject(new Error("events failed")));k(r=>({...r,events:Math.round(performance.now()-t)})),l(o)}catch(t){l(null),g(o=>o||t.message||"events failed"),A(o=>o||{at:Date.now(),message:t.message})}p(!1)}a.useEffect(()=>{v()},[]);const j=t=>!!t,b=Array.isArray(i?.providers)?i.providers:Array.isArray(i)?i:[],y=Array.isArray(u?.events)?u.events.length:0;return e.jsxs("div",{className:"p-4 border border-cream-border bg-white rounded mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"font-semibold text-brand-brown",children:"API Status"}),e.jsx("button",{onClick:v,disabled:N,className:"text-xs px-2 py-1 border border-cream-border rounded bg-cream hover:bg-cream-hover disabled:opacity-60",children:N?"Refreshing…":"Refresh"})]}),S&&e.jsx("div",{className:"text-xs text-red-600 mb-2",children:S}),e.jsxs("ul",{className:"text-sm text-brand-brown/80 space-y-1",children:[e.jsxs("li",{children:[e.jsx("span",{className:"font-medium",children:"Health:"})," ",j(h)?e.jsx("span",{className:"text-green-700",children:"OK"}):e.jsx("span",{className:"text-red-600",children:"Unavailable"}),h?.service?e.jsx("span",{className:"ml-2 text-brand-brown/60",children:h.service}):null,x.health?e.jsxs("span",{className:"ml-2 text-brand-brown/50",children:[x.health," ms"]}):null]}),e.jsxs("li",{children:[e.jsx("span",{className:"font-medium",children:"Providers API:"})," ",j(i)?e.jsx("span",{className:"text-green-700",children:"OK"}):e.jsx("span",{className:"text-red-600",children:"Unavailable"}),b?.length>=0?e.jsxs("span",{className:"ml-2 text-brand-brown/60",children:[b.length," configured"]}):null,x.providers?e.jsxs("span",{className:"ml-2 text-brand-brown/50",children:[x.providers," ms"]}):null]}),e.jsxs("li",{children:[e.jsx("span",{className:"font-medium",children:"Events (demo):"})," ",j(u)?e.jsx("span",{className:"text-green-700",children:"OK"}):e.jsx("span",{className:"text-red-600",children:"Unavailable"}),j(u)?e.jsxs("span",{className:"ml-2 text-brand-brown/60",children:[y," found"]}):null,x.events?e.jsxs("span",{className:"ml-2 text-brand-brown/50",children:[x.events," ms"]}):null]})]}),f&&e.jsxs("div",{className:"text-[11px] text-brand-brown/60 mt-2",children:["Last error at ",new Date(f.at).toLocaleTimeString(),": ",f.message]})]})}function T(){return{}}async function R(){const h=await fetch("/api/providers",{headers:T()});if(!h.ok)throw new Error(`Failed to fetch provider toggles (${h.status})`);const m=await h.json();return(Array.isArray(m)?m:Array.isArray(m.providers)?m.providers:[]).map(c=>({name:String(c.name||"").toLowerCase(),enabled:!!c.enabled}))}async function F(h){const m=h.map(l=>({name:String(l.name||"").toLowerCase(),enabled:!!l.enabled})),i=await fetch("/api/providers",{method:"PUT",headers:{"Content-Type":"application/json",...T()},body:JSON.stringify(m)});if(!i.ok)throw new Error(`Failed to update provider toggles (${i.status})`);const c=await i.json();return(Array.isArray(c)?c:Array.isArray(c.providers)?c.providers:[]).map(l=>({name:String(l.name||"").toLowerCase(),enabled:!!l.enabled}))}function M(){const[h,m]=a.useState(!0),[i,c]=a.useState(!1),[u,l]=a.useState(""),[N,p]=a.useState(""),[S,g]=a.useState([{name:"ticketmaster",enabled:!0},{name:"seatgeek",enabled:!0}]),[x,k]=a.useState(()=>localStorage.getItem("demoEvents")==="1"),[f,A]=a.useState(()=>localStorage.getItem("smartAliases")!=="0"),[v,j]=a.useState(()=>U()),[b,y]=a.useState({key:"",kind:"city",value:""}),[t,o]=a.useState(()=>localStorage.getItem("showWeather")!=="0");async function r(){l(""),p(""),m(!0);try{const s=await R();Array.isArray(s)&&s.length&&g(s)}catch(s){l(s.message||"Failed to load provider toggles")}finally{m(!1)}}a.useEffect(()=>{r()},[]);async function L(){c(!0),l(""),p("");try{const s=await F(S);g(s),p("Provider settings saved")}catch(s){l(s.message||"Failed to save settings")}finally{c(!1)}}function D(s){g(n=>n.map(d=>d.name===s?{...d,enabled:!d.enabled}:d))}function I(){const s=!x;k(s),localStorage.setItem("demoEvents",s?"1":"0")}function W(){const s=!f;A(s),localStorage.setItem("smartAliases",s?"1":"0")}function $(){const s=!t;o(s),localStorage.setItem("showWeather",s?"1":"0");try{window.dispatchEvent(new StorageEvent("storage",{key:"showWeather",newValue:s?"1":"0"}))}catch{}}function K(){const s=(b.key||"").trim().toLowerCase(),n=(b.value||"").trim(),d=b.kind;if(!s||!n){l("Alias key and value are required");return}const C=v.filter(E=>(E&&E.key)!==s),w={key:s};d==="area"?w.area=n:d==="city"?w.city=n:d==="province"?w.province=n:d==="country"?w.country=n:d==="continent"&&(w.continent=n),C.push(w),j(C),P(C),y({key:"",kind:d,value:""}),p("Custom alias added"),setTimeout(()=>p(""),1200)}function O(s){const n=v.filter(d=>d.key!==s);j(n),P(n)}return e.jsxs("div",{className:"p-6 max-w-3xl",children:[e.jsx("h2",{className:"text-2xl font-bold mb-3 text-brand-orange",children:"Settings"}),e.jsx(H,{}),e.jsxs("div",{className:"bg-cream-sand p-4 border border-cream-border space-y-4",children:[e.jsxs("section",{children:[e.jsx("h3",{className:"font-semibold text-brand-brown mb-2",children:"Events Providers"}),e.jsx("p",{className:"text-sm text-brand-brown/80 mb-3",children:"Enable or disable trusted sources for events aggregation."}),h?e.jsx("div",{className:"text-sm text-brand-brown",children:"Loading…"}):e.jsx("ul",{className:"divide-y divide-cream-border",children:S.map(s=>e.jsxs("li",{className:"py-2 flex items-center justify-between",children:[e.jsx("span",{className:"capitalize text-brand-brown",children:s.name}),e.jsxs("label",{className:"inline-flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:s.enabled,onChange:()=>D(s.name)}),e.jsx("span",{children:s.enabled?"Enabled":"Disabled"})]})]},s.name))}),e.jsxs("div",{className:"mt-3 flex gap-2",children:[e.jsx("button",{onClick:r,className:"px-3 py-1.5 bg-white border border-cream-border text-brand-brown hover:bg-cream-sand/70",children:"Refresh"}),e.jsx("button",{onClick:L,disabled:i,className:"px-3 py-1.5 bg-brand-orange text-white disabled:opacity-60",children:i?"Saving…":"Save"})]}),u&&e.jsx("p",{className:"mt-2 text-sm text-red-600",children:u}),N&&e.jsx("p",{className:"mt-2 text-sm text-green-700",children:N})]}),e.jsxs("section",{className:"pt-4 border-t border-cream-border",children:[e.jsx("h3",{className:"font-semibold text-brand-brown mb-2",children:"Demo Data"}),e.jsxs("label",{className:"inline-flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:x,onChange:I}),e.jsx("span",{children:"Show demo events (force demo results in Events UI)"})]}),e.jsx("p",{className:"text-xs text-brand-brown/70 mt-1",children:"This sets a local flag only. The server also auto-falls back to demo when no provider keys are configured."})]}),e.jsxs("section",{className:"pt-4 border-t border-cream-border",children:[e.jsx("h3",{className:"font-semibold text-brand-brown mb-2",children:"Weather"}),e.jsxs("label",{className:"inline-flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:t,onChange:$}),e.jsx("span",{children:"Show live weather in Planner"})]})]}),e.jsxs("section",{className:"pt-4 border-t border-cream-border",children:[e.jsx("h3",{className:"font-semibold text-brand-brown mb-2",children:"Smart Search"}),e.jsxs("label",{className:"inline-flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:f,onChange:W}),e.jsx("span",{children:"Use location aliases (CPT, JHB, KZN…)"})]}),e.jsx("p",{className:"text-xs text-brand-brown/70 mt-1",children:"When enabled, common shorthand codes and nicknames are recognized in search (e.g., CPT → Cape Town, JHB → Johannesburg, KZN → KwaZulu-Natal)."})]}),e.jsxs("section",{className:"pt-4 border-t border-cream-border",children:[e.jsx("h3",{className:"font-semibold text-brand-brown mb-2",children:"Custom Location Aliases"}),e.jsx("p",{className:"text-sm text-brand-brown/80 mb-3",children:'Add your own shortcuts (e.g., "PSB" → Port Shepstone). These merge with built-ins and only apply on this device.'}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 items-start sm:items-end",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-xs text-brand-brown/70 mb-1",children:"Alias key"}),e.jsx("input",{className:"w-full border border-cream-border px-2 py-1.5 bg-white",placeholder:"e.g., psb",value:b.key,onChange:s=>y(n=>({...n,key:s.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-brand-brown/70 mb-1",children:"Type"}),e.jsxs("select",{className:"border border-cream-border px-2 py-1.5 bg-white",value:b.kind,onChange:s=>y(n=>({...n,kind:s.target.value})),children:[e.jsx("option",{value:"area",children:"Area"}),e.jsx("option",{value:"city",children:"City"}),e.jsx("option",{value:"province",children:"Province"}),e.jsx("option",{value:"country",children:"Country"}),e.jsx("option",{value:"continent",children:"Continent"})]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-xs text-brand-brown/70 mb-1",children:"Maps to"}),e.jsx("input",{className:"w-full border border-cream-border px-2 py-1.5 bg-white",placeholder:"e.g., Port Shepstone",value:b.value,onChange:s=>y(n=>({...n,value:s.target.value}))})]}),e.jsx("div",{children:e.jsx("button",{onClick:K,className:"px-3 py-1.5 bg-brand-orange text-white",children:"Add"})})]}),v&&v.length?e.jsx("ul",{className:"mt-3 divide-y divide-cream-border",children:v.map(s=>e.jsxs("li",{className:"py-2 flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-brand-brown",children:[e.jsx("span",{className:"font-mono bg-white border border-cream-border px-1 py-0.5 mr-2",children:s.key}),s.area?`Area: ${s.area}`:s.city?`City: ${s.city}`:s.province?`Province: ${s.province}`:s.country?`Country: ${s.country}`:s.continent?`Continent: ${s.continent}`:""]}),e.jsx("button",{onClick:()=>O(s.key),className:"px-2 py-1 border border-cream-border bg-white text-brand-brown",children:"Remove"})]},s.key))}):e.jsx("p",{className:"text-xs text-brand-brown/70 mt-2",children:"No custom aliases yet."})]})]})]})}export{M as default};
