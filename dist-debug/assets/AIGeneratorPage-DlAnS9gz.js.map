{"version":3,"file":"AIGeneratorPage-DlAnS9gz.js","sources":["../../src/utils/logger.js","../../src/utils/aiClient.js","../../src/utils/aiSessionClient.js","../../src/components/AIGeneratorPanel.jsx","../../src/pages/AIGeneratorPage.jsx"],"sourcesContent":["/* eslint-disable no-console */\r\n// Lightweight logger helper with performance monitoring\r\n// Keep console statements confined to this file so ESLint warnings don't appear\r\n// across the codebase. Logs are only emitted outside of production builds.\r\n\r\nconst isDev = process.env.NODE_ENV !== 'production';\r\nconst performanceMarkers = new Map();\r\n\r\nexport function dbg(...args) {\r\n  if (isDev) {\r\n    // console usage intentionally allowed in this helper\r\n    // eslint-disable-next-line no-console\r\n    console.log(...args);\r\n  }\r\n}\r\n\r\n/**\r\n * Mark a performance checkpoint\r\n * @param {string} name - Unique name for this marker\r\n * @example markStart('api-fetch')\r\n */\r\nexport function markStart(name) {\r\n  if (isDev && typeof performance !== 'undefined' && performance.mark) {\r\n    performance.mark(`${name}-start`);\r\n  }\r\n  performanceMarkers.set(`${name}-start`, Date.now());\r\n}\r\n\r\n/**\r\n * Measure time since markStart was called\r\n * @param {string} name - Name matching the markStart call\r\n * @param {boolean} log - Whether to log the result (default: true)\r\n * @returns {number} Duration in milliseconds\r\n * @example const duration = markEnd('api-fetch'); // logs: \"api-fetch: 245ms\"\r\n */\r\nexport function markEnd(name, log = true) {\r\n  const startKey = `${name}-start`;\r\n  const startTime = performanceMarkers.get(startKey);\r\n  \r\n  if (!startTime) {\r\n    if (isDev) {\r\n      // eslint-disable-next-line no-console\r\n      console.warn(`[logger] No marker found for \"${name}\"`);\r\n    }\r\n    return 0;\r\n  }\r\n  \r\n  const duration = Date.now() - startTime;\r\n  performanceMarkers.delete(startKey);\r\n  \r\n  if (isDev && typeof performance !== 'undefined' && performance.mark && performance.measure) {\r\n    try {\r\n      performance.mark(`${name}-end`);\r\n      performance.measure(name, `${name}-start`, `${name}-end`);\r\n    } catch (e) {\r\n      // Silently ignore if marks don't exist\r\n    }\r\n  }\r\n  \r\n  if (log && isDev) {\r\n    // eslint-disable-next-line no-console\r\n    console.log(`[${name}] ${duration}ms`);\r\n  }\r\n  \r\n  return duration;\r\n}\r\n\r\n/**\r\n * Log a warning message\r\n * @param {string} message - Warning message\r\n * @param {*} data - Optional additional data to log\r\n */\r\nexport function warn(message, data = null) {\r\n  if (isDev) {\r\n    // eslint-disable-next-line no-console\r\n    console.warn(`[⚠️  warning] ${message}`, data);\r\n  }\r\n}\r\n\r\n/**\r\n * Log an error message\r\n * @param {string} message - Error message\r\n * @param {Error} error - Optional error object\r\n */\r\nexport function error(message, error = null) {\r\n  if (isDev) {\r\n    // eslint-disable-next-line no-console\r\n    console.error(`[❌ error] ${message}`, error);\r\n  }\r\n}\r\n\r\n/**\r\n * Log an info message\r\n * @param {string} message - Info message\r\n * @param {*} data - Optional additional data\r\n */\r\nexport function info(message, data = null) {\r\n  if (isDev) {\r\n    // eslint-disable-next-line no-console\r\n    console.info(`[ℹ️  info] ${message}`, data);\r\n  }\r\n}\r\n\r\n/**\r\n * Get all active performance markers for debugging\r\n * @returns {Array} Array of {name, duration} objects\r\n */\r\nexport function getActiveMarkers() {\r\n  const now = Date.now();\r\n  return Array.from(performanceMarkers.entries()).map(([name, time]) => ({\r\n    name: name.replace('-start', ''),\r\n    duration: now - time,\r\n  }));\r\n}\r\n\r\n/**\r\n * Clear all performance markers\r\n */\r\nexport function clearMarkers() {\r\n  performanceMarkers.clear();\r\n}\r\n\r\nexport default { dbg, markStart, markEnd, warn, error, info, getActiveMarkers, clearMarkers };\r\n","// AI client utility wrapping REST + SSE streaming itinerary generation.\r\n// Provides two main functions:\r\n//  - generateItinerary(prompt): single shot POST returning parsed data\r\n//  - streamItinerary(prompt, { onEvent, onError, onDone, signal }) : SSE phased stream\r\n\r\n// Prefer build-time env, but allow a runtime override during E2E tests.\r\nconst BUILD_API_BASE = import.meta.env.VITE_API_BASE || 'http://localhost:4000';\r\nfunction getApiBase() {\r\n  try {\r\n    if (typeof window !== 'undefined' && window.__E2E__) {\r\n      // If the test harness provided an explicit API base, use it. Otherwise\r\n      // use same-origin to route requests through the preview server (\"/api/...\").\r\n      return window.__E2E_API_BASE != null ? window.__E2E_API_BASE : '';\r\n    }\r\n  } catch (e) {}\r\n  return BUILD_API_BASE;\r\n}\r\nlet API_BASE = getApiBase();\r\n// If we're deployed (non-localhost) but API_BASE points to localhost, fall back to same-origin.\r\ntry {\r\n  if (typeof window !== 'undefined') {\r\n    const host = window.location.hostname;\r\n    if (host && host !== 'localhost' && /localhost:\\d+$/i.test(API_BASE)) {\r\n      API_BASE = ''; // use relative /api/* endpoints (expect reverse proxy or same server)\r\n    }\r\n  }\r\n} catch {}\r\nconst API_TOKEN = import.meta.env.VITE_API_TOKEN || '';\r\nfunction withAuth(headers = {}){\r\n  const h = { ...headers };\r\n  if (API_TOKEN) h['Authorization'] = `Bearer ${API_TOKEN}`;\r\n  return h;\r\n}\r\n\r\nexport async function generateItinerary(prompt) {\r\n  try {\r\n    const res = await fetch(`${API_BASE}/api/ai/itinerary`, {\r\n      method: 'POST',\r\n      headers: withAuth({ 'Content-Type': 'application/json' }),\r\n      body: JSON.stringify({ prompt })\r\n    });\r\n    if (!res.ok) {\r\n      let err = `Request failed (${res.status})`;\r\n      try { const j = await res.json(); err = j.error || err; } catch {}\r\n      throw new Error(err);\r\n    }\r\n    const data = await res.json();\r\n    return data.data;\r\n  } catch (e) {\r\n    if (e.name === 'TypeError') {\r\n      // Network errors often surface as TypeError in fetch\r\n      throw new Error('Network error – verify API is reachable');\r\n    }\r\n    throw e;\r\n  }\r\n}\r\n\r\nexport function streamItinerary(prompt, { onEvent, onError, onDone, signal } = {}) {\r\n  const url = new URL(`${API_BASE}/api/ai/itinerary/stream`);\r\n  url.searchParams.set('prompt', prompt);\r\n  const ctrl = new AbortController();\r\n  if (signal) signal.addEventListener('abort', () => ctrl.abort(), { once: true });\r\n\r\n  fetch(url.toString(), { signal: ctrl.signal, headers: withAuth({ 'Accept': 'text/event-stream' }) })\r\n    .then(async (res) => {\r\n      if (!res.ok) {\r\n        let err = `Stream request failed (${res.status})`;\r\n        try { const j = await res.json(); err = j.error || err; } catch {}\r\n        throw new Error(err);\r\n      }\r\n      const reader = res.body.getReader();\r\n      const decoder = new TextDecoder('utf-8');\r\n      let buffer = '';\r\n  // Stream reader loop\r\n  // eslint-disable-next-line no-constant-condition\r\n  while (true) {\r\n        const { done, value } = await reader.read();\r\n        if (done) break;\r\n        buffer += decoder.decode(value, { stream: true });\r\n        let idx;\r\n        while ((idx = buffer.indexOf('\\n\\n')) !== -1) {\r\n          const chunk = buffer.slice(0, idx).trim();\r\n          buffer = buffer.slice(idx + 2);\r\n          if (!chunk) continue;\r\n          const lines = chunk.split('\\n');\r\n            let event = 'message';\r\n            let data = '';\r\n            for (const ln of lines) {\r\n              if (ln.startsWith('event:')) event = ln.slice(6).trim();\r\n              else if (ln.startsWith('data:')) data += ln.slice(5).trim();\r\n            }\r\n            if (data) {\r\n              try {\r\n                const parsed = JSON.parse(data);\r\n                onEvent && onEvent({ event, data: parsed });\r\n                if (event === 'pricing') {\r\n                  // Dispatch custom event so layout can surface a global toast shortcut\r\n                  try { window.dispatchEvent(new CustomEvent('colleco:draftPricing',{ detail:{ phase:'pricing' } })); } catch {}\r\n                }\r\n                if (event === 'done') {\r\n                  onDone && onDone();\r\n                }\r\n              } catch (e) {\r\n                // ignore JSON parse errors per event\r\n              }\r\n            }\r\n        }\r\n      }\r\n      onDone && onDone();\r\n    })\r\n    .catch(err => {\r\n      if (ctrl.signal.aborted) return; // ignore abort errors\r\n      if (err && err.name === 'TypeError') {\r\n        onError && onError(new Error('Network error – streaming endpoint unreachable'));\r\n      } else {\r\n        onError && onError(err);\r\n      }\r\n    });\r\n\r\n  return { cancel: () => ctrl.abort() };\r\n}\r\n\r\nexport async function refineItinerary(prompt, instructions){\r\n  const res = await fetch(`${API_BASE}/api/ai/itinerary/refine`, {\r\n    method: 'POST',\r\n    headers: withAuth({ 'Content-Type': 'application/json' }),\r\n    body: JSON.stringify({ prompt, instructions })\r\n  });\r\n  if(!res.ok){\r\n    let err = 'Refine failed';\r\n    try { const j = await res.json(); err = j.error || err; } catch{}\r\n    throw new Error(err);\r\n  }\r\n  const data = await res.json();\r\n  return data.data;\r\n}\r\n\r\n// New: parse flight intent from natural language\r\nexport async function parseFlightIntent(prompt){\r\n  const res = await fetch(`${API_BASE}/api/ai/flight`, {\r\n    method: 'POST',\r\n    headers: withAuth({ 'Content-Type': 'application/json' }),\r\n    body: JSON.stringify({ prompt })\r\n  });\r\n  if(!res.ok){\r\n    let err = 'Flight intent failed';\r\n    try { const j = await res.json(); err = j.error || err; } catch{}\r\n    throw new Error(err);\r\n  }\r\n  const data = await res.json();\r\n  return data.data;\r\n}\r\n\r\n// Unified parse intent\r\nexport async function parseIntent(prompt){\r\n  const res = await fetch(`${API_BASE}/api/ai/intent`, {\r\n    method: 'POST',\r\n    headers: withAuth({ 'Content-Type': 'application/json' }),\r\n    body: JSON.stringify({ prompt })\r\n  });\r\n  if(!res.ok){\r\n    let err = 'Intent parse failed';\r\n    try { const j = await res.json(); err = j.error || err; } catch{}\r\n    throw new Error(err);\r\n  }\r\n  const data = await res.json();\r\n  return data.data;\r\n}\r\n","// Session-oriented AI helpers\r\nconst API_BASE = import.meta.env.VITE_API_BASE || 'http://localhost:4000';\r\nconst API_TOKEN = import.meta.env.VITE_API_TOKEN || '';\r\nfunction withAuth(headers = {}){\r\n  const h = { ...headers };\r\n  if (API_TOKEN) h['Authorization'] = `Bearer ${API_TOKEN}`;\r\n  return h;\r\n}\r\n\r\nexport async function startSession(prompt){\r\n  const res = await fetch(`${API_BASE}/api/ai/session`, { method:'POST', headers: withAuth({'Content-Type':'application/json'}), body: JSON.stringify({ prompt }) });\r\n  if(!res.ok){ let e='Session start failed'; try{const j=await res.json(); e=j.error||e;}catch{} throw new Error(e); }\r\n  return res.json();\r\n}\r\n\r\nexport async function refineSession(id, instructions){\r\n  const res = await fetch(`${API_BASE}/api/ai/session/${id}/refine`, { method:'POST', headers: withAuth({'Content-Type':'application/json'}), body: JSON.stringify({ instructions }) });\r\n  if(!res.ok){ let e='Session refine failed'; try{const j=await res.json(); e=j.error||e;}catch{} throw new Error(e); }\r\n  const data = await res.json();\r\n  return data.data;\r\n}\r\n\r\nexport async function uploadDraft(prompt, data){\r\n  const res = await fetch(`${API_BASE}/api/ai/draft`, { method:'POST', headers: withAuth({'Content-Type':'application/json'}), body: JSON.stringify({ prompt, data }) });\r\n  if(!res.ok){ let e='Upload failed'; try{const j=await res.json(); e=j.error||e;}catch{} throw new Error(e); }\r\n  return res.json();\r\n}\r\n\r\nexport async function fetchSession(id){\r\n  const res = await fetch(`${API_BASE}/api/ai/session/${id}`, { headers: withAuth() });\r\n  if(!res.ok){ let e='Fetch session failed'; try{const j=await res.json(); e=j.error||e;}catch{} throw new Error(e); }\r\n  return res.json();\r\n}\r\n","import React, { useState, useRef, useEffect, useCallback } from 'react';\r\nimport { dbg } from '../utils/logger';\r\nimport WorkflowPanel from './WorkflowPanel';\r\nimport { Link } from 'react-router-dom';\r\nimport { generateItinerary, streamItinerary, parseFlightIntent, parseIntent } from '../utils/aiClient.js';\r\nimport { refineItinerary } from '../utils/aiClient.js';\r\nimport { startSession, refineSession, uploadDraft, fetchSession } from '../utils/aiSessionClient.js';\r\n\r\n/**\r\n * AI Itinerary Generator Panel\r\n * - Accepts natural language prompt\r\n * - Supports single-shot generation or progressive streaming\r\n * - Shows phased output (parse, plan, pricing) with accessible live updates\r\n */\r\nexport default function AIGeneratorPanel() {\r\n  const [prompt, setPrompt] = useState(() => {\r\n    try {\r\n      const saved = localStorage.getItem('colleco.lastAIPrompt');\r\n      return saved || 'Family trip to Rome and Florence for 6 nights in June, 2 adults 1 child, budget $4000, love food and history';\r\n    } catch {\r\n      return 'Family trip to Rome and Florence for 6 nights in June, 2 adults 1 child, budget $4000, love food and history';\r\n    }\r\n  });\r\n  const [mode, setMode] = useState('stream'); // 'stream' | 'single'\r\n  const [phases, setPhases] = useState({});\r\n  const [fullData, setFullData] = useState(null);\r\n  const [error, setError] = useState('');\r\n  const [refineText, setRefineText] = useState('');\r\n  const [refining, setRefining] = useState(false);\r\n  const [applied, setApplied] = useState(false);\r\n  const [sessionId, setSessionId] = useState(null);\r\n  const [sessionMode, setSessionMode] = useState(false);\r\n  const [loading, setLoading] = useState(false);\r\n  const [active, setActive] = useState(false);\r\n  const [uploading, setUploading] = useState(false);\r\n  const [uploadedId, setUploadedId] = useState(null);\r\n  const [scoped, setScoped] = useState(false);\r\n  const [history, setHistory] = useState([]); // session snapshots\r\n  const [showDiff, setShowDiff] = useState(false);\r\n  const [flightIntent, setFlightIntent] = useState(null);\r\n  const [intents, setIntents] = useState([]);\r\n  const [, setLastOps] = useState(null);\r\n  const [opsUndo, setOpsUndo] = useState([]);\r\n  const abortRef = useRef(null);\r\n  const liveRef = useRef(null);\r\n\r\n  // Persist prompt to localStorage\r\n  useEffect(() => {\r\n    try {\r\n      if (prompt && prompt.trim()) localStorage.setItem('colleco.lastAIPrompt', prompt);\r\n    } catch {}\r\n  }, [prompt]);\r\n\r\n  const liveMessage = useCallback(() => {\r\n    if (error) return `Error: ${error}`;\r\n    if (loading && mode === 'single') return 'Generating draft';\r\n    if (active && mode === 'stream') {\r\n      const done = phases.done;\r\n      if (done) return 'Generation complete';\r\n      if (phases.pricing) return 'Pricing phase received';\r\n      if (phases.plan) return 'Plan phase received';\r\n      if (phases.parse) return 'Parse phase received';\r\n      return 'Preparing draft…';\r\n    }\r\n    return '';\r\n  }, [phases, error, loading, active, mode]);\r\n\r\n  // Update live region when message changes\r\n  useEffect(() => {\r\n    if (liveRef.current) liveRef.current.textContent = liveMessage();\r\n  }, [liveMessage]);\r\n\r\n  function reset() {\r\n    setPhases({}); setFullData(null); setError(''); setLoading(false); setActive(false); abortRef.current?.cancel(); abortRef.current=null;\r\n    setApplied(false);\r\n    setSessionId(null); setUploadedId(null);\r\n    setHistory([]); setShowDiff(false);\r\n    setFlightIntent(null);\r\n    setIntents([]);\r\n    setLastOps(null);\r\n    setOpsUndo([]);\r\n  }\r\n\r\n  async function handleSingle() {\r\n    reset();\r\n    if (!prompt.trim()) { setError('Prompt required'); return; }\r\n    setLoading(true);\r\n    try {\r\n    dbg('[AIGEN] handleSingle: sending generate request', { prompt: prompt && prompt.slice(0,80) });\r\n      const data = await generateItinerary(prompt.trim());\r\n  dbg('[AIGEN] handleSingle: received data', data);\r\n      setFullData(data);\r\n      const parsePhase = baseFrom(data);\r\n  dbg('[AIGEN] handleSingle: parsePhase', parsePhase);\r\n      setPhases({ parse: parsePhase, plan: { itinerary: data.itinerary }, pricing: { pricing: data.pricing }, done: true });\r\n      setActive(false);\r\n    } catch(e) {\r\n      setError(e.message || 'Generation failed');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }\r\n\r\n  function handleStream() {\r\n    reset();\r\n    if (!prompt.trim()) { setError('Prompt required'); return; }\r\n  // detect intents first (unified)\r\n  parseIntent(prompt.trim()).then((r)=>{ if(r && Array.isArray(r.intents)) setIntents(r.intents); }).catch(()=>{});\r\n  // keep flight intent for now (backward compatibility/UI card)\r\n  parseFlightIntent(prompt.trim()).then(setFlightIntent).catch(()=>{});\r\n    setActive(true);\r\n    const stream = streamItinerary(prompt.trim(), {\r\n      onEvent: ({ event, data }) => {\r\n        setPhases(prev => {\r\n          const next = { ...prev };\r\n          if (event === 'parse') next.parse = data;\r\n          else if (event === 'plan') next.plan = data;\r\n          else if (event === 'pricing') next.pricing = data;\r\n          else if (event === 'done') next.done = true;\r\n          return next;\r\n        });\r\n        if (event === 'done') setActive(false);\r\n      },\r\n      onError: (err) => { setError(err.message || 'Stream failed'); setActive(false); },\r\n      onDone: () => { setActive(false); }\r\n    });\r\n    abortRef.current = stream;\r\n  }\r\n\r\n  function deepClonePhases(p){\r\n    try { return JSON.parse(JSON.stringify(p)); } catch { return { ...p }; }\r\n  }\r\n\r\n  function applyExtendShorten(nightsDelta){\r\n    setPhases(prev=>{\r\n      if(!prev || !prev.plan || !prev.plan.itinerary) return prev;\r\n      const snapshot = deepClonePhases(prev);\r\n      setOpsUndo(stack=>[...stack, snapshot]);\r\n      const next = deepClonePhases(prev);\r\n      const currentNights = next.parse?.nights || next.plan.itinerary.length;\r\n      let newNights = Math.max(1, currentNights + nightsDelta);\r\n      // update parse\r\n      if(next.parse) next.parse.nights = newNights;\r\n      // adjust itinerary days\r\n      const days = [...next.plan.itinerary];\r\n      if(newNights > days.length){\r\n        const toAdd = newNights - days.length;\r\n        const last = days[days.length-1] || { destination: next.parse?.destinations?.[0]||'Destination', activities:['Leisure & exploration'] };\r\n        for(let i=0;i<toAdd;i++){\r\n          const dayNum = days.length+1;\r\n          const dest = last.destination || last.title?.replace(/^.*-\\s*/,'') || 'Destination';\r\n          days.push({ day: dayNum, title: `Day ${dayNum} - ${dest}`, destination: dest, activities: [...(last.activities||['Leisure & exploration'])] });\r\n        }\r\n      } else if(newNights < days.length){\r\n        days.length = newNights;\r\n      }\r\n      next.plan.itinerary = days.map((d,idx)=> ({ ...d, day: idx+1, title: `Day ${idx+1} - ${d.destination||d.title?.replace(/^.*-\\s*/,'')||'Destination'}` }));\r\n      return next;\r\n    });\r\n  }\r\n\r\n  function applyBudgetAdjust(percent){\r\n    setPhases(prev=>{\r\n      if(!prev || !prev.pricing || !prev.pricing.pricing) return prev;\r\n      const snapshot = deepClonePhases(prev);\r\n      setOpsUndo(stack=>[...stack, snapshot]);\r\n      const next = deepClonePhases(prev);\r\n      const scale = 1 + (percent/100);\r\n      const p = next.pricing.pricing;\r\n      if(p.total!=null) p.total = Math.round(p.total * scale);\r\n      if(p.breakdown){ Object.keys(p.breakdown).forEach(k=>{ p.breakdown[k] = Math.round(p.breakdown[k] * scale); }); }\r\n      if(p.note){ p.note += percent>=0? ` · increased by ${percent}%` : ` · decreased by ${Math.abs(percent)}%`; }\r\n      return next;\r\n    });\r\n  }\r\n\r\n  function applySwapDestination(from, to){\r\n    setPhases(prev=>{\r\n      if(!prev || !prev.plan || !prev.plan.itinerary) return prev;\r\n      const snapshot = deepClonePhases(prev);\r\n      setOpsUndo(stack=>[...stack, snapshot]);\r\n      const next = deepClonePhases(prev);\r\n      // update parse destinations list\r\n      if(next.parse && Array.isArray(next.parse.destinations)){\r\n        next.parse.destinations = next.parse.destinations.map(d=> (d.toLowerCase()===String(from).toLowerCase()? to : d));\r\n      }\r\n      // update each day\r\n      const fromLc = String(from).toLowerCase();\r\n      next.plan.itinerary = next.plan.itinerary.map((d,idx)=>{\r\n        const dest = (d.destination||d.title||'').toString();\r\n        const isMatch = dest.toLowerCase()===fromLc || /-\\s*.+$/.test(d.title||'') && (d.title.replace(/^.*-\\s*/,'').toLowerCase()===fromLc);\r\n        const newDest = isMatch ? to : (d.destination||d.title?.replace(/^.*-\\s*/,'')||dest);\r\n        return { ...d, day: idx+1, destination: newDest, title: `Day ${idx+1} - ${newDest}` };\r\n      });\r\n      return next;\r\n    });\r\n  }\r\n\r\n  function applyItineraryOps(ops){\r\n    if(!ops || ops.length===0) return;\r\n    setLastOps(ops);\r\n    for(const op of ops){\r\n      if(op.op==='extend') applyExtendShorten(+Math.abs(op.nightsDelta||1));\r\n      else if(op.op==='shorten') applyExtendShorten(-Math.abs(op.nightsDelta||1));\r\n      else if(op.op==='adjustBudget') applyBudgetAdjust(op.percent||0);\r\n      else if(op.op==='swapDestination' && op.from && op.to) applySwapDestination(op.from, op.to);\r\n    }\r\n    if(liveRef.current){ liveRef.current.textContent = `Applied ${ops.length} itinerary change${ops.length>1?'s':''}.`; setTimeout(()=>{ if(liveRef.current) liveRef.current.textContent=''; },2500); }\r\n  }\r\n\r\n  function undoLastOps(){\r\n    setOpsUndo(stack=>{\r\n      if(!stack || stack.length===0) return stack;\r\n      const nextStack = stack.slice(0, -1);\r\n      const snapshot = stack[stack.length-1];\r\n      setPhases(snapshot);\r\n      if(liveRef.current){ liveRef.current.textContent = 'Reverted last itinerary changes.'; setTimeout(()=>{ if(liveRef.current) liveRef.current.textContent=''; },2000); }\r\n      return nextStack;\r\n    });\r\n  }\r\n\r\n  function handleCancel() {\r\n    abortRef.current?.cancel();\r\n    setActive(false); setLoading(false);\r\n  }\r\n\r\n  async function handleRefine(){\r\n    if(!fullData && !phases.parse) { setError('Generate first'); return; }\r\n    if(!refineText.trim()) { setError('Refine instructions required'); return; }\r\n    setRefining(true); setError('');\r\n    try {\r\n      let refined;\r\n      if(sessionMode && sessionId){\r\n        refined = await refineSession(sessionId, refineText.trim());\r\n        // refresh history\r\n        try { const full = await fetchSession(sessionId); setHistory(full.history||[]); } catch {}\r\n      } else {\r\n        const basePrompt = prompt.trim();\r\n        refined = await refineItinerary(basePrompt, refineText.trim());\r\n      }\r\n  setFullData(refined);\r\n  setPhases({ parse: baseFrom(refined), plan: { itinerary: refined.itinerary }, pricing: { pricing: refined.pricing }, done: true });\r\n       setRefineText('');\r\n     } catch(e){ setError(e.message||'Refine failed'); }\r\n     finally { setRefining(false); }\r\n   }\r\n\r\n  async function handleStartSession(){\r\n    if(!prompt.trim()) { setError('Prompt required'); return; }\r\n    try {\r\n  const s = await startSession(prompt.trim());\r\n      setSessionId(s.id);\r\n      setSessionMode(true);\r\n  setFullData(s.data);\r\n  setPhases({ parse: baseFrom(s.data), plan: { itinerary: s.data.itinerary }, pricing: { pricing: s.data.pricing }, done: true });\r\n  setScoped(!!s.scoped);\r\n      setHistory([{ type:'parse', data: s.data, at: Date.now() }]);\r\n      if(liveRef.current){ liveRef.current.textContent = 'Session started'; setTimeout(()=>{ if(liveRef.current) liveRef.current.textContent=''; },1500); }\r\n    } catch(e){ setError(e.message||'Session failed'); }\r\n  }\r\n\r\n  async function handleUploadDraft(){\r\n    const data = fullData || (phases.parse && phases.plan && phases.pricing && {\r\n      ...phases.parse,\r\n      itinerary: phases.plan.itinerary,\r\n      pricing: phases.pricing.pricing\r\n    });\r\n    if(!data){ setError('Nothing to upload'); return; }\r\n    setUploading(true); setError('');\r\n    try {\r\n  const r = await uploadDraft(prompt.trim(), data);\r\n  setUploadedId(r.id); if(r.scoped) setScoped(true);\r\n    } catch(e){ setError(e.message||'Upload failed'); }\r\n    finally { setUploading(false); }\r\n  }\r\n\r\n  function handleApply(){\r\n    const data = fullData || (phases.parse && phases.plan && phases.pricing && {\r\n      ...phases.parse,\r\n      itinerary: phases.plan.itinerary,\r\n      pricing: phases.pricing.pricing\r\n    });\r\n    if(!data){ setError('Nothing to apply yet'); return; }\r\n    try {\r\n      const draft = {\r\n        appliedAt: Date.now(),\r\n        sourcePrompt: prompt.trim(),\r\n        itinerary: data.itinerary,\r\n        meta: {\r\n          nights: data.nights,\r\n          destinations: data.destinations,\r\n          interests: data.interests,\r\n          budget: data.budget\r\n        }\r\n      };\r\n      localStorage.setItem('aiItineraryDraft:v1', JSON.stringify(draft));\r\n      setApplied(true);\r\n      // Announce via live region\r\n      if(liveRef.current){ liveRef.current.textContent = 'AI draft stored. Open Itinerary page to import.'; setTimeout(()=>{ if(liveRef.current) liveRef.current.textContent=''; }, 3000); }\r\n    } catch(e){ setError('Failed to store draft'); }\r\n  }\r\n\r\n  function formatCurrency(v, c) { return new Intl.NumberFormat(undefined, { style: 'currency', currency: c||'USD'}).format(v); }\r\n\r\n  // Normalize raw AI data to parse phase shape\r\n  function baseFrom(data) {\r\n    if (!data || typeof data !== 'object') return {};\r\n    const nights = data.nights ?? (Array.isArray(data.itinerary) ? data.itinerary.length : undefined);\r\n    const destinations = Array.isArray(data.destinations) ? data.destinations : Array.isArray(data.itinerary) ? data.itinerary.map(d => d.destination || d.title?.replace(/^.*-\\s*/, '')).filter(Boolean) : [];\r\n    const interests = Array.isArray(data.interests) ? data.interests : [];\r\n    const budget = data.budget ?? (data.pricing && data.pricing.total ? { amount: data.pricing.total, currency: (data.pricing.currency || 'USD') } : undefined);\r\n    return { nights, destinations, interests, budget };\r\n  }\r\n\r\n  const parse = phases.parse; const plan = phases.plan; const pricing = phases.pricing;\r\n\r\n  return (\r\n    <div className=\"ai-panel max-w-4xl mx-auto flex flex-col gap-4\" aria-labelledby=\"aiGenHeading\">\r\n  <h1 id=\"aiGenHeading\" className=\"text-2xl font-bold text-brand-brown\">Trip Assist</h1>\r\n  <p className=\"text-sm text-brand-brown/80 leading-snug\">Describe your trip — budget, vibe, pace, must‑dos. You’ll get a draft with an outline and rough costs. See it build in steps or generate a single draft, then refine until it feels right.</p>\r\n\r\n  {/* Workflow Panel */}\r\n  <WorkflowPanel currentPage=\"ai\" />\r\n\r\n      {/* Quick start prompt ideas */}\r\n      <div className=\"rounded border border-cream-border bg-cream p-3\">\r\n        <div className=\"text-xs font-semibold text-brand-brown mb-2\">Quick start ideas</div>\r\n        <div className=\"flex gap-2 overflow-x-auto pb-1 pr-1\">\r\n          {[\r\n            'Family-friendly Cape Town long weekend in June, 2 adults 2 kids, budget $2000, nature + beaches + penguins',\r\n            'Romantic Italy 7 nights: Rome, Florence, Amalfi; foodie + history; mid-range; September',\r\n            'Safari + beach 10 days: Kruger + Mauritius; 2 adults; July; budget $5000; photography + relaxation',\r\n            'Backpacking Southeast Asia 14 days: Thailand + Vietnam; budget; nightlife + street food; hostels',\r\n            'Wine and wildlife 5 nights: Stellenbosch + Cape Town; 4 adults; September; wineries + Table Mountain',\r\n          ].map((s, idx) => (\r\n            <button\r\n              key={idx}\r\n              type=\"button\"\r\n              onClick={() => setPrompt(s)}\r\n              className=\"shrink-0 max-w-[22rem] text-left px-2 py-1 rounded border border-cream-border bg-cream-sand hover:bg-cream-hover text-[11px]\"\r\n              title=\"Use this idea\"\r\n            >\r\n              {s}\r\n            </button>\r\n          ))}\r\n        </div>\r\n      </div>\r\n      <label className=\"flex flex-col gap-1 text-sm font-medium text-brand-brown\">\r\n        Prompt\r\n        <textarea value={prompt} onChange={e=>setPrompt(e.target.value)} rows={4} className=\"w-full p-2 rounded border border-cream-border bg-cream focus:outline-none focus:ring-2 focus:ring-brand-orange/40 text-sm resize-y\" />\r\n      </label>\r\n      {/* Intent detections */}\r\n      {intents && intents.length>0 && (\r\n        <div className=\"rounded border border-cream-border bg-cream-sand/60 p-3 text-xs\">\r\n          <div className=\"font-semibold mb-1\">Detected request{intents.length>1?'s':''}</div>\r\n          <div className=\"flex flex-col gap-2\">\r\n            {intents.filter(i=>i.type!=='flight_search').map((i,idx)=>{\r\n              if(i.type==='hotel_search'){\r\n                const href = `/plan-trip?category=Lodging${i.city?`&city=${encodeURIComponent(i.city)}`:''}${i.budget?.amount?`&budget=${encodeURIComponent(i.budget.amount)}`:''}${i.stars?`&stars=${i.stars}`:''}`;\r\n                return (\r\n                  <div key={idx} className=\"flex items-center justify-between gap-2\">\r\n                    <div>Hotel search {i.city?`in ${i.city}`:''} {i.nights?`· ${i.nights} nights`:''}</div>\r\n                    <a href={href} className=\"inline-flex items-center px-2 py-1 rounded bg-brand-orange text-white\">Find hotels</a>\r\n                  </div>\r\n                );\r\n              }\r\n              if(i.type==='car_rental'){\r\n                const href = `/plan-trip?category=Transport${i.pickupCity?`&city=${encodeURIComponent(i.pickupCity)}`:''}`;\r\n                return (\r\n                  <div key={idx} className=\"flex items-center justify-between gap-2\">\r\n                    <div>Car hire {i.pickupCity?`in ${i.pickupCity}`:''} {i.pickupDate?`· ${i.pickupDate}`:''}</div>\r\n                    <a href={href} className=\"inline-flex items-center px-2 py-1 rounded bg-brand-orange text-white\">Find cars</a>\r\n                  </div>\r\n                );\r\n              }\r\n              if(i.type==='activity_search'){\r\n                const href = `/plan-trip?category=Activity${i.city?`&city=${encodeURIComponent(i.city)}`:''}`;\r\n                return (\r\n                  <div key={idx} className=\"flex items-center justify-between gap-2\">\r\n                    <div>Activities {i.city?`in ${i.city}`:''} {i.startDate?`· ${i.startDate}`:''}</div>\r\n                    <a href={href} className=\"inline-flex items-center px-2 py-1 rounded bg-brand-orange text-white\">Find activities</a>\r\n                  </div>\r\n                );\r\n              }\r\n              if(i.type==='dining_search'){\r\n                const href = `/plan-trip?category=Dining${i.city?`&city=${encodeURIComponent(i.city)}`:''}${i.nearMe?'&setLocation=1':''}`;\r\n                return (\r\n                  <div key={idx} className=\"flex items-center justify-between gap-2\">\r\n                    <div>Dining {i.city?`in ${i.city}`: i.nearMe? 'near you': ''} {i.time?`· ${i.time}`:''}</div>\r\n                    <a href={href} className=\"inline-flex items-center px-2 py-1 rounded bg-brand-orange text-white\">Find dining</a>\r\n                  </div>\r\n                );\r\n              }\r\n              if(i.type==='transfer_request'){\r\n                const href = `/plan-trip?category=Transport${i.city?`&city=${encodeURIComponent(i.city)}`:''}${i.nearMe?'&setLocation=1':''}`;\r\n                return (\r\n                  <div key={idx} className=\"flex items-center justify-between gap-2\">\r\n                    <div>Transfers {i.city?`in ${i.city}`: i.nearMe? 'near you': ''} {i.time?`· ${i.time}`:''}</div>\r\n                    <a href={href} className=\"inline-flex items-center px-2 py-1 rounded bg-brand-orange text-white\">Find transfers</a>\r\n                  </div>\r\n                );\r\n              }\r\n              if(i.type==='event_search'){\r\n                const href = `/plan-trip?tab=events${i.city?`&city=${encodeURIComponent(i.city)}`:''}${i.nearMe?'&setLocation=1':''}`;\r\n                return (\r\n                  <div key={idx} className=\"flex items-center justify-between gap-2\">\r\n                    <div>Events {i.city?`in ${i.city}`: i.nearMe? 'near you': ''} {i.startDate?`· from ${i.startDate}`:''}</div>\r\n                    <a href={href} className=\"inline-flex items-center px-2 py-1 rounded bg-brand-orange text-white\">Browse events</a>\r\n                  </div>\r\n                );\r\n              }\r\n              if(i.type==='visa_help'){\r\n                return (\r\n                  <div key={idx} className=\"flex items-center justify-between gap-2\">\r\n                    <div>Visa help detected</div>\r\n                    <a href={`/compliance`} className=\"inline-flex items-center px-2 py-1 rounded bg-brand-brown text-white\">Open Compliance</a>\r\n                  </div>\r\n                );\r\n              }\r\n              if(i.type==='insurance_help'){\r\n                return (\r\n                  <div key={idx} className=\"flex items-center justify-between gap-2\">\r\n                    <div>Insurance help detected</div>\r\n                    <a href={`/compliance`} className=\"inline-flex items-center px-2 py-1 rounded bg-brand-brown text-white\">Open Compliance</a>\r\n                  </div>\r\n                );\r\n              }\r\n              if(i.type==='itinerary_ops'){\r\n                const hasUndo = opsUndo.length>0;\r\n                return (\r\n                  <div key={idx} className=\"flex items-center justify-between gap-2\">\r\n                    <div>Itinerary adjustments detected ({i.ops?.length||0})</div>\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <button type=\"button\" onClick={()=>applyItineraryOps(i.ops||[])} className=\"inline-flex items-center px-2 py-1 rounded bg-brand-brown text-white\">Apply now</button>\r\n                      {hasUndo && <button type=\"button\" onClick={undoLastOps} className=\"text-brand-brown underline\">Undo</button>}\r\n                    </div>\r\n                  </div>\r\n                );\r\n              }\r\n              if(i.type==='quote_ops'){\r\n                return (\r\n                  <div key={idx} className=\"flex items-center justify-between gap-2\">\r\n                    <div>Quote action detected</div>\r\n                    <a href={`/quotes/new`} className=\"inline-flex items-center px-2 py-1 rounded bg-brand-brown text-white\">Open quotes</a>\r\n                  </div>\r\n                );\r\n              }\r\n              return null;\r\n            })}\r\n          </div>\r\n        </div>\r\n      )}\r\n      {flightIntent && (\r\n        <div className=\"rounded border border-cream-border bg-cream-sand/60 p-3 text-xs\">\r\n          <div className=\"font-semibold mb-1\">Detected flight request</div>\r\n          <div>From: {flightIntent.from?.city} {flightIntent.from?.code? `(${flightIntent.from.code})`: ''}</div>\r\n          <div>To: {flightIntent.to?.city} {flightIntent.to?.code? `(${flightIntent.to.code})`: ''}</div>\r\n          <div>Date: {flightIntent.date || '—'} {flightIntent.time? `at ${flightIntent.time}`: ''}</div>\r\n          <div>Passengers: {flightIntent.pax} · Cabin: {flightIntent.cabin}</div>\r\n          <div className=\"mt-2 flex gap-2\">\r\n            <a href={`/plan-trip?category=Flights&from=${encodeURIComponent(flightIntent.from?.code||flightIntent.from?.city||'')}&to=${encodeURIComponent(flightIntent.to?.code||flightIntent.to?.city||'')}&date=${encodeURIComponent(flightIntent.date||'')}&time=${encodeURIComponent(flightIntent.time||'')}&pax=${flightIntent.pax}&cabin=${encodeURIComponent(flightIntent.cabin)}`}\r\n               className=\"inline-flex items-center px-3 py-1.5 rounded bg-brand-orange text-white\">\r\n              Search flights\r\n            </a>\r\n            <button onClick={()=>setFlightIntent(null)} className=\"text-brand-brown underline\">Dismiss</button>\r\n          </div>\r\n        </div>\r\n      )}\r\n      <div className=\"flex flex-wrap gap-3 items-center\">\r\n        <div className=\"inline-flex items-center gap-2 bg-cream-sand px-3 py-1 rounded border border-cream-border text-sm\">\r\n          <span className=\"font-semibold\">Mode:</span>\r\n          <label className=\"flex items-center gap-1 cursor-pointer\"><input type=\"radio\" name=\"aimode\" value=\"stream\" checked={mode==='stream'} onChange={()=>setMode('stream')} /> <span>Stream</span></label>\r\n          <label className=\"flex items-center gap-1 cursor-pointer\"><input type=\"radio\" name=\"aimode\" value=\"single\" checked={mode==='single'} onChange={()=>setMode('single')} /> <span>Single</span></label>\r\n        </div>\r\n        {mode==='single' && <button onClick={handleSingle} disabled={loading} className=\"px-4 py-2 rounded bg-brand-orange text-white text-sm font-semibold hover:bg-brand-highlight disabled:bg-gray-300 disabled:text-gray-500 disabled:cursor-not-allowed\">{loading? 'Generating…':'Generate'}</button>}\r\n        {mode==='stream' && <button onClick={handleStream} disabled={active} className=\"px-4 py-2 rounded bg-brand-orange text-white text-sm font-semibold hover:bg-brand-highlight disabled:bg-gray-300 disabled:text-gray-500 disabled:cursor-not-allowed\">{active? 'Streaming…':'Start Stream'}</button>}\r\n        {(active||loading) && <button onClick={handleCancel} className=\"px-3 py-2 rounded bg-brand-brown text-white text-xs font-semibold hover:bg-brand-brown/80\">Cancel</button>}\r\n        <button onClick={reset} className=\"px-3 py-2 rounded border border-brand-brown text-brand-brown text-xs font-semibold hover:bg-cream-hover\">Clear</button>\r\n  <button onClick={handleApply} disabled={applied || !(phases.plan && phases.pricing)} className=\"px-3 py-2 rounded bg-brand-brown text-white text-xs font-semibold disabled:bg-gray-300 disabled:text-gray-500 disabled:cursor-not-allowed\">{applied? 'Saved':'Save draft for Itinerary'}</button>\r\n        <button onClick={handleUploadDraft} disabled={uploading || uploadedId || !(phases.plan && phases.pricing)} className=\"px-3 py-2 rounded bg-brand-orange text-white text-xs font-semibold disabled:bg-gray-300 disabled:text-gray-500 disabled:cursor-not-allowed\">{uploadedId? 'Uploaded':'Upload Draft'}</button>\r\n        <div className=\"flex items-center gap-1 ml-2 text-[11px]\">\r\n          <label className=\"flex items-center gap-1 cursor-pointer\"><input type=\"checkbox\" checked={sessionMode} onChange={(e)=>{ if(!e.target.checked){ setSessionMode(false); setSessionId(null);} else { handleStartSession(); } }} /> Session</label>\r\n          {sessionId && <span className=\"text-green-700 flex items-center gap-1\">#{sessionId.slice(0,6)} {scoped && <span title=\"Scoped to token\" className=\"inline-block text-[10px] px-1 py-0.5 rounded bg-brand-orange text-white\">LOCK</span>}</span>}\r\n        </div>\r\n      </div>\r\n\r\n      {/* Next steps shortcuts */}\r\n      <div className=\"flex flex-wrap items-center gap-2 text-[11px] text-brand-brown/70\">\r\n        <span className=\"mr-1\">Next:</span>\r\n        <Link to=\"/itinerary\" className=\"underline hover:text-brand-brown\">Open Itinerary to import draft</Link>\r\n        <span aria-hidden>•</span>\r\n        <Link to=\"/plan-trip\" className=\"underline hover:text-brand-brown\">Open Trip Planner</Link>\r\n      </div>\r\n      <div className=\"mt-2 w-full flex flex-col gap-2 bg-cream-sand/50 border border-cream-border rounded p-3\">\r\n        <label className=\"text-xs font-semibold text-brand-brown flex items-center gap-2\">Refine plan\r\n          {refining && <span className=\"animate-pulse text-[10px] font-normal\">Refining…</span>}\r\n          {sessionMode && sessionId && <span className=\"text-[10px] bg-brand-brown text-white px-1.5 py-0.5 rounded\">Session</span>}\r\n        </label>\r\n        <textarea value={refineText} onChange={e=>setRefineText(e.target.value)} placeholder=\"e.g. slow the pace; add beach and 2 more nights; swap Florence for Venice\" rows={2} className=\"w-full p-2 rounded border border-cream-border bg-cream focus:outline-none focus:ring-1 focus:ring-brand-orange/40 text-xs resize-y\" />\r\n        <div className=\"flex gap-2\">\r\n          <button onClick={handleRefine} disabled={refining || !refineText.trim()} className=\"px-3 py-1.5 rounded bg-brand-orange text-white text-xs font-semibold disabled:bg-gray-300 disabled:text-gray-500 disabled:cursor-not-allowed\">Refine</button>\r\n          {applied && <span className=\"text-[11px] text-green-700\">Stored draft ready to import.</span>}\r\n        </div>\r\n  <p className=\"text-[10px] text-brand-brown/60\">Tips: Keep it short and actionable — e.g., &quot;add museum&quot;, &quot;add 2 more nights&quot;, &quot;swap to family‑friendly&quot;, &quot;reduce budget by 10%&quot;.</p>\r\n        {uploadedId && <p className=\"text-[10px] text-green-700\">Draft stored on server (id {uploadedId}).</p>}\r\n      </div>\r\n      <div aria-live=\"polite\" aria-atomic=\"true\" className=\"sr-only\" ref={liveRef} />\r\n      {error && <div role=\"alert\" className=\"bg-red-100 border border-red-300 text-red-800 px-3 py-2 rounded text-sm\">{error}</div>}\r\n\r\n      {/* Phases */}\r\n      <div className=\"grid md:grid-cols-3 gap-4\">\r\n        <section className=\"p-3 rounded border border-cream-border bg-cream-sand/40 flex flex-col\">\r\n          <h2 className=\"font-semibold text-sm mb-2 flex items-center gap-2\">Parse {parse ? <span className=\"text-green-600\">✓</span>: active&&mode==='stream'?<span className=\"animate-pulse\">…</span>:null}</h2>\r\n          {!parse && <p className=\"text-xs text-brand-brown/60\">Destinations, dates, travelers, budget, interests.</p>}\r\n          {parse && (\r\n            <div className=\"text-xs space-y-1\">\r\n              <div><span className=\"font-semibold\">Destinations:</span> {parse.destinations.join(', ')||'—'}</div>\r\n              <div><span className=\"font-semibold\">Dates:</span> {parse.startDate||'?' } → {parse.endDate||'?'} ({parse.nights} nights)</div>\r\n              <div>\r\n                <span className=\"font-semibold\">Travelers:</span>\r\n                {parse.travelers?.adults != null ? `${parse.travelers.adults} adults` : '—'}\r\n                {parse.travelers?.children ? `, ${parse.travelers.children} children` : ''}\r\n              </div>\r\n              <div><span className=\"font-semibold\">Budget:</span> {parse.budget.amount? formatCurrency(parse.budget.amount, parse.budget.currency): 'n/a'} {parse.budget.perPerson? '(per person)':''}</div>\r\n              <div><span className=\"font-semibold\">Interests:</span> {parse.interests.join(', ')||'—'}</div>\r\n            </div>\r\n          )}\r\n        </section>\r\n        <section className=\"p-3 rounded border border-cream-border bg-cream-sand/40 flex flex-col\">\r\n          <h2 className=\"font-semibold text-sm mb-2 flex items-center gap-2\">Plan {plan ? <span className=\"text-green-600\">✓</span>: parse && active&&mode==='stream'?<span className=\"animate-pulse\">…</span>:null}</h2>\r\n          {!plan && <p className=\"text-xs text-brand-brown/60\">Skeleton itinerary days & activities.</p>}\r\n          {plan && <ol className=\"text-xs list-decimal ml-4 space-y-1 max-h-60 overflow-auto pr-2\">{plan.itinerary.map(d => <li key={d.day}><span className=\"font-semibold\">{d.title}:</span> {d.activities.join('; ')}</li>)}</ol>}\r\n        </section>\r\n        <section className=\"p-3 rounded border border-cream-border bg-cream-sand/40 flex flex-col\">\r\n          <h2 className=\"font-semibold text-sm mb-2 flex items-center gap-2\">Pricing {pricing ? <span className=\"text-green-600\">✓</span>: plan && active&&mode==='stream'?<span className=\"animate-pulse\">…</span>:null}</h2>\r\n          {!pricing && <p className=\"text-xs text-brand-brown/60\">Rough heuristic estimate with scaling.</p>}\r\n          {pricing && (\r\n            <div className=\"text-xs space-y-1\">\r\n              <div><span className=\"font-semibold\">Total:</span> {formatCurrency(pricing.pricing.total, pricing.pricing.currency)}</div>\r\n              <div className=\"grid grid-cols-3 gap-2\">\r\n                {Object.entries(pricing.pricing.breakdown).map(([k,v]) => <div key={k}>{k}: {formatCurrency(v, pricing.pricing.currency)}</div>)}\r\n              </div>\r\n              <div className=\"italic text-[10px] text-brand-brown/70\">{pricing.pricing.note}</div>\r\n            </div>\r\n          )}\r\n        </section>\r\n      </div>\r\n\r\n      {fullData && mode==='single' && (\r\n        <details className=\"mt-2 text-xs\">\r\n          <summary className=\"cursor-pointer font-semibold\">Full JSON</summary>\r\n          <pre className=\"bg-cream-sand border border-cream-border rounded p-2 overflow-auto max-h-72 whitespace-pre-wrap break-all\">{JSON.stringify(fullData,null,2)}</pre>\r\n        </details>\r\n      )}\r\n\r\n      {sessionMode && sessionId && history.length > 0 && (\r\n        <div className=\"mt-4 border border-cream-border rounded p-3 bg-cream-sand/40\">\r\n          <div className=\"flex items-center justify-between mb-2\">\r\n            <h2 className=\"text-sm font-semibold flex items-center gap-2\">Session History <span className=\"text-[10px] font-normal text-brand-brown/60\">{history.length} snapshot{history.length>1?'s':''}</span></h2>\r\n            <button onClick={()=>setShowDiff(d=>!d)} className=\"text-[11px] underline\">{showDiff? 'Hide Diff':'Show Diff'}</button>\r\n          </div>\r\n          <ol className=\"text-[11px] space-y-1 max-h-48 overflow-auto pr-2\">\r\n            {history.map((h,i)=>(\r\n              <li key={i} className=\"flex flex-col gap-0.5\">\r\n                <div className=\"flex items-center gap-2\"><span className=\"px-1.5 py-0.5 rounded bg-brand-brown text-white text-[10px] uppercase\">{h.type}</span><span className=\"text-brand-brown/70\">{new Date(h.at).toLocaleTimeString()}</span></div>\r\n                <div className=\"grid grid-cols-3 gap-2 text-[10px]\">\r\n                  <span>Nights: {h.data.nights}</span>\r\n                  <span>Dests: {h.data.destinations.length}</span>\r\n                  <span>Interests: {h.data.interests.length}</span>\r\n                </div>\r\n              </li>\r\n            ))}\r\n          </ol>\r\n          {showDiff && history.length > 1 && (\r\n            <SessionDiff prev={history[history.length-2].data} curr={history[history.length-1].data} />\r\n          )}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction SessionDiff({ prev, curr }){\r\n  const addedInterests = curr.interests.filter(i=>!prev.interests.includes(i));\r\n  const nightsDelta = curr.nights - prev.nights;\r\n  const destDelta = curr.destinations.length - prev.destinations.length;\r\n  const badge = (text) => <span className=\"inline-block px-1.5 py-0.5 rounded bg-brand-orange text-white text-[10px] mr-1\">{text}</span>;\r\n  // Day/activity diff (heuristic): compare titles & activity strings if itinerary arrays exist\r\n  const prevDays = (prev.itinerary||[]).reduce((m,d)=>{ m[d.day]=d; return m; },{});\r\n  const currDays = (curr.itinerary||[]).reduce((m,d)=>{ m[d.day]=d; return m; },{});\r\n  const dayAdds = Object.keys(currDays).filter(day=>!prevDays[day]);\r\n  const dayRemovals = Object.keys(prevDays).filter(day=>!currDays[day]);\r\n  const activityAdds = [];\r\n  const activityRemovals = [];\r\n  Object.keys(currDays).forEach(day=>{\r\n    if(prevDays[day]){\r\n      const prevActs = new Set(prevDays[day].activities||[]);\r\n      const currActs = new Set(currDays[day].activities||[]);\r\n      for(const a of currActs){ if(!prevActs.has(a)) activityAdds.push({ day, a }); }\r\n      for(const a of prevActs){ if(!currActs.has(a)) activityRemovals.push({ day, a }); }\r\n    }\r\n  });\r\n  const [expand, setExpand] = React.useState(false);\r\n  return (\r\n    <div className=\"mt-3 text-[11px] border-t border-cream-border pt-2\">\r\n      <h3 className=\"font-semibold mb-1 flex items-center gap-2\">Last Change</h3>\r\n      <div className=\"space-y-1\">\r\n        {nightsDelta!==0 && <div>{badge('NIGHTS')} {nightsDelta>0? `+${nightsDelta}`: nightsDelta} nights (prev {prev.nights} → {curr.nights})</div>}\r\n        {addedInterests.length>0 && <div>{badge('INTERESTS')} Added: {addedInterests.join(', ')}</div>}\r\n        {destDelta!==0 && <div>{badge('DESTS')} {destDelta>0? `+${destDelta}`: destDelta} destinations (count)</div>}\r\n        {dayAdds.length>0 && <div>{badge('DAY+')} Added day(s): {dayAdds.join(', ')}</div>}\r\n        {dayRemovals.length>0 && <div>{badge('DAY-')} Removed day(s): {dayRemovals.join(', ')}</div>}\r\n        {activityAdds.length>0 && <div>{badge('ACT+')} {activityAdds.slice(0,4).map(x=>`D${x.day}:${x.a}`).join(', ')}{activityAdds.length>4? '…':''}</div>}\r\n        {activityRemovals.length>0 && <div>{badge('ACT-')} {activityRemovals.slice(0,4).map(x=>`D${x.day}:${x.a}`).join(', ')}{activityRemovals.length>4? '…':''}</div>}\r\n        {nightsDelta===0 && addedInterests.length===0 && destDelta===0 && <div className=\"italic text-brand-brown/60\">No core field changes detected.</div>}\r\n      </div>\r\n      {(activityAdds.length>4 || activityRemovals.length>4) && (\r\n        <button onClick={()=>setExpand(e=>!e)} className=\"mt-2 underline text-[10px]\">{expand? 'Hide full activity diff':'Show full activity diff'}</button>\r\n      )}\r\n      {expand && (\r\n        <div className=\"mt-2 grid sm:grid-cols-2 gap-3\">\r\n          <div>\r\n            <div className=\"font-semibold text-[10px] mb-1\">Added Activities ({activityAdds.length})</div>\r\n            <ul className=\"space-y-0.5 max-h-40 overflow-auto pr-1\">\r\n              {activityAdds.map((x,i)=><li key={i} className=\"truncate\">D{x.day}: {x.a}</li>)}\r\n            </ul>\r\n          </div>\r\n          <div>\r\n            <div className=\"font-semibold text-[10px] mb-1\">Removed Activities ({activityRemovals.length})</div>\r\n            <ul className=\"space-y-0.5 max-h-40 overflow-auto pr-1\">\r\n              {activityRemovals.map((x,i)=><li key={i} className=\"truncate\">D{x.day}: {x.a}</li>)}\r\n            </ul>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","import React, { useEffect } from 'react';\r\nimport AIGeneratorPanel from '../components/AIGeneratorPanel.jsx';\r\n\r\nexport default function AIGeneratorPage() {\r\n  useEffect(() => {\r\n    const prev = document.title;\r\n    document.title = 'Trip Assist | CollEco Travel';\r\n    return () => { document.title = prev; };\r\n  }, []);\r\n  return (\r\n    <div className=\"overflow-x-hidden\">\r\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\r\n      <AIGeneratorPanel />\r\n    </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":["API_BASE","withAuth","useState","useRef","useEffect","useCallback","jsxs","jsx"],"mappings":"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"}