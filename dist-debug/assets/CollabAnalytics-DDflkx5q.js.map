{"version":3,"file":"CollabAnalytics-DDflkx5q.js","sources":["../../src/pages/CollabAnalytics.jsx"],"sourcesContent":["import React, { useEffect, useMemo, useState, useCallback } from \"react\";\r\nimport { listThreads, computeAnalytics, ROLES } from \"../utils/collabStore\";\r\n\r\nexport default function CollabAnalytics() {\r\n  const [threads, setThreads] = useState(() => listThreads());\r\n  const [q, setQ] = useState(\"\");\r\n  const [fromDate, setFromDate] = useState(\"\");\r\n  const [toDate, setToDate] = useState(\"\");\r\n  const [slaMins, setSlaMins] = useState(60);\r\n\r\n  useEffect(() => {\r\n    // Refresh from storage (stateless aggregation)\r\n    setThreads(listThreads());\r\n  }, []);\r\n\r\n  const filtered = useMemo(() => {\r\n    const term = q.trim().toLowerCase();\r\n    if (!term) return threads;\r\n    return threads.filter(t => `${t.ref} ${t.clientName} ${t.title}`.toLowerCase().includes(term));\r\n  }, [threads, q]);\r\n\r\n  const isInRange = useCallback((ts) => {\r\n    if (!ts) return false;\r\n    const d = new Date(ts);\r\n    if (fromDate) {\r\n      const f = new Date(fromDate + \"T00:00:00\");\r\n      if (d < f) return false;\r\n    }\r\n    if (toDate) {\r\n      const t = new Date(toDate + \"T23:59:59\");\r\n      if (d > t) return false;\r\n    }\r\n    return true;\r\n  }, [fromDate, toDate]);\r\n\r\n  const aggregate = useMemo(() => {\r\n    const totals = {\r\n      totalThreads: 0,\r\n      totalMessages: 0,\r\n      totalAttachments: 0,\r\n      channelCounts: {},\r\n      avgResponseByRole: {},\r\n      awaitingCounts: {},\r\n      bottlenecks: [],\r\n      dailyCounts: {},\r\n    };\r\n\r\n    // For simple averages, average per-thread averages (demo-friendly)\r\n    const roleSums = {}; // role -> sum of per-thread avg\r\n    const roleCounts = {}; // role -> threads counted\r\n\r\n    for (const t of filtered) {\r\n      const msgs = (t.messages || []).filter(m => isInRange(m.createdAt));\r\n      const atts = (t.attachments || []).filter(a => isInRange(a.addedAt));\r\n      if (msgs.length === 0 && atts.length === 0) continue; // exclude threads with nothing in range\r\n      totals.totalThreads += 1;\r\n      totals.totalMessages += msgs.length;\r\n      totals.totalAttachments += atts.length;\r\n\r\n      // Channels in range\r\n      for (const m of msgs) {\r\n        totals.channelCounts[m.channel] = (totals.channelCounts[m.channel] || 0) + 1;\r\n      }\r\n\r\n      // Avg response by role (replies in range)\r\n      const sorted = msgs.slice().sort((a, b) => a.createdAt - b.createdAt);\r\n      const responseTimes = {}; // role -> [mins]\r\n      let prevBy = null, prevAt = null;\r\n      for (const m of sorted) {\r\n        if (prevBy && m.authorRole !== prevBy && prevAt) {\r\n          const diff = Math.max(0, Math.round((m.createdAt - prevAt) / 60000));\r\n          (responseTimes[m.authorRole] = responseTimes[m.authorRole] || []).push(diff);\r\n        }\r\n        prevBy = m.authorRole;\r\n        prevAt = m.createdAt;\r\n      }\r\n      const avgInThread = Object.fromEntries(Object.entries(responseTimes).map(([r, diffs]) => [r, Math.round(diffs.reduce((a, b) => a + b, 0) / diffs.length)]));\r\n      for (const [r, v] of Object.entries(avgInThread)) {\r\n        roleSums[r] = (roleSums[r] || 0) + v;\r\n        roleCounts[r] = (roleCounts[r] || 0) + 1;\r\n      }\r\n\r\n      // Awaiting based on overall analytics (not range-limited) so it reflects current state\r\n      const overall = computeAnalytics(t);\r\n      for (const r of overall.awaiting || []) {\r\n        totals.awaitingCounts[r] = (totals.awaitingCounts[r] || 0) + 1;\r\n      }\r\n\r\n      // Bottleneck heuristic: time since last message\r\n      const allMsgs = (t.messages || []).slice().sort((x, y) => x.createdAt - y.createdAt);\r\n      if (allMsgs.length) {\r\n        const last = allMsgs[allMsgs.length - 1];\r\n        const ageMin = Math.round((Date.now() - last.createdAt) / 60000);\r\n        totals.bottlenecks.push({ bookingId: t.bookingId, ref: t.ref, title: t.title, clientName: t.clientName, ageMin, awaiting: overall.awaiting });\r\n      }\r\n\r\n      // Daily trend counts in range\r\n      for (const m of msgs) {\r\n        const day = new Date(m.createdAt).toISOString().slice(0, 10);\r\n        totals.dailyCounts[day] = (totals.dailyCounts[day] || 0) + 1;\r\n      }\r\n    }\r\n\r\n    for (const r of Object.keys(roleSums)) {\r\n      totals.avgResponseByRole[r] = Math.round(roleSums[r] / Math.max(1, roleCounts[r]));\r\n    }\r\n    totals.bottlenecks.sort((x, y) => y.ageMin - x.ageMin);\r\n\r\n    return totals;\r\n  }, [filtered, isInRange]);\r\n\r\n  const roleLabel = (r) => r === ROLES.agent ? \"Agent\" : r === ROLES.client ? \"Client\" : r === ROLES.productOwner ? \"Product Owner\" : r;\r\n  const exportCsv = () => {\r\n    // Thread-level CSV aligned to current filters\r\n    const rows = [\r\n      [\"bookingId\",\"ref\",\"title\",\"clientName\",\"messagesInRange\",\"attachmentsInRange\",\"lastMsgAgeMin\",\"awaiting\",\"avgRespAgent\",\"avgRespClient\",\"avgRespPO\",\"inapp\",\"whatsapp\",\"email\",\"sms\",\"call\",\"note\"],\r\n    ];\r\n  const _days = aggregate.dailyCounts; // not per thread but okay; we keep per-thread core metrics\r\n    for (const t of filtered) {\r\n      const msgs = (t.messages || []).filter(m => isInRange(m.createdAt));\r\n      const atts = (t.attachments || []).filter(a => isInRange(a.addedAt));\r\n      if (msgs.length === 0 && atts.length === 0) continue;\r\n      // per-thread avg as computed earlier (recompute quickly)\r\n      const sorted = msgs.slice().sort((a, b) => a.createdAt - b.createdAt);\r\n      const responseTimes = {};\r\n      let prevBy = null, prevAt = null;\r\n      for (const m of sorted) {\r\n        if (prevBy && m.authorRole !== prevBy && prevAt) {\r\n          const diff = Math.max(0, Math.round((m.createdAt - prevAt) / 60000));\r\n          (responseTimes[m.authorRole] = responseTimes[m.authorRole] || []).push(diff);\r\n        }\r\n        prevBy = m.authorRole; prevAt = m.createdAt;\r\n      }\r\n      const avg = Object.fromEntries(Object.entries(responseTimes).map(([r, diffs]) => [r, Math.round(diffs.reduce((a,b)=>a+b,0)/diffs.length)]));\r\n      const overall = computeAnalytics(t);\r\n      const allMsgs = (t.messages || []).slice().sort((x, y) => x.createdAt - y.createdAt);\r\n      const lastAge = allMsgs.length ? Math.round((Date.now() - allMsgs[allMsgs.length-1].createdAt)/60000) : \"\";\r\n      const ch = msgs.reduce((acc, m) => (acc[m.channel]=(acc[m.channel]||0)+1, acc), {});\r\n      rows.push([\r\n        t.bookingId, t.ref, t.title, t.clientName,\r\n        msgs.length, atts.length, lastAge,\r\n        (overall.awaiting||[]).join(\"|\"),\r\n        avg[ROLES.agent]||\"\", avg[ROLES.client]||\"\", avg[ROLES.productOwner]||\"\",\r\n        ch[\"in-app\"]||0, ch[\"whatsapp\"]||0, ch[\"email\"]||0, ch[\"sms\"]||0, ch[\"call\"]||0, ch[\"note\"]||0,\r\n      ]);\r\n    }\r\n    const csv = rows.map(r => r.map(v => typeof v === \"string\" ? '\"'+v.replaceAll('\"','\"\"')+'\"' : v).join(\",\")).join(\"\\n\");\r\n    const blob = new Blob([csv], { type: \"text/csv;charset=utf-8\" });\r\n    const url = URL.createObjectURL(blob);\r\n    const a = document.createElement(\"a\");\r\n    a.href = url; a.download = `collab-analytics-${new Date().toISOString().slice(0,10)}.csv`;\r\n    document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);\r\n  };\r\n\r\n  return (\r\n    <div className=\"p-6 space-y-6\">\r\n      <div className=\"flex flex-wrap items-center justify-between gap-3\">\r\n        <h1 className=\"text-2xl font-semibold text-brand-brown\">Collaboration Analytics</h1>\r\n        <div className=\"flex flex-wrap items-center gap-2\">\r\n          <input\r\n            className=\"border rounded px-3 py-1.5 bg-cream hover:bg-cream-hover w-56\"\r\n            placeholder=\"Search by ref, client, title\"\r\n            value={q}\r\n            onChange={e=>setQ(e.target.value)}\r\n          />\r\n          <input type=\"date\" className=\"border rounded px-2 py-1.5\" value={fromDate} onChange={e=>setFromDate(e.target.value)} />\r\n          <span className=\"text-brand-brown/60\">to</span>\r\n          <input type=\"date\" className=\"border rounded px-2 py-1.5\" value={toDate} onChange={e=>setToDate(e.target.value)} />\r\n          <div className=\"flex items-center gap-1\">\r\n            <span className=\"text-sm text-brand-brown/70\">SLA (mins)</span>\r\n            <input type=\"number\" min=\"1\" className=\"w-20 border rounded px-2 py-1.5\" value={slaMins} onChange={e=>setSlaMins(Number(e.target.value)||0)} />\r\n          </div>\r\n          <button onClick={exportCsv} className=\"px-3 py-1.5 rounded bg-brand-orange text-white hover:bg-brand-highlight\">Export CSV</button>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n        <StatCard label=\"Active Threads\" value={aggregate.totalThreads} />\r\n        <StatCard label=\"Messages\" value={aggregate.totalMessages} />\r\n        <StatCard label=\"Attachments\" value={aggregate.totalAttachments} />\r\n      </div>\r\n\r\n      {/* Trendline */}\r\n      <div className=\"bg-white rounded border border-cream-border p-4\">\r\n        <h2 className=\"font-semibold text-brand-brown mb-2\">Daily Messages Trend</h2>\r\n        {Object.keys(aggregate.dailyCounts).length === 0 ? (\r\n          <div className=\"text-sm text-brand-brown/60\">No messages in selected range.</div>\r\n        ) : (\r\n          <div className=\"space-y-1\">\r\n            {Object.entries(aggregate.dailyCounts).sort(([a],[b]) => a.localeCompare(b)).map(([day, count]) => (\r\n              <div key={day} className=\"flex items-center gap-2\">\r\n                <div className=\"w-24 text-xs text-brand-brown/70\">{day}</div>\r\n                <div className=\"flex-1 bg-cream h-3 rounded\">\r\n                  <div className=\"bg-brand-orange h-3 rounded\" style={{ width: `${Math.min(100, (count/Math.max(1, Math.max(...Object.values(aggregate.dailyCounts))))*100)}%` }} />\r\n                </div>\r\n                <div className=\"w-10 text-xs text-brand-brown/70 text-right\">{count}</div>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\r\n        <div className=\"bg-cream rounded border border-cream-border p-4\">\r\n          <h2 className=\"font-semibold text-brand-brown mb-2\">Average Response (mins) by Role</h2>\r\n          <ul className=\"text-sm text-brand-brown space-y-1\">\r\n            {Object.keys(aggregate.avgResponseByRole).length === 0 ? (\r\n              <li className=\"text-brand-brown/60\">No data yet.</li>\r\n            ) : (\r\n              Object.entries(aggregate.avgResponseByRole).map(([r, v]) => (\r\n                <li key={r} className=\"flex items-center justify-between border-b border-cream-border py-1\">\r\n                  <span>{roleLabel(r)}</span>\r\n                  <span>{v}m</span>\r\n                </li>\r\n              ))\r\n            )}\r\n          </ul>\r\n        </div>\r\n\r\n        <div className=\"bg-cream rounded border border-cream-border p-4\">\r\n          <h2 className=\"font-semibold text-brand-brown mb-2\">Messages by Channel</h2>\r\n          <ul className=\"text-sm text-brand-brown space-y-1\">\r\n            {Object.keys(aggregate.channelCounts).length === 0 ? (\r\n              <li className=\"text-brand-brown/60\">No messages yet.</li>\r\n            ) : (\r\n              Object.entries(aggregate.channelCounts).map(([c, v]) => (\r\n                <li key={c} className=\"flex items-center justify-between border-b border-cream-border py-1\">\r\n                  <span className=\"capitalize\">{c}</span>\r\n                  <span>{v}</span>\r\n                </li>\r\n              ))\r\n            )}\r\n          </ul>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\r\n        <div className=\"bg-white rounded border border-cream-border p-4\">\r\n          <h2 className=\"font-semibold text-brand-brown mb-2\">Awaiting Response</h2>\r\n          <ul className=\"text-sm text-brand-brown space-y-1\">\r\n            {Object.keys(aggregate.awaitingCounts).length === 0 ? (\r\n              <li className=\"text-brand-brown/60\">All clear.</li>\r\n            ) : (\r\n              Object.entries(aggregate.awaitingCounts).map(([r, v]) => (\r\n                <li key={r} className=\"flex items-center justify-between border-b border-cream-border py-1\">\r\n                  <span>{roleLabel(r)}</span>\r\n                  <span>{v} thread(s)</span>\r\n                </li>\r\n              ))\r\n            )}\r\n          </ul>\r\n        </div>\r\n\r\n        <div className=\"bg-white rounded border border-cream-border p-4\">\r\n          <h2 className=\"font-semibold text-brand-brown mb-2\">Top Bottlenecks</h2>\r\n          <ul className=\"text-sm text-brand-brown space-y-2\">\r\n            {aggregate.bottlenecks.length === 0 ? (\r\n              <li className=\"text-brand-brown/60\">No bottlenecks detected.</li>\r\n            ) : (\r\n              aggregate.bottlenecks.slice(0, 5).map(b => (\r\n                <li key={b.bookingId} className={`border-b border-cream-border pb-2 ${b.ageMin > slaMins ? \"bg-red-50\" : \"\"}`}>\r\n                  <div className=\"font-medium\">\r\n                    {b.title} <span className=\"text-brand-brown/60\">({b.ref})</span>\r\n                    {b.ageMin > slaMins ? <span className=\"ml-2 text-xs text-red-700\">SLA breached</span> : null}\r\n                  </div>\r\n                  <div className=\"text-xs text-brand-brown/70\">{b.clientName}</div>\r\n                  <div className=\"text-xs text-brand-brown/70 mt-1\">Last message: {b.ageMin}m ago</div>\r\n                  <div className=\"text-xs text-brand-brown/70\">Awaiting: {b.awaiting?.length ? b.awaiting.map(roleLabel).join(\", \") : \"-\"}</div>\r\n                </li>\r\n              ))\r\n            )}\r\n          </ul>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction StatCard({ label, value }) {\r\n  return (\r\n    <div className=\"bg-white rounded border border-cream-border p-4\">\r\n      <div className=\"text-brand-brown/70 text-sm\">{label}</div>\r\n      <div className=\"text-2xl font-semibold text-brand-brown\">{value}</div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":["useState","useEffect","useMemo","useCallback","a","jsxs","jsx"],"mappings":"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"}