{"version":3,"file":"Compliance-BUv0Nl3T.js","sources":["../../src/pages/Compliance.jsx"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\r\nimport AutoSyncBanner from \"../components/ui/AutoSyncBanner\";\r\nimport ComplianceStatusCard from \"../components/ui/ComplianceStatusCard\";\r\nimport VerifiedBadge from \"../components/ui/VerifiedBadge\";\r\nimport { isApiEnabled as providersApiEnabled, listProviders, uploadDocument, verifyProvider } from \"../api/providersApi\";\r\n\r\n// Helpers for expiry states\r\nfunction isExpired(ts) {\r\n\tif (!ts) return false;\r\n\treturn Number(ts) < Date.now();\r\n}\r\n\r\nfunction isExpiringSoon(ts, days = 30) {\r\n\tif (!ts) return false;\r\n\tconst now = Date.now();\r\n\tconst diff = Number(ts) - now;\r\n\treturn diff > 0 && diff <= days * 24 * 60 * 60 * 1000;\r\n}\r\n\r\nexport default function Compliance() {\r\n\tconst [providers, setProviders] = useState([]);\r\n\tconst [loading, setLoading] = useState(false);\r\n\tconst [error, setError] = useState(\"\");\r\n\tconst [showVerifiedOnly, setShowVerifiedOnly] = useState(false);\r\n\r\n\tconst REQUIRED_TYPES = [\"license\", \"insurance\", \"permit\"]; // demo baseline\r\n\r\n\tuseEffect(() => {\r\n\t\t(async () => {\r\n\t\t\tif (!providersApiEnabled) return;\r\n\t\t\ttry { setLoading(true); setError(\"\");\r\n\t\t\t\tconst list = await listProviders();\r\n\t\t\t\tsetProviders(list);\r\n\t\t\t} catch (e) { setError(e.message || 'Failed to load providers'); }\r\n\t\t\tfinally { setLoading(false); }\r\n\t\t})();\r\n\t}, []);\r\n\r\n\tfunction computeCounts(list) {\r\n\t\tlet valid = 0, expiring = 0, missing = 0;\r\n\t\tfor (const p of list) {\r\n\t\t\tconst docs = Array.isArray(p.documents) ? p.documents : [];\r\n\t\t\tconst presentTypes = new Set(docs.map(d => d.docType));\r\n\t\t\tfor (const t of REQUIRED_TYPES) {\r\n\t\t\t\tif (!presentTypes.has(t)) missing += 1;\r\n\t\t\t}\r\n\t\t\tfor (const d of docs) {\r\n\t\t\t\tif (isExpired(d.expiresAt)) continue;\r\n\t\t\t\tif (isExpiringSoon(d.expiresAt)) expiring += 1; else valid += 1;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn { valid, expiring, missing };\r\n\t}\r\n\r\n\tconst viewProviders = showVerifiedOnly ? (providers || []).filter(p => p.verified) : (providers || []);\r\n\tconst counts = computeCounts(viewProviders);\r\n\r\n\tasync function onUpload(e) {\r\n\t\te.preventDefault();\r\n\t\tconst form = e.currentTarget;\r\n\t\tconst providerId = form.providerId.value;\r\n\t\tconst docType = form.docType.value;\r\n\t\tconst file = form.file.files?.[0];\r\n\t\tconst expires = form.expiresAt.value ? new Date(form.expiresAt.value).getTime() : undefined;\r\n\t\tif (!providerId || !docType || !file) return;\r\n\t\tif (!providersApiEnabled) { alert('Upload stub ‚Äî enable API to persist'); return; }\r\n\t\ttry {\r\n\t\t\tsetLoading(true); setError(\"\");\r\n\t\t\tawait uploadDocument({ providerId, docType, fileName: file.name, fileSize: file.size, expiresAt: expires });\r\n\t\t\tconst list = await listProviders(); setProviders(list);\r\n\t\t\tform.reset();\r\n\t\t} catch (e) { setError(e.message || 'Upload failed'); }\r\n\t\tfinally { setLoading(false); }\r\n\t}\r\n\r\n\tasync function onVerify(providerId) {\r\n\t\tif (!providersApiEnabled) { alert('Verify stub ‚Äî enable API to persist'); return; }\r\n\t\ttry { setLoading(true); setError(\"\");\r\n\t\t\tawait verifyProvider(providerId, true);\r\n\t\t\tconst list = await listProviders(); setProviders(list);\r\n\t\t} catch (e) { setError(e.message || 'Verify failed'); }\r\n\t\tfinally { setLoading(false); }\r\n\t}\r\n\r\n\treturn (\r\n\t\t<div className=\"overflow-x-hidden min-h-screen flex items-start justify-center px-4 py-6\">\r\n\t\t\t<div className=\"w-full max-w-4xl text-brand-brown\">\r\n\t\t\t<h2 className=\"text-xl font-bold mb-4\">üõ°Ô∏è Compliance Center</h2>\r\n\t\t\t<div className=\"mb-3\"><AutoSyncBanner message=\"Documents are validated automatically; expiry reminders are sent before deadlines.\" /></div>\r\n\t\t\t<div className=\"mb-4\"><ComplianceStatusCard valid={counts.valid} expiring={counts.expiring} missing={counts.missing} /></div>\r\n\t\t\t<div className=\"bg-cream-sand p-4 border border-cream-border rounded\">\r\n\t\t\t\t<p className=\"mb-2\">Upload and manage licenses, permits, and insurance documents.</p>\r\n\t\t\t\t<p className=\"text-brand-brown/70 text-sm\">Automation-ready placeholder ‚Äî upload tools and live validation results will appear here.</p>\r\n\t\t\t\t<form className=\"mt-3 flex flex-col sm:flex-row gap-2\" onSubmit={onUpload}>\r\n\t\t\t\t\t<input name=\"providerId\" className=\"border rounded px-2 py-1 flex-1\" placeholder=\"Provider ID (e.g., hotel-123)\" required />\r\n\t\t\t\t\t<select name=\"docType\" className=\"border rounded px-2 py-1\">\r\n\t\t\t\t\t\t<option value=\"license\">Business license</option>\r\n\t\t\t\t\t\t<option value=\"insurance\">Insurance certificate</option>\r\n\t\t\t\t\t\t<option value=\"permit\">Operating permit</option>\r\n\t\t\t\t\t</select>\r\n\t\t\t\t\t<input name=\"file\" type=\"file\" className=\"border rounded px-2 py-1\" />\r\n\t\t\t\t\t<input name=\"expiresAt\" type=\"date\" className=\"border rounded px-2 py-1\" aria-label=\"Expiry date\" />\r\n\t\t\t\t\t<button className=\"px-3 py-1.5 bg-brand-orange text-white rounded\">Upload</button>\r\n\t\t\t\t</form>\r\n\t\t\t\t{error ? <div className=\"text-sm text-red-600 mt-2\">{error}</div> : null}\r\n\t\t\t\t{loading ? <div className=\"text-sm text-brand-brown/70 mt-2\">Loading‚Ä¶</div> : null}\r\n\t\t\t\t<div className=\"mt-4\">\r\n\t\t\t\t\t{counts.expiring > 0 ? (\r\n\t\t\t\t\t\t<div className=\"mb-2 text-sm flex items-center gap-2 bg-amber-50 border border-amber-200 text-amber-800 px-2 py-1 rounded\">\r\n\t\t\t\t\t\t\t<span className=\"font-medium\">Heads up:</span>\r\n\t\t\t\t\t\t\t<span>{counts.expiring} document{counts.expiring>1?'s':''} expiring soon.</span>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t) : null}\r\n\t\t\t\t\t<div className=\"flex items-center justify-between mb-1\">\r\n\t\t\t\t\t\t<div className=\"font-semibold\">Providers</div>\r\n\t\t\t\t\t\t<label className=\"text-sm flex items-center gap-2\">\r\n\t\t\t\t\t\t\t<input type=\"checkbox\" className=\"accent-brand-orange\" checked={showVerifiedOnly} onChange={e => setShowVerifiedOnly(e.target.checked)} />\r\n\t\t\t\t\t\t\t<span>Verified only</span>\r\n\t\t\t\t\t\t</label>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t{!providersApiEnabled ? (\r\n\t\t\t\t\t\t<div className=\"text-sm text-brand-brown/70\">Enable API to view persisted providers/documents.</div>\r\n\t\t\t\t\t) : (\r\n\t\t\t\t\t\t<ul className=\"space-y-2\">\r\n\t\t\t\t\t\t\t{(viewProviders || []).map(p => (\r\n\t\t\t\t\t\t\t\t<li key={p.id} className=\"border border-cream-border rounded p-2 bg-cream\">\r\n\t\t\t\t\t\t\t\t\t<div className=\"flex items-center justify-between\">\r\n\t\t\t\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"font-semibold\">{p.name || p.id} <VerifiedBadge verified={p.verified} /></div>\r\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"text-xs text-brand-brown/70\">ID: {p.id}</div>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t{!p.verified ? (\r\n\t\t\t\t\t\t\t\t\t\t\t<button onClick={() => onVerify(p.id)} className=\"text-xs px-2 py-1 rounded bg-emerald-600 text-white\">Mark Verified</button>\r\n\t\t\t\t\t\t\t\t\t\t) : null}\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{(p.documents || []).length ? (\r\n\t\t\t\t\t\t\t\t\t\t<ul className=\"text-sm mt-2\">\r\n\t\t\t\t\t\t\t\t\t\t\t{p.documents.map(d => (\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<li key={d.id} className=\"flex items-center justify-between border-t border-cream-border py-1\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{d.docType} ‚Äî {d.fileName} <span className=\"text-xs text-brand-brown/60\">({Math.ceil((d.fileSize||0)/1024)} KB)</span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{d.expiresAt ? (\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"ml-2 text-xs text-brand-brown/70\">Exp: {new Date(d.expiresAt).toLocaleDateString()}</span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t) : null}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"text-xs text-brand-brown/70 flex items-center gap-2\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{isExpired(d.expiresAt) ? (\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"px-1.5 py-0.5 rounded bg-red-100 text-red-700 border border-red-200\">Expired</span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t) : isExpiringSoon(d.expiresAt) ? (\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"px-1.5 py-0.5 rounded bg-amber-100 text-amber-800 border border-amber-200\">Expiring soon</span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t) : null}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{d.status || 'pending'}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t</li>\r\n\t\t\t\t\t\t\t\t\t\t\t))}\r\n\t\t\t\t\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t\t\t\t\t) : null}\r\n\t\t\t\t\t\t\t\t</li>\r\n\t\t\t\t\t\t\t))}\r\n\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t)}\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n}"],"names":["useState","useEffect","jsxs","jsx"],"mappings":"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"}