{"version":3,"mappings":"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","names":["useState","useRef","useEffect","useMemo","jsPDF","jsxs","jsx"],"ignoreList":[],"sources":["../../src/pages/Itinerary.jsx"],"sourcesContent":["import React, { useMemo, useState, useEffect, useRef } from 'react';\r\nimport ItineraryDay from \"../components/ui/ItineraryDay\";\r\nimport ExperienceCard from \"../components/ui/ExperienceCard\";\r\nimport MemoryNote from \"../components/ui/MemoryNote\";\r\nimport LiveTripProgress from \"../components/ui/LiveTripProgress\";\r\nimport WeatherWidget from \"../components/WeatherWidget\";\r\nimport { useTripState, setMemory, computeProgress } from \"../utils/useTripState\";\r\nimport { useBasketState } from \"../utils/useBasketState\";\r\nimport { useLocalStorageState } from \"../useLocalStorageState\";\r\nimport WorkflowPanel from \"../components/WorkflowPanel\";\r\n\r\nexport default function Itinerary() {\r\n  const [trip, setTrip] = useTripState();\r\n  const [linkQuotes] = useLocalStorageState('basketAutoSync:v1', true);\r\n  const { basket, updateDay: _updateBasketDay, removeFromBasket } = useBasketState(); // _updateBasketDay unused (legacy API)\r\n  const [search, setSearch] = useState(\"\");\r\n  const [showSettings, setShowSettings] = useState(false);\r\n  const [tripLocation, setTripLocation] = useLocalStorageState('trip_location', {\r\n    city: 'Durban',\r\n    country: 'South Africa'\r\n  });\r\n  const [itinerarySettings, setItinerarySettings] = useLocalStorageState('itinerary_settings', {\r\n    companyName: 'CollEco Travel',\r\n    tagline: 'The Odyssey of Adventure',\r\n    website: 'www.travelcolleco.com',\r\n    logo: null\r\n  });\r\n  \r\n  // Auto-save undo stack (silent background feature)\r\n  const undoStackRef = useRef([]);\r\n  const lastSavedRef = useRef(null);\r\n  \r\n  // Track changes and auto-save to undo stack\r\n  useEffect(() => {\r\n    const current = JSON.stringify(trip);\r\n    if (lastSavedRef.current && lastSavedRef.current !== current) {\r\n      try {\r\n        const snapshot = JSON.parse(lastSavedRef.current);\r\n        undoStackRef.current.push(snapshot);\r\n        // Keep only last 20 versions for performance\r\n        if (undoStackRef.current.length > 20) undoStackRef.current.shift();\r\n      } catch(e) {}\r\n    }\r\n    lastSavedRef.current = current;\r\n  }, [trip]);\r\n  \r\n  // Keyboard shortcut for undo (Ctrl/Cmd+Z) - silent feature\r\n  useEffect(() => {\r\n    const handleUndo = (e) => {\r\n      if ((e.ctrlKey || e.metaKey) && e.key === 'z' && !e.shiftKey) {\r\n        e.preventDefault();\r\n        if (undoStackRef.current.length > 0) {\r\n          const previous = undoStackRef.current.pop();\r\n          setTrip(previous);\r\n        }\r\n      }\r\n    };\r\n    window.addEventListener('keydown', handleUndo);\r\n    return () => window.removeEventListener('keydown', handleUndo);\r\n  }, [setTrip]);\r\n  \r\n  // Auto-detect and merge AI drafts silently\r\n  useEffect(() => {\r\n    try {\r\n      const raw = localStorage.getItem('aiItineraryDraft:v1');\r\n      if (raw && Object.keys(trip.days || {}).length === 0) {\r\n        // Only auto-import if itinerary is empty\r\n        const draft = JSON.parse(raw);\r\n        const draftDays = {};\r\n        \r\n        (draft.itinerary || []).forEach(d => {\r\n          const key = String(d.day || d.dayNumber || 1);\r\n          if (!draftDays[key]) draftDays[key] = [];\r\n          draftDays[key].push({\r\n            id: 'ai-' + d.day + '-' + Math.random().toString(36).slice(2),\r\n            title: d.title || `Day ${d.day}`,\r\n            time: 'Flexible',\r\n            subtitle: (d.activities || []).join(', '),\r\n            _aiSource: true\r\n          });\r\n        });\r\n        \r\n        setTrip(prev => ({ ...prev, days: draftDays }));\r\n        localStorage.removeItem('aiItineraryDraft:v1');\r\n      }\r\n    } catch(e) {}\r\n  }, [trip.days, setTrip]);\r\n\r\n  // Auto-sync basket items into their assigned days\r\n  useEffect(() => {\r\n    if (!linkQuotes) return;\r\n    setTrip(t => {\r\n      let next = { ...t, days: { ...t.days } };\r\n      let mutated = false;\r\n      const basketIds = new Set(basket.map(b => b.id));\r\n\r\n      // Remove previously synced items no longer in basket\r\n      Object.keys(next.days).forEach(d => {\r\n        const filtered = (next.days[d] || []).filter(it => !(it._basketSource && !basketIds.has(it.id)));\r\n        if (filtered.length !== (next.days[d] || []).length) {\r\n          next.days[d] = filtered;\r\n          mutated = true;\r\n        }\r\n      });\r\n\r\n      // Add / move items according to their assigned day\r\n      basket.forEach(bItem => {\r\n        const targetDay = String(bItem.day || 1);\r\n        const existingInTarget = (next.days[targetDay] || []).find(it => it.id === bItem.id);\r\n        \r\n        // Remove from other days if exists\r\n        Object.keys(next.days).forEach(d => {\r\n          if (d !== targetDay) {\r\n            if ((next.days[d] || []).some(it => it.id === bItem.id && it._basketSource)) {\r\n              next.days[d] = next.days[d].filter(it => it.id !== bItem.id);\r\n              mutated = true;\r\n            }\r\n          }\r\n        });\r\n        \r\n        // Add to target day if not there\r\n        if (!existingInTarget) {\r\n          const arr = next.days[targetDay] || [];\r\n          next.days[targetDay] = [...arr, { ...bItem, time: bItem.time || 'Flexible', _basketSource: true }];\r\n          mutated = true;\r\n        }\r\n      });\r\n      \r\n      // Auto-sort items within each day intelligently\r\n      Object.keys(next.days).forEach(d => {\r\n        const items = next.days[d] || [];\r\n        if (items.length > 1) {\r\n          const sorted = [...items].sort((a, b) => {\r\n            // Priority order: Morning ‚Üí Afternoon ‚Üí Evening ‚Üí Flexible\r\n            const timeOrder = { 'Morning': 0, 'Afternoon': 1, 'Evening': 2, 'Flexible': 3 };\r\n            const aTime = timeOrder[a.time] ?? 99;\r\n            const bTime = timeOrder[b.time] ?? 99;\r\n            if (aTime !== bTime) return aTime - bTime;\r\n            \r\n            // Secondary: Basket items before manual items\r\n            if (a._basketSource && !b._basketSource) return -1;\r\n            if (!a._basketSource && b._basketSource) return 1;\r\n            \r\n            return 0;\r\n          });\r\n          \r\n          // Check if order changed\r\n          const orderChanged = sorted.some((item, idx) => items[idx]?.id !== item.id);\r\n          if (orderChanged) {\r\n            next.days[d] = sorted;\r\n            mutated = true;\r\n          }\r\n        }\r\n      });\r\n      \r\n      // Auto-cleanup: Remove empty days (except Day 1)\r\n      Object.keys(next.days).forEach(d => {\r\n        if (d !== '1' && (!next.days[d] || next.days[d].length === 0)) {\r\n          delete next.days[d];\r\n          mutated = true;\r\n        }\r\n      });\r\n\r\n      return mutated ? next : t;\r\n    });\r\n  }, [basket, linkQuotes, setTrip]);\r\n\r\n  // Filter items by search\r\n  const filteredDays = useMemo(() => {\r\n    if (!search.trim()) return trip.days;\r\n    \r\n    const q = search.trim().toLowerCase();\r\n    const filtered = {};\r\n    \r\n    Object.keys(trip.days).forEach(day => {\r\n      const items = (trip.days[day] || []).filter(it => \r\n        (it.title || '').toLowerCase().includes(q) || \r\n        (it.subtitle || '').toLowerCase().includes(q)\r\n      );\r\n      if (items.length > 0) {\r\n        filtered[day] = items;\r\n      }\r\n    });\r\n    \r\n    return filtered;\r\n  }, [trip.days, search]);\r\n\r\n  // Remove item from itinerary with smart cleanup\r\n  function removeItem(day, itemId) {\r\n    setTrip(prev => {\r\n      const dayItems = (prev.days[day] || []).filter(it => it.id !== itemId);\r\n      const item = (prev.days[day] || []).find(it => it.id === itemId);\r\n      \r\n      // If it's a basket item, also remove from basket\r\n      if (item?._basketSource) {\r\n        removeFromBasket(itemId);\r\n      }\r\n      \r\n      const newDays = { ...prev.days, [day]: dayItems };\r\n      \r\n      // Auto-cleanup: Remove day if empty (except Day 1)\r\n      if (day !== '1' && dayItems.length === 0) {\r\n        delete newDays[day];\r\n      }\r\n      \r\n      return { ...prev, days: newDays };\r\n    });\r\n  }\r\n\r\n  // Add empty day with smart numbering\r\n  function addDay() {\r\n    const existing = Object.keys(trip.days || {}).map(n => Number(n)).filter(n => Number.isFinite(n) && n > 0);\r\n    const next = existing.length ? Math.max(...existing) + 1 : 1;\r\n    \r\n    // Smart: Don't create if there's already an empty day at the end\r\n    const lastDay = String(Math.max(...existing, 0));\r\n    if (lastDay && (!trip.days[lastDay] || trip.days[lastDay].length === 0)) {\r\n      return; // Already have an empty day\r\n    }\r\n    \r\n    setTrip(prev => ({ ...prev, days: { ...prev.days, [String(next)]: [] } }));\r\n  }\r\n\r\n  // Export to PDF\r\n  async function handleExport() {\r\n    const { default: jsPDF } = await import(\"jspdf\");\r\n    const doc = new jsPDF();\r\n    \r\n    const pageWidth = doc.internal.pageSize.getWidth();\r\n    const pageHeight = doc.internal.pageSize.getHeight();\r\n    \r\n    // Helper function to add header to current page\r\n    const addHeader = () => {\r\n      // Add custom logo if available\r\n      if (itinerarySettings.logo) {\r\n        try {\r\n          const logoW = 45;\r\n          const logoH = 20;\r\n          const logoX = pageWidth - 14 - logoW;\r\n          doc.addImage(itinerarySettings.logo, 'PNG', logoX, 8, logoW, logoH);\r\n        } catch (e) {\r\n          console.warn('Logo add failed:', e);\r\n        }\r\n      }\r\n      \r\n      // Company name at top - centered\r\n      doc.setFontSize(16);\r\n      doc.setFont(undefined, \"bold\");\r\n      const companyName = itinerarySettings.companyName || \"CollEco Travel\";\r\n      const companyWidth = doc.getTextWidth(companyName);\r\n      doc.text(companyName, (pageWidth - companyWidth) / 2, 16);\r\n      \r\n      // Letterhead: Bird logo - \"Tagline\" - Globe (centered)\r\n      doc.setFontSize(24);\r\n      const bird = \"ü¶ú\";\r\n      doc.setFontSize(11);\r\n      doc.setFont(undefined, \"italic\");\r\n      const payoffLine = itinerarySettings.tagline || \"The Odyssey of Adventure\";\r\n      const payoffWidth = doc.getTextWidth(payoffLine);\r\n      doc.setFontSize(14);\r\n      const globe = \"üåç\";\r\n      \r\n      // Calculate total width of bird + payoff + globe\r\n      doc.setFontSize(24);\r\n      const birdWidth = doc.getTextWidth(bird);\r\n      doc.setFontSize(14);\r\n      const globeWidth = doc.getTextWidth(globe);\r\n      const spacing = 2;\r\n      const totalWidth = birdWidth + spacing + payoffWidth + spacing + globeWidth;\r\n      const startX = (pageWidth - totalWidth) / 2;\r\n      \r\n      // Draw centered elements\r\n      doc.setFontSize(24);\r\n      doc.text(bird, startX, 26);\r\n      \r\n      doc.setFontSize(11);\r\n      doc.setFont(undefined, \"italic\");\r\n      doc.text(payoffLine, startX + birdWidth + spacing, 26);\r\n      \r\n      doc.setFontSize(14);\r\n      doc.text(globe, startX + birdWidth + spacing + payoffWidth + spacing, 26);\r\n      \r\n      // Decorative line\r\n      doc.setDrawColor(255, 140, 0); // Orange color\r\n      doc.setLineWidth(0.5);\r\n      doc.line(14, 36, pageWidth - 14, 36);\r\n      \r\n      doc.setTextColor(0, 0, 0);\r\n    };\r\n    \r\n    // Helper function to add footer to current page\r\n    const addFooter = () => {\r\n      // Website\r\n      doc.setFontSize(10);\r\n      doc.setFont(undefined, \"bold\");\r\n      doc.setTextColor(255, 140, 0); // Orange color\r\n      const websiteText = itinerarySettings.website || \"www.travelcolleco.com\";\r\n      const websiteWidth = doc.getTextWidth(websiteText);\r\n      const websiteX = (pageWidth - websiteWidth) / 2;\r\n      doc.text(websiteText, websiteX, pageHeight - 10);\r\n      \r\n      // Underline the website\r\n      doc.setDrawColor(255, 140, 0);\r\n      doc.setLineWidth(0.5);\r\n      doc.line(websiteX, pageHeight - 9, websiteX + websiteWidth, pageHeight - 9);\r\n      \r\n      doc.setTextColor(0, 0, 0);\r\n    };\r\n    \r\n    // Add header to first page\r\n    addHeader();\r\n    \r\n    // Generated date - left aligned (only on first page)\r\n    doc.setFontSize(9);\r\n    doc.setFont(undefined, \"normal\");\r\n    doc.setTextColor(100, 100, 100);\r\n    const dateText = `Itinerary for the Mkhize family generated on ${new Date().toLocaleDateString('en-GB')}`;\r\n    doc.text(dateText, 14, 32);\r\n    doc.setTextColor(0, 0, 0);\r\n    \r\n    let y = 46;\r\n    const days = Object.keys(trip.days).sort((a, b) => Number(a) - Number(b));\r\n    const startDate = new Date(); // Starting from today\r\n    \r\n    days.forEach((d, dayIndex) => {\r\n      // Calculate the actual date for this day\r\n      const currentDate = new Date(startDate);\r\n      currentDate.setDate(startDate.getDate() + dayIndex);\r\n      const formattedDate = currentDate.toLocaleDateString('en-GB'); // DD-MM-YYYY format\r\n      \r\n      doc.setFontSize(14);\r\n      doc.setFont(undefined, \"bold\");\r\n      doc.text(`Day ${d} - ${formattedDate}`, 14, y);\r\n      y += 8;\r\n      \r\n      doc.setFontSize(10);\r\n      doc.setFont(undefined, \"normal\");\r\n      \r\n      (trip.days[d] || []).forEach((item) => {\r\n        // Include time if available\r\n        const timeInfo = item.time ? `[${item.time}] ` : '';\r\n        const text = `‚Ä¢ ${timeInfo}${item.title}${item.subtitle ? \" ‚Äî \" + item.subtitle : \"\"}`;\r\n        const lines = doc.splitTextToSize(text, 180);\r\n        lines.forEach(line => {\r\n          if (y > 270) {\r\n            doc.addPage();\r\n            addHeader();\r\n            y = 46;\r\n          }\r\n          doc.text(line, 18, y);\r\n          y += 6;\r\n        });\r\n      });\r\n      \r\n      const mem = trip.memories?.[d];\r\n      if (mem) {\r\n        doc.setFont(undefined, \"italic\");\r\n        const memLines = doc.splitTextToSize(`Notes: ${mem}`, 180);\r\n        memLines.forEach(line => {\r\n          if (y > 270) {\r\n            doc.addPage();\r\n            addHeader();\r\n            y = 46;\r\n          }\r\n          doc.text(line, 18, y);\r\n          y += 6;\r\n        });\r\n        doc.setFont(undefined, \"normal\");\r\n      }\r\n      \r\n      y += 6;\r\n    });\r\n    \r\n    // Add footer to all pages\r\n    const pageCount = doc.internal.getNumberOfPages();\r\n    for (let i = 1; i <= pageCount; i++) {\r\n      doc.setPage(i);\r\n      addFooter();\r\n    }\r\n    \r\n    doc.save(\"itinerary.pdf\");\r\n  }\r\n\r\n  const dayKeys = Object.keys(filteredDays).sort((a, b) => Number(a) - Number(b));\r\n  const totalItems = Object.values(filteredDays).reduce((sum, items) => sum + items.length, 0);\r\n\r\n  return (\r\n    <div className=\"w-full min-h-screen bg-gradient-to-br from-cream to-cream-sand\">\r\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 sm:py-8\">\r\n        {/* Header */}\r\n        <div className=\"bg-white rounded-xl shadow-sm border border-cream-border p-6 mb-6\">\r\n          <div className=\"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4\">\r\n            <div className=\"flex-1\">\r\n              <div className=\"flex items-center gap-3 mb-2\">\r\n                <h1 className=\"text-3xl sm:text-4xl font-bold text-brand-brown\">Trip Itinerary</h1>\r\n                <span className=\"text-xs bg-green-100 text-green-700 px-3 py-1 rounded-full font-semibold\" title=\"Auto-save, smart ordering, and AI draft detection enabled\">\r\n                  Smart Mode\r\n                </span>\r\n              </div>\r\n              <p className=\"text-brand-russty text-sm sm:text-base\">\r\n                {dayKeys.length} day{dayKeys.length > 1 ? 's' : ''} ‚Ä¢ {totalItems} activit{totalItems === 1 ? 'y' : 'ies'} planned\r\n              </p>\r\n            </div>\r\n            <div className=\"flex flex-wrap gap-3\">\r\n              <button \r\n                onClick={() => setShowSettings(!showSettings)}\r\n                className=\"px-4 py-2 rounded-lg border-2 border-cream-border text-brand-brown hover:border-brand-orange hover:bg-cream font-semibold transition-all shadow-sm\"\r\n              >\r\n                Settings\r\n              </button>\r\n              <button \r\n                onClick={handleExport}\r\n                className=\"px-4 py-2 rounded-lg border-2 border-brand-orange text-brand-orange hover:bg-brand-orange hover:text-white font-semibold transition-all shadow-sm hover:shadow-md\"\r\n              >\r\n                Export PDF\r\n              </button>\r\n              <button \r\n                onClick={addDay}\r\n                className=\"px-4 py-2 rounded-lg bg-brand-orange text-white hover:bg-brand-highlight font-semibold transition-all shadow-sm hover:shadow-md\"\r\n              >\r\n                Add Day\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        \r\n        {/* Settings Panel */}\r\n        {showSettings && (\r\n          <div className=\"bg-white rounded-xl shadow-sm border border-cream-border p-6 mb-6\">\r\n            <h2 className=\"text-xl font-bold text-brand-brown mb-4 flex items-center gap-2\">\r\n              <span>‚öôÔ∏è</span>\r\n              Itinerary Settings\r\n            </h2>\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n              {/* Left Column */}\r\n              <div className=\"space-y-4\">\r\n                <div>\r\n                  <label className=\"block text-sm font-semibold text-brand-brown mb-1\">Company Name</label>\r\n                  <input\r\n                    type=\"text\"\r\n                    value={itinerarySettings.companyName}\r\n                    onChange={e => setItinerarySettings({...itinerarySettings, companyName: e.target.value})}\r\n                    className=\"w-full px-3 py-2 border border-cream-border rounded-lg focus:border-brand-orange focus:outline-none\"\r\n                    placeholder=\"CollEco Travel\"\r\n                  />\r\n                </div>\r\n                <div>\r\n                  <label className=\"block text-sm font-semibold text-brand-brown mb-1\">Tagline</label>\r\n                  <input\r\n                    type=\"text\"\r\n                    value={itinerarySettings.tagline}\r\n                    onChange={e => setItinerarySettings({...itinerarySettings, tagline: e.target.value})}\r\n                    className=\"w-full px-3 py-2 border border-cream-border rounded-lg focus:border-brand-orange focus:outline-none\"\r\n                    placeholder=\"The Odyssey of Adventure\"\r\n                  />\r\n                </div>\r\n                <div>\r\n                  <label className=\"block text-sm font-semibold text-brand-brown mb-1\">Website</label>\r\n                  <input\r\n                    type=\"text\"\r\n                    value={itinerarySettings.website}\r\n                    onChange={e => setItinerarySettings({...itinerarySettings, website: e.target.value})}\r\n                    className=\"w-full px-3 py-2 border border-cream-border rounded-lg focus:border-brand-orange focus:outline-none\"\r\n                    placeholder=\"www.travelcolleco.com\"\r\n                  />\r\n                </div>\r\n                <div className=\"border-t border-cream-border pt-4\">\r\n                  <h3 className=\"text-sm font-semibold text-brand-brown mb-3\">Trip Location (for weather)</h3>\r\n                  <div className=\"space-y-3\">\r\n                    <div>\r\n                      <label className=\"block text-xs font-semibold text-brand-brown/70 mb-1\">City</label>\r\n                      <input\r\n                        type=\"text\"\r\n                        value={tripLocation.city}\r\n                        onChange={e => setTripLocation({...tripLocation, city: e.target.value})}\r\n                        className=\"w-full px-3 py-2 border border-cream-border rounded-lg focus:border-brand-orange focus:outline-none\"\r\n                        placeholder=\"Durban\"\r\n                      />\r\n                    </div>\r\n                    <div>\r\n                      <label className=\"block text-xs font-semibold text-brand-brown/70 mb-1\">Country</label>\r\n                      <input\r\n                        type=\"text\"\r\n                        value={tripLocation.country}\r\n                        onChange={e => setTripLocation({...tripLocation, country: e.target.value})}\r\n                        className=\"w-full px-3 py-2 border border-cream-border rounded-lg focus:border-brand-orange focus:outline-none\"\r\n                        placeholder=\"South Africa\"\r\n                      />\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n              \r\n              {/* Right Column - Logo Upload */}\r\n              <div>\r\n                <label className=\"block text-sm font-semibold text-brand-brown mb-1\">Company Logo</label>\r\n                <div className=\"border-2 border-dashed border-cream-border rounded-lg p-4 text-center\">\r\n                  {itinerarySettings.logo ? (\r\n                    <div className=\"space-y-3\">\r\n                      <img \r\n                        src={itinerarySettings.logo} \r\n                        alt=\"Company logo\" \r\n                        className=\"h-24 w-auto mx-auto object-contain\"\r\n                      />\r\n                      <button\r\n                        onClick={() => setItinerarySettings({...itinerarySettings, logo: null})}\r\n                        className=\"px-4 py-2 bg-red-100 text-red-700 rounded-lg text-sm font-semibold hover:bg-red-200 transition-colors\"\r\n                      >\r\n                        Remove Logo\r\n                      </button>\r\n                    </div>\r\n                  ) : (\r\n                    <div className=\"space-y-3\">\r\n                      <div className=\"text-4xl opacity-30\">üñºÔ∏è</div>\r\n                      <input\r\n                        type=\"file\"\r\n                        id=\"itineraryLogoUpload\"\r\n                        accept=\"image/*\"\r\n                        onChange={(e) => {\r\n                          const file = e.target.files?.[0];\r\n                          if (!file) return;\r\n                          if (!file.type.startsWith('image/')) {\r\n                            alert('Please upload an image file');\r\n                            return;\r\n                          }\r\n                          if (file.size > 2 * 1024 * 1024) {\r\n                            alert('Image must be less than 2MB');\r\n                            return;\r\n                          }\r\n                          const reader = new FileReader();\r\n                          reader.onload = (evt) => {\r\n                            const dataUrl = evt.target?.result;\r\n                            if (dataUrl && typeof dataUrl === 'string') {\r\n                              setItinerarySettings({...itinerarySettings, logo: dataUrl});\r\n                            }\r\n                          };\r\n                          reader.readAsDataURL(file);\r\n                        }}\r\n                        className=\"hidden\"\r\n                      />\r\n                      <label\r\n                        htmlFor=\"itineraryLogoUpload\"\r\n                        className=\"inline-block px-4 py-2 bg-brand-orange text-white rounded-lg font-semibold hover:bg-brand-highlight transition-colors cursor-pointer\"\r\n                      >\r\n                        üì§ Upload Logo\r\n                      </label>\r\n                      <p className=\"text-xs text-brand-russty\">Max 2MB ‚Ä¢ PNG, JPG, SVG</p>\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {/* Search */}\r\n        <div className=\"mb-6\">\r\n          <input\r\n            type=\"text\"\r\n            value={search}\r\n            onChange={(e) => setSearch(e.target.value)}\r\n            placeholder=\"üîç Search itinerary...\"\r\n            className=\"w-full sm:w-96 px-4 py-2 border-2 border-cream-border rounded-lg focus:border-brand-orange focus:outline-none focus:ring-2 focus:ring-brand-orange/20\"\r\n          />\r\n          {search && (\r\n            <p className=\"mt-2 text-sm text-brand-russty\">\r\n              Showing results for &quot;{search}&quot; ¬∑ <button onClick={() => setSearch(\"\")} className=\"underline hover:no-underline text-brand-orange\">Clear</button>\r\n            </p>\r\n          )}\r\n        </div>\r\n\r\n        {/* Workflow */}\r\n        <div className=\"mb-6\">\r\n          <WorkflowPanel \r\n            currentPage=\"itinerary\" \r\n            basketCount={basket.length}\r\n            hasItinerary={Object.keys(trip.days).length > 0}\r\n          />\r\n        </div>\r\n\r\n        {/* Progress & Content */}\r\n        <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\r\n          <div className=\"lg:col-span-1\">\r\n            <LiveTripProgress steps={computeProgress(trip, linkQuotes ? basket.length : 0)} />\r\n          </div>\r\n\r\n          <div className=\"lg:col-span-2\">\r\n            <div className=\"bg-white rounded-2xl shadow-md p-4 sm:p-6\">\r\n              {dayKeys.length === 0 ? (\r\n                <div className=\"text-center py-12 px-4\">\r\n                  <div className=\"mb-4 text-6xl opacity-20\">üìÖ</div>\r\n                  <p className=\"text-brand-brown font-semibold mb-2\">No itinerary items yet</p>\r\n                  <p className=\"text-sm text-brand-russty mb-4\">\r\n                    {linkQuotes ? 'Add products to your basket on Trip Planner to get started.' : 'Click \"Add Day\" to create your first day.'}\r\n                  </p>\r\n                  <button\r\n                    onClick={addDay}\r\n                    className=\"px-6 py-3 bg-brand-orange text-white rounded-xl font-semibold hover:bg-brand-highlight transition-all shadow-sm hover:shadow-md\"\r\n                  >\r\n                    Create First Day\r\n                  </button>\r\n                </div>\r\n              ) : (\r\n                <div className=\"space-y-6\">\r\n                  {dayKeys.map((day) => {\r\n                    // Calculate date for this day (starting from today)\r\n                    const startDate = new Date();\r\n                    const currentDate = new Date(startDate);\r\n                    currentDate.setDate(startDate.getDate() + (Number(day) - 1));\r\n                    \r\n                    return (\r\n                    <div key={day} className=\"bg-gradient-to-br from-white to-cream-sand/20 rounded-2xl shadow-md p-4 sm:p-6\">\r\n                      <ItineraryDay day={day}>\r\n                        <div className=\"flex items-center justify-between mb-4\">\r\n                          <h3 className=\"text-2xl sm:text-3xl font-bold text-brand-brown\">Day {day}</h3>\r\n                          <span className=\"text-xs sm:text-sm text-brand-russty bg-cream-sand px-2 sm:px-3 py-1 rounded-full font-semibold\">\r\n                            {(filteredDays[day] || []).length} {(filteredDays[day] || []).length === 1 ? 'item' : 'items'}\r\n                          </span>\r\n                        </div>\r\n\r\n                        {/* Weather Forecast */}\r\n                        {tripLocation.city && (\r\n                          <div className=\"mb-5\">\r\n                            <WeatherWidget \r\n                              city={tripLocation.city} \r\n                              country={tripLocation.country}\r\n                            />\r\n                          </div>\r\n                        )}\r\n\r\n                        <div className=\"space-y-3\">\r\n                          {(filteredDays[day] || []).map((item, idx) => (\r\n                            <div key={item.id || idx} className=\"relative group\">\r\n                              <ExperienceCard \r\n                                title={item.title} \r\n                                subtitle={item.subtitle} \r\n                                time={item.time} \r\n                              />\r\n                              {item._basketSource && (\r\n                                <span className=\"absolute left-2 top-2 text-[10px] px-2 py-1 rounded-full bg-blue-100 text-blue-700 font-semibold\">\r\n                                  From Basket\r\n                                </span>\r\n                              )}\r\n                              <button\r\n                                onClick={() => removeItem(day, item.id)}\r\n                                className=\"absolute right-2 top-2 opacity-0 group-hover:opacity-100 transition-opacity bg-red-500 hover:bg-red-600 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm\"\r\n                                title=\"Remove item\"\r\n                              >\r\n                                ‚úï\r\n                              </button>\r\n                            </div>\r\n                          ))}\r\n                        </div>\r\n\r\n                        {/* Memory Notes */}\r\n                        <div className=\"mt-4\">\r\n                          <MemoryNote\r\n                            day={day}\r\n                            value={trip.memories?.[day] || ''}\r\n                            onChange={(val) => setMemory(trip, setTrip, day, val)}\r\n                            placeholder=\"Add notes or memories for this day...\"\r\n                          />\r\n                        </div>\r\n                      </ItineraryDay>\r\n                    </div>\r\n                    );\r\n                  })}\r\n                </div>\r\n              )}\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"file":"Itinerary-Db3jaCzc.js"}