{"version":3,"file":"PrivacySettings-B_In51Te.js","sources":["../../src/utils/consentApi.js","../../src/pages/PrivacySettings.jsx"],"sourcesContent":["/**\r\n * Legal Consent API Utility\r\n * Provides functions to interact with backend consent endpoints\r\n * POPI Act Compliance: Section 11 (Lawful basis for data processing)\r\n */\r\n\r\nconst API_BASE = import.meta.env.VITE_API_BASE || 'http://localhost:4000';\r\n\r\n/**\r\n * Store user consent to legal documents\r\n * @param {string} userId - Unique user identifier\r\n * @param {object} consentData - { consentType, acceptedSLA }\r\n * @returns {Promise} - { success, consentId, timestamp }\r\n */\r\nexport async function storeConsent(userId, consentData = {}) {\r\n  try {\r\n    const response = await fetch(`${API_BASE}/api/legal/consent`, {\r\n      method: 'POST',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n      },\r\n      body: JSON.stringify({\r\n        userId,\r\n        consentType: consentData.consentType || 'registration',\r\n        acceptedTerms: true,\r\n        acceptedPrivacy: true,\r\n        acceptedSLA: consentData.acceptedSLA || false,\r\n      }),\r\n    });\r\n\r\n    if (!response.ok) {\r\n      const error = await response.text();\r\n      throw new Error(error || `HTTP ${response.status}`);\r\n    }\r\n\r\n    return await response.json();\r\n  } catch (error) {\r\n    console.error('[consentApi] storeConsent failed:', error);\r\n    throw error;\r\n  }\r\n}\r\n\r\n/**\r\n * Get full consent history for a user\r\n * POPI Act: Section 14 - User's right to access personal information\r\n * @param {string} userId - Unique user identifier\r\n * @returns {Promise} - { userId, consentHistory, totalRecords }\r\n */\r\nexport async function getConsentHistory(userId) {\r\n  try {\r\n    const response = await fetch(`${API_BASE}/api/legal/consent/${userId}`);\r\n\r\n    if (!response.ok) {\r\n      const error = await response.text();\r\n      throw new Error(error || `HTTP ${response.status}`);\r\n    }\r\n\r\n    return await response.json();\r\n  } catch (error) {\r\n    console.error('[consentApi] getConsentHistory failed:', error);\r\n    throw error;\r\n  }\r\n}\r\n\r\n/**\r\n * Get consent summary for UI display (Privacy Settings)\r\n * @param {string} userId - Unique user identifier\r\n * @returns {Promise} - { userId, hasConsented, latestConsent, versions }\r\n */\r\nexport async function getConsentSummary(userId) {\r\n  try {\r\n    const response = await fetch(`${API_BASE}/api/legal/consent-summary/${userId}`);\r\n\r\n    if (!response.ok) {\r\n      const error = await response.text();\r\n      throw new Error(error || `HTTP ${response.status}`);\r\n    }\r\n\r\n    return await response.json();\r\n  } catch (error) {\r\n    console.error('[consentApi] getConsentSummary failed:', error);\r\n    throw error;\r\n  }\r\n}\r\n\r\n/**\r\n * Withdraw user consent\r\n * POPI Act: Section 11.4.3 - User's right to withdraw consent at any time\r\n * @param {string} userId - Unique user identifier\r\n * @param {string} reason - Optional reason for withdrawal\r\n * @returns {Promise} - { success, withdrawalId, message }\r\n */\r\nexport async function withdrawConsent(userId, reason = '') {\r\n  try {\r\n    const response = await fetch(`${API_BASE}/api/legal/consent/${userId}/withdraw`, {\r\n      method: 'POST',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n      },\r\n      body: JSON.stringify({\r\n        reason: reason || 'Not specified',\r\n      }),\r\n    });\r\n\r\n    if (!response.ok) {\r\n      const error = await response.text();\r\n      throw new Error(error || `HTTP ${response.status}`);\r\n    }\r\n\r\n    return await response.json();\r\n  } catch (error) {\r\n    console.error('[consentApi] withdrawConsent failed:', error);\r\n    throw error;\r\n  }\r\n}\r\n\r\n/**\r\n * Get current legal document versions\r\n * @returns {Promise} - { termsVersion, privacyVersion, slaVersion, lastUpdated }\r\n */\r\nexport async function getLegalVersions() {\r\n  try {\r\n    const response = await fetch(`${API_BASE}/api/legal/versions`);\r\n\r\n    if (!response.ok) {\r\n      const error = await response.text();\r\n      throw new Error(error || `HTTP ${response.status}`);\r\n    }\r\n\r\n    return await response.json();\r\n  } catch (error) {\r\n    console.error('[consentApi] getLegalVersions failed:', error);\r\n    throw error;\r\n  }\r\n}\r\n\r\n/**\r\n * Check if user has given consent\r\n * Utility function for checking permission before showing certain features\r\n * @param {string} userId - Unique user identifier\r\n * @returns {Promise<boolean>} - true if user has consented, false otherwise\r\n */\r\nexport async function hasUserConsented(userId) {\r\n  try {\r\n    const summary = await getConsentSummary(userId);\r\n    return summary.hasConsented && summary.termsAccepted && summary.privacyAccepted;\r\n  } catch (error) {\r\n    console.warn('[consentApi] hasUserConsented check failed, assuming not consented:', error);\r\n    return false;\r\n  }\r\n}\r\n\r\n/**\r\n * Get audit log stats (admin function)\r\n * @returns {Promise} - { totalConsents, uniqueUsers, acceptedTerms, etc. }\r\n */\r\nexport async function getAuditStats() {\r\n  try {\r\n    const response = await fetch(`${API_BASE}/api/legal/stats`);\r\n\r\n    if (!response.ok) {\r\n      const error = await response.text();\r\n      throw new Error(error || `HTTP ${response.status}`);\r\n    }\r\n\r\n    return await response.json();\r\n  } catch (error) {\r\n    console.error('[consentApi] getAuditStats failed:', error);\r\n    throw error;\r\n  }\r\n}\r\n\r\n/**\r\n * Get paginated audit log (admin function)\r\n * @param {object} filters - { userId, action, limit, offset }\r\n * @returns {Promise} - { total, records, limit, offset }\r\n */\r\nexport async function getAuditLog(filters = {}) {\r\n  try {\r\n    const params = new URLSearchParams();\r\n    if (filters.userId) params.append('userId', filters.userId);\r\n    if (filters.action) params.append('action', filters.action);\r\n    if (filters.limit) params.append('limit', filters.limit);\r\n    if (filters.offset) params.append('offset', filters.offset);\r\n\r\n    const queryString = params.toString() ? `?${params.toString()}` : '';\r\n    const response = await fetch(`${API_BASE}/api/legal/audit${queryString}`);\r\n\r\n    if (!response.ok) {\r\n      const error = await response.text();\r\n      throw new Error(error || `HTTP ${response.status}`);\r\n    }\r\n\r\n    return await response.json();\r\n  } catch (error) {\r\n    console.error('[consentApi] getAuditLog failed:', error);\r\n    throw error;\r\n  }\r\n}\r\n\r\nexport default {\r\n  storeConsent,\r\n  getConsentHistory,\r\n  getConsentSummary,\r\n  withdrawConsent,\r\n  getLegalVersions,\r\n  hasUserConsented,\r\n  getAuditStats,\r\n  getAuditLog,\r\n};\r\n","/**\r\n * Privacy Settings Page\r\n * Allows users to view and manage their consent and data privacy\r\n * POPI Act Compliance: Section 14 (User rights to access and control personal data)\r\n */\r\n\r\nimport { useState, useEffect, useCallback } from 'react';\r\nimport { Shield, Lock, Trash2, CheckCircle, AlertCircle, Download } from 'lucide-react';\r\nimport { useUser } from '../context/UserContext';\r\nimport { getConsentSummary, getConsentHistory, withdrawConsent } from '../utils/consentApi';\r\n\r\nexport default function PrivacySettings() {\r\n  const { user } = useUser();\r\n  const [consentSummary, setConsentSummary] = useState(null);\r\n  const [consentHistory, setConsentHistory] = useState(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState('');\r\n  const [withdrawalReason, setWithdrawalReason] = useState('');\r\n  const [showWithdrawalConfirm, setShowWithdrawalConfirm] = useState(false);\r\n  const [withdrawing, setWithdrawing] = useState(false);\r\n\r\n  const loadConsentData = useCallback(async () => {\r\n    try {\r\n      setLoading(true);\r\n      setError('');\r\n\r\n      const userId = user?.id || user?.email;\r\n\r\n      const [summary, history] = await Promise.all([\r\n        getConsentSummary(userId),\r\n        getConsentHistory(userId),\r\n      ]);\r\n\r\n      setConsentSummary(summary);\r\n      setConsentHistory(history);\r\n    } catch (err) {\r\n      console.error('Failed to load consent data:', err);\r\n      setError('Failed to load privacy settings: ' + err.message);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, [user?.id, user?.email]);\r\n\r\n  // Load consent data on mount / when user changes\r\n  // loadConsentData already lists `user?.id` and `user?.email` in its dependencies.\r\n  // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  useEffect(() => {\r\n    if (!user?.id && !user?.email) {\r\n      setError('Please log in to view privacy settings');\r\n      setLoading(false);\r\n      return;\r\n    }\r\n\r\n    loadConsentData();\r\n  }, [loadConsentData]); // eslint-disable-line react-hooks/exhaustive-deps\r\n\r\n  const handleWithdrawConsent = async () => {\r\n    if (!withdrawalReason.trim()) {\r\n      setError('Please provide a reason for withdrawal');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      setWithdrawing(true);\r\n      const userId = user?.id || user?.email;\r\n      \r\n      await withdrawConsent(userId, withdrawalReason);\r\n      \r\n      setError('');\r\n      setShowWithdrawalConfirm(false);\r\n      setWithdrawalReason('');\r\n      \r\n      // Reload consent data\r\n      await loadConsentData();\r\n      \r\n      // Show success message\r\n      alert('Consent withdrawn successfully. Your data will be deleted or anonymized per POPI Act requirements.');\r\n    } catch (err) {\r\n      setError('Failed to withdraw consent: ' + err.message);\r\n    } finally {\r\n      setWithdrawing(false);\r\n    }\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"min-h-screen bg-cream p-6 sm:p-10 flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <Shield className=\"w-12 h-12 text-brand-orange mx-auto mb-4 animate-spin\" />\r\n          <p className=\"text-gray-600\">Loading privacy settings...</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!user) {\r\n    return (\r\n      <div className=\"min-h-screen bg-cream p-6 sm:p-10 flex items-center justify-center\">\r\n        <div className=\"bg-white rounded-lg shadow-sm p-8 text-center max-w-md\">\r\n          <AlertCircle className=\"w-12 h-12 text-orange-500 mx-auto mb-4\" />\r\n          <h1 className=\"text-2xl font-bold text-brand-brown mb-2\">Not Logged In</h1>\r\n          <p className=\"text-gray-600 mb-6\">Please log in to view your privacy settings.</p>\r\n          <a href=\"/login\" className=\"btn btn-primary\">\r\n            Go to Login\r\n          </a>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-cream p-6 sm:p-10\">\r\n      <div className=\"max-w-4xl mx-auto\">\r\n        {/* Header */}\r\n        <div className=\"flex items-center gap-4 mb-8\">\r\n          <Shield className=\"w-8 h-8 text-brand-orange\" />\r\n          <div>\r\n            <h1 className=\"text-3xl font-bold text-brand-brown mb-2\">Privacy & Data Settings</h1>\r\n            <p className=\"text-gray-600\">Manage your consent and personal data (POPI Act Compliant)</p>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Error Message */}\r\n        {error && (\r\n          <div className=\"bg-red-50 border-l-4 border-red-400 p-4 rounded-lg mb-6\">\r\n            <p className=\"text-red-700\">{error}</p>\r\n          </div>\r\n        )}\r\n\r\n        {/* Consent Status Summary */}\r\n        {consentSummary && (\r\n          <div className=\"grid md:grid-cols-3 gap-6 mb-8\">\r\n            {/* Terms Status */}\r\n            <div className=\"bg-white rounded-lg shadow-sm p-6 border-t-4 border-green-500\">\r\n              <div className=\"flex items-center justify-between mb-4\">\r\n                <h3 className=\"font-semibold text-brand-brown\">Terms & Conditions</h3>\r\n                {consentSummary.termsAccepted ? (\r\n                  <CheckCircle className=\"w-5 h-5 text-green-500\" />\r\n                ) : (\r\n                  <AlertCircle className=\"w-5 h-5 text-red-500\" />\r\n                )}\r\n              </div>\r\n              <p className=\"text-sm text-gray-600 mb-4\">\r\n                {consentSummary.termsAccepted ? 'Accepted' : 'Not accepted'}\r\n              </p>\r\n              {consentSummary.latestConsent && (\r\n                <>\r\n                  <p className=\"text-xs text-gray-500 mb-1\">\r\n                    <strong>Version:</strong> {consentSummary.versions?.termsVersion || 'N/A'}\r\n                  </p>\r\n                  <p className=\"text-xs text-gray-500\">\r\n                    <strong>Date:</strong> {new Date(consentSummary.lastConsentDate).toLocaleDateString()}\r\n                  </p>\r\n                </>\r\n              )}\r\n            </div>\r\n\r\n            {/* Privacy Policy Status */}\r\n            <div className=\"bg-white rounded-lg shadow-sm p-6 border-t-4 border-green-500\">\r\n              <div className=\"flex items-center justify-between mb-4\">\r\n                <h3 className=\"font-semibold text-brand-brown\">Privacy Policy</h3>\r\n                {consentSummary.privacyAccepted ? (\r\n                  <CheckCircle className=\"w-5 h-5 text-green-500\" />\r\n                ) : (\r\n                  <AlertCircle className=\"w-5 h-5 text-red-500\" />\r\n                )}\r\n              </div>\r\n              <p className=\"text-sm text-gray-600 mb-4\">\r\n                {consentSummary.privacyAccepted ? 'Accepted' : 'Not accepted'}\r\n              </p>\r\n              {consentSummary.latestConsent && (\r\n                <>\r\n                  <p className=\"text-xs text-gray-500 mb-1\">\r\n                    <strong>Version:</strong> {consentSummary.versions?.privacyVersion || 'N/A'}\r\n                  </p>\r\n                  <p className=\"text-xs text-gray-500\">\r\n                    <strong>Date:</strong> {new Date(consentSummary.lastConsentDate).toLocaleDateString()}\r\n                  </p>\r\n                </>\r\n              )}\r\n            </div>\r\n\r\n            {/* SLA Status (if applicable) */}\r\n            <div className=\"bg-white rounded-lg shadow-sm p-6 border-t-4 border-blue-500\">\r\n              <div className=\"flex items-center justify-between mb-4\">\r\n                <h3 className=\"font-semibold text-brand-brown\">Service Agreement</h3>\r\n                {consentSummary.slaAccepted ? (\r\n                  <CheckCircle className=\"w-5 h-5 text-green-500\" />\r\n                ) : (\r\n                  <AlertCircle className=\"w-5 h-5 text-gray-400\" />\r\n                )}\r\n              </div>\r\n              <p className=\"text-sm text-gray-600 mb-4\">\r\n                {consentSummary.slaAccepted ? 'Accepted (Partner)' : 'Not applicable'}\r\n              </p>\r\n              {consentSummary.slaAccepted && consentSummary.latestConsent && (\r\n                <>\r\n                  <p className=\"text-xs text-gray-500 mb-1\">\r\n                    <strong>Version:</strong> {consentSummary.versions?.slaVersion || 'N/A'}\r\n                  </p>\r\n                  <p className=\"text-xs text-gray-500\">\r\n                    <strong>Date:</strong> {new Date(consentSummary.lastConsentDate).toLocaleDateString()}\r\n                  </p>\r\n                </>\r\n              )}\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {/* Consent History */}\r\n        {consentHistory && consentHistory.consentHistory.length > 0 && (\r\n          <div className=\"bg-white rounded-lg shadow-sm p-6 mb-8\">\r\n            <h2 className=\"text-xl font-bold text-brand-brown mb-4 flex items-center gap-2\">\r\n              <Lock className=\"w-5 h-5\" />\r\n              Consent History\r\n            </h2>\r\n            <p className=\"text-sm text-gray-600 mb-6\">\r\n              POPI Act: This is your audit trail showing when you provided consent.\r\n            </p>\r\n            \r\n            {consentHistory.consentHistory.map((record, idx) => (\r\n              <div key={idx} className=\"border-b border-gray-200 pb-4 mb-4 last:border-b-0 last:mb-0\">\r\n                <div className=\"flex items-center justify-between mb-2\">\r\n                  <span className=\"font-semibold text-brand-brown capitalize\">\r\n                    {record.consentType?.replace(/_/g, ' ')}\r\n                  </span>\r\n                  <span className=\"text-xs text-gray-500\">\r\n                    {new Date(record.timestamp).toLocaleString()}\r\n                  </span>\r\n                </div>\r\n                <div className=\"grid md:grid-cols-3 gap-4 text-sm text-gray-600\">\r\n                  <div>\r\n                    <span className=\"font-medium\">Terms:</span> {record.acceptedTerms?.accepted ? '✓' : '✗'}\r\n                  </div>\r\n                  <div>\r\n                    <span className=\"font-medium\">Privacy:</span> {record.acceptedPrivacy?.accepted ? '✓' : '✗'}\r\n                  </div>\r\n                  <div>\r\n                    <span className=\"font-medium\">SLA:</span> {record.acceptedSLA?.accepted ? '✓' : '✗'}\r\n                  </div>\r\n                </div>\r\n                <p className=\"text-xs text-gray-400 mt-2\">\r\n                  IP: {record.ipAddress} | Version: T{record.termsVersion}, P{record.privacyVersion}, S{record.slaVersion}\r\n                </p>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        )}\r\n\r\n        {/* Data Access Rights */}\r\n        <div className=\"bg-white rounded-lg shadow-sm p-6 mb-8\">\r\n          <h2 className=\"text-xl font-bold text-brand-brown mb-4 flex items-center gap-2\">\r\n            <Download className=\"w-5 h-5\" />\r\n            Your Data Rights (POPI Act)\r\n          </h2>\r\n          \r\n          <div className=\"grid md:grid-cols-2 gap-6 text-sm text-gray-700\">\r\n            <div>\r\n              <h3 className=\"font-semibold text-brand-brown mb-2\">✓ Right to Access</h3>\r\n              <p>You have the right to know what personal data CollEco stores about you. Request your data export at any time.</p>\r\n            </div>\r\n            <div>\r\n              <h3 className=\"font-semibold text-brand-brown mb-2\">✓ Right to Correct</h3>\r\n              <p>If your information is inaccurate, contact support@colleco.com to request corrections within 5 business days.</p>\r\n            </div>\r\n            <div>\r\n              <h3 className=\"font-semibold text-brand-brown mb-2\">✓ Right to Delete</h3>\r\n              <p>Withdraw consent to delete your account and personal data. Processing begins within 30 days.</p>\r\n            </div>\r\n            <div>\r\n              <h3 className=\"font-semibold text-brand-brown mb-2\">✓ Right to Portability</h3>\r\n              <p>Request your data in a machine-readable format (JSON/CSV) for transfer to another service.</p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Withdraw Consent Section */}\r\n        <div className=\"bg-red-50 rounded-lg shadow-sm p-6 border border-red-200\">\r\n          <h2 className=\"text-xl font-bold text-red-700 mb-2 flex items-center gap-2\">\r\n            <Trash2 className=\"w-5 h-5\" />\r\n            Withdraw Consent & Delete Account\r\n          </h2>\r\n          \r\n          <p className=\"text-sm text-red-600 mb-4\">\r\n            Withdrawing consent will delete your account and personal data per POPI Act requirements. This action cannot be undone.\r\n          </p>\r\n\r\n          {!showWithdrawalConfirm ? (\r\n            <button\r\n              onClick={() => setShowWithdrawalConfirm(true)}\r\n              className=\"btn bg-red-600 hover:bg-red-700 text-white\"\r\n            >\r\n              Withdraw Consent & Delete Account\r\n            </button>\r\n          ) : (\r\n            <div className=\"space-y-4\">\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                  Why are you withdrawing consent? (required)\r\n                </label>\r\n                <textarea\r\n                  value={withdrawalReason}\r\n                  onChange={(e) => setWithdrawalReason(e.target.value)}\r\n                  placeholder=\"Please tell us why...\"\r\n                  className=\"w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-orange\"\r\n                  rows=\"3\"\r\n                />\r\n              </div>\r\n\r\n              <div className=\"bg-yellow-50 border border-yellow-200 p-3 rounded-lg text-sm text-yellow-700\">\r\n                <strong>⚠️ Warning:</strong> This will permanently delete your account and all associated data.\r\n              </div>\r\n\r\n              <div className=\"flex gap-4\">\r\n                <button\r\n                  onClick={() => {\r\n                    setShowWithdrawalConfirm(false);\r\n                    setWithdrawalReason('');\r\n                  }}\r\n                  className=\"btn btn-secondary flex-1\"\r\n                >\r\n                  Cancel\r\n                </button>\r\n                <button\r\n                  onClick={handleWithdrawConsent}\r\n                  disabled={withdrawing}\r\n                  className=\"btn bg-red-600 hover:bg-red-700 text-white flex-1 disabled:opacity-50\"\r\n                >\r\n                  {withdrawing ? 'Processing...' : 'Confirm Withdrawal'}\r\n                </button>\r\n              </div>\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        {/* Contact Information */}\r\n        <div className=\"bg-gray-50 rounded-lg shadow-sm p-6 mt-8 border border-gray-200\">\r\n          <h3 className=\"font-semibold text-brand-brown mb-4\">Privacy Officer Contact</h3>\r\n          <p className=\"text-sm text-gray-600 mb-4\">\r\n            For questions about your privacy rights or to exercise your POPI Act rights, contact our Privacy Officer:\r\n          </p>\r\n          <div className=\"space-y-2 text-sm\">\r\n            <p><strong>Email:</strong> <a href=\"mailto:privacy@colleco.com\" className=\"text-brand-orange hover:underline\">privacy@colleco.com</a></p>\r\n            <p><strong>Phone:</strong> <a href=\"tel:+27XXXXXXXXX\" className=\"text-brand-orange hover:underline\">[PLACEHOLDER]</a></p>\r\n            <p><strong>Address:</strong> [PLACEHOLDER - Company address]</p>\r\n            <p className=\"text-xs text-gray-500 mt-4\">Response time: Within 15 business days per POPI Act requirements</p>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":["useState","useCallback","useEffect","jsxs","jsx","Fragment"],"mappings":"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"}