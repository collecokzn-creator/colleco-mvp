{"version":3,"file":"client-BwpB5jnn.js","sources":["../../src/utils/payments.js","../../src/api/client.js"],"sourcesContent":["const STORAGE_KEY = 'payments:v1';\r\n\r\nfunction load() {\r\n  try { const raw = localStorage.getItem(STORAGE_KEY); return raw ? JSON.parse(raw) : { sessions: {}, payments: [] }; }\r\n  catch { return { sessions: {}, payments: [] }; }\r\n}\r\nfunction save(state) {\r\n  try { localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); } catch {}\r\n}\r\n\r\nexport function computeFees(items = [], currency = 'USD') {\r\n  const subtotal = items.reduce((s, it) => s + Math.max(0, Number(it.amount || 0)), 0);\r\n  const paymentProcessor = Math.round(subtotal * 0.029 * 100) / 100 + 0.3;\r\n  const platformFee = Math.round(subtotal * 0.05 * 100) / 100;\r\n  const taxes = Math.round(subtotal * 0.15 * 100) / 100;\r\n  const total = Math.round((subtotal + paymentProcessor + platformFee + taxes) * 100) / 100;\r\n  return { currency, subtotal, paymentProcessor, platformFee, taxes, total };\r\n}\r\n\r\nexport function createMockCheckout({ items = [], currency = 'USD', metadata = {} }) {\r\n  const state = load();\r\n  const sessionId = Math.random().toString(36).slice(2);\r\n  state.sessions[sessionId] = { id: sessionId, items, currency, metadata, createdAt: Date.now(), status: 'open' };\r\n  save(state);\r\n  const params = new URLSearchParams({ sessionId });\r\n  return { sessionId, checkoutUrl: `/payment-success?${params.toString()}` };\r\n}\r\n\r\nexport function confirmMockPayment(sessionId) {\r\n  const state = load();\r\n  const s = state.sessions[sessionId];\r\n  if (!s) return null;\r\n  s.status = 'paid';\r\n  const fees = computeFees(s.items, s.currency);\r\n  const payment = { id: sessionId, amount: fees.total, currency: s.currency, items: s.items, metadata: s.metadata, paidAt: Date.now() };\r\n  state.payments.push(payment);\r\n  save(state);\r\n  return payment;\r\n}\r\n\r\nexport function getPayment(sessionId) {\r\n  const state = load();\r\n  return state.payments.find(p => p.id === sessionId) || null;\r\n}\r\n\r\nexport function listPayments() {\r\n  return load().payments || [];\r\n}\r\n\r\nexport function totalPaid() {\r\n  return (load().payments || []).reduce((s, p) => s + (p.amount || 0), 0);\r\n}\r\n","// CollEco Travel API Client (scalable, API-first)\r\n// Use this module for all frontend API calls. Easily swap endpoints for white-labeling or partner integrations.\r\n// Example: import { getQuotes } from '../api/client'\r\n\r\n// Default to local dev server if not provided. Use Vite's import.meta.env in the browser build.\r\nconst BASE_URL = (typeof import.meta !== 'undefined' && import.meta.env && import.meta.env.VITE_API_URL)\r\n  ? import.meta.env.VITE_API_URL\r\n  : (typeof window !== 'undefined' ? `${window.location.origin}/api` : 'http://localhost:4000/api');\r\n\r\nexport async function getQuotes() {\r\n  // GET /quotes\r\n  const res = await fetch(`${BASE_URL}/quotes`);\r\n  if (!res.ok) {\r\n    const body = await res.text();\r\n    const err = new Error('Failed to fetch quotes');\r\n    err.status = res.status;\r\n    err.body = body;\r\n    throw err;\r\n  }\r\n  return res.json();\r\n}\r\n\r\nexport async function getItineraries() {\r\n  // GET /itineraries\r\n  const res = await fetch(`${BASE_URL}/itineraries`);\r\n  if (!res.ok) throw new Error('Failed to fetch itineraries');\r\n  return res.json();\r\n}\r\n\r\nexport async function createBooking(data) {\r\n  // POST /bookings\r\n  const res = await fetch(`${BASE_URL}/bookings`, {\r\n    method: 'POST',\r\n    headers: { 'Content-Type': 'application/json' },\r\n    body: JSON.stringify(data)\r\n  });\r\n  if (!res.ok) {\r\n    const ct = res.headers.get('content-type') || '';\r\n    const body = ct.includes('application/json') ? await res.json() : await res.text();\r\n    const err = new Error('Failed to create booking');\r\n    err.status = res.status;\r\n    err.body = body;\r\n    throw err;\r\n  }\r\n  return res.json();\r\n}\r\n\r\nexport async function getBooking(id) {\r\n  // GET /bookings/:id\r\n  if (!id) throw new Error('Missing booking id');\r\n  const res = await fetch(`${BASE_URL}/bookings/${encodeURIComponent(id)}`);\r\n  if (!res.ok) {\r\n    const body = await res.text();\r\n    const err = new Error('Failed to fetch booking');\r\n    err.status = res.status;\r\n    err.body = body;\r\n    throw err;\r\n  }\r\n  return res.json();\r\n}\r\n\r\nexport async function bookAccommodation({ hotelName, nights, unitPrice, currency = 'USD', customer = {}, metadata = {} }){\r\n  const res = await fetch(`${BASE_URL}/bookings/accommodation`, {\r\n    method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ hotelName, nights, unitPrice, currency, customer, metadata })\r\n  });\r\n  if(!res.ok) {\r\n    const ct = res.headers.get('content-type') || '';\r\n    const body = ct.includes('application/json') ? await res.json() : await res.text();\r\n    const err = new Error('Failed to create accommodation booking'); err.status = res.status; err.body = body; throw err;\r\n  }\r\n  return res.json();\r\n}\r\n\r\nexport async function checkAccommodationAvailability({ roomType = 'standard', startDate, endDate }){\r\n  const url = new URL(`${BASE_URL.replace(/\\/api$/,'')}/api/accommodation/availability`);\r\n  if(roomType) url.searchParams.set('roomType', roomType);\r\n  if(startDate) url.searchParams.set('startDate', startDate);\r\n  if(endDate) url.searchParams.set('endDate', endDate);\r\n  const res = await fetch(url.toString());\r\n  if(!res.ok){ const body = await res.text(); const err = new Error('Failed to check availability'); err.status = res.status; err.body = body; throw err; }\r\n  return res.json();\r\n}\r\n\r\nexport async function createAccommodationHold({ roomType = 'standard', startDate, endDate, qty = 1, holdMinutes = 10 }){\r\n  const res = await fetch(`${BASE_URL}/accommodation/hold`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ roomType, startDate, endDate, qty, holdMinutes }) });\r\n  if(!res.ok){ const body = await res.text(); const err = new Error('Failed to create hold'); err.status = res.status; err.body = body; throw err; }\r\n  return res.json();\r\n}\r\n\r\nexport async function bookFlight({ from, to, date, price, currency = 'USD', customer = {}, metadata = {}, flightNumber, returnFlight }){\r\n  const res = await fetch(`${BASE_URL}/bookings/flight`, {\r\n    method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ from, to, date, price, currency, customer, metadata, flightNumber, returnFlight })\r\n  });\r\n  if(!res.ok) {\r\n    const ct = res.headers.get('content-type') || '';\r\n    const body = ct.includes('application/json') ? await res.json() : await res.text();\r\n    const err = new Error('Failed to create flight booking'); err.status = res.status; err.body = body; throw err;\r\n  }\r\n  return res.json();\r\n}\r\n\r\nexport async function bookCar({ vehicleType, days = 1, pricePerDay, currency = 'USD', customer = {}, metadata = {} }){\r\n  const res = await fetch(`${BASE_URL}/bookings/car`, {\r\n    method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ vehicleType, days, pricePerDay, currency, customer, metadata })\r\n  });\r\n  if(!res.ok) {\r\n    const ct = res.headers.get('content-type') || '';\r\n    const body = ct.includes('application/json') ? await res.json() : await res.text();\r\n    const err = new Error('Failed to create car booking'); err.status = res.status; err.body = body; throw err;\r\n  }\r\n  return res.json();\r\n}\r\n\r\n// Add more endpoints as needed for partners, admin, payments, etc.\r\n\r\nexport async function getFlight(itemId){\r\n  if(!itemId) throw new Error('Missing flight item id');\r\n  const res = await fetch(`${BASE_URL}/flights/${encodeURIComponent(itemId)}`);\r\n  if(!res.ok){ const body = await res.text(); const err = new Error('Failed to fetch flight'); err.status = res.status; err.body = body; throw err; }\r\n  return res.json();\r\n}\r\n\r\nexport function subscribeToFlightUpdates(onEvent, opts = { role: 'client' }){\r\n  if(typeof window === 'undefined' || !window.EventSource) return { close: ()=>{} };\r\n  const base = (typeof import.meta !== 'undefined' && import.meta.env && import.meta.env.VITE_API_URL)\r\n    ? import.meta.env.VITE_API_URL\r\n    : (typeof window !== 'undefined' ? `${window.location.origin}/api` : 'http://localhost:4000/api');\r\n  const url = new URL(`${base.replace(/\\/api$/,'')}/events`);\r\n  if(opts.role) url.searchParams.set('role', opts.role);\r\n  const es = new EventSource(url.toString());\r\n  es.addEventListener('flight.updated', (ev) => {\r\n    try { const data = JSON.parse(ev.data); onEvent && onEvent(data); } catch(e){}\r\n  });\r\n  return { close: ()=> es.close() };\r\n}\r\n"],"names":[],"mappings":"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"}