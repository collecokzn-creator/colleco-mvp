{"version":3,"file":"gamificationEngine-BquAD8q6.js","sources":["../../src/utils/gamificationEngine.js"],"sourcesContent":["/**\r\n * CollEco Travel Gamification Engine\r\n * \r\n * Powers engagement through challenges, achievements, leaderboards, and rewards.\r\n * Integrates with loyalty system, booking flows, and revenue tracking.\r\n */\r\n\r\n// ==================== STORAGE KEYS ====================\r\nconst _CHALLENGES_KEY = 'colleco.gamification.challenges';\r\nconst ACHIEVEMENTS_KEY = 'colleco.gamification.achievements';\r\nconst LEADERBOARDS_KEY = 'colleco.gamification.leaderboards';\r\nconst STREAKS_KEY = 'colleco.gamification.streaks';\r\nconst PROGRESS_KEY = 'colleco.gamification.progress';\r\n\r\n// ==================== CHALLENGE DEFINITIONS ====================\r\n\r\nexport const PARTNER_CHALLENGES = {\r\n  // Revenue Challenges\r\n  revenue_starter: {\r\n    id: 'revenue_starter',\r\n    name: 'First R10K',\r\n    description: 'Earn your first R10,000 in revenue',\r\n    type: 'partner',\r\n    category: 'revenue',\r\n    target: 10000,\r\n    reward: { points: 500, badge: 'revenue_bronze' },\r\n    difficulty: 'easy',\r\n  },\r\n  revenue_pro: {\r\n    id: 'revenue_pro',\r\n    name: 'Revenue Champion',\r\n    description: 'Reach R100,000 in total revenue',\r\n    type: 'partner',\r\n    category: 'revenue',\r\n    target: 100000,\r\n    reward: { points: 2500, badge: 'revenue_gold' },\r\n    difficulty: 'hard',\r\n  },\r\n  monthly_target: {\r\n    id: 'monthly_target',\r\n    name: 'Monthly Goal',\r\n    description: 'Hit R50,000 revenue in a single month',\r\n    type: 'partner',\r\n    category: 'revenue',\r\n    target: 50000,\r\n    timeframe: 'monthly',\r\n    reward: { points: 1000, badge: 'monthly_star' },\r\n    difficulty: 'medium',\r\n  },\r\n\r\n  // Booking Challenges\r\n  booking_milestone_10: {\r\n    id: 'booking_milestone_10',\r\n    name: '10 Bookings',\r\n    description: 'Receive 10 confirmed bookings',\r\n    type: 'partner',\r\n    category: 'bookings',\r\n    target: 10,\r\n    reward: { points: 200, badge: 'booking_bronze' },\r\n    difficulty: 'easy',\r\n  },\r\n  booking_milestone_100: {\r\n    id: 'booking_milestone_100',\r\n    name: '100 Bookings',\r\n    description: 'Reach 100 confirmed bookings',\r\n    type: 'partner',\r\n    category: 'bookings',\r\n    target: 100,\r\n    reward: { points: 1500, badge: 'booking_gold' },\r\n    difficulty: 'hard',\r\n  },\r\n\r\n  // Occupancy Challenges\r\n  high_occupancy: {\r\n    id: 'high_occupancy',\r\n    name: 'Fully Booked',\r\n    description: 'Maintain 90%+ occupancy for 30 days',\r\n    type: 'partner',\r\n    category: 'occupancy',\r\n    target: 90,\r\n    duration: 30,\r\n    reward: { points: 800, badge: 'occupancy_champion' },\r\n    difficulty: 'medium',\r\n  },\r\n\r\n  // Rating Challenges\r\n  five_star_streak: {\r\n    id: 'five_star_streak',\r\n    name: '5-Star Streak',\r\n    description: 'Get 10 consecutive 5-star reviews',\r\n    type: 'partner',\r\n    category: 'rating',\r\n    target: 10,\r\n    threshold: 5,\r\n    reward: { points: 1200, badge: 'excellence_badge' },\r\n    difficulty: 'hard',\r\n  },\r\n\r\n  // Engagement Challenges\r\n  quick_responder: {\r\n    id: 'quick_responder',\r\n    name: 'Quick Responder',\r\n    description: 'Respond to 20 inquiries within 1 hour',\r\n    type: 'partner',\r\n    category: 'engagement',\r\n    target: 20,\r\n    timeLimit: 60, // minutes\r\n    reward: { points: 300, badge: 'responsive_partner' },\r\n    difficulty: 'medium',\r\n  },\r\n\r\n  // Point Milestone Challenges (auto-complete)\r\n  point_milestone_500: {\r\n    id: 'point_milestone_500',\r\n    name: 'Rising Star',\r\n    description: 'Earn 500 total points',\r\n    type: 'partner',\r\n    category: 'points',\r\n    target: 500,\r\n    reward: { points: 0, badge: 'revenue_bronze' },\r\n    difficulty: 'easy',\r\n  },\r\n  point_milestone_1500: {\r\n    id: 'point_milestone_1500',\r\n    name: 'Star Performer',\r\n    description: 'Earn 1500 total points',\r\n    type: 'partner',\r\n    category: 'points',\r\n    target: 1500,\r\n    reward: { points: 0, badge: 'revenue_silver' },\r\n    difficulty: 'medium',\r\n  },\r\n  point_milestone_3000: {\r\n    id: 'point_milestone_3000',\r\n    name: 'Elite Partner',\r\n    description: 'Earn 3000 total points',\r\n    type: 'partner',\r\n    category: 'points',\r\n    target: 3000,\r\n    reward: { points: 0, badge: 'revenue_gold' },\r\n    difficulty: 'hard',\r\n  },\r\n};\r\n\r\nexport const TRAVELER_CHALLENGES = {\r\n  // Trip Challenges\r\n  first_trip: {\r\n    id: 'first_trip',\r\n    name: 'First Adventure',\r\n    description: 'Complete your first trip',\r\n    type: 'traveler',\r\n    category: 'trips',\r\n    target: 1,\r\n    reward: { points: 100, badge: 'explorer_bronze' },\r\n    difficulty: 'easy',\r\n  },\r\n  trip_milestone_10: {\r\n    id: 'trip_milestone_10',\r\n    name: 'Seasoned Traveler',\r\n    description: 'Complete 10 trips',\r\n    type: 'traveler',\r\n    category: 'trips',\r\n    target: 10,\r\n    reward: { points: 1000, badge: 'explorer_gold' },\r\n    difficulty: 'medium',\r\n  },\r\n\r\n  // Geography Challenges\r\n  province_explorer: {\r\n    id: 'province_explorer',\r\n    name: 'Province Explorer',\r\n    description: 'Visit all 9 provinces of South Africa',\r\n    type: 'traveler',\r\n    category: 'geography',\r\n    target: 9,\r\n    reward: { points: 2000, badge: 'sa_explorer' },\r\n    difficulty: 'hard',\r\n  },\r\n  country_collector: {\r\n    id: 'country_collector',\r\n    name: 'Globe Trotter',\r\n    description: 'Visit 5 different countries',\r\n    type: 'traveler',\r\n    category: 'geography',\r\n    target: 5,\r\n    reward: { points: 1500, badge: 'globe_trotter' },\r\n    difficulty: 'medium',\r\n  },\r\n\r\n  // Loyalty Challenges\r\n  loyalty_tier_silver: {\r\n    id: 'loyalty_tier_silver',\r\n    name: 'Silver Status',\r\n    description: 'Reach Silver tier in loyalty program',\r\n    type: 'traveler',\r\n    category: 'loyalty',\r\n    target: 'silver',\r\n    reward: { points: 500, badge: 'loyal_silver' },\r\n    difficulty: 'easy',\r\n  },\r\n  loyalty_tier_platinum: {\r\n    id: 'loyalty_tier_platinum',\r\n    name: 'Platinum Elite',\r\n    description: 'Reach Platinum tier in loyalty program',\r\n    type: 'traveler',\r\n    category: 'loyalty',\r\n    target: 'platinum',\r\n    reward: { points: 3000, badge: 'loyal_platinum' },\r\n    difficulty: 'hard',\r\n  },\r\n\r\n  // Spending Challenges\r\n  big_spender: {\r\n    id: 'big_spender',\r\n    name: 'Big Spender',\r\n    description: 'Spend R50,000+ on travel',\r\n    type: 'traveler',\r\n    category: 'spending',\r\n    target: 50000,\r\n    reward: { points: 2500, badge: 'vip_traveler' },\r\n    difficulty: 'hard',\r\n  },\r\n\r\n  // Social Challenges\r\n  referral_champion: {\r\n    id: 'referral_champion',\r\n    name: 'Referral Champion',\r\n    description: 'Refer 5 friends who complete a booking',\r\n    type: 'traveler',\r\n    category: 'social',\r\n    target: 5,\r\n    reward: { points: 1000, badge: 'ambassador' },\r\n    difficulty: 'medium',\r\n  },\r\n\r\n  // Review Challenges\r\n  reviewer: {\r\n    id: 'reviewer',\r\n    name: 'Helpful Reviewer',\r\n    description: 'Write 10 verified reviews',\r\n    type: 'traveler',\r\n    category: 'reviews',\r\n    target: 10,\r\n    reward: { points: 400, badge: 'trusted_reviewer' },\r\n    difficulty: 'easy',\r\n  },\r\n\r\n  // Point Milestone Challenges (auto-complete)\r\n  traveler_point_milestone_500: {\r\n    id: 'traveler_point_milestone_500',\r\n    name: 'Adventure Starter',\r\n    description: 'Earn 500 total points',\r\n    type: 'traveler',\r\n    category: 'points',\r\n    target: 500,\r\n    reward: { points: 0, badge: 'explorer_bronze' },\r\n    difficulty: 'easy',\r\n  },\r\n  traveler_point_milestone_1500: {\r\n    id: 'traveler_point_milestone_1500',\r\n    name: 'Experienced Traveler',\r\n    description: 'Earn 1500 total points',\r\n    type: 'traveler',\r\n    category: 'points',\r\n    target: 1500,\r\n    reward: { points: 0, badge: 'loyal_silver' },\r\n    difficulty: 'medium',\r\n  },\r\n  traveler_point_milestone_3000: {\r\n    id: 'traveler_point_milestone_3000',\r\n    name: 'Elite Traveler',\r\n    description: 'Earn 3000 total points',\r\n    type: 'traveler',\r\n    category: 'points',\r\n    target: 3000,\r\n    reward: { points: 0, badge: 'explorer_gold' },\r\n    difficulty: 'hard',\r\n  },\r\n};\r\n\r\n// ==================== ACHIEVEMENT BADGES ====================\r\n\r\nconst BADGE_DEFINITIONS = {\r\n  // Partner Badges\r\n  revenue_bronze: { name: 'Revenue Starter', tier: 'bronze', icon: 'ðŸ¥‰', color: '#CD7F32' },\r\n  revenue_silver: { name: 'Revenue Builder', tier: 'silver', icon: 'ðŸ¥ˆ', color: '#C0C0C0' },\r\n  revenue_gold: { name: 'Revenue Champion', tier: 'gold', icon: 'ðŸ¥‡', color: '#FFD700' },\r\n  booking_bronze: { name: 'Booking Starter', tier: 'bronze', icon: 'ðŸ“…', color: '#CD7F32' },\r\n  booking_gold: { name: 'Booking Master', tier: 'gold', icon: 'ðŸ†', color: '#FFD700' },\r\n  occupancy_champion: { name: 'Occupancy Champion', tier: 'gold', icon: 'ðŸŽ¯', color: '#FFD700' },\r\n  excellence_badge: { name: 'Excellence Badge', tier: 'platinum', icon: 'â­', color: '#E5E4E2' },\r\n  responsive_partner: { name: 'Quick Responder', tier: 'silver', icon: 'âš¡', color: '#C0C0C0' },\r\n  monthly_star: { name: 'Monthly Star', tier: 'gold', icon: 'ðŸŒŸ', color: '#FFD700' },\r\n\r\n  // Traveler Badges\r\n  explorer_bronze: { name: 'First Explorer', tier: 'bronze', icon: 'ðŸ—ºï¸', color: '#CD7F32' },\r\n  explorer_gold: { name: 'Seasoned Traveler', tier: 'gold', icon: 'âœˆï¸', color: '#FFD700' },\r\n  sa_explorer: { name: 'SA Explorer', tier: 'platinum', icon: 'ðŸ‡¿ðŸ‡¦', color: '#E5E4E2' },\r\n  globe_trotter: { name: 'Globe Trotter', tier: 'gold', icon: 'ðŸŒ', color: '#FFD700' },\r\n  loyal_silver: { name: 'Loyal Silver', tier: 'silver', icon: 'ðŸ’Ž', color: '#C0C0C0' },\r\n  loyal_platinum: { name: 'Loyal Platinum', tier: 'platinum', icon: 'ðŸ‘‘', color: '#E5E4E2' },\r\n  vip_traveler: { name: 'VIP Traveler', tier: 'platinum', icon: 'ðŸ’³', color: '#E5E4E2' },\r\n  ambassador: { name: 'Ambassador', tier: 'gold', icon: 'ðŸŽ–ï¸', color: '#FFD700' },\r\n  trusted_reviewer: { name: 'Trusted Reviewer', tier: 'silver', icon: 'âœï¸', color: '#C0C0C0' },\r\n};\r\n\r\n// ==================== CORE GAMIFICATION ENGINE ====================\r\n\r\n/**\r\n * Get user's active challenges\r\n */\r\nexport function getActiveChallenges(userId, userType = 'traveler') {\r\n  const allChallenges = userType === 'partner' ? PARTNER_CHALLENGES : TRAVELER_CHALLENGES;\r\n  const progressData = getProgressData(userId);\r\n  \r\n  return Object.values(allChallenges).map(challenge => {\r\n    const progress = progressData[challenge.id] || { current: 0, completed: false };\r\n    \r\n    return {\r\n      ...challenge,\r\n      title: challenge.name,\r\n      progress: progress.current,\r\n      completed: progress.completed,\r\n      completedAt: progress.completedAt,\r\n      percentComplete: Math.min((progress.current / challenge.target) * 100, 100),\r\n    };\r\n  });\r\n}\r\n\r\n/**\r\n * Update challenge progress\r\n */\r\nexport function updateChallengeProgress(userId, challengeId, value, operation = 'increment') {\r\n  const progressData = getProgressData(userId);\r\n  const challenge = { ...PARTNER_CHALLENGES, ...TRAVELER_CHALLENGES }[challengeId];\r\n  \r\n  if (!challenge) {\r\n    return { success: false, message: 'Challenge not found' };\r\n  }\r\n\r\n  const current = progressData[challengeId] || { current: 0, completed: false };\r\n  \r\n  let newValue;\r\n  if (operation === 'increment') {\r\n    newValue = current.current + value;\r\n  } else if (operation === 'set') {\r\n    newValue = value;\r\n  } else {\r\n    newValue = Math.max(current.current, value); // max operation\r\n  }\r\n\r\n  // Cap at target if challenge is capped\r\n  if (challenge.cap !== false) {\r\n    newValue = Math.min(newValue, challenge.target);\r\n  }\r\n\r\n  progressData[challengeId] = {\r\n    current: newValue,\r\n    completed: current.completed || newValue >= challenge.target,\r\n    lastUpdated: new Date().toISOString(),\r\n  };\r\n\r\n  // Check if just completed\r\n  if (!current.completed && newValue >= challenge.target) {\r\n    progressData[challengeId].completed = true;\r\n    progressData[challengeId].completedAt = new Date().toISOString();\r\n    \r\n    // Award rewards\r\n    const reward = awardChallengeReward(userId, challenge);\r\n    saveProgressData(userId, progressData);\r\n    \r\n    return {\r\n      success: true,\r\n      completed: true,\r\n      progress: newValue,\r\n      target: challenge.target,\r\n      percentComplete: 100,\r\n      challenge,\r\n      reward,\r\n      message: `ðŸŽ‰ Challenge completed: ${challenge.name}! +${challenge.reward.points} points`,\r\n    };\r\n  }\r\n\r\n  saveProgressData(userId, progressData);\r\n  \r\n  return {\r\n    success: true,\r\n    completed: false,\r\n    progress: newValue,\r\n    target: challenge.target,\r\n    percentComplete: (newValue / challenge.target) * 100,\r\n  };\r\n}\r\n\r\n/**\r\n * Award challenge rewards\r\n */\r\nfunction awardChallengeReward(userId, challenge) {\r\n  const achievements = getAchievements(userId);\r\n  \r\n  // Award points\r\n  const pointsAwarded = challenge.reward.points;\r\n  \r\n  // Award badge\r\n  if (challenge.reward.badge) {\r\n    achievements.badges = achievements.badges || [];\r\n    if (!achievements.badges.includes(challenge.reward.badge)) {\r\n      achievements.badges.push(challenge.reward.badge);\r\n      achievements.lastBadgeEarned = {\r\n        badgeId: challenge.reward.badge,\r\n        earnedAt: new Date().toISOString(),\r\n        challengeId: challenge.id,\r\n      };\r\n    }\r\n  }\r\n\r\n  achievements.totalPoints = (achievements.totalPoints || 0) + pointsAwarded;\r\n  achievements.challengesCompleted = (achievements.challengesCompleted || 0) + 1;\r\n  \r\n  saveAchievements(userId, achievements);\r\n  \r\n  return {\r\n    points: pointsAwarded,\r\n    badge: challenge.reward.badge,\r\n    badgeDetails: BADGE_DEFINITIONS[challenge.reward.badge],\r\n    totalPoints: achievements.totalPoints,\r\n  };\r\n}\r\n\r\n/**\r\n * Get user's achievements\r\n */\r\nexport function getAchievements(userId) {\r\n  try {\r\n    const data = localStorage.getItem(`${ACHIEVEMENTS_KEY}.${userId}`);\r\n    return data ? JSON.parse(data) : {\r\n      badges: [],\r\n      totalPoints: 0,\r\n      challengesCompleted: 0,\r\n      joinedAt: new Date().toISOString(),\r\n    };\r\n  } catch {\r\n    return {\r\n      badges: [],\r\n      totalPoints: 0,\r\n      challengesCompleted: 0,\r\n      joinedAt: new Date().toISOString(),\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * Save achievements\r\n */\r\nfunction saveAchievements(userId, achievements) {\r\n  localStorage.setItem(`${ACHIEVEMENTS_KEY}.${userId}`, JSON.stringify(achievements));\r\n}\r\n\r\n/**\r\n * Get progress data\r\n */\r\nfunction getProgressData(userId) {\r\n  try {\r\n    const data = localStorage.getItem(`${PROGRESS_KEY}.${userId}`);\r\n    return data ? JSON.parse(data) : {};\r\n  } catch {\r\n    return {};\r\n  }\r\n}\r\n\r\n/**\r\n * Save progress data\r\n */\r\nfunction saveProgressData(userId, progressData) {\r\n  localStorage.setItem(`${PROGRESS_KEY}.${userId}`, JSON.stringify(progressData));\r\n}\r\n\r\n// ==================== STREAKS ====================\r\n\r\n/**\r\n * Update streak counter\r\n */\r\nexport function updateStreak(userId, action = 'login') {\r\n  const streaks = getStreaks(userId);\r\n  const today = new Date().toISOString().split('T')[0];\r\n  const yesterday = new Date(Date.now() - 86400000).toISOString().split('T')[0];\r\n  \r\n  const streak = streaks[action] || { current: 0, best: 0, longest: 0, lastDate: null };\r\n  \r\n  if (streak.lastDate === today) {\r\n    // Already counted today\r\n    return streak;\r\n  }\r\n  \r\n  if (streak.lastDate === yesterday) {\r\n    // Continuing streak\r\n    streak.current += 1;\r\n  } else {\r\n    // Streak broken, restart\r\n    streak.current = 1;\r\n  }\r\n  \r\n  streak.best = Math.max(streak.best, streak.current);\r\n  streak.longest = Math.max(streak.longest || streak.best, streak.current);\r\n  streak.lastDate = today;\r\n  \r\n  streaks[action] = streak;\r\n  saveStreaks(userId, streaks);\r\n  \r\n  // Award milestone badges for streaks\r\n  if (streak.current === 7) {\r\n    updateChallengeProgress(userId, 'week_streak', 1, 'increment');\r\n  } else if (streak.current === 30) {\r\n    updateChallengeProgress(userId, 'month_streak', 1, 'increment');\r\n  }\r\n  \r\n  return streak;\r\n}\r\n\r\n/**\r\n * Get streaks\r\n */\r\nexport function getStreaks(userId) {\r\n  try {\r\n    const data = localStorage.getItem(`${STREAKS_KEY}.${userId}`);\r\n    return data ? JSON.parse(data) : {};\r\n  } catch {\r\n    return {};\r\n  }\r\n}\r\n\r\n/**\r\n * Save streaks\r\n */\r\nfunction saveStreaks(userId, streaks) {\r\n  localStorage.setItem(`${STREAKS_KEY}.${userId}`, JSON.stringify(streaks));\r\n}\r\n\r\n// ==================== LEADERBOARDS ====================\r\n\r\n/**\r\n * Anonymize user data for POPI Act compliance\r\n */\r\nfunction anonymizeUserData(entry, currentUserId) {\r\n  const isCurrentUser = entry.userId === currentUserId;\r\n  const consent = getLeaderboardConsent(entry.userId);\r\n  \r\n  // Only show full data for the current user\r\n  if (isCurrentUser) {\r\n    return {\r\n      ...entry,\r\n      isCurrentUser: true,\r\n      displayName: entry.metadata?.businessName || entry.metadata?.name || 'You',\r\n      city: consent.showCity ? entry.metadata?.city : undefined,\r\n    };\r\n  }\r\n  \r\n  // Anonymize other users - POPI Act compliance\r\n  return {\r\n    userId: `anon_${entry.rank}`, // Anonymized ID\r\n    rank: entry.rank,\r\n    value: entry.value,\r\n    isCurrentUser: false,\r\n    displayName: consent.showBusinessName && entry.metadata?.businessName \r\n      ? entry.metadata.businessName \r\n      : `User ${entry.rank}`,\r\n    ...(consent.showCity && entry.metadata?.city && { city: entry.metadata.city }),\r\n    metadata: {\r\n      // No personal information - only anonymized display name\r\n      name: `User ${entry.rank}`,\r\n    },\r\n    lastUpdated: entry.lastUpdated,\r\n  };\r\n}\r\n\r\n/**\r\n * Get leaderboard data (POPI Act compliant)\r\n */\r\nexport function getLeaderboard(type = 'partner', category = 'revenue', timeframe = 'all', currentUserId = null) {\r\n  try {\r\n    const data = localStorage.getItem(LEADERBOARDS_KEY);\r\n    const leaderboards = data ? JSON.parse(data) : {};\r\n    \r\n    // Map all_time to all for backward compatibility\r\n    const normalizedTimeframe = timeframe === 'all_time' ? 'all' : timeframe;\r\n    \r\n    const key = `${type}_${category}_${normalizedTimeframe}`;\r\n    const rawLeaderboard = leaderboards[key] || [];\r\n    \r\n    // Anonymize all entries except current user (POPI Act compliance)\r\n    return rawLeaderboard.map(entry => anonymizeUserData(entry, currentUserId));\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Update leaderboard entry (stores only necessary data)\r\n */\r\nexport function updateLeaderboard(userId, userType, category, value, metadata = {}) {\r\n  try {\r\n    const data = localStorage.getItem(LEADERBOARDS_KEY);\r\n    const leaderboards = data ? JSON.parse(data) : {};\r\n    \r\n    const timeframes = ['all', 'monthly', 'weekly'];\r\n    \r\n    timeframes.forEach(timeframe => {\r\n      const key = `${userType}_${category}_${timeframe}`;\r\n      let board = leaderboards[key] || [];\r\n      \r\n      // Find or create user entry\r\n      let entry = board.find(e => e.userId === userId);\r\n      \r\n      // Only store non-identifying metadata (POPI Act compliance)\r\n      const safeMetadata = {\r\n        // DO NOT store: name, email, phone, address, ID numbers\r\n        // Only store: anonymized display name and general location (optional)\r\n        city: metadata.city || null, // General city only (not full address)\r\n        // Business users can optionally show business name (not personal name)\r\n        businessName: userType === 'partner' ? metadata.businessName : null,\r\n      };\r\n      \r\n      if (entry) {\r\n        entry.value = value;\r\n        entry.category = category;\r\n        entry.metadata = safeMetadata;\r\n        entry.lastUpdated = new Date().toISOString();\r\n      } else {\r\n        entry = {\r\n          userId,\r\n          category,\r\n          value,\r\n          metadata: safeMetadata,\r\n          lastUpdated: new Date().toISOString(),\r\n        };\r\n        board.push(entry);\r\n      }\r\n      \r\n      // Sort and rank\r\n      board.sort((a, b) => b.value - a.value);\r\n      board = board.slice(0, 100); // Keep top 100\r\n      board.forEach((entry, index) => {\r\n        entry.rank = index + 1;\r\n      });\r\n      \r\n      leaderboards[key] = board;\r\n    });\r\n    \r\n    localStorage.setItem(LEADERBOARDS_KEY, JSON.stringify(leaderboards));\r\n    \r\n    return { success: true, category };\r\n  } catch {\r\n    return { success: false };\r\n  }\r\n}\r\n\r\n/**\r\n * Get user's leaderboard rank\r\n */\r\nexport function getUserRank(userId, userType, category, timeframe = 'all') {\r\n  const leaderboard = getLeaderboard(userType, category, timeframe, userId);\r\n  const entry = leaderboard.find(e => e.userId === userId);\r\n  \r\n  return entry ? { rank: entry.rank, total: leaderboard.length } : { rank: null, total: 0 };\r\n}\r\n\r\n/**\r\n * Get user consent status for leaderboard participation (POPI Act)\r\n */\r\nexport function getLeaderboardConsent(userId) {\r\n  try {\r\n    const data = localStorage.getItem(`colleco.gamification.consent.${userId}`);\r\n    const parsed = data ? JSON.parse(data) : null;\r\n    return parsed || {\r\n      enabled: false, // Opt-in required for POPI Act compliance\r\n      showCity: false,\r\n      showBusinessName: false,\r\n      consentDate: null,\r\n    };\r\n  } catch {\r\n    return {\r\n      enabled: false,\r\n      showCity: false,\r\n      showBusinessName: false,\r\n      consentDate: null,\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * Set user consent for leaderboard (POPI Act compliance)\r\n */\r\nexport function setLeaderboardConsent(userId, consent) {\r\n  const consentData = {\r\n    enabled: consent.enabled || false,\r\n    showCity: consent.showCity || false,\r\n    showBusinessName: consent.showBusinessName || false,\r\n    consentDate: new Date().toISOString(),\r\n    version: '1.0', // Track consent version for auditing\r\n  };\r\n  \r\n  localStorage.setItem(`colleco.gamification.consent.${userId}`, JSON.stringify(consentData));\r\n  \r\n  return { success: true, consent: consentData };\r\n}\r\n\r\n// ==================== POINTS SYSTEM ====================\r\n\r\n/**\r\n * Award points for actions\r\n */\r\nexport const POINT_VALUES = {\r\n  // Partner actions\r\n  booking_received: 10,\r\n  booking_confirmed: 25,\r\n  five_star_review: 50,\r\n  quick_response: 5,\r\n  profile_complete: 100,\r\n  \r\n  // Traveler actions\r\n  booking_made: 15,\r\n  trip_completed: 50,\r\n  review_written: 20,\r\n  profile_photo_added: 25,\r\n  referral_signup: 100,\r\n  referral_booking: 500,\r\n};\r\n\r\n/**\r\n * Award points\r\n */\r\nexport function awardPoints(userId, action, multiplier = 1) {\r\n  const points = POINT_VALUES[action] || 0;\r\n  const totalPoints = points * multiplier;\r\n  \r\n  const achievements = getAchievements(userId);\r\n  achievements.totalPoints = (achievements.totalPoints || 0) + totalPoints;\r\n  achievements.pointHistory = achievements.pointHistory || [];\r\n  achievements.pointHistory.push({\r\n    action,\r\n    points: totalPoints,\r\n    timestamp: new Date().toISOString(),\r\n  });\r\n  \r\n  saveAchievements(userId, achievements);\r\n  \r\n  // Check and auto-complete point milestone challenges\r\n  const currentPoints = achievements.totalPoints;\r\n  const milestones = [\r\n    { threshold: 500, partnerId: 'point_milestone_500', travelerId: 'traveler_point_milestone_500' },\r\n    { threshold: 1500, partnerId: 'point_milestone_1500', travelerId: 'traveler_point_milestone_1500' },\r\n    { threshold: 3000, partnerId: 'point_milestone_3000', travelerId: 'traveler_point_milestone_3000' },\r\n  ];\r\n  \r\n  for (const milestone of milestones) {\r\n    if (currentPoints >= milestone.threshold) {\r\n      // Try both partner and traveler milestone challenges\r\n      const challengeIds = [milestone.partnerId, milestone.travelerId];\r\n      for (const challengeId of challengeIds) {\r\n        const challenge = { ...PARTNER_CHALLENGES, ...TRAVELER_CHALLENGES }[challengeId];\r\n        if (challenge) {\r\n          const progressData = getProgressData(userId);\r\n          if (!progressData[challengeId]?.completed) {\r\n            updateChallengeProgress(userId, challengeId, currentPoints, 'set');\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n  \r\n  return {\r\n    success: true,\r\n    pointsAwarded: totalPoints,\r\n    totalPoints: achievements.totalPoints,\r\n    action,\r\n  };\r\n}\r\n\r\n/**\r\n * Get point history\r\n */\r\nexport function getPointHistory(userId, limit = 50) {\r\n  const achievements = getAchievements(userId);\r\n  const history = achievements.pointHistory || [];\r\n  \r\n  return history\r\n    .sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp))\r\n    .slice(0, limit);\r\n}\r\n\r\n// ==================== REWARDS & BENEFITS ====================\r\n\r\nexport const REWARD_TIERS = [\r\n  {\r\n    minPoints: 0,\r\n    name: 'Bronze',\r\n    benefits: ['5% booking discount', 'Priority email support'],\r\n    color: '#CD7F32',\r\n    discount: 5,\r\n  },\r\n  {\r\n    minPoints: 500,\r\n    name: 'Silver',\r\n    benefits: ['10% booking discount', 'Priority phone support', 'Free trip insurance'],\r\n    color: '#C0C0C0',\r\n    discount: 10,\r\n  },\r\n  {\r\n    minPoints: 1500,\r\n    name: 'Gold',\r\n    benefits: ['15% booking discount', '24/7 concierge', 'Free upgrades', 'Lounge access'],\r\n    color: '#FFD700',\r\n    discount: 15,\r\n  },\r\n  {\r\n    minPoints: 3000,\r\n    name: 'Platinum',\r\n    benefits: ['20% booking discount', 'Personal travel advisor', 'Complimentary transfers', 'VIP experiences'],\r\n    color: '#E5E4E2',\r\n    discount: 20,\r\n  },\r\n];\r\n\r\n/**\r\n * Get user's reward tier\r\n */\r\nexport function getRewardTier(userId) {\r\n  const achievements = getAchievements(userId);\r\n  const points = achievements.totalPoints || 0;\r\n  \r\n  let currentTier = { ...REWARD_TIERS[0], discount: 0.05 };\r\n  \r\n  for (const tier of REWARD_TIERS) {\r\n    if (points >= tier.minPoints) {\r\n      currentTier = { ...tier, discount: tier.discount / 100 };\r\n    }\r\n  }\r\n  \r\n  return currentTier;\r\n}\r\n\r\n/**\r\n * Reset monthly challenges\r\n */\r\nexport function resetMonthlyChallenges() {\r\n  // This should be called at the start of each month\r\n  // Implementation depends on backend cron job or scheduled task\r\n  console.warn('resetMonthlyChallenges should be called via backend scheduler');\r\n}\r\n\r\nexport default {\r\n  getActiveChallenges,\r\n  updateChallengeProgress,\r\n  getAchievements,\r\n  updateStreak,\r\n  getStreaks,\r\n  getLeaderboard,\r\n  updateLeaderboard,\r\n  getUserRank,\r\n  getLeaderboardConsent,\r\n  setLeaderboardConsent,\r\n  awardPoints,\r\n  getPointHistory,\r\n  getRewardTier,\r\n  PARTNER_CHALLENGES,\r\n  TRAVELER_CHALLENGES,\r\n  POINT_VALUES,\r\n  REWARD_TIERS,\r\n};\r\n\r\n// Export CHALLENGES in test-expected format\r\nexport const CHALLENGES = {\r\n  partner: Object.values(PARTNER_CHALLENGES).map(c => ({...c, title: c.name})),\r\n  traveler: Object.values(TRAVELER_CHALLENGES).map(c => ({...c, title: c.name}))\r\n};\r\n\r\n// Export BADGES in test-expected tier-organized format  \r\nexport const BADGES = {\r\n  bronze: Object.entries(BADGE_DEFINITIONS).filter(([_k, v]) => v.tier === 'bronze').map(([id, badge]) => ({id, ...badge})),\r\n  silver: Object.entries(BADGE_DEFINITIONS).filter(([_k, v]) => v.tier === 'silver').map(([id, badge]) => ({id, ...badge})),\r\n  gold: Object.entries(BADGE_DEFINITIONS).filter(([_k, v]) => v.tier === 'gold').map(([id, badge]) => ({id, ...badge})),\r\n  platinum: Object.entries(BADGE_DEFINITIONS).filter(([_k, v]) => v.tier === 'platinum').map(([id, badge]) => ({id, ...badge}))\r\n};\r\n"],"names":[],"mappings":"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"}