{"version":3,"file":"useBasketState-DcL2gvap.js","sources":["../../src/utils/useBasketState.js"],"sourcesContent":["import { useCallback } from 'react';\r\nimport { useLocalStorageState } from '../useLocalStorageState';\r\n\r\n// Smart auto-day assignment based on category and existing items\r\nfunction smartDayAssignment(item, currentBasket) {\r\n  const category = (item.category || '').toLowerCase();\r\n  \r\n  // Find highest day currently used\r\n  const maxDay = currentBasket.length > 0 \r\n    ? Math.max(...currentBasket.map(i => i.day || 1))\r\n    : 0;\r\n  \r\n  // Lodging/Accommodation: Start on next available day\r\n  if (category === 'lodging' || category === 'accommodation' || category.includes('hotel')) {\r\n    const lastLodging = currentBasket\r\n      .filter(i => ['lodging', 'accommodation'].includes((i.category || '').toLowerCase()) || (i.category || '').includes('hotel'))\r\n      .sort((a, b) => (b.day || 1) - (a.day || 1))[0];\r\n    \r\n    if (lastLodging) {\r\n      // Get nights from title (e.g., \"2 nights\") or default to 1\r\n      const nightsMatch = (lastLodging.title || '').match(/(\\d+)\\s*night/i);\r\n      const nights = nightsMatch ? parseInt(nightsMatch[1]) : 1;\r\n      return (lastLodging.day || 1) + nights;\r\n    }\r\n    return maxDay + 1 || 1;\r\n  }\r\n  \r\n  // Activities: Assign based on time of day and description\r\n  if (category === 'activity' || category === 'tour' || category === 'experience') {\r\n    const title = (item.title || '').toLowerCase();\r\n    const desc = (item.description || '').toLowerCase();\r\n    const text = title + ' ' + desc;\r\n    \r\n    // Detect time hints\r\n    let suggestedTime = 'Flexible';\r\n    if (text.match(/morning|breakfast|sunrise|early/i)) suggestedTime = 'Morning';\r\n    else if (text.match(/afternoon|lunch|midday/i)) suggestedTime = 'Afternoon';\r\n    else if (text.match(/evening|dinner|sunset|night/i)) suggestedTime = 'Evening';\r\n    \r\n    // Assign time to item for smart sorting\r\n    item.time = suggestedTime;\r\n    \r\n    // Multi-day tours get consecutive days\r\n    const daysMatch = text.match(/(\\d+)[-\\s]*day/i);\r\n    if (daysMatch) {\r\n      const tourDays = parseInt(daysMatch[1]);\r\n      if (tourDays > 1) {\r\n        return maxDay + 1 || 1; // Start on next day\r\n      }\r\n    }\r\n    \r\n    // Single activities: add to current day or next if it's full\r\n    const currentDayItems = currentBasket.filter(i => i.day === maxDay);\r\n    return currentDayItems.length >= 4 ? maxDay + 1 : (maxDay || 1);\r\n  }\r\n  \r\n  // Dining: Assign based on meal type\r\n  if (category === 'dining' || category.includes('food') || category.includes('restaurant')) {\r\n    const title = (item.title || '').toLowerCase();\r\n    if (title.includes('breakfast')) { item.time = 'Morning'; }\r\n    else if (title.includes('lunch')) { item.time = 'Afternoon'; }\r\n    else if (title.includes('dinner')) { item.time = 'Evening'; }\r\n    else { item.time = 'Flexible'; }\r\n    \r\n    return maxDay || 1;\r\n  }\r\n  \r\n  // Transport/Flights: Typically day 1 or last day\r\n  if (category === 'transport' || category === 'flight' || category.includes('transfer')) {\r\n    const title = (item.title || '').toLowerCase();\r\n    if (title.includes('return') || title.includes('departure')) {\r\n      return maxDay + 1 || 1; // Return on last day\r\n    }\r\n    item.time = 'Morning'; // Flights usually morning\r\n    return 1; // Arrival on day 1\r\n  }\r\n  \r\n  // Default: Add to current day\r\n  return maxDay || 1;\r\n}\r\n\r\n// Basket item shape: { id, title, description?, category?, price (number), quantity, day?, time? }\r\n// All items in basket feed itinerary; paid (price>0) items feed quote creation shortcut.\r\nexport function useBasketState() {\r\n  const [basket, setBasket] = useLocalStorageState('basket:v1', []);\r\n\r\n  const addToBasket = useCallback((item) => {\r\n    setBasket((prev) => {\r\n      if (!item?.id) return prev;\r\n      const existing = prev.find(i => i.id === item.id);\r\n      if (existing) {\r\n        return prev.map(i => i.id === item.id ? { ...i, quantity: (i.quantity||1) + 1 } : i);\r\n      }\r\n      \r\n      // Smart auto-assignment: determine best day if not specified\r\n      const assignedDay = item.day || smartDayAssignment(item, prev);\r\n      \r\n      return [...prev, { ...item, quantity: item.quantity || 1, price: Number(item.price||0), day: assignedDay, time: item.time || 'Flexible' }];\r\n    });\r\n  }, [setBasket]);\r\n\r\n  const removeFromBasket = useCallback((id) => {\r\n    setBasket(prev => prev.filter(i => i.id !== id));\r\n  }, [setBasket]);\r\n\r\n  const updateQuantity = useCallback((id, qty) => {\r\n    setBasket(prev => prev.map(i => i.id === id ? { ...i, quantity: Math.max(1, qty) } : i));\r\n  }, [setBasket]);\r\n\r\n  const updateItem = useCallback((id, patch) => {\r\n    setBasket(prev => prev.map(i => i.id === id ? { ...i, ...patch } : i));\r\n  }, [setBasket]);\r\n\r\n  const updateDay = useCallback((id, day) => {\r\n    setBasket(prev => prev.map(i => i.id === id ? { ...i, day: Math.max(1, Number(day)||1) } : i));\r\n  }, [setBasket]);\r\n\r\n  const reorderWithin = useCallback((idsInNewOrder) => {\r\n    // idsInNewOrder: array of existing basket item ids representing desired order; others keep relative order appended\r\n    setBasket(prev => {\r\n      const map = new Map(prev.map(i=>[i.id,i]));\r\n      const used = new Set();\r\n      const next = [];\r\n      idsInNewOrder.forEach(id=>{ if(map.has(id)){ next.push(map.get(id)); used.add(id);} });\r\n      prev.forEach(i=>{ if(!used.has(i.id)) next.push(i); });\r\n      return next;\r\n    });\r\n  }, [setBasket]);\r\n\r\n  const clearBasket = useCallback(() => setBasket([]), [setBasket]);\r\n\r\n  const paidItems = basket.filter(i => Number(i.price) > 0);\r\n\r\n  return { basket, addToBasket, removeFromBasket, updateQuantity, updateItem, updateDay, reorderWithin, clearBasket, paidItems };\r\n}\r\n"],"names":["useCallback"],"mappings":"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"}