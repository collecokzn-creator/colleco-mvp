import{r as p,j as e,L as he,R as ke}from"./index-E_l07fEO.js";const q="http://localhost:4000";function G(a={}){return{...a}}async function Ie(a){const o=await fetch(`${q}/api/ai/itinerary`,{method:"POST",headers:G({"Content-Type":"application/json"}),body:JSON.stringify({prompt:a})});if(!o.ok){let c="Request failed";try{c=(await o.json()).error||c}catch{}throw new Error(c)}return(await o.json()).data}function Te(a,{onEvent:o,onError:r,onDone:c,signal:s}={}){const h=new URL(`${q}/api/ai/itinerary/stream`);h.searchParams.set("prompt",a);const N=new AbortController;return s&&s.addEventListener("abort",()=>N.abort(),{once:!0}),fetch(h.toString(),{signal:N.signal,headers:G({Accept:"text/event-stream"})}).then(async v=>{if(!v.ok){let j="Stream request failed";try{j=(await v.json()).error||j}catch{}throw new Error(j)}const k=v.body.getReader(),m=new TextDecoder("utf-8");let u="";for(;;){const{done:j,value:R}=await k.read();if(j)break;u+=m.decode(R,{stream:!0});let O;for(;(O=u.indexOf(`

`))!==-1;){const i=u.slice(0,O).trim();if(u=u.slice(O+2),!i)continue;const y=i.split(`
`);let $="message",C="";for(const D of y)D.startsWith("event:")?$=D.slice(6).trim():D.startsWith("data:")&&(C+=D.slice(5).trim());if(C)try{const D=JSON.parse(C);o&&o({event:$,data:D}),$==="done"&&c&&c()}catch{}}}c&&c()}).catch(v=>{N.signal.aborted||r&&r(v)}),{cancel:()=>N.abort()}}async function Ae(a,o){const r=await fetch(`${q}/api/ai/itinerary/refine`,{method:"POST",headers:G({"Content-Type":"application/json"}),body:JSON.stringify({prompt:a,instructions:o})});if(!r.ok){let s="Refine failed";try{s=(await r.json()).error||s}catch{}throw new Error(s)}return(await r.json()).data}async function Re(a){const o=await fetch(`${q}/api/ai/flight`,{method:"POST",headers:G({"Content-Type":"application/json"}),body:JSON.stringify({prompt:a})});if(!o.ok){let c="Flight intent failed";try{c=(await o.json()).error||c}catch{}throw new Error(c)}return(await o.json()).data}async function Oe(a){const o=await fetch(`${q}/api/ai/intent`,{method:"POST",headers:G({"Content-Type":"application/json"}),body:JSON.stringify({prompt:a})});if(!o.ok){let c="Intent parse failed";try{c=(await o.json()).error||c}catch{}throw new Error(c)}return(await o.json()).data}const W="http://localhost:4000";function Y(a={}){return{...a}}async function Pe(a){const o=await fetch(`${W}/api/ai/session`,{method:"POST",headers:Y({"Content-Type":"application/json"}),body:JSON.stringify({prompt:a})});if(!o.ok){let r="Session start failed";try{r=(await o.json()).error||r}catch{}throw new Error(r)}return o.json()}async function Ee(a,o){const r=await fetch(`${W}/api/ai/session/${a}/refine`,{method:"POST",headers:Y({"Content-Type":"application/json"}),body:JSON.stringify({instructions:o})});if(!r.ok){let s="Session refine failed";try{s=(await r.json()).error||s}catch{}throw new Error(s)}return(await r.json()).data}async function Ue(a,o){const r=await fetch(`${W}/api/ai/draft`,{method:"POST",headers:Y({"Content-Type":"application/json"}),body:JSON.stringify({prompt:a,data:o})});if(!r.ok){let c="Upload failed";try{c=(await r.json()).error||c}catch{}throw new Error(c)}return r.json()}async function Fe(a){const o=await fetch(`${W}/api/ai/session/${a}`,{headers:Y()});if(!o.ok){let r="Fetch session failed";try{r=(await o.json()).error||r}catch{}throw new Error(r)}return o.json()}function Le(){const[a,o]=p.useState("Family trip to Rome and Florence for 6 nights in June, 2 adults 1 child, budget $4000, love food and history"),[r,c]=p.useState("stream"),[s,h]=p.useState({}),[N,v]=p.useState(null),[k,m]=p.useState(""),[u,j]=p.useState(""),[R,O]=p.useState(!1),[i,y]=p.useState(!1),[$,C]=p.useState(null),[D,ne]=p.useState(!1),[L,H]=p.useState(!1),[P,U]=p.useState(!1),[me,se]=p.useState(!1),[B,ae]=p.useState(null),[xe,re]=p.useState(!1),[T,z]=p.useState([]),[ie,oe]=p.useState(!1),[x,Q]=p.useState(null),[K,ce]=p.useState([]),[Je,le]=p.useState(null),[ue,M]=p.useState([]),V=p.useRef(null),f=p.useRef(null);p.useEffect(()=>{f.current&&(f.current.textContent=fe())},[s,k,L,P]);function fe(){return k?`Error: ${k}`:L&&r==="single"?"Generating draft":P&&r==="stream"?s.done?"Generation complete":s.pricing?"Pricing phase received":s.plan?"Plan phase received":s.parse?"Parse phase received":"Preparing draft…":""}function X(){h({}),v(null),m(""),H(!1),U(!1),V.current?.cancel(),V.current=null,y(!1),C(null),ae(null),z([]),oe(!1),Q(null),ce([]),le(null),M([])}async function ge(){if(X(),!a.trim()){m("Prompt required");return}H(!0);try{const t=await Ie(a.trim());v(t),h({parse:Z(t),plan:{itinerary:t.itinerary},pricing:{pricing:t.pricing},done:!0})}catch(t){m(t.message||"Failed")}finally{H(!1)}}function Z(t){return{original:t.original,destinations:t.destinations,startDate:t.startDate,endDate:t.endDate,nights:t.nights,travelers:t.travelers,budget:t.budget,interests:t.interests,meta:t.meta}}function be(){if(X(),!a.trim()){m("Prompt required");return}Oe(a.trim()).then(n=>{n&&Array.isArray(n.intents)&&ce(n.intents)}).catch(()=>{}),Re(a.trim()).then(Q).catch(()=>{}),U(!0);const t=Te(a.trim(),{onEvent:({event:n,data:l})=>{h(S=>{const g={...S};return n==="parse"?g.parse=l:n==="plan"?g.plan=l:n==="pricing"?g.pricing=l:n==="done"&&(g.done=!0),g}),n==="done"&&U(!1)},onError:n=>{m(n.message||"Stream failed"),U(!1)},onDone:()=>{U(!1)}});V.current=t}function F(t){try{return JSON.parse(JSON.stringify(t))}catch{return{...t}}}function de(t){h(n=>{if(!n||!n.plan||!n.plan.itinerary)return n;const l=F(n);M(I=>[...I,l]);const S=F(n),g=S.parse?.nights||S.plan.itinerary.length;let b=Math.max(1,g+t);S.parse&&(S.parse.nights=b);const d=[...S.plan.itinerary];if(b>d.length){const I=b-d.length,A=d[d.length-1]||{destination:S.parse?.destinations?.[0]||"Destination",activities:["Leisure & exploration"]};for(let te=0;te<I;te++){const _=d.length+1,pe=A.destination||A.title?.replace(/^.*-\s*/,"")||"Destination";d.push({day:_,title:`Day ${_} - ${pe}`,destination:pe,activities:[...A.activities||["Leisure & exploration"]]})}}else b<d.length&&(d.length=b);return S.plan.itinerary=d.map((I,A)=>({...I,day:A+1,title:`Day ${A+1} - ${I.destination||I.title?.replace(/^.*-\s*/,"")||"Destination"}`})),S})}function ye(t){h(n=>{if(!n||!n.pricing||!n.pricing.pricing)return n;const l=F(n);M(d=>[...d,l]);const S=F(n),g=1+t/100,b=S.pricing.pricing;return b.total!=null&&(b.total=Math.round(b.total*g)),b.breakdown&&Object.keys(b.breakdown).forEach(d=>{b.breakdown[d]=Math.round(b.breakdown[d]*g)}),b.note&&(b.note+=t>=0?` · increased by ${t}%`:` · decreased by ${Math.abs(t)}%`),S})}function je(t,n){h(l=>{if(!l||!l.plan||!l.plan.itinerary)return l;const S=F(l);M(d=>[...d,S]);const g=F(l);g.parse&&Array.isArray(g.parse.destinations)&&(g.parse.destinations=g.parse.destinations.map(d=>d.toLowerCase()===String(t).toLowerCase()?n:d));const b=String(t).toLowerCase();return g.plan.itinerary=g.plan.itinerary.map((d,I)=>{const A=(d.destination||d.title||"").toString(),_=A.toLowerCase()===b||/-\s*.+$/.test(d.title||"")&&d.title.replace(/^.*-\s*/,"").toLowerCase()===b?n:d.destination||d.title?.replace(/^.*-\s*/,"")||A;return{...d,day:I+1,destination:_,title:`Day ${I+1} - ${_}`}}),g})}function we(t){if(!(!t||t.length===0)){le(t);for(const n of t)n.op==="extend"?de(+Math.abs(n.nightsDelta||1)):n.op==="shorten"?de(-Math.abs(n.nightsDelta||1)):n.op==="adjustBudget"?ye(n.percent||0):n.op==="swapDestination"&&n.from&&n.to&&je(n.from,n.to);f.current&&(f.current.textContent=`Applied ${t.length} itinerary change${t.length>1?"s":""}.`,setTimeout(()=>{f.current&&(f.current.textContent="")},2500))}}function Ne(){M(t=>{if(!t||t.length===0)return t;const n=t.slice(0,-1),l=t[t.length-1];return h(l),f.current&&(f.current.textContent="Reverted last itinerary changes.",setTimeout(()=>{f.current&&(f.current.textContent="")},2e3)),n})}function ve(){V.current?.cancel(),U(!1),H(!1)}async function Se(){if(!N&&!s.parse){m("Generate first");return}if(!u.trim()){m("Refine instructions required");return}O(!0),m("");try{let t;if(D&&$){t=await Ee($,u.trim());try{const n=await Fe($);z(n.history||[])}catch{}}else{const n=a.trim();t=await Ae(n,u.trim())}v(t),h({parse:Z(t),plan:{itinerary:t.itinerary},pricing:{pricing:t.pricing},done:!0}),j("")}catch(t){m(t.message||"Refine failed")}finally{O(!1)}}async function $e(){if(!a.trim()){m("Prompt required");return}try{const t=await Pe(a.trim());C(t.id),ne(!0),v(t.data),h({parse:Z(t.data),plan:{itinerary:t.data.itinerary},pricing:{pricing:t.data.pricing},done:!0}),re(!!t.scoped),z([{type:"parse",data:t.data,at:Date.now()}]),f.current&&(f.current.textContent="Session started",setTimeout(()=>{f.current&&(f.current.textContent="")},1500))}catch(t){m(t.message||"Session failed")}}async function Ce(){const t=N||s.parse&&s.plan&&s.pricing&&{...s.parse,itinerary:s.plan.itinerary,pricing:s.pricing.pricing};if(!t){m("Nothing to upload");return}se(!0),m("");try{const n=await Ue(a.trim(),t);ae(n.id),n.scoped&&re(!0)}catch(n){m(n.message||"Upload failed")}finally{se(!1)}}function De(){const t=N||s.parse&&s.plan&&s.pricing&&{...s.parse,itinerary:s.plan.itinerary,pricing:s.pricing.pricing};if(!t){m("Nothing to apply yet");return}try{const n={appliedAt:Date.now(),sourcePrompt:a.trim(),itinerary:t.itinerary,meta:{nights:t.nights,destinations:t.destinations,interests:t.interests,budget:t.budget}};localStorage.setItem("aiItineraryDraft:v1",JSON.stringify(n)),y(!0),f.current&&(f.current.textContent="AI draft stored. Open Itinerary page to import.",setTimeout(()=>{f.current&&(f.current.textContent="")},3e3))}catch{m("Failed to store draft")}}function ee(t,n){return new Intl.NumberFormat(void 0,{style:"currency",currency:n||"USD"}).format(t)}const w=s.parse,J=s.plan,E=s.pricing;return e.jsxs("div",{className:"ai-panel max-w-4xl mx-auto flex flex-col gap-4","aria-labelledby":"aiGenHeading",children:[e.jsx("h1",{id:"aiGenHeading",className:"text-2xl font-bold text-brand-brown",children:"Trip Assist"}),e.jsx("p",{className:"text-sm text-brand-brown/80 leading-snug",children:"Describe your trip — budget, vibe, pace, must‑dos. You’ll get a draft with an outline and rough costs. See it build in steps or generate a single draft, then refine until it feels right."}),e.jsxs("div",{className:"rounded border border-cream-border bg-cream p-3",children:[e.jsx("div",{className:"text-xs font-semibold text-brand-brown mb-2",children:"Quick start ideas"}),e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-1 pr-1",children:["Family-friendly Cape Town long weekend in June, 2 adults 2 kids, budget $2000, nature + beaches + penguins","Romantic Italy 7 nights: Rome, Florence, Amalfi; foodie + history; mid-range; September","Safari + beach 10 days: Kruger + Mauritius; 2 adults; July; budget $5000; photography + relaxation","Backpacking Southeast Asia 14 days: Thailand + Vietnam; budget; nightlife + street food; hostels","Wine and wildlife 5 nights: Stellenbosch + Cape Town; 4 adults; September; wineries + Table Mountain"].map((t,n)=>e.jsx("button",{type:"button",onClick:()=>o(t),className:"shrink-0 max-w-[22rem] text-left px-2 py-1 rounded border border-cream-border bg-cream-sand hover:bg-cream-hover text-[11px]",title:"Use this idea",children:t},n))})]}),e.jsxs("label",{className:"flex flex-col gap-1 text-sm font-medium text-brand-brown",children:["Prompt",e.jsx("textarea",{value:a,onChange:t=>o(t.target.value),rows:4,className:"w-full p-2 rounded border border-cream-border bg-cream focus:outline-none focus:ring-2 focus:ring-brand-orange/40 text-sm resize-y"})]}),K&&K.length>0&&e.jsxs("div",{className:"rounded border border-cream-border bg-cream-sand/60 p-3 text-xs",children:[e.jsxs("div",{className:"font-semibold mb-1",children:["Detected request",K.length>1?"s":""]}),e.jsx("div",{className:"flex flex-col gap-2",children:K.filter(t=>t.type!=="flight_search").map((t,n)=>{if(t.type==="hotel_search"){const l=`/plan-trip?category=Lodging${t.city?`&city=${encodeURIComponent(t.city)}`:""}${t.budget?.amount?`&budget=${encodeURIComponent(t.budget.amount)}`:""}${t.stars?`&stars=${t.stars}`:""}`;return e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{children:["Hotel search ",t.city?`in ${t.city}`:""," ",t.nights?`· ${t.nights} nights`:""]}),e.jsx("a",{href:l,className:"inline-flex items-center px-2 py-1 rounded bg-brand-orange text-white",children:"Find hotels"})]},n)}if(t.type==="car_rental"){const l=`/plan-trip?category=Transport${t.pickupCity?`&city=${encodeURIComponent(t.pickupCity)}`:""}`;return e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{children:["Car hire ",t.pickupCity?`in ${t.pickupCity}`:""," ",t.pickupDate?`· ${t.pickupDate}`:""]}),e.jsx("a",{href:l,className:"inline-flex items-center px-2 py-1 rounded bg-brand-orange text-white",children:"Find cars"})]},n)}if(t.type==="activity_search"){const l=`/plan-trip?category=Activity${t.city?`&city=${encodeURIComponent(t.city)}`:""}`;return e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{children:["Activities ",t.city?`in ${t.city}`:""," ",t.startDate?`· ${t.startDate}`:""]}),e.jsx("a",{href:l,className:"inline-flex items-center px-2 py-1 rounded bg-brand-orange text-white",children:"Find activities"})]},n)}if(t.type==="dining_search"){const l=`/plan-trip?category=Dining${t.city?`&city=${encodeURIComponent(t.city)}`:""}${t.nearMe?"&setLocation=1":""}`;return e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{children:["Dining ",t.city?`in ${t.city}`:t.nearMe?"near you":""," ",t.time?`· ${t.time}`:""]}),e.jsx("a",{href:l,className:"inline-flex items-center px-2 py-1 rounded bg-brand-orange text-white",children:"Find dining"})]},n)}if(t.type==="transfer_request"){const l=`/plan-trip?category=Transport${t.city?`&city=${encodeURIComponent(t.city)}`:""}${t.nearMe?"&setLocation=1":""}`;return e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{children:["Transfers ",t.city?`in ${t.city}`:t.nearMe?"near you":""," ",t.time?`· ${t.time}`:""]}),e.jsx("a",{href:l,className:"inline-flex items-center px-2 py-1 rounded bg-brand-orange text-white",children:"Find transfers"})]},n)}if(t.type==="event_search"){const l=`/plan-trip?tab=events${t.city?`&city=${encodeURIComponent(t.city)}`:""}${t.nearMe?"&setLocation=1":""}`;return e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{children:["Events ",t.city?`in ${t.city}`:t.nearMe?"near you":""," ",t.startDate?`· from ${t.startDate}`:""]}),e.jsx("a",{href:l,className:"inline-flex items-center px-2 py-1 rounded bg-brand-orange text-white",children:"Browse events"})]},n)}if(t.type==="visa_help")return e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("div",{children:"Visa help detected"}),e.jsx("a",{href:"/compliance",className:"inline-flex items-center px-2 py-1 rounded bg-brand-brown text-white",children:"Open Compliance"})]},n);if(t.type==="insurance_help")return e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("div",{children:"Insurance help detected"}),e.jsx("a",{href:"/compliance",className:"inline-flex items-center px-2 py-1 rounded bg-brand-brown text-white",children:"Open Compliance"})]},n);if(t.type==="itinerary_ops"){const l=ue.length>0;return e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{children:["Itinerary adjustments detected (",t.ops?.length||0,")"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>we(t.ops||[]),className:"inline-flex items-center px-2 py-1 rounded bg-brand-brown text-white",children:"Apply now"}),l&&e.jsx("button",{type:"button",onClick:Ne,className:"text-brand-brown underline",children:"Undo"})]})]},n)}return t.type==="quote_ops"?e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("div",{children:"Quote action detected"}),e.jsx("a",{href:"/quotes/new",className:"inline-flex items-center px-2 py-1 rounded bg-brand-brown text-white",children:"Open quotes"})]},n):null})})]}),x&&e.jsxs("div",{className:"rounded border border-cream-border bg-cream-sand/60 p-3 text-xs",children:[e.jsx("div",{className:"font-semibold mb-1",children:"Detected flight request"}),e.jsxs("div",{children:["From: ",x.from?.city," ",x.from?.code?`(${x.from.code})`:""]}),e.jsxs("div",{children:["To: ",x.to?.city," ",x.to?.code?`(${x.to.code})`:""]}),e.jsxs("div",{children:["Date: ",x.date||"—"," ",x.time?`at ${x.time}`:""]}),e.jsxs("div",{children:["Passengers: ",x.pax," · Cabin: ",x.cabin]}),e.jsxs("div",{className:"mt-2 flex gap-2",children:[e.jsx("a",{href:`/plan-trip?category=Flights&from=${encodeURIComponent(x.from?.code||x.from?.city||"")}&to=${encodeURIComponent(x.to?.code||x.to?.city||"")}&date=${encodeURIComponent(x.date||"")}&time=${encodeURIComponent(x.time||"")}&pax=${x.pax}&cabin=${encodeURIComponent(x.cabin)}`,className:"inline-flex items-center px-3 py-1.5 rounded bg-brand-orange text-white",children:"Search flights"}),e.jsx("button",{onClick:()=>Q(null),className:"text-brand-brown underline",children:"Dismiss"})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-3 items-center",children:[e.jsxs("div",{className:"inline-flex items-center gap-2 bg-cream-sand px-3 py-1 rounded border border-cream-border text-sm",children:[e.jsx("span",{className:"font-semibold",children:"Mode:"}),e.jsxs("label",{className:"flex items-center gap-1 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"aimode",value:"stream",checked:r==="stream",onChange:()=>c("stream")})," ",e.jsx("span",{children:"Stream"})]}),e.jsxs("label",{className:"flex items-center gap-1 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"aimode",value:"single",checked:r==="single",onChange:()=>c("single")})," ",e.jsx("span",{children:"Single"})]})]}),r==="single"&&e.jsx("button",{onClick:ge,disabled:L,className:"px-4 py-2 rounded bg-brand-orange text-white text-sm font-semibold hover:bg-brand-highlight disabled:opacity-50",children:L?"Generating…":"Generate"}),r==="stream"&&e.jsx("button",{onClick:be,disabled:P,className:"px-4 py-2 rounded bg-brand-orange text-white text-sm font-semibold hover:bg-brand-highlight disabled:opacity-50",children:P?"Streaming…":"Start Stream"}),(P||L)&&e.jsx("button",{onClick:ve,className:"px-3 py-2 rounded bg-brand-brown text-white text-xs font-semibold hover:bg-brand-brown/80",children:"Cancel"}),e.jsx("button",{onClick:X,className:"px-3 py-2 rounded border border-brand-brown text-brand-brown text-xs font-semibold hover:bg-cream-hover",children:"Clear"}),e.jsx("button",{onClick:De,disabled:i||!(s.plan&&s.pricing),className:"px-3 py-2 rounded bg-brand-brown text-white text-xs font-semibold disabled:opacity-40",children:i?"Saved":"Save draft for Itinerary"}),e.jsx("button",{onClick:Ce,disabled:me||B||!(s.plan&&s.pricing),className:"px-3 py-2 rounded bg-brand-orange text-white text-xs font-semibold disabled:opacity-40",children:B?"Uploaded":"Upload Draft"}),e.jsxs("div",{className:"flex items-center gap-1 ml-2 text-[11px]",children:[e.jsxs("label",{className:"flex items-center gap-1 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:D,onChange:t=>{t.target.checked?$e():(ne(!1),C(null))}})," Session"]}),$&&e.jsxs("span",{className:"text-green-700 flex items-center gap-1",children:["#",$.slice(0,6)," ",xe&&e.jsx("span",{title:"Scoped to token",className:"inline-block text-[10px] px-1 py-0.5 rounded bg-brand-orange text-white",children:"LOCK"})]})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-[11px] text-brand-brown/70",children:[e.jsx("span",{className:"mr-1",children:"Next:"}),e.jsx(he,{to:"/itinerary",className:"underline hover:text-brand-brown",children:"Open Itinerary to import draft"}),e.jsx("span",{"aria-hidden":!0,children:"•"}),e.jsx(he,{to:"/plan-trip",className:"underline hover:text-brand-brown",children:"Open Trip Planner"})]}),e.jsxs("div",{className:"mt-2 w-full flex flex-col gap-2 bg-cream-sand/50 border border-cream-border rounded p-3",children:[e.jsxs("label",{className:"text-xs font-semibold text-brand-brown flex items-center gap-2",children:["Refine plan",R&&e.jsx("span",{className:"animate-pulse text-[10px] font-normal",children:"Refining…"}),D&&$&&e.jsx("span",{className:"text-[10px] bg-brand-brown text-white px-1.5 py-0.5 rounded",children:"Session"})]}),e.jsx("textarea",{value:u,onChange:t=>j(t.target.value),placeholder:"e.g. slow the pace; add beach and 2 more nights; swap Florence for Venice",rows:2,className:"w-full p-2 rounded border border-cream-border bg-cream focus:outline-none focus:ring-1 focus:ring-brand-orange/40 text-xs resize-y"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:Se,disabled:R||!u.trim(),className:"px-3 py-1.5 rounded bg-brand-orange text-white text-xs font-semibold disabled:opacity-40",children:"Refine"}),i&&e.jsx("span",{className:"text-[11px] text-green-700",children:"Stored draft ready to import."})]}),e.jsx("p",{className:"text-[10px] text-brand-brown/60",children:'Tips: Keep it short and actionable — e.g., "add museum", "add 2 more nights", "swap to family‑friendly", "reduce budget by 10%".'}),B&&e.jsxs("p",{className:"text-[10px] text-green-700",children:["Draft stored on server (id ",B,")."]})]}),e.jsx("div",{"aria-live":"polite","aria-atomic":"true",className:"sr-only",ref:f}),k&&e.jsx("div",{role:"alert",className:"bg-red-100 border border-red-300 text-red-800 px-3 py-2 rounded text-sm",children:k}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-4",children:[e.jsxs("section",{className:"p-3 rounded border border-cream-border bg-cream-sand/40 flex flex-col",children:[e.jsxs("h2",{className:"font-semibold text-sm mb-2 flex items-center gap-2",children:["Parse ",w?e.jsx("span",{className:"text-green-600",children:"✓"}):P&&r==="stream"?e.jsx("span",{className:"animate-pulse",children:"…"}):null]}),!w&&e.jsx("p",{className:"text-xs text-brand-brown/60",children:"Destinations, dates, travelers, budget, interests."}),w&&e.jsxs("div",{className:"text-xs space-y-1",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Destinations:"})," ",w.destinations.join(", ")||"—"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Dates:"})," ",w.startDate||"?"," → ",w.endDate||"?"," (",w.nights," nights)"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Travelers:"})," ",w.travelers.adults," adults ",w.travelers.children?`, ${w.travelers.children} children`:""]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Budget:"})," ",w.budget.amount?ee(w.budget.amount,w.budget.currency):"n/a"," ",w.budget.perPerson?"(per person)":""]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Interests:"})," ",w.interests.join(", ")||"—"]})]})]}),e.jsxs("section",{className:"p-3 rounded border border-cream-border bg-cream-sand/40 flex flex-col",children:[e.jsxs("h2",{className:"font-semibold text-sm mb-2 flex items-center gap-2",children:["Plan ",J?e.jsx("span",{className:"text-green-600",children:"✓"}):w&&P&&r==="stream"?e.jsx("span",{className:"animate-pulse",children:"…"}):null]}),!J&&e.jsx("p",{className:"text-xs text-brand-brown/60",children:"Skeleton itinerary days & activities."}),J&&e.jsx("ol",{className:"text-xs list-decimal ml-4 space-y-1 max-h-60 overflow-auto pr-2",children:J.itinerary.map(t=>e.jsxs("li",{children:[e.jsxs("span",{className:"font-semibold",children:[t.title,":"]})," ",t.activities.join("; ")]},t.day))})]}),e.jsxs("section",{className:"p-3 rounded border border-cream-border bg-cream-sand/40 flex flex-col",children:[e.jsxs("h2",{className:"font-semibold text-sm mb-2 flex items-center gap-2",children:["Pricing ",E?e.jsx("span",{className:"text-green-600",children:"✓"}):J&&P&&r==="stream"?e.jsx("span",{className:"animate-pulse",children:"…"}):null]}),!E&&e.jsx("p",{className:"text-xs text-brand-brown/60",children:"Rough heuristic estimate with scaling."}),E&&e.jsxs("div",{className:"text-xs space-y-1",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Total:"})," ",ee(E.pricing.total,E.pricing.currency)]}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:Object.entries(E.pricing.breakdown).map(([t,n])=>e.jsxs("div",{children:[t,": ",ee(n,E.pricing.currency)]},t))}),e.jsx("div",{className:"italic text-[10px] text-brand-brown/70",children:E.pricing.note})]})]})]}),N&&r==="single"&&e.jsxs("details",{className:"mt-2 text-xs",children:[e.jsx("summary",{className:"cursor-pointer font-semibold",children:"Full JSON"}),e.jsx("pre",{className:"bg-cream-sand border border-cream-border rounded p-2 overflow-auto max-h-72 whitespace-pre-wrap break-all",children:JSON.stringify(N,null,2)})]}),D&&$&&T.length>0&&e.jsxs("div",{className:"mt-4 border border-cream-border rounded p-3 bg-cream-sand/40",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("h2",{className:"text-sm font-semibold flex items-center gap-2",children:["Session History ",e.jsxs("span",{className:"text-[10px] font-normal text-brand-brown/60",children:[T.length," snapshot",T.length>1?"s":""]})]}),e.jsx("button",{onClick:()=>oe(t=>!t),className:"text-[11px] underline",children:ie?"Hide Diff":"Show Diff"})]}),e.jsx("ol",{className:"text-[11px] space-y-1 max-h-48 overflow-auto pr-2",children:T.map((t,n)=>e.jsxs("li",{className:"flex flex-col gap-0.5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"px-1.5 py-0.5 rounded bg-brand-brown text-white text-[10px] uppercase",children:t.type}),e.jsx("span",{className:"text-brand-brown/70",children:new Date(t.at).toLocaleTimeString()})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-[10px]",children:[e.jsxs("span",{children:["Nights: ",t.data.nights]}),e.jsxs("span",{children:["Dests: ",t.data.destinations.length]}),e.jsxs("span",{children:["Interests: ",t.data.interests.length]})]})]},n))}),ie&&T.length>1&&e.jsx(Me,{prev:T[T.length-2].data,curr:T[T.length-1].data})]})]})}function Me({prev:a,curr:o}){const r=o.interests.filter(i=>!a.interests.includes(i)),c=o.nights-a.nights,s=o.destinations.length-a.destinations.length,h=i=>e.jsx("span",{className:"inline-block px-1.5 py-0.5 rounded bg-brand-orange text-white text-[10px] mr-1",children:i}),N=(a.itinerary||[]).reduce((i,y)=>(i[y.day]=y,i),{}),v=(o.itinerary||[]).reduce((i,y)=>(i[y.day]=y,i),{}),k=Object.keys(v).filter(i=>!N[i]),m=Object.keys(N).filter(i=>!v[i]),u=[],j=[];Object.keys(v).forEach(i=>{if(N[i]){const y=new Set(N[i].activities||[]),$=new Set(v[i].activities||[]);for(const C of $)y.has(C)||u.push({day:i,a:C});for(const C of y)$.has(C)||j.push({day:i,a:C})}});const[R,O]=ke.useState(!1);return e.jsxs("div",{className:"mt-3 text-[11px] border-t border-cream-border pt-2",children:[e.jsx("h3",{className:"font-semibold mb-1 flex items-center gap-2",children:"Last Change"}),e.jsxs("div",{className:"space-y-1",children:[c!==0&&e.jsxs("div",{children:[h("NIGHTS")," ",c>0?`+${c}`:c," nights (prev ",a.nights," → ",o.nights,")"]}),r.length>0&&e.jsxs("div",{children:[h("INTERESTS")," Added: ",r.join(", ")]}),s!==0&&e.jsxs("div",{children:[h("DESTS")," ",s>0?`+${s}`:s," destinations (count)"]}),k.length>0&&e.jsxs("div",{children:[h("DAY+")," Added day(s): ",k.join(", ")]}),m.length>0&&e.jsxs("div",{children:[h("DAY-")," Removed day(s): ",m.join(", ")]}),u.length>0&&e.jsxs("div",{children:[h("ACT+")," ",u.slice(0,4).map(i=>`D${i.day}:${i.a}`).join(", "),u.length>4?"…":""]}),j.length>0&&e.jsxs("div",{children:[h("ACT-")," ",j.slice(0,4).map(i=>`D${i.day}:${i.a}`).join(", "),j.length>4?"…":""]}),c===0&&r.length===0&&s===0&&e.jsx("div",{className:"italic text-brand-brown/60",children:"No core field changes detected."})]}),(u.length>4||j.length>4)&&e.jsx("button",{onClick:()=>O(i=>!i),className:"mt-2 underline text-[10px]",children:R?"Hide full activity diff":"Show full activity diff"}),R&&e.jsxs("div",{className:"mt-2 grid sm:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"font-semibold text-[10px] mb-1",children:["Added Activities (",u.length,")"]}),e.jsx("ul",{className:"space-y-0.5 max-h-40 overflow-auto pr-1",children:u.map((i,y)=>e.jsxs("li",{className:"truncate",children:["D",i.day,": ",i.a]},y))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-semibold text-[10px] mb-1",children:["Removed Activities (",j.length,")"]}),e.jsx("ul",{className:"space-y-0.5 max-h-40 overflow-auto pr-1",children:j.map((i,y)=>e.jsxs("li",{className:"truncate",children:["D",i.day,": ",i.a]},y))})]})]})]})}function qe(){return p.useEffect(()=>{const a=document.title;return document.title="Trip Assist | CollEco Travel",()=>{document.title=a}},[]),e.jsx("div",{className:"flex flex-col gap-4",children:e.jsx(Le,{})})}export{qe as default};
