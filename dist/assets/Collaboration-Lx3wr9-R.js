import{r,j as e}from"./index-E_l07fEO.js";import{p as W,C as o,R as l,l as X,s as Y,a as u,c as Z,b as _,m as ee,o as te,d as O}from"./collabStore-RBK6R8ls.js";const ae=[{id:1,ref:"CE-2024-001",clientName:"Alice Johnson",status:"Accepted",itineraryName:"Kruger Safari Adventure",items:[{id:101,name:"Safari Game Drive",category:"activity",price:1500,qty:2,startTime:"06:00",endTime:"09:00",description:"Early morning game drive to spot the Big Five."},{id:102,name:"Safari Lodge",category:"hotel",price:4500,qty:2,startTime:"14:00",description:"Two nights stay in a luxury safari lodge."}]},{id:2,ref:"CE-2024-002",clientName:"Bob Williams",status:"Sent",itineraryName:"Drakensberg Mountain Retreat",items:[{id:201,name:"Guided Mountain Hike",category:"hike",price:1200,qty:4,startTime:"09:00",endTime:"13:00",description:"Explore the majestic peaks and valleys."},{id:202,name:"Picnic Lunch",category:"dining",price:450,qty:4,startTime:"13:00",endTime:"14:00",description:"Enjoy a curated picnic with local delicacies."},{id:203,name:"Stargazing",category:"activity",qty:4,startTime:"20:00",endTime:"21:00",description:"A guided tour of the southern night sky."}]},{id:3,ref:"CE-2024-003",clientName:"Charlie Brown",status:"Draft",itineraryName:"Cape Town City Tour",items:[{id:301,name:"City Tour",category:"car",price:800,qty:1,startTime:"10:00",endTime:"13:00",description:"A guided tour of the city's main attractions."},{id:302,name:"Museum Tickets",category:"activity",price:300,qty:1,startTime:"14:00",endTime:"16:00",description:"Entry to the Iziko South African Museum."}]}];function $({bookingId:a,fromName:m="Client",content:i="Got it, thanks!",authorRole:h="client"}){return W(a,{authorRole:h,authorName:m,channel:o.whatsapp,content:i})}function ne(a,m,i){try{"Notification"in window&&(Notification.permission==="granted"?new Notification(m,{body:i}):Notification.permission!=="denied"&&Notification.requestPermission())}catch{}console.info(`[Notify:${a}] ${m} - ${i}`)}const N=!1;const k=[{value:l.agent,label:"Agent"},{value:l.client,label:"Client"},{value:l.productOwner,label:"Product Owner"}];function p({role:a}){const m={[l.agent]:"bg-brand-orange/10 text-brand-brown border border-brand-orange/30",[l.client]:"bg-cream-hover text-brand-brown border border-cream-border",[l.productOwner]:"bg-amber-50 text-amber-800 border border-amber-300",[l.system]:"bg-gray-100 text-gray-700 border border-gray-200"},i=k.find(h=>h.value===a)?.label||a;return e.jsx("span",{className:`px-2 py-0.5 rounded text-xs ${m[a]}`,children:i})}function B({channel:a}){const i={[o.inapp]:{cls:"bg-emerald-50 text-emerald-700",label:"In-App"},[o.whatsapp]:{cls:"bg-green-50 text-green-700",label:"WhatsApp"},[o.email]:{cls:"bg-blue-50 text-blue-700",label:"Email"},[o.sms]:{cls:"bg-purple-50 text-purple-700",label:"SMS"},[o.call]:{cls:"bg-gray-50 text-gray-700",label:"Call"},[o.note]:{cls:"bg-yellow-50 text-yellow-700",label:"Note"}}[a]||{cls:"bg-gray-50 text-gray-700",label:a};return e.jsx("span",{className:`px-2 py-0.5 rounded text-xs border ${i.cls}`,children:i.label})}function oe(){const[a,m]=r.useState(()=>localStorage.getItem("collabRole")||l.agent),[i,h]=r.useState(null),[x,b]=r.useState([]),[S,C]=r.useState(""),[g,P]=r.useState("all"),[A,q]=r.useState(o.inapp),[y,R]=r.useState(""),[T,E]=r.useState({recording:!1,mediaRecorder:null,chunks:[]}),[j,L]=r.useState(!1),[w,z]=r.useState(!0);r.useEffect(()=>{(async()=>D())()},[]);function D(){Object.keys(X()).length||Y(ae),b(u())}r.useEffect(()=>{},[a]),r.useEffect(()=>{i==null&&x.length&&h(x[0].bookingId)},[x,i]);const n=r.useMemo(()=>x.find(t=>t.bookingId===i),[x,i]),f=r.useMemo(()=>Z(n),[n]),v=r.useMemo(()=>_(n),[n]);r.useEffect(()=>{n&&(async()=>{try{N||ee(n.bookingId,a)}catch{}})()},[n,a]),r.useEffect(()=>{if(n){let t=te(({event:s,payload:d})=>{if(!(!n||d?.bookingId!==n.bookingId)){if(s==="message"){const c=d.message;c.authorRole!==a&&ne(a,`New ${c.channel} message`,c.content?.slice(0,120)||""),b(u())}s==="attachment"&&b(u())}});try{"Notification"in window&&Notification.requestPermission?.()}catch{}return()=>{try{t?.()}catch{}}}},[n,a]),r.useEffect(()=>{if(!j||!n)return;const t=setInterval(async()=>{$({bookingId:n.bookingId,content:"(Auto) WhatsApp: confirmed, thanks!"}),b(u())},12e3);return()=>clearInterval(t)},[j,n]);async function F(){const t=S.trim();if(!t||!n)return;const s=y?[y]:[],d={authorRole:a,authorName:k.find(c=>c.value===a)?.label,content:t,channel:A,mentions:s,visibility:g};try{N||(W(n.bookingId,d),b(u()))}finally{C(""),R("")}}async function U(t){const s=t.target.files?.[0];if(!s||!n)return;const d={name:s.name,size:s.size,type:s.type,byRole:a,visibility:g};O(n.bookingId,d),b(u())}async function H(){try{const t=await navigator.mediaDevices.getUserMedia({audio:!0}),s=new MediaRecorder(t),d=[];s.ondataavailable=c=>{c.data.size>0&&d.push(c.data)},s.onstop=async()=>{const c=new Blob(d,{type:"audio/webm"}),G=await c.arrayBuffer(),V=new Uint8Array(G).byteLength,K=URL.createObjectURL(c),Q=`voice-note-${new Date().toISOString().replace(/[:.]/g,"-")}.webm`;N||(O(n.bookingId,{name:Q,size:V,type:"audio/webm",byRole:a,url:K,visibility:g}),b(u()))},s.start(),E({recording:!0,mediaRecorder:s,chunks:d})}catch(t){console.error("Recording failed",t)}}function J(){try{T.mediaRecorder?.stop(),E({recording:!1,mediaRecorder:null,chunks:[]})}catch{}}function I(t){return t.visibility==="all"?!0:t.visibility==="agent-client"?a===l.agent||a===l.client:t.visibility==="agent-po"?a===l.agent||a===l.productOwner:!0}function M(t){return I(t)}return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[e.jsx("h1",{className:"text-2xl font-semibold text-brand-brown",children:"Collaboration Workspace"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{className:"lg:hidden px-2 py-1 border rounded",onClick:()=>z(t=>!t),children:[w?"Hide":"Show"," Bookings"]}),e.jsx("select",{className:"border rounded px-2 py-1 bg-cream hover:bg-cream-hover",value:a,onChange:t=>{m(t.target.value),localStorage.setItem("collabRole",t.target.value)},children:k.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))}),e.jsx(p,{role:a})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-6",children:[w&&e.jsxs("aside",{className:"lg:col-span-3 bg-cream rounded border border-cream-border",children:[e.jsx("div",{className:"p-3 border-b border-cream-border font-medium text-brand-brown",children:"Bookings"}),e.jsx("ul",{className:"max-h-[70vh] overflow-y-auto",children:x.map(t=>e.jsx("li",{children:e.jsx("button",{onClick:()=>h(t.bookingId),className:`w-full text-left px-3 py-2 hover:bg-cream-hover ${i===t.bookingId?"bg-cream-hover":""}`,children:e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold text-brand-brown",children:t.title}),e.jsxs("div",{className:"text-xs text-brand-brown/70",children:[t.ref," • ",t.clientName]})]}),e.jsx("div",{className:"text-xs text-brand-brown/70",children:t.unread?.[a]?e.jsx("span",{className:"inline-block min-w-5 text-center px-1 py-0.5 bg-brand-orange text-white rounded-full",children:t.unread[a]}):null})]})})},t.bookingId))})]}),e.jsxs("section",{className:`lg:col-span-6 bg-white rounded border border-cream-border flex flex-col ${w?"":"lg:col-span-9"}`,children:[e.jsxs("div",{className:"p-3 border-b border-cream-border flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-brand-brown",children:n?.title||"Select a booking"}),e.jsxs("div",{className:"text-xs text-brand-brown/70",children:[n?.ref," • ",n?.clientName," • Status: ",n?.status]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsx("span",{className:"text-brand-brown/60",children:"Visibility:"}),e.jsxs("select",{className:"border rounded px-1.5 py-0.5",value:g,onChange:t=>P(t.target.value),children:[e.jsx("option",{value:"all",children:"All Participants"}),e.jsx("option",{value:"agent-client",children:"Agent + Client"}),e.jsx("option",{value:"agent-po",children:"Agent + Product Owner"})]}),e.jsx("span",{className:"text-brand-brown/60 ml-2",children:"Channel:"}),e.jsxs("select",{className:"border rounded px-1.5 py-0.5",value:A,onChange:t=>q(t.target.value),children:[e.jsx("option",{value:o.inapp,children:"In-App"}),e.jsx("option",{value:o.whatsapp,children:"WhatsApp"}),e.jsx("option",{value:o.email,children:"Email"}),e.jsx("option",{value:o.sms,children:"SMS"}),e.jsx("option",{value:o.note,children:"Note"})]})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",children:[(n?.messages||[]).filter(I).map(t=>e.jsx("div",{className:`max-w-[85%] ${t.authorRole===a?"ml-auto":""}`,children:e.jsxs("div",{className:`rounded px-3 py-2 border text-sm ${t.authorRole===l.client?"bg-cream-hover border-cream-border":"bg-cream border-cream-border"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(p,{role:t.authorRole}),e.jsx(B,{channel:t.channel}),t.mentions?.length?e.jsx("span",{className:"text-xs text-brand-brown/70",children:t.mentions.map(s=>"@"+s).join(" ")}):null]}),e.jsx("div",{className:"whitespace-pre-wrap text-brand-brown",children:t.content}),e.jsx("div",{className:"text-[11px] text-brand-brown/60 mt-1",children:new Date(t.createdAt).toLocaleString()})]})},t.id)),(n?.attachments||[]).filter(M).length?e.jsxs("div",{className:"pt-2",children:[e.jsx("div",{className:"text-xs font-medium text-brand-brown mb-1",children:"Shared Documents"}),e.jsx("ul",{className:"space-y-1",children:n.attachments.filter(M).map(t=>e.jsxs("li",{className:"text-sm text-brand-brown border-b border-cream-border py-1",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("span",{children:[t.name," ",e.jsxs("span",{className:"text-brand-brown/60",children:["(",Math.ceil((t.size||0)/1024)," KB)"]})]}),e.jsxs("span",{className:"text-xs text-brand-brown/60",children:["by ",e.jsx(p,{role:t.byRole})]})]}),t.type?.startsWith("audio/")&&t.url?e.jsx("audio",{className:"mt-1 w-full",controls:!0,src:t.url}):null]},t.id))})]}):null]}),e.jsxs("div",{className:"p-3 border-t border-cream-border sticky bottom-0 bg-white",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"flex-1 border rounded px-3 py-2",placeholder:"Write a message… use @client or @productOwner to mention",value:S,onChange:t=>C(t.target.value)}),e.jsxs("select",{className:"border rounded px-2 py-2",value:y,onChange:t=>R(t.target.value),children:[e.jsx("option",{value:"",children:"@Mention"}),e.jsx("option",{value:"client",children:"@client"}),e.jsx("option",{value:"productOwner",children:"@productOwner"})]}),e.jsxs("label",{className:"cursor-pointer px-3 py-2 border rounded bg-cream hover:bg-cream-hover text-brand-brown",children:["Attach",e.jsx("input",{type:"file",className:"hidden",onChange:U})]}),T.recording?e.jsx("button",{onClick:J,className:"px-3 py-2 border rounded bg-red-600 text-white",children:"Stop"}):e.jsx("button",{onClick:H,className:"px-3 py-2 border rounded bg-cream hover:bg-cream-hover text-brand-brown",children:"Record"}),e.jsx("button",{onClick:F,className:"px-4 py-2 bg-brand-orange text-white rounded hover:opacity-95",children:"Send"})]}),e.jsx("div",{className:"text-[11px] text-brand-brown/60 mt-1",children:"WhatsApp/email sync is simulated. Replies via external channels appear in the timeline with their channel tag."})]})]}),e.jsxs("aside",{className:"lg:col-span-3 bg-cream rounded border border-cream-border p-3 space-y-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-brand-brown",children:"AI Summary"}),e.jsx("div",{className:"text-sm text-brand-brown/80 mt-1",children:v.summary}),v.bullets?.length?e.jsx("ul",{className:"list-disc list-inside text-sm text-brand-brown mt-2",children:v.bullets.map((t,s)=>e.jsx("li",{children:t},s))}):null]}),e.jsxs("div",{className:"border-t border-cream-border pt-3",children:[e.jsx("div",{className:"font-medium text-brand-brown mb-1",children:"Collaboration Analytics"}),e.jsx("div",{className:"text-xs text-brand-brown/70",children:"Average response mins"}),e.jsx("ul",{className:"text-sm text-brand-brown",children:Object.entries(f.avgResponseMins||{}).map(([t,s])=>e.jsxs("li",{className:"flex items-center justify-between py-0.5",children:[e.jsx("span",{children:e.jsx(p,{role:t})}),e.jsxs("span",{children:[s,"m"]})]},t))}),e.jsx("div",{className:"text-xs text-brand-brown/70 mt-2",children:"Messages per channel"}),e.jsx("ul",{className:"text-sm text-brand-brown",children:Object.entries(f.channelCounts||{}).map(([t,s])=>e.jsxs("li",{className:"flex items-center justify-between py-0.5",children:[e.jsx("span",{children:e.jsx(B,{channel:t})}),e.jsx("span",{children:s})]},t))}),e.jsx("div",{className:"text-xs text-brand-brown/70 mt-2",children:"Awaiting response"}),e.jsx("div",{className:"text-sm text-brand-brown flex flex-wrap gap-1",children:f.awaiting?.length?f.awaiting.map((t,s)=>e.jsx(p,{role:t},s)):e.jsx("span",{className:"text-brand-brown/60",children:"-"})})]}),e.jsxs("div",{className:"border-t border-cream-border pt-3",children:[e.jsx("div",{className:"font-medium text-brand-brown mb-1",children:"Omnichannel & Push"}),e.jsxs("ul",{className:"text-sm text-brand-brown/90 space-y-1",children:[e.jsx("li",{children:"• WhatsApp integration stub ready (webhook-style)."}),e.jsx("li",{children:"• Email/SMS fallback simulated via channel tags."}),e.jsx("li",{children:"• Mobile push: add FCM/Expo later for alerts."}),e.jsx("li",{children:"• Open API hooks for Slack/Teams/CRM coming next."})]}),e.jsxs("label",{className:"mt-2 flex items-center gap-2 text-sm text-brand-brown",children:[e.jsx("input",{type:"checkbox",checked:j,onChange:t=>L(t.target.checked)}),e.jsx("span",{children:"Auto-simulate WhatsApp replies"})]}),e.jsx("button",{onClick:()=>{n&&($({bookingId:n.bookingId,content:"Replying from WhatsApp: looks good!"}),b(u()))},className:"mt-2 text-xs px-3 py-1.5 rounded bg-green-600 text-white hover:opacity-95",children:"Simulate WhatsApp reply"})]})]})]})]})}export{oe as default};
