import{j as e,r as u,R as Y}from"./index-E_l07fEO.js";import{A as ke}from"./AutoSyncBanner-HMD482kt.js";import{u as Se,L as Ce,c as De,s as Ee}from"./useTripState-B35c8IxU.js";import{E as Ie}from"./jspdf.es.min-GZClMTNp.js";import{u as Re}from"./useBasketState-Oi3ySvlX.js";import{u as A}from"./useLocalStorageState-B5CzfI59.js";import{F as Ae,P as Me}from"./PaymentButton-BtM63kBm.js";import"./payments-Crek84YA.js";function Oe({title:l,children:d,onClose:h,actions:j}){return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:h}),e.jsxs("div",{className:"relative bg-white rounded shadow-lg w-full max-w-md mx-4 p-5 animate-fadeIn border border-cream-border text-brand-brown",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold",children:l}),e.jsx("button",{onClick:h,className:"text-sm px-2 py-1 rounded hover:bg-cream-sand",children:"✕"})]}),e.jsx("div",{className:"mb-4 max-h-[60vh] overflow-y-auto pr-1",children:d}),e.jsx("div",{className:"flex justify-end gap-2",children:j})]})]})}function Fe({day:l,date:d,children:h}){return e.jsxs("div",{className:"rounded border border-cream-border bg-cream p-4 text-brand-brown",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("h4",{className:"font-semibold",children:["Day ",l]}),d?e.jsx("span",{className:"text-sm text-brand-brown/70",children:d}):null]}),e.jsx("div",{className:"space-y-3",role:"list","aria-label":`Itinerary items for day ${l}`,children:h})]})}function Le({title:l,subtitle:d,time:h,notes:j,onAdd:w,onRemove:S}){return e.jsxs("div",{className:"rounded border border-cream-border bg-cream-sand p-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-brand-brown",children:l}),d?e.jsx("div",{className:"text-sm text-brand-brown/70",children:d}):null,h?e.jsx("div",{className:"text-xs text-brand-brown/60 mt-0.5",children:h}):null]}),e.jsxs("div",{className:"flex gap-2",children:[w?e.jsx("button",{className:"px-2 py-1 text-sm rounded border border-brand-brown text-brand-brown hover:bg-brand-brown/10",onClick:w,children:"Add"}):null,S?e.jsx("button",{className:"px-2 py-1 text-sm rounded border border-cream-border text-brand-brown hover:bg-cream-hover",onClick:S,children:"Remove"}):null]})]}),j?e.jsx("p",{className:"text-sm text-brand-brown/80 mt-2",children:j}):null]})}function _e({value:l,onChange:d,placeholder:h="Capture a memory… (this saves automatically)",rows:j=2}){return e.jsxs("div",{className:"rounded border border-cream-border bg-cream p-2",children:[e.jsx("textarea",{className:"w-full resize-none bg-transparent outline-none text-sm text-brand-brown placeholder:text-brand-brown/50",rows:j,value:l,onChange:w=>d?.(w.target.value),placeholder:h}),e.jsx("div",{className:"text-[11px] text-brand-brown/60",children:"Memories sync to your itinerary and can be exported to PDF later."})]})}function Ve(){const[l,d]=Se(),[h,j]=A("basketAutoSync:v1",!0),{basket:w,updateDay:S,removeFromBasket:M,reorderWithin:C}=Re(),c=u.useRef(null),f=u.useRef(null),[m,x]=A("itineraryReorderDay:v1",null),[y,g]=A("itineraryBulkModeDay:v1",null),[E,N]=u.useState({}),[B,P]=u.useState(null),[G,H]=u.useState(""),O=u.useRef(null),[X,de]=A("itineraryHighContrastFocus:v1",!1),[U,ue]=A("itineraryEnableToasts:v1",!0),[ee,J]=u.useState([]),[re,be]=A("itineraryAnimations:v1",!0),[te,me]=A("itineraryHideAI:v1",!1),[K,q]=u.useState(null),[xe,V]=u.useState(!1),[T,Q]=u.useState(""),p=u.useRef([]),k=u.useRef([]),[Be,$]=u.useState(0),[ne,he]=u.useState(!1);u.useRef({active:!1,timer:null,baseSnapshot:null});function F(r,t){const n=JSON.parse(JSON.stringify(r));p.current.push({trip:n,label:t}),k.current=[],p.current.length>50&&p.current.shift(),$(a=>a+1)}function se(){if(!p.current.length)return;const r=JSON.parse(JSON.stringify(l)),t=p.current.pop();k.current.push({trip:r,label:"redo-of-"+(t.label||"change")}),d(t.trip),$(n=>n+1)}function ae(){if(!k.current.length)return;const r=JSON.parse(JSON.stringify(l)),t=k.current.pop();p.current.push({trip:r,label:"undo-of-"+(t.label||"change")}),d(t.trip),$(n=>n+1)}u.useEffect(()=>{function r(t){const n=t.key.toLowerCase();(t.ctrlKey||t.metaKey)&&n==="z"&&!t.shiftKey?(t.preventDefault(),se()):(t.ctrlKey||t.metaKey)&&n==="z"&&t.shiftKey&&(t.preventDefault(),ae())}return window.addEventListener("keydown",r),()=>window.removeEventListener("keydown",r)},[]),u.useEffect(()=>{try{const r=localStorage.getItem("aiItineraryDraft:v1");if(r){const t=JSON.parse(r);q(t)}}catch{}},[l.days]);const I=T.trim().length>0;u.useEffect(()=>{I&&(x(null),g(null))},[I,x,g]);function oe(r){if(!K)return;const t={};(K.itinerary||[]).forEach(n=>{const a=String(n.day||n.dayNumber||n.dayIndex||n.day||n.day===0?n.day:n.day||n.dayNumber||1);t[a]||(t[a]=[]),t[a].push({id:"ai-"+n.day+"-"+Math.random().toString(36).slice(2),title:n.title||`Day ${n.day}`,time:"Flexible",subtitle:(n.activities||[]).join(", "),_aiSource:!0})}),r==="replace"?(F(l,"ai-replace"),d(n=>({...n,days:t}))):r==="merge"&&(F(l,"ai-merge"),d(n=>{const a={...n.days};return Object.keys(t).forEach(o=>{a[o]=[...a[o]||[],...t[o]]}),{...n,days:a}}));try{localStorage.removeItem("aiItineraryDraft:v1")}catch{}q(null),V(!1),L("Draft imported")}function R(r,t){d(n=>(F(n,t),r(n)))}function pe(r,t){if(!E[r]||!E[r].size)return;const n=E[r],a=(l.days[r]||[]).filter(o=>n.has(o.id));a.length&&(R(o=>{const s=(o.days[r]||[]).filter(b=>!n.has(b.id)),i=[...o.days[t]||[],...a];return{...o,days:{...o.days,[r]:s,[t]:i}}},"bulkMove"),a.forEach(o=>{o._basketSource&&S(o.id,Number(t))}),N(o=>({...o,[r]:new Set})),g(null))}function fe(r){if(y===r){g(null);return}g(r),x(null),N(t=>({...t,[r]:new Set(t[r]||[])}))}function ye(r,t){N(n=>{const a=new Set(n[r]||[]);return a.has(t)?a.delete(t):a.add(t),{...n,[r]:a}})}function ge(r){x(m===r?null:r)}u.useEffect(()=>{m&&!l.days[m]&&x(null),y&&!l.days[y]&&g(null)},[l.days,m,y,x,g]);function ve(r,t,n){c.current={day:t,index:n},r.dataTransfer.effectAllowed="move"}function je(r,t,n){f.current={day:t,index:n}}function ie(){const r=c.current,t=f.current;if(!r||!t||r.day!==t.day||r.index===t.index){c.current=f.current=null;return}let n=[];R(a=>{const o=[...a.days[r.day]||[]],[s]=o.splice(r.index,1);return o.splice(t.index,0,s),n=o.filter(i=>i._basketSource).map(i=>i.id),{...a,days:{...a.days,[r.day]:o}}},"reorder"),n.length&&C(n),L(`Reordered to position ${t.index+1} in day ${t.day}`),c.current=f.current=null}function L(r){if(O.current&&(O.current.textContent=r,setTimeout(()=>{O.current&&O.current.textContent===r&&(O.current.textContent="")},2e3)),U){const t=Date.now()+Math.random().toString(36).slice(2);J(n=>{const a=[...n,{id:t,msg:r}];return a.length>4&&a.shift(),a}),setTimeout(()=>{J(n=>n.filter(a=>a.id!==t))},3500)}}u.useEffect(()=>{h&&d(r=>{let t={...r,days:{...r.days}},n=!1;const a=new Set(w.map(o=>o.id));return Object.keys(t.days).forEach(o=>{const s=(t.days[o]||[]).filter(i=>!(i._basketSource&&!a.has(i.id)));s.length!==(t.days[o]||[]).length&&(t.days[o]=s,n=!0)}),w.forEach(o=>{const s=String(o.day||1),i=(t.days[s]||[]).find(b=>b.id===o.id);if(Object.keys(t.days).forEach(b=>{b!==s&&(t.days[b]||[]).some(v=>v.id===o.id&&v._basketSource)&&(t.days[b]=t.days[b].filter(v=>v.id!==o.id),n=!0)}),!i){const b=t.days[s]||[];t.days[s]=[...b,{...o,time:o.time||"Flexible",_basketSource:!0}],n=!0}}),n?t:r})},[w,h,d]);const le=u.useMemo(()=>{const r=[];return Object.keys(l.days).forEach(t=>{(l.days[t]||[]).forEach(n=>r.push({name:n.title,amount:50}))}),r.length?r:[{name:"Itinerary deposit",amount:100}]},[l]),we=()=>{const r=new Ie;r.setFontSize(16),r.text("Your CollEco Itinerary",14,20),r.setFontSize(11),r.text("This PDF export includes your day plan and memories.",14,28);let t=40;Object.keys(l.days).sort((a,o)=>Number(a)-Number(o)).forEach(a=>{r.setFont(void 0,"bold"),r.text(`Day ${a}`,14,t),t+=8,r.setFont(void 0,"normal"),(l.days[a]||[]).forEach(s=>{r.text(`• ${s.title}${s.subtitle?" — "+s.subtitle:""}`,18,t),t+=6});const o=l.memories?.[a];o&&(r.text(`Notes: ${o}`,18,t),t+=8),t+=4,t>270&&(r.addPage(),t=20)}),r.save("itinerary.pdf")};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"px-6 py-8 text-brand-brown "+(X?"focus-visible:outline-none [&_*:focus-visible]:outline [&_*:focus-visible]:outline-2 [&_*:focus-visible]:outline-offset-2 [&_*:focus-visible]:outline-brand-brown":""),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Itinerary"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"hidden sm:flex items-center gap-2 mr-2",children:[e.jsx("input",{value:T,onChange:r=>Q(r.target.value),placeholder:"Search itinerary…","aria-label":"Search itinerary items",className:"px-2 py-1 text-sm border border-cream-border rounded bg-white w-48"}),I&&e.jsx("button",{onClick:()=>Q(""),className:"text-xs underline text-brand-brown/70 hover:text-brand-brown",children:"Clear"})]}),K&&e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>V(r=>!r),className:"px-3 py-2 rounded bg-brand-brown text-white text-sm font-medium hover:bg-brand-brown/90",children:"Draft"}),xe&&e.jsxs("div",{className:"absolute right-0 mt-2 w-72 bg-white border border-cream-border rounded shadow p-3 text-xs space-y-2 z-50",children:[e.jsx("div",{className:"font-semibold text-brand-brown mb-1",children:"Draft detected"}),e.jsx("p",{className:"text-brand-brown/70",children:"A stored draft is available. Import it into your current itinerary."}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>oe("merge"),className:"px-2 py-1 rounded bg-brand-orange text-white hover:bg-brand-highlight",children:"Merge"}),e.jsx("button",{onClick:()=>oe("replace"),className:"px-2 py-1 rounded bg-red-600 text-white hover:bg-red-500",children:"Replace"}),e.jsx("button",{onClick:()=>{try{localStorage.removeItem("aiItineraryDraft:v1")}catch{}q(null),V(!1)},className:"px-2 py-1 rounded border border-cream-border hover:bg-cream-sand",children:"Dismiss"})]}),e.jsx("p",{className:"text-[10px] text-brand-brown/50",children:"Merge appends new days/items. Replace discards current days."})]})]}),e.jsx(Te,{highContrastFocus:X,setHighContrastFocus:de,enableToasts:U,setEnableToasts:ue,animationsEnabled:re,setAnimationsEnabled:be}),e.jsx("button",{onClick:we,className:"px-3 py-2 rounded border border-brand-brown text-brand-brown hover:bg-brand-brown/10",children:"Export PDF"})]})]}),e.jsx("p",{className:"mb-2 text-brand-brown/80",children:"Plan each day and capture memories — everything stays in sync."}),e.jsx("div",{className:"sm:hidden mb-3",children:e.jsx("input",{value:T,onChange:r=>Q(r.target.value),placeholder:"Search itinerary…","aria-label":"Search itinerary items",className:"w-full px-2 py-1 text-sm border border-cream-border rounded bg-white"})}),I&&e.jsxs("div",{className:"mb-3 text-xs bg-white/60 border border-cream-border rounded p-2 text-brand-brown/70",role:"status","aria-live":"polite",children:["Filtering items by “",T,"”. Reorder and bulk select are disabled while searching."]}),m&&e.jsx("div",{className:"mb-4 text-xs bg-white/60 border border-cream-border rounded p-2 text-brand-brown/70",role:"status","aria-live":"polite",children:"Reorder mode: Use the drag handles with mouse, or keyboard – Tab to item, Space to pick up, Arrow Up/Down to move, Enter to drop, Esc to cancel."}),e.jsx("div",{className:"mb-4",children:e.jsx(ke,{message:"Itinerary updates will reflect in quotes and bookings automatically."})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsx(Ce,{steps:De(l,h?w.length:0)}),e.jsx("div",{className:"md:col-span-2 rounded border border-cream-border bg-cream p-4",children:e.jsx("div",{className:"grid grid-cols-1 gap-4",children:Object.keys(l.days).length===0?e.jsxs("div",{className:"text-brand-brown/70",children:["No items yet. ",h?"Add products to your basket on Trip Planner.":"Basket auto-sync disabled."]}):Object.keys(l.days).sort((r,t)=>Number(r)-Number(t)).map(r=>e.jsxs(Fe,{day:r,onDragOver:t=>{m&&t.preventDefault()},onDrop:t=>{if(!m)return;const n=c.current;n&&n.day!==r&&(R(a=>{const o=[...a.days[n.day]||[]],[s]=o.splice(n.index,1),i=[...a.days[r]||[],s];return{...a,days:{...a.days,[n.day]:o,[r]:i}}},"move-day"),l.days[n.day]?.[n.index]?._basketSource&&S(l.days[n.day][n.index].id,Number(r)),c.current=f.current=null)},children:[e.jsxs("div",{className:"flex justify-between gap-3 mb-1 text-xs",children:[y===r&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-brand-brown/70",children:"Move selected to:"}),e.jsxs("select",{className:"border border-cream-border rounded px-1 py-0.5",onChange:t=>{const n=t.target.value;n&&pe(r,n)},defaultValue:"",children:[e.jsx("option",{value:"",disabled:!0,children:"Day..."}),Object.keys(l.days).sort((t,n)=>Number(t)-Number(n)).filter(t=>t!==r).map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsxs("div",{className:"flex gap-3",children:[!I&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>fe(r),className:"underline text-brand-brown/70 hover:text-brand-brown",children:y===r?"Exit bulk select":"Bulk select"}),e.jsx("button",{onClick:()=>ge(r),className:"underline text-brand-brown/70 hover:text-brand-brown",children:m===r?"Finish reorder":"Reorder"})]}),I&&e.jsx("span",{className:"text-brand-brown/50",children:"Actions disabled in search"})]})]}),(l.days[r]||[]).filter(t=>!(te&&t._aiSource)).filter(t=>{if(!I)return!0;const n=T.trim().toLowerCase();return(t.title||"").toLowerCase().includes(n)||(t.subtitle||"").toLowerCase().includes(n)}).map((t,n)=>{const a=t._basketSource,o=m===r&&c.current&&c.current.day===r&&c.current.index===n;return e.jsxs("div",{role:"listitem","aria-label":t.title,"aria-grabbed":m===r?o:void 0,tabIndex:m===r?0:-1,className:"relative group outline-none "+(m===r?"ring-1 ring-transparent ":"")+(o?" opacity-40":""),onKeyDown:s=>{if(m!==r)return;const i=s.key;if(i===" "){if(s.preventDefault(),c.current&&c.current.day===r&&c.current.index===n){c.current=null,L("Cancelled drag");return}c.current={day:r,index:n},L(`Picked up ${t.title}`)}else if(i==="Escape")c.current&&(c.current=null,L("Cancelled drag"),s.preventDefault());else if(i==="Enter")c.current&&f.current&&f.current.day===r&&(ie(),s.preventDefault());else if(i==="ArrowUp"||i==="ArrowDown"){if(!c.current||c.current.day!==r)return;s.preventDefault();const b=c.current.index,v=(l.days[r]||[]).length,_=b+(i==="ArrowUp"?-1:1);if(_<0||_>=v)return;f.current={day:r,index:_},R(Z=>{const z=[...Z.days[r]||[]],[Ne]=z.splice(b,1);z.splice(_,0,Ne),c.current={day:r,index:_};const ce=z.filter(W=>W._basketSource).map(W=>W.id);return ce.length&&C(ce),{...Z,days:{...Z.days,[r]:z}}},"keyboard-drag"),L(`Moved to position ${_+1} in day ${r}`)}},onDragEnter:s=>je(s,r,n),onDragEnd:ie,children:[m===r&&e.jsx("div",{draggable:!0,onDragStart:s=>ve(s,r,n),className:"absolute -left-5 top-2 w-3 h-3 cursor-grab active:cursor-grabbing flex items-center justify-center text-[9px] text-brand-brown/60",title:"Drag to reorder",children:"☰"}),y===r&&e.jsx("div",{className:"absolute -left-6 top-2",children:e.jsx("input",{type:"checkbox",checked:E[r]?.has(t.id)||!1,onChange:()=>ye(r,t.id)})}),e.jsx(Le,{title:t.title,subtitle:t.subtitle,time:t.time}),t._aiSource&&e.jsx("span",{className:"absolute right-1 bottom-1 text-[9px] tracking-wide px-1.5 py-0.5 rounded bg-brand-orange text-white/95 font-semibold uppercase shadow-sm",children:"Suggested"}),c.current&&m===r&&f.current&&f.current.day===r&&f.current.index===n&&c.current.index!==n&&e.jsx("div",{className:"absolute -inset-1 border-2 border-dashed border-brand-brown rounded pointer-events-none","aria-hidden":"true"}),e.jsx("div",{className:"absolute left-1 top-1 text-[10px] px-1 py-0.5 rounded bg-white/80 border border-cream-border text-brand-brown/70",children:t.price>0?"PAID":"INCLUDED"}),m===r&&e.jsxs("div",{className:"absolute right-1 top-1 flex flex-col gap-1 opacity-70 group-hover:opacity-100",children:[e.jsx("button",{"aria-label":"Move up",className:"text-[10px] px-1 py-0.5 rounded bg-white border border-cream-border",onClick:()=>{R(s=>{const i=[...s.days[r]||[]];if(n===0)return s;const b=i[n-1];i[n-1]=i[n],i[n]=b;const v=i.filter(D=>D._basketSource).map(D=>D.id);return C(v),{...s,days:{...s.days,[r]:i}}},"keyboard-reorder-up")},children:"↑"}),e.jsx("button",{"aria-label":"Move down",className:"text-[10px] px-1 py-0.5 rounded bg-white border border-cream-border",onClick:()=>{R(s=>{const i=[...s.days[r]||[]];if(n===i.length-1)return s;const b=i[n+1];i[n+1]=i[n],i[n]=b;const v=i.filter(D=>D._basketSource).map(D=>D.id);return C(v),{...s,days:{...s.days,[r]:i}}},"keyboard-reorder-down")},children:"↓"})]}),a&&e.jsxs("div",{className:"mt-1 flex items-center gap-2 text-xs text-brand-brown/70",children:[e.jsx("label",{children:"Day:"}),e.jsx("select",{className:"border border-cream-border rounded px-1 py-0.5 bg-white",value:t.day||r,onChange:s=>{const i=s.target.value;F(l,"change-item-day"),S(t.id,Number(i))},children:Object.keys(l.days).sort((s,i)=>Number(s)-Number(i)).map(s=>e.jsx("option",{value:s,children:s},s))}),e.jsx("button",{className:"ml-2 text-red-600 hover:underline",onClick:()=>{F(l,"remove-linked"),M(t.id)},title:"Remove from itinerary (removes from basket)",children:"Remove"})]}),!a&&e.jsx("div",{className:"mt-1 flex items-center gap-2 text-[11px] text-brand-brown/60",children:e.jsx("button",{className:"underline",onClick:()=>P({item:t,originDay:r}),children:"Repeat on days…"})})]},n)}),e.jsx(_e,{value:l.memories?.[r]||"",onChange:t=>{d(n=>(F(n,"memory-edit"),Ee(n,r,t)))}})]},r))})})]}),e.jsxs("div",{className:"mb-8 mt-4 bg-cream rounded border border-cream-border p-4 text-sm flex items-start gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{id:"toggleLink",type:"checkbox",checked:h,onChange:r=>j(r.target.checked)}),e.jsx("label",{htmlFor:"toggleLink",className:"cursor-pointer select-none",children:"Automatically reflect selected quote experiences in itinerary progress"})]}),e.jsxs("div",{className:"flex items-center gap-2 ml-auto",children:[e.jsx("input",{id:"toggleAIHide",type:"checkbox",checked:te,onChange:r=>me(r.target.checked)}),e.jsx("label",{htmlFor:"toggleAIHide",className:"cursor-pointer select-none text-xs",children:"Hide suggested items"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("div",{className:"md:col-span-2",children:e.jsx(Ae,{items:le,currency:"USD"})}),e.jsx("div",{className:"flex items-start",children:e.jsx(Me,{items:le,currency:"USD"})})]})]}),e.jsx("div",{"aria-live":"polite","aria-atomic":"true",className:"sr-only",ref:O}),U&&ee.length>0&&e.jsx("div",{className:"fixed bottom-4 left-1/2 -translate-x-1/2 z-50 flex flex-col gap-2 w-[90%] max-w-sm",children:ee.map(r=>e.jsxs("div",{className:"pointer-events-auto bg-brand-brown text-white text-sm rounded shadow px-3 py-2 flex items-start gap-3 "+(re?"toast-fade":""),"aria-live":"off","aria-hidden":"true",children:[e.jsx("div",{className:"flex-1 break-words",children:r.msg}),e.jsx("button",{onClick:()=>J(t=>t.filter(n=>n.id!==r.id)),className:"text-white/70 hover:text-white focus:outline-none focus:ring-1 focus:ring-white rounded","aria-label":"Dismiss notification",children:"×"})]},r.id))}),e.jsxs("div",{className:"fixed bottom-4 right-4 z-40 flex flex-col gap-2 items-end",children:[e.jsx("button",{disabled:!p.current.length,onClick:se,className:"px-3 py-2 rounded shadow text-sm font-medium transition-colors "+(p.current.length?"bg-brand-brown text-white hover:bg-brand-brown/90":"bg-gray-300 text-gray-500 cursor-not-allowed"),title:p.current.length?`Undo (${p.current[p.current.length-1].label||"change"}) – Ctrl/Cmd+Z`:"Nothing to undo",children:"Undo"}),e.jsx("button",{disabled:!k.current.length,onClick:ae,className:"px-3 py-2 rounded shadow text-sm font-medium transition-colors "+(k.current.length?"bg-brand-brown text-white hover:bg-brand-brown/90":"bg-gray-300 text-gray-500 cursor-not-allowed"),title:k.current.length?`Redo (${k.current[k.current.length-1].label||"change"}) – Ctrl/Cmd+Shift+Z`:"Nothing to redo",children:"Redo"}),e.jsx("button",{onClick:()=>he(r=>!r),className:"px-3 py-2 rounded shadow text-sm font-medium bg-white/90 border border-cream-border hover:bg-white",children:ne?"Hide History":"History"}),ne&&e.jsxs("div",{className:"mt-1 w-56 max-h-60 overflow-auto bg-white border border-cream-border rounded shadow text-xs p-2 space-y-1",children:[e.jsx("div",{className:"font-semibold mb-1",children:"Undo Stack (latest first)"}),p.current.slice().reverse().slice(0,10).map((r,t)=>{const n=p.current.length-1-t;return e.jsxs("button",{onClick:()=>{const a=JSON.parse(JSON.stringify(l));k.current.push({trip:a,label:"jump-from-history"});const o=p.current[n];p.current=p.current.slice(0,n),d(o.trip),$(s=>s+1)},className:"w-full text-left px-2 py-1 rounded hover:bg-cream focus:outline-none focus:ring-1 focus:ring-brand-brown",children:[n+1,". ",r.label||"change"]},n)}),!p.current.length&&e.jsx("div",{className:"text-brand-brown/60 italic",children:"Empty"})]})]}),B&&e.jsxs(Oe,{title:"Repeat Item on Additional Days",onClose:()=>{P(null),H("")},actions:[e.jsx("button",{onClick:()=>{P(null),H("")},className:"px-3 py-1 rounded border border-cream-border hover:bg-cream-sand text-sm",children:"Cancel"},"cancel"),e.jsx("button",{onClick:()=>{const r=G.split(/[,\s]+/).map(n=>n.trim()).filter(Boolean),t=Array.from(new Set(r));t.length&&(R(n=>{const a={...n,days:{...n.days}};return t.forEach(o=>{const s=Number(o);if(!Number.isFinite(s)||s<=0)return;const i=String(s),b=a.days[i]||[];b.some(v=>v.id===B.item.id)||(a.days[i]=[...b,{...B.item}])}),a},"repeat-multi-day"),P(null),H(""))},className:"px-3 py-1 rounded bg-brand-brown text-white text-sm hover:bg-brand-brown/90",children:"Apply"},"apply")],children:[e.jsx("p",{className:"text-sm mb-3",children:"Enter additional day numbers (comma or space separated). Existing occurrences are skipped."}),e.jsx("input",{autoFocus:!0,value:G,onChange:r=>H(r.target.value),placeholder:"e.g. 2, 4 5",className:"w-full border border-cream-border rounded px-2 py-1 text-sm mb-3"}),e.jsxs("p",{className:"text-xs text-brand-brown/60",children:["Invalid or duplicate day values are ignored. Original day: ",B.originDay]})]})]})}function Te({highContrastFocus:l,setHighContrastFocus:d,enableToasts:h,setEnableToasts:j,animationsEnabled:w,setAnimationsEnabled:S}){const[M,C]=Y.useState(!1),c=Y.useRef(null),f=Y.useRef(null);function m(){try{localStorage.removeItem("itineraryHighContrastFocus:v1"),localStorage.removeItem("itineraryEnableToasts:v1"),localStorage.removeItem("itineraryReorderDay:v1"),localStorage.removeItem("itineraryBulkModeDay:v1"),localStorage.removeItem("itineraryAnimations:v1"),d(!1),j(!0),S(!0)}catch{}}return u.useEffect(()=>{if(M){let x=function(N){N.key==="Escape"&&(C(!1),f.current?.focus()),N.key==="Tab"&&y&&y.length&&(N.shiftKey&&document.activeElement===g?(N.preventDefault(),E.focus()):!N.shiftKey&&document.activeElement===E&&(N.preventDefault(),g.focus()))};const y=c.current?.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'),g=y?.[0],E=y?.[y.length-1];return g&&g.focus(),document.addEventListener("keydown",x),()=>document.removeEventListener("keydown",x)}},[M]),e.jsxs("div",{className:"relative",children:[e.jsx("button",{ref:f,onClick:()=>C(x=>!x),"aria-haspopup":"dialog","aria-expanded":M,className:"px-3 py-2 rounded border border-brand-brown text-brand-brown hover:bg-brand-brown/10 text-sm",children:"Preferences"}),M&&e.jsxs("div",{ref:c,role:"dialog","aria-label":"Itinerary preferences",className:"absolute right-0 mt-2 w-64 bg-white border border-cream-border rounded shadow p-3 z-50 text-sm space-y-3",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:l,onChange:x=>d(x.target.checked)}),e.jsx("span",{children:"High contrast focus outlines"})]}),e.jsx("p",{className:"text-[11px] text-brand-brown/60 mt-1",children:"Improves keyboard navigability."})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:h,onChange:x=>j(x.target.checked)}),e.jsx("span",{children:"Enable visual toasts"})]}),e.jsx("p",{className:"text-[11px] text-brand-brown/60 mt-1",children:"Mirrors screen reader announcements."})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:w,onChange:x=>S(x.target.checked)}),e.jsx("span",{children:"Motion animations"})]}),e.jsx("p",{className:"text-[11px] text-brand-brown/60 mt-1",children:"Disable to reduce visual motion."})]}),e.jsxs("div",{className:"flex justify-end",children:[e.jsx("button",{onClick:m,className:"mr-auto text-[10px] underline text-brand-brown/60 hover:text-brand-brown",title:"Reset all itinerary preferences to defaults",children:"Reset"}),e.jsx("button",{onClick:()=>C(!1),className:"text-xs underline text-brand-brown/70 hover:text-brand-brown",children:"Close"})]})]})]})}export{Ve as default};
