import{a as S,r as m,j as e}from"./index-E_l07fEO.js";import{u as R}from"./useBasketState-Oi3ySvlX.js";import{u as E,g as I}from"./pdfGenerators-pPwcPHZM.js";import{f as d}from"./currency-SRo7-frQ.js";import"./useLocalStorageState-B5CzfI59.js";import"./jspdf.es.min-GZClMTNp.js";function B(){const{quotes:u,createQuote:b,updateQuote:t,addItem:c,updateItem:n,removeItem:h,computeTotals:g,setStatus:j}=E(),{paidItems:i}=R(),o=S(),l=new URLSearchParams(o.search).get("edit"),[x,N]=m.useState(l||null),[f,w]=m.useState(!1);m.useEffect(()=>{if(!x){const r=b({});N(r),w(!0),!l&&o.state?.fromBasket&&i.length&&i.forEach(s=>{c(r,{title:s.title,description:s.description,category:s.category,unitPrice:s.price,quantity:s.quantity||1})})}},[x,b,l,o.state,i,c]);const a=u.find(r=>r.id===x);function y(){a&&c(a.id,{title:"New Line Item",unitPrice:0,quantity:1})}function v(){a&&I(a)}if(!a)return e.jsx("div",{className:"p-6",children:"Loading Quote..."});const{subtotal:C,discount:p,tax:k,total:D}=g(a);return e.jsxs("div",{className:"px-6 py-8 text-brand-brown max-w-5xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h1",{className:"text-3xl font-bold",children:l?"Edit Quote":"New Quote"}),e.jsx("div",{className:"flex gap-2",children:e.jsx("button",{onClick:v,className:"px-3 py-2 rounded border border-brand-brown text-brand-brown hover:bg-cream-hover",children:"Export PDF"})})]}),f&&e.jsx("p",{className:"text-sm text-brand-brown/70 mb-4",children:"A draft quote was created â€” fill in details below."}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-3 mb-8",children:[e.jsxs("div",{className:"space-y-4 md:col-span-2",children:[e.jsxs("div",{className:"bg-cream rounded border border-cream-border p-4 space-y-3",children:[e.jsx("h2",{className:"font-semibold mb-2",children:"Quote Details"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-xs uppercase tracking-wide text-brand-brown/70",children:"Client Name"}),e.jsx("input",{value:a.clientName,onChange:r=>t(a.id,{clientName:r.target.value}),className:"px-2 py-1 rounded border border-cream-border bg-white"})]}),e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-xs uppercase tracking-wide text-brand-brown/70",children:"Client Email"}),e.jsx("input",{type:"email",value:a.clientEmail||"",onChange:r=>t(a.id,{clientEmail:r.target.value}),className:"px-2 py-1 rounded border border-cream-border bg-white"})]}),e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-xs uppercase tracking-wide text-brand-brown/70",children:"Currency"}),e.jsxs("select",{value:a.currency,onChange:r=>t(a.id,{currency:r.target.value}),className:"px-2 py-1 rounded border border-cream-border bg-white",children:[e.jsx("option",{value:"USD",children:"USD"}),e.jsx("option",{value:"EUR",children:"EUR"}),e.jsx("option",{value:"ZAR",children:"ZAR"}),e.jsx("option",{value:"GBP",children:"GBP"})]})]}),e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-xs uppercase tracking-wide text-brand-brown/70",children:"Quote Number"}),e.jsx("input",{value:a.quoteNumber||"",readOnly:!0,className:"px-2 py-1 rounded border border-cream-border bg-white text-brand-brown/60"})]}),e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-xs uppercase tracking-wide text-brand-brown/70",children:"Tax Rate (%)"}),e.jsx("input",{type:"number",min:"0",value:a.taxRate,onChange:r=>t(a.id,{taxRate:Number(r.target.value)}),className:"px-2 py-1 rounded border border-cream-border bg-white"})]}),e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-xs uppercase tracking-wide text-brand-brown/70",children:"Discount (%)"}),e.jsx("input",{type:"number",min:"0",max:"100",value:a.discountRate||0,onChange:r=>t(a.id,{discountRate:Number(r.target.value)}),className:"px-2 py-1 rounded border border-cream-border bg-white"})]}),e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-xs uppercase tracking-wide text-brand-brown/70",children:"Status"}),e.jsxs("select",{value:a.status,onChange:r=>j(a.id,r.target.value),className:"px-2 py-1 rounded border border-cream-border bg-white",children:[e.jsx("option",{children:"Draft"}),e.jsx("option",{children:"Sent"}),e.jsx("option",{children:"Accepted"}),e.jsx("option",{children:"Declined"})]})]}),e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-xs uppercase tracking-wide text-brand-brown/70",children:"Due Date"}),e.jsx("input",{type:"date",value:a.dueDate||"",onChange:r=>t(a.id,{dueDate:r.target.value}),className:"px-2 py-1 rounded border border-cream-border bg-white"})]})]}),e.jsxs("label",{className:"flex flex-col gap-1 text-sm",children:[e.jsx("span",{className:"text-xs uppercase tracking-wide text-brand-brown/70",children:"Internal / Client Notes"}),e.jsx("textarea",{rows:3,value:a.notes,onChange:r=>t(a.id,{notes:r.target.value}),className:"px-2 py-1 rounded border border-cream-border bg-white"})]})]}),e.jsxs("div",{className:"bg-cream rounded border border-cream-border p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h2",{className:"font-semibold",children:"Line Items"}),e.jsx("button",{onClick:y,className:"px-2 py-1 text-xs rounded border border-brand-brown text-brand-brown hover:bg-cream-hover",children:"Add Item"})]}),a.items.length===0&&e.jsx("p",{className:"text-sm text-brand-brown/60",children:"No items yet. Add your first line."}),e.jsx("ul",{className:"space-y-3",children:a.items.map(r=>e.jsx("li",{className:"bg-white rounded border border-cream-border p-3",children:e.jsxs("div",{className:"grid md:grid-cols-5 gap-3 text-sm",children:[e.jsxs("label",{className:"flex flex-col gap-1 md:col-span-2",children:[e.jsx("span",{className:"text-[10px] uppercase tracking-wide text-brand-brown/60",children:"Title"}),e.jsx("input",{value:r.title,onChange:s=>n(a.id,r.id,{title:s.target.value}),className:"px-2 py-1 rounded border border-cream-border bg-cream-sand"})]}),e.jsxs("label",{className:"flex flex-col gap-1 md:col-span-2",children:[e.jsx("span",{className:"text-[10px] uppercase tracking-wide text-brand-brown/60",children:"Description"}),e.jsx("input",{value:r.description||"",onChange:s=>n(a.id,r.id,{description:s.target.value}),className:"px-2 py-1 rounded border border-cream-border bg-cream-sand"})]}),e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-[10px] uppercase tracking-wide text-brand-brown/60",children:"Category"}),e.jsx("input",{value:r.category||"",onChange:s=>n(a.id,r.id,{category:s.target.value}),className:"px-2 py-1 rounded border border-cream-border bg-cream-sand"})]}),e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-[10px] uppercase tracking-wide text-brand-brown/60",children:"Unit Price"}),e.jsx("input",{type:"number",min:"0",value:r.unitPrice,onChange:s=>n(a.id,r.id,{unitPrice:Number(s.target.value)}),className:"px-2 py-1 rounded border border-cream-border bg-cream-sand"})]}),e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-[10px] uppercase tracking-wide text-brand-brown/60",children:"Qty"}),e.jsx("input",{type:"number",min:"1",value:r.quantity,onChange:s=>n(a.id,r.id,{quantity:Number(s.target.value)}),className:"px-2 py-1 rounded border border-cream-border bg-cream-sand"})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-[10px] uppercase tracking-wide text-brand-brown/60",children:"Line Total"}),e.jsx("div",{className:"px-2 py-1 rounded bg-cream-sand border border-cream-border",children:d(Number(r.unitPrice)*Number(r.quantity||1),a.currency)})]}),e.jsx("div",{className:"flex items-end",children:e.jsx("button",{onClick:()=>h(a.id,r.id),className:"mt-auto px-2 py-1 text-xs rounded bg-red-500 text-white hover:bg-red-400",children:"Remove"})})]})},r.id))})]})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"bg-cream rounded border border-cream-border p-4 text-sm",children:[e.jsx("h2",{className:"font-semibold mb-2",children:"Summary"}),e.jsxs("div",{className:"flex justify-between py-1",children:[e.jsx("span",{className:"text-brand-brown/70",children:"Subtotal"}),e.jsx("span",{children:d(C,a.currency)})]}),p>0&&e.jsxs("div",{className:"flex justify-between py-1",children:[e.jsxs("span",{className:"text-brand-brown/70",children:["Discount (",a.discountRate||0,"%)"]}),e.jsxs("span",{children:["-",d(p,a.currency)]})]}),a.taxRate>0&&e.jsxs("div",{className:"flex justify-between py-1",children:[e.jsxs("span",{className:"text-brand-brown/70",children:["Tax (",a.taxRate,"%)"]}),e.jsx("span",{children:d(k,a.currency)})]}),e.jsxs("div",{className:"flex justify-between py-1 font-semibold border-t border-cream-border mt-2 pt-2",children:[e.jsx("span",{children:"Total"}),e.jsx("span",{children:d(D,a.currency)})]}),e.jsxs("p",{className:"text-[11px] text-brand-brown/60 mt-3",children:["Status: ",e.jsx("span",{className:"font-medium",children:a.status})]}),e.jsxs("p",{className:"text-[11px] text-brand-brown/60",children:["Created: ",new Date(a.createdAt).toLocaleString()]}),e.jsxs("p",{className:"text-[11px] text-brand-brown/60",children:["Updated: ",new Date(a.updatedAt).toLocaleString()]}),a.dueDate&&e.jsxs("p",{className:"text-[11px] text-brand-brown/60",children:["Due: ",new Date(a.dueDate).toLocaleDateString()]})]})})]})]})}export{B as default};
