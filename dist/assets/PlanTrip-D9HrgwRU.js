import{r as i,j as r,a as hr,u as gr,P as k,s as Be,b as yr,c as qe,d as ze,g as fr,L as T,p as vr,e as wr,f as jr,h as Nr}from"./index-E_l07fEO.js";import{A as Cr}from"./AutoSyncBanner-HMD482kt.js";import{u as Sr,L as Lr,c as Mr}from"./useTripState-B35c8IxU.js";import{u as kr}from"./useBasketState-Oi3ySvlX.js";import{f as oe}from"./currency-SRo7-frQ.js";import"./useLocalStorageState-B5CzfI59.js";function he(f=[],u="dateAsc"){const v=Array.isArray(f)?f.slice():[],d=b=>{const h=Date.parse(b);return Number.isFinite(h)?h:NaN},p=u!=="dateDesc";return v.map(b=>({e:b,t:d(b?.date)})).sort((b,h)=>{const m=b.t,w=h.t,j=Number.isNaN(m),C=Number.isNaN(w);return j&&C?0:j?1:C?-1:p?m-w:w-m}).map(b=>b.e)}function Pr(f=[],u=[],v="dateAsc"){return he([...f||[],...u||[]],v)}function $r({open:f,onClose:u,onSave:v,initial:d={}}){const[p,b]=i.useState(d.city||""),[h,m]=i.useState(d.province||""),[w,j]=i.useState(d.country||"");return f?r.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/30",children:r.jsxs("div",{className:"bg-white rounded shadow-lg border border-cream-border w-[min(28rem,92vw)] p-4",children:[r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsx("h3",{className:"font-semibold",children:"Set My Location"}),r.jsx("button",{onClick:u,"aria-label":"Close",className:"text-brand-brown/70 hover:text-brand-brown",children:"âœ•"})]}),r.jsx("p",{className:"text-sm text-brand-brown/70 mb-3",children:"This helps us apply â€œNear meâ€ filters quickly."}),r.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2 mb-3",children:[r.jsx("input",{value:p,onChange:C=>b(C.target.value),placeholder:"City",className:"px-2 py-1 border border-cream-border rounded"}),r.jsx("input",{value:h,onChange:C=>m(C.target.value),placeholder:"Province/State",className:"px-2 py-1 border border-cream-border rounded"}),r.jsx("input",{value:w,onChange:C=>j(C.target.value),placeholder:"Country",className:"px-2 py-1 border border-cream-border rounded"})]}),r.jsxs("div",{className:"flex items-center justify-end gap-2",children:[r.jsx("button",{onClick:u,className:"text-sm px-3 py-1 rounded border border-cream-border bg-white hover:bg-cream-hover",children:"Cancel"}),r.jsx("button",{onClick:()=>v({city:p.trim(),province:h.trim(),country:w.trim()}),className:"text-sm px-3 py-1 rounded border border-brand-brown bg-brand-brown text-cream hover:bg-brand-brown/90",children:"Save"})]})]})}):null}const Or={0:{text:"Clear",icon:"â˜€ï¸"},1:{text:"Mainly clear",icon:"ğŸŒ¤ï¸"},2:{text:"Partly cloudy",icon:"â›…"},3:{text:"Overcast",icon:"â˜ï¸"},45:{text:"Fog",icon:"ğŸŒ«ï¸"},48:{text:"Depositing rime fog",icon:"ğŸŒ«ï¸"},51:{text:"Light drizzle",icon:"ğŸŒ¦ï¸"},53:{text:"Moderate drizzle",icon:"ğŸŒ¦ï¸"},55:{text:"Dense drizzle",icon:"ğŸŒ§ï¸"},56:{text:"Light freezing drizzle",icon:"ğŸŒ§ï¸"},57:{text:"Dense freezing drizzle",icon:"ğŸŒ§ï¸"},61:{text:"Slight rain",icon:"ğŸŒ¦ï¸"},63:{text:"Moderate rain",icon:"ğŸŒ§ï¸"},65:{text:"Heavy rain",icon:"ğŸŒ§ï¸"},66:{text:"Light freezing rain",icon:"ğŸŒ§ï¸"},67:{text:"Heavy freezing rain",icon:"ğŸŒ§ï¸"},71:{text:"Slight snow",icon:"ğŸŒ¨ï¸"},73:{text:"Moderate snow",icon:"ğŸŒ¨ï¸"},75:{text:"Heavy snow",icon:"â„ï¸"},77:{text:"Snow grains",icon:"â„ï¸"},80:{text:"Rain showers (slight)",icon:"ğŸŒ¦ï¸"},81:{text:"Rain showers (moderate)",icon:"ğŸŒ§ï¸"},82:{text:"Rain showers (violent)",icon:"â›ˆï¸"},85:{text:"Snow showers (slight)",icon:"ğŸŒ¨ï¸"},86:{text:"Snow showers (heavy)",icon:"â„ï¸"},95:{text:"Thunderstorm",icon:"â›ˆï¸"},96:{text:"Thunderstorm with hail (slight)",icon:"â›ˆï¸"},99:{text:"Thunderstorm with hail (heavy)",icon:"â›ˆï¸"}};function We(f){return Or[f]||{text:"Unknown",icon:"â˜ï¸"}}const Ge=600*1e3,He=new Map,Je=new Map;async function Er(f,u){const v=`${(f||"").toLowerCase()}|${(u||"").toLowerCase()}`,d=He.get(v);if(d&&Date.now()-d.ts<Ge)return d.data;const p=new URL("https://geocoding-api.open-meteo.com/v1/search");p.searchParams.set("name",f),p.searchParams.set("count","1"),p.searchParams.set("language","en"),p.searchParams.set("format","json"),u&&p.searchParams.set("country",u);const b=await fetch(p.toString());if(!b.ok)throw new Error("Failed to geocode");const h=await b.json(),m=Array.isArray(h.results)&&h.results[0];if(!m)throw new Error("Location not found");const w={lat:m.latitude,lon:m.longitude,name:m.name,country_code:m.country_code};return He.set(v,{data:w,ts:Date.now()}),w}async function Tr(f,u,v=5){const d=`${f}|${u}|${v}`,p=Je.get(d);if(p&&Date.now()-p.ts<Ge)return p.data;const b=new URL("https://api.open-meteo.com/v1/forecast");b.searchParams.set("latitude",String(f)),b.searchParams.set("longitude",String(u)),b.searchParams.set("current","temperature_2m,apparent_temperature,relative_humidity_2m,weather_code,wind_speed_10m"),b.searchParams.set("daily","weather_code,temperature_2m_max,temperature_2m_min,uv_index_max,precipitation_probability_max,precipitation_sum"),b.searchParams.set("forecast_days",String(v)),b.searchParams.set("timezone","auto");const h=await fetch(b.toString());if(!h.ok)throw new Error("Failed to fetch weather");const m=await h.json(),w=m.current||{},j=m.daily||{},C={current:{temp:w.temperature_2m,feelsLike:w.apparent_temperature,humidity:w.relative_humidity_2m,wind:w.wind_speed_10m,code:w.weather_code,...We(w.weather_code)},forecast:[]},q=Math.min((j.time||[]).length,v);for(let M=0;M<q;M++){const Q=(j.weather_code||[])[M];C.forecast.push({date:j.time[M],tmin:(j.temperature_2m_min||[])[M],tmax:(j.temperature_2m_max||[])[M],uvMax:(j.uv_index_max||[])[M],popMax:(j.precipitation_probability_max||[])[M],precipSum:(j.precipitation_sum||[])[M],code:Q,...We(Q)})}return Je.set(d,{data:C,ts:Date.now()}),C}async function Ar(f,u){const{lat:v,lon:d,name:p}=await Er(f,u),b=await Tr(v,d,5);return{locationName:p,...b}}function _r({city:f,country:u}){const[v,d]=i.useState({loading:!1,error:"",data:null});if(i.useEffect(()=>{let m=!0;async function w(){if(!f&&!u){d({loading:!1,error:"",data:null});return}d(j=>({...j,loading:!0,error:""}));try{const j=f||"",C=u||"",q=await Ar(j||C,C||void 0);if(!m)return;d({loading:!1,error:"",data:q})}catch{if(!m)return;d({loading:!1,error:"Could not load weather",data:null})}}return w(),()=>{m=!1}},[f,u]),!f&&!u)return null;const{loading:p,error:b,data:h}=v;return r.jsxs("div",{className:"mb-4 p-3 rounded border border-cream-border bg-cream flex items-center justify-between gap-3",children:[r.jsxs("div",{className:"min-w-0",children:[r.jsxs("div",{className:"text-sm font-semibold",children:["Weather ",h?.locationName?`â€¢ ${h.locationName}`:f||u||""]}),p&&r.jsx("div",{className:"text-[12px] text-brand-brown/60",children:"Loadingâ€¦"}),b&&r.jsx("div",{role:"alert",className:"text-[12px] text-red-600",children:b}),h&&r.jsxs("div",{className:"text-[12px] text-brand-brown/80 flex items-center gap-2 flex-wrap",children:[r.jsxs("span",{className:"px-1 py-0.5 rounded bg-white border border-cream-border",children:[h.current.icon," ",Math.round(h.current.temp),"Â°C"]}),r.jsxs("span",{className:"hidden sm:inline",children:[h.current.text," â€¢ wind ",Math.round(h.current.wind)," km/h"]}),Number.isFinite(h.current.feelsLike)&&r.jsxs("span",{className:"px-1 py-0.5 rounded bg-white border border-cream-border",children:["feels ",Math.round(h.current.feelsLike),"Â°C"]}),Number.isFinite(h.current.humidity)&&r.jsxs("span",{className:"px-1 py-0.5 rounded bg-white border border-cream-border",children:["humidity ",Math.round(h.current.humidity),"%"]})]})]}),h&&r.jsx("div",{className:"flex items-center gap-2 overflow-x-auto",children:h.forecast.map(m=>r.jsxs("div",{className:"text-center px-2 py-1 rounded bg-white border border-cream-border min-w-[72px]",children:[r.jsx("div",{className:"text-[10px] text-brand-brown/60",children:new Date(m.date).toLocaleDateString(void 0,{weekday:"short"})}),r.jsx("div",{className:"text-[16px]",children:m.icon}),r.jsxs("div",{className:"text-[11px] text-brand-brown/70",children:[Math.round(m.tmin),"â€“",Math.round(m.tmax),"Â°C"]}),r.jsxs("div",{className:"mt-0.5 flex items-center justify-center gap-1",children:[Number.isFinite(m.popMax)&&r.jsxs("span",{className:"text-[10px] text-brand-brown/60 px-1 py-0.5 rounded bg-cream-sand border border-cream-border",title:"Max precipitation probability",children:[Math.round(m.popMax),"%"]}),Number.isFinite(m.uvMax)&&r.jsxs("span",{className:"text-[10px] text-brand-brown/60 px-1 py-0.5 rounded bg-cream-sand border border-cream-border",title:"Max UV index",children:["UV ",Math.round(m.uvMax)]})]})]},m.date))})]})}function qr(){const[f]=Sr(),[u,v]=i.useState(""),d=hr(),p=gr(),[b,h]=i.useState(null),{basket:m,addToBasket:w,removeFromBasket:j,updateQuantity:C,updateDay:q,paidItems:M,clearBasket:Q}=kr(),[ge,V]=i.useState(""),[ye,Y]=i.useState(""),[fe,ce]=i.useState(!1),[Ke,ie]=i.useState([]),A=i.useRef(null),[le,Z]=i.useState(""),[de,_]=i.useState(""),[X,me]=i.useState(""),[ve,we]=i.useState(()=>{try{return JSON.parse(localStorage.getItem("planTripPresets:v1")||"[]")}catch{return[]}}),[je,Qe]=i.useState(""),[Ne,Ce]=i.useState(()=>{try{return JSON.parse(localStorage.getItem("planTripRecentFilters:v1")||"[]")}catch{return[]}}),[Se,Le]=i.useState([]),[N,Ve]=i.useState(()=>{try{return localStorage.getItem("tripSimpleMode")==="1"}catch{return!1}}),[E,Ye]=i.useState(()=>{try{return localStorage.getItem("catalogSort:v1")||"relevance"}catch{return"relevance"}});i.useEffect(()=>{try{localStorage.setItem("catalogSort:v1",E)}catch{}},[E]);const[Ze,Xe]=i.useState(()=>{try{return localStorage.getItem("showWeather")!=="0"}catch{return!0}}),[ee,er]=i.useState(()=>{try{return localStorage.getItem("weatherCollapsed")==="1"}catch{return!1}});i.useEffect(()=>{function e(a){a&&a.key==="showWeather"&&Xe(a.newValue!=="0")}return window.addEventListener("storage",e),()=>window.removeEventListener("storage",e)},[]);function rr(){const e=!N;Ve(e);try{localStorage.setItem("tripSimpleMode",e?"1":"0")}catch{}}function S(e,a="info",o=2e3){const s=Math.random().toString(36).slice(2);Le(n=>[...n,{id:s,text:e,type:a}]),setTimeout(()=>Le(n=>n.filter(c=>c.id!==s)),o)}i.useEffect(()=>{const a=new URLSearchParams(d.search).get("q");a&&v(a)},[d.search]);const t=i.useMemo(()=>{const e=new URLSearchParams(d.search);return{continent:e.get("continent")||"",country:e.get("country")||"",province:e.get("province")||"",city:e.get("city")||"",area:e.get("area")||"",category:e.get("category")||"",priceMin:e.get("priceMin")||"",priceMax:e.get("priceMax")||"",paidOnly:e.get("paidOnly")==="1",freeOnly:e.get("freeOnly")==="1"}},[d.search]);i.useEffect(()=>{try{localStorage.setItem("lastLocFilters",JSON.stringify(t))}catch{}},[t]),i.useEffect(()=>{const e=t,a=["continent","country","province","city","area","category","priceMin","priceMax","paidOnly","freeOnly"];if(!a.some(n=>{const c=e[n];return(typeof c=="boolean"?c?"1":"":String(c||"").trim())!==""}))return;const s=a.map(n=>{const c=e[n],g=typeof c=="boolean"?c?"1":"":String(c||"").trim().toLowerCase();return`${n}=${encodeURIComponent(g)}`}).join("&");Ce(n=>{const g=[s,...n.map(y=>y.signature)].filter((y,l,L)=>L.indexOf(y)===l).slice(0,6).map(y=>({signature:y,filters:Object.fromEntries(y.split("&").map(l=>{const[L,U]=l.split("=");return[L,U?decodeURIComponent(U):""]}))}));try{localStorage.setItem("planTripRecentFilters:v1",JSON.stringify(g))}catch{}return g})},[t.continent,t.country,t.province,t.city,t.area,t.category,t.priceMin,t.priceMax,t.paidOnly,t.freeOnly]);function Me(e){const a=["continent","country","province","city","area","category","priceMin","priceMax","paidOnly","freeOnly"],o=new URLSearchParams(d.search);a.forEach(s=>{let n=e?.[s];s==="paidOnly"?n=e?.paidOnly?"1":"":s==="freeOnly"?n=e?.freeOnly?"1":"":n=(n||"").trim(),n?o.set(s,n):o.delete(s)}),p({search:o.toString()?`?${o.toString()}`:""},{replace:!0})}function tr(){const e=(je||"").trim();if(!e){S("Enter a preset name","warn");return}const a={name:e,filters:t};we(o=>{const n=[...o.filter(c=>c.name!==e),a].sort((c,g)=>c.name.localeCompare(g.name));try{localStorage.setItem("planTripPresets:v1",JSON.stringify(n))}catch{}return _("saved"),setTimeout(()=>_(""),1500),me(e),S(`Preset "${e}" saved`,"success"),n})}function ar(e){we(a=>{const o=a.filter(s=>s.name!==e);try{localStorage.setItem("planTripPresets:v1",JSON.stringify(o))}catch{}return _("deleted"),setTimeout(()=>_(""),1500),X===e&&me(""),S(`Preset "${e}" deleted`,"info"),o})}function nr(e){const a=ve.find(o=>o.name===e);a&&(Me(a.filters),_("applied"),setTimeout(()=>_(""),1200),S(`Applied preset "${e}"`,"success"))}i.useEffect(()=>{const e=new URLSearchParams(d.search);if(!["continent","country","province","city","area","category","priceMin","priceMax","paidOnly","freeOnly"].some(o=>e.get(o)))try{const o=localStorage.getItem("lastLocFilters");if(!o)return;const s=JSON.parse(o);if(!s||typeof s!="object")return;const n=new URLSearchParams;["continent","country","province","city","area","category","priceMin","priceMax"].forEach(c=>{s[c]&&n.set(c,s[c])}),s.paidOnly&&n.set("paidOnly","1"),s.freeOnly&&n.set("freeOnly","1"),[...n.keys()].length&&p({search:`?${n.toString()}`},{replace:!0})}catch{}},[]),i.useEffect(()=>{const e=new URLSearchParams(d.search),a=["continent","country","province","city","area","category","priceMin","priceMax","paidOnly","freeOnly"].some(s=>e.get(s));e.get("tab")==="events"?G("events"):a&&G("catalog")},[d.search]),i.useEffect(()=>{function e(a){if(a.key!=="/")return;const o=a.target&&a.target.tagName?a.target.tagName.toLowerCase():"";o==="input"||o==="textarea"||a.metaKey||a.ctrlKey||a.altKey||(a.preventDefault(),b&&typeof b.focus=="function"&&b.focus())}return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[b]);const D=e=>Array.from(new Set(e.filter(Boolean))),R=e=>[...e].sort((a,o)=>String(a).localeCompare(String(o),void 0,{sensitivity:"base"})),sr=i.useMemo(()=>R(D(k.map(e=>e.continent))),[]),ke=i.useMemo(()=>R(D(k.filter(e=>!t.continent||(e.continent||"").toLowerCase()===t.continent.toLowerCase()).map(e=>e.country))),[t.continent]),Pe=i.useMemo(()=>R(D(k.filter(e=>(!t.continent||(e.continent||"").toLowerCase()===t.continent.toLowerCase())&&(!t.country||(e.country||"").toLowerCase()===t.country.toLowerCase())).map(e=>e.province))),[t.continent,t.country]),$e=i.useMemo(()=>R(D(k.filter(e=>(!t.continent||(e.continent||"").toLowerCase()===t.continent.toLowerCase())&&(!t.country||(e.country||"").toLowerCase()===t.country.toLowerCase())&&(!t.province||(e.province||"").toLowerCase()===t.province.toLowerCase())).map(e=>e.city))),[t.continent,t.country,t.province]),Oe=i.useMemo(()=>R(D(k.filter(e=>(!t.continent||(e.continent||"").toLowerCase()===t.continent.toLowerCase())&&(!t.country||(e.country||"").toLowerCase()===t.country.toLowerCase())&&(!t.province||(e.province||"").toLowerCase()===t.province.toLowerCase())&&(!t.city||(e.city||"").toLowerCase()===t.city.toLowerCase())).map(e=>e.area))),[t.continent,t.country,t.province,t.city]),Ee=i.useMemo(()=>R(D(k.filter(e=>(!t.continent||(e.continent||"").toLowerCase()===t.continent.toLowerCase())&&(!t.country||(e.country||"").toLowerCase()===t.country.toLowerCase())&&(!t.province||(e.province||"").toLowerCase()===t.province.toLowerCase())&&(!t.city||(e.city||"").toLowerCase()===t.city.toLowerCase())&&(!t.area||(e.area||"").toLowerCase()===t.area.toLowerCase())).map(e=>e.category))),[t.continent,t.country,t.province,t.city,t.area]),P=i.useMemo(()=>{const e=(l,L)=>String(l||"").toLowerCase()===String(L||"").toLowerCase(),a=k,o={continent:{},country:{},province:{},city:{},area:{},category:{}};for(const l of a)l.continent&&(o.continent[l.continent]=(o.continent[l.continent]||0)+1);const s=a.filter(l=>!t.continent||e(l.continent,t.continent));for(const l of s)l.country&&(o.country[l.country]=(o.country[l.country]||0)+1);const n=s.filter(l=>!t.country||e(l.country,t.country));for(const l of n)l.province&&(o.province[l.province]=(o.province[l.province]||0)+1);const c=n.filter(l=>!t.province||e(l.province,t.province));for(const l of c)l.city&&(o.city[l.city]=(o.city[l.city]||0)+1);const g=c.filter(l=>!t.city||e(l.city,t.city));for(const l of g)l.area&&(o.area[l.area]=(o.area[l.area]||0)+1);const y=g.filter(l=>!t.area||e(l.area,t.area));for(const l of y)l.category&&(o.category[l.category]=(o.category[l.category]||0)+1);return o},[t.continent,t.country,t.province,t.city,t.area]),[re,F]=i.useState([]),[ue,te]=i.useState(!1),[pe,z]=i.useState(""),[or,W]=i.useState(1),[cr,H]=i.useState(!1),[Te,ir]=i.useState({}),[J,lr]=i.useState(()=>{try{return localStorage.getItem("includePastEvents")==="1"}catch{return!1}}),[be,dr]=i.useState(()=>{try{return localStorage.getItem("eventsSort")||"dateAsc"}catch{return"dateAsc"}});function mr(){const e=!J;lr(e);try{localStorage.setItem("includePastEvents",e?"1":"0")}catch{}}const[ae,ur]=i.useState(()=>{try{return localStorage.getItem("eventsGroupByMonth")==="1"}catch{return!1}});function pr(e){dr(e);try{localStorage.setItem("eventsSort",e)}catch{}F(a=>he(a,e))}function br(){const e=!ae;ur(e);try{localStorage.setItem("eventsGroupByMonth",e?"1":"0")}catch{}}const[O,G]=i.useState(()=>{try{return localStorage.getItem("planTripTab")||"catalog"}catch{return"catalog"}});i.useEffect(()=>{try{localStorage.setItem("planTripTab",O)}catch{}},[O]),i.useEffect(()=>{N&&O!=="catalog"&&G("catalog")},[N]),i.useEffect(()=>{const e=u.trim(),a=t.city.trim(),o=t.country.trim();if(N){F([]),z(""),W(1),H(!1);return}if(!o&&!a&&e.length<3){F([]),z(""),W(1),H(!1);return}let s=!0;te(!0),z("");const n=setTimeout(async()=>{try{const{events:c,page:g,hasMore:y,countsBySource:l}=await Be({q:e||"",city:a,country:o,page:1,limit:8,includePast:J});if(!s)return;F(he(Array.isArray(c)?c:[],be)),W(g||1),H(!!y),ir(l||{})}catch{if(!s)return;F([]),z("Could not load events right now."),W(1),H(!1)}finally{s&&te(!1)}},350);return()=>{s=!1,clearTimeout(n)}},[t.city,t.country,u,J,N]);function I(e,a){const o=["continent","country","province","city","area"],s=new URLSearchParams(d.search);a?s.set(e,a):s.delete(e);const n=o.indexOf(e);for(let c=n+1;c<o.length;c++)s.delete(o[c]);p({search:s.toString()?`?${s.toString()}`:""},{replace:!0})}function $(e,a){const o=new URLSearchParams(d.search);a?o.set(e,a):o.delete(e),p({search:o.toString()?`?${o.toString()}`:""},{replace:!0})}function Ae(){const e=new URLSearchParams(d.search);["continent","country","province","city","area"].forEach(a=>e.delete(a)),p({search:e.toString()?`?${e.toString()}`:""},{replace:!0})}const _e=i.useMemo(()=>{const e=u.trim().toLowerCase();let a=k;const{continent:o,country:s,province:n,city:c,area:g,category:y}=t;(o||s||n||c||g)&&(a=a.filter(x=>(!o||(x.continent||"").toLowerCase()===o.toLowerCase())&&(!s||(x.country||"").toLowerCase()===s.toLowerCase())&&(!n||(x.province||"").toLowerCase()===n.toLowerCase())&&(!c||(x.city||"").toLowerCase()===c.toLowerCase())&&(!g||(x.area||"").toLowerCase()===g.toLowerCase()))),y&&(a=a.filter(x=>(x.category||"").toLowerCase()===y.toLowerCase()));const l=Number(t.priceMin||""),L=Number(t.priceMax||""),U=!Number.isNaN(l)&&t.priceMin!=="",B=!Number.isNaN(L)&&t.priceMax!=="";return U&&(a=a.filter(x=>(Number(x.price)||0)>=l)),B&&(a=a.filter(x=>(Number(x.price)||0)<=L)),t.freeOnly?a=a.filter(x=>(Number(x.price)||0)===0):t.paidOnly&&(a=a.filter(x=>(Number(x.price)||0)>0)),e?a.filter(x=>x.title.toLowerCase().includes(e)||x.description.toLowerCase().includes(e)||x.category.toLowerCase().includes(e)||(x.continent||"").toLowerCase().includes(e)||(x.country||"").toLowerCase().includes(e)||(x.province||"").toLowerCase().includes(e)||(x.city||"").toLowerCase().includes(e)||(x.area||"").toLowerCase().includes(e)):a},[u,t]),ne=i.useMemo(()=>{const e=[..._e],a=u.trim().toLowerCase();if(E==="alpha")return e.sort((s,n)=>String(s.title).localeCompare(String(n.title)));if(E==="priceAsc")return e.sort((s,n)=>(Number(s.price)||0)-(Number(n.price)||0));if(E==="priceDesc")return e.sort((s,n)=>(Number(n.price)||0)-(Number(s.price)||0));if(!a)return e;const o=s=>{let n=0;const c=String(s.title||"").toLowerCase(),g=String(s.description||"").toLowerCase(),y=String(s.category||"").toLowerCase();return c.includes(a)&&(n+=5+Math.max(0,20-c.indexOf(a))),g.includes(a)&&(n+=2+Math.max(0,10-g.indexOf(a))),y.includes(a)&&(n+=3),n};return e.sort((s,n)=>o(n)-o(s))},[_e,E,u]);function De(e){const a=u.trim();if(!a)return e;const o=a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),s=new RegExp(`(${o})`,"ig");return String(e).split(s).map((c,g)=>s.test(c)?r.jsx("mark",{className:"bg-yellow-100 text-inherit p-0 rounded",children:c},g):r.jsx("span",{children:c},g))}const Re=i.useMemo(()=>yr(k),[]),xe=i.useMemo(()=>qe(),[]),[xr,se]=i.useState(!1);i.useEffect(()=>{const e=new URLSearchParams(d.search);e.get("setLocation")==="1"&&(se(!0),e.delete("setLocation"),p({search:e.toString()?`?${e.toString()}`:""},{replace:!0}))},[]);function Fe(){const e=u.trim();if(!e)return;const a=e.toLowerCase(),o=[" in "," near "," around "," at "];let s=-1,n="";for(const x of o){const K=a.lastIndexOf(x);K>s&&(s=K,n=x)}let c=e,g="";s>0&&(c=e.slice(0,s).trim(),g=e.slice(s+n.length).trim());const y=wr(c||e),{smartAliases:l}=ze();let L=jr(g,Re,l);if(Object.keys(L).length===0&&(L=Nr(e,Re,l)),!y&&Object.keys(L).length===0)return;const U=["continent","country","province","city","area","category","q"],B=new URLSearchParams(d.search);U.forEach(x=>B.delete(x)),y&&B.set("category",y),Object.entries(L).forEach(([x,K])=>{K&&B.set(x,K)}),v(""),p({search:`?${B.toString()}`},{replace:!1});try{S&&S(`Applied smart filters${y?` â€¢ ${y}`:""}${Object.values(L).length?` â€¢ ${Object.values(L)[0]}`:""}`,"success")}catch{}}const Ie=i.useMemo(()=>{const e=(u||"").trim();if(!e)return null;const{smartAliases:a}=ze(),o=fr(e,{products:k,myLocation:xe,enableAliases:a});return o?{text:o.label,count:o.count,cat:o.params.category,loc:(()=>{const{category:s,...n}=o.params;return n})()}:null},[u,xe]),Ue=i.useMemo(()=>{if(!Array.isArray(k)||k.length===0)return[];const e=new Map;for(const n of k){const c=(n.city||"").trim();c&&e.set(c,(e.get(c)||0)+1)}const a=Array.from(e.entries()).sort((n,c)=>c[1]-n[1]).slice(0,4).map(([n,c])=>({city:n,count:c})),o=n=>k.filter(c=>!(n.category&&String(c.category||"")!==n.category||n.city&&String(c.city||"")!==n.city||n.province&&String(c.province||"")!==n.province||n.country&&String(c.country||"")!==n.country||n.continent&&String(c.continent||"")!==n.continent||n.area&&String(c.area||"")!==n.area)).length;return a.map(({city:n})=>{const c={category:"Lodging",city:n};return{label:`Hotels in ${n} (${o(c)})`,params:c}})},[]);return r.jsxs("div",{className:"px-6 py-8 text-brand-brown",children:[r.jsxs("div",{className:"flex items-start justify-between gap-3",children:[r.jsxs("div",{children:[r.jsx("h2",{className:"text-3xl font-bold mb-1",children:"Trip Planner"}),r.jsx("p",{className:"mb-4 text-brand-brown/80",children:"Plan your trip with simple, powerful filters."})]}),r.jsx("div",{className:"mt-1",children:r.jsxs("label",{className:"inline-flex items-center gap-2 text-sm",children:[r.jsx("input",{type:"checkbox",checked:N,onChange:rr}),r.jsx("span",{children:"Simple mode"})]})})]}),!N&&r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"mb-4",children:r.jsx(Cr,{message:"Your quotes, itinerary, and bookings stay in sync in real time."})}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[r.jsx(Lr,{steps:Mr(f,m.length)}),r.jsxs(T,{to:"/quotes",className:"p-4 bg-cream-sand border border-cream-border rounded-md hover:bg-cream-hover transition",children:[r.jsx("div",{className:"font-semibold",children:"Quotes"}),r.jsx("p",{className:"text-sm text-brand-brown/80",children:"Generate a proposal from paid basket items."})]}),r.jsxs(T,{to:"/itinerary",className:"p-4 bg-cream-sand border border-cream-border rounded-md hover:bg-cream-hover transition",children:[r.jsx("div",{className:"font-semibold",children:"Itinerary"}),r.jsx("p",{className:"text-sm text-brand-brown/80",children:"All basket items populate your day plan."})]})]})]}),r.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-10",children:[r.jsxs("div",{className:"lg:col-span-2",children:[Ze&&r.jsxs("div",{className:"mb-2",children:[r.jsxs("div",{className:"flex items-center justify-between mb-1",children:[r.jsx("span",{className:"text-sm font-semibold text-brand-brown/80",children:"Weather"}),r.jsx("button",{type:"button",className:"text-[11px] px-2 py-0.5 rounded border border-cream-border bg-white hover:bg-cream-hover",onClick:()=>{const e=!ee;er(e);try{localStorage.setItem("weatherCollapsed",e?"1":"0")}catch{}},"aria-expanded":!ee,children:ee?"Expand":"Collapse"})]}),!ee&&r.jsx(_r,{city:t.city,country:t.country})]}),!N&&r.jsxs("div",{role:"tablist","aria-label":"Plan Trip sections",className:"mb-3 flex border-b border-cream-border gap-2",children:[r.jsx("button",{role:"tab","aria-selected":O==="catalog",onClick:()=>G("catalog"),className:`px-3 py-2 text-sm -mb-px border-b-2 ${O==="catalog"?"border-brand-brown text-brand-brown":"border-transparent text-brand-brown/60 hover:text-brand-brown"}`,children:"Catalog"}),r.jsx("button",{role:"tab","aria-selected":O==="events",onClick:()=>G("events"),className:`px-3 py-2 text-sm -mb-px border-b-2 ${O==="events"?"border-brand-brown text-brand-brown":"border-transparent text-brand-brown/60 hover:text-brand-brown"}`,children:"Events"})]}),(N||O==="catalog")&&r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"flex items-center justify-between mb-3 sticky [top:var(--sticky-offset)] z-10 bg-cream/80 backdrop-blur supports-[backdrop-filter]:bg-cream/60 px-1 py-2 rounded border border-cream-border shadow-sm",children:[r.jsxs("h3",{className:"font-semibold text-lg",children:["Product Catalog ",r.jsxs("span",{className:"text-sm text-brand-brown/60",children:["â€¢ ",ne.length]})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsxs("label",{className:"text-[11px] text-brand-brown/70 inline-flex items-center gap-1",children:[r.jsx("span",{className:"hidden sm:inline",children:"Sort"}),r.jsxs("select",{"aria-label":"Sort catalog",className:"text-[11px] px-2 py-1 border border-cream-border rounded bg-white",value:E,onChange:e=>Ye(e.target.value),children:[r.jsx("option",{value:"relevance",children:"Relevance"}),r.jsx("option",{value:"alpha",children:"A â†’ Z"}),r.jsx("option",{value:"priceAsc",children:"Price: Low to High"}),r.jsx("option",{value:"priceDesc",children:"Price: High to Low"})]})]}),r.jsx("input",{ref:h,value:u,onChange:e=>{v(e.target.value);const a=new URLSearchParams(d.search);e.target.value?a.set("q",e.target.value):a.delete("q"),p({search:a.toString()?`?${a.toString()}`:""},{replace:!0})},placeholder:"Search catalogâ€¦",title:"Press / to focus",className:"text-sm px-2 py-1 border border-cream-border rounded bg-white","aria-label":"Search product catalog",onKeyDown:e=>{if(e.key==="Escape"){e.preventDefault();const a=new URLSearchParams(d.search);a.delete("q"),v(""),p({search:a.toString()?`?${a.toString()}`:""},{replace:!0})}else e.key==="Enter"&&(e.preventDefault(),Fe())}}),Ie&&r.jsxs("button",{type:"button",onClick:Fe,className:"ml-2 text-[11px] px-2 py-1 rounded bg-white border border-cream-border shadow-sm hover:bg-cream-hover focus:outline-none focus:ring-2 focus:ring-brand-brown/30 inline-flex items-center gap-1","aria-label":"Apply smart filters suggestion",children:[r.jsx("span",{className:"text-brand-brown/70",children:"ğŸ”"}),r.jsx("span",{className:"truncate max-w-[12rem]",children:Ie.text})]}),r.jsx("button",{type:"button",className:"text-[11px] px-2 py-1 rounded border border-cream-border bg-white hover:bg-cream-hover",title:"Use my location",onClick:()=>{const e=qe();if(!e||!e.city&&!e.province&&!e.country){S("Set your location first","warn");return}const a=new URLSearchParams(d.search);["continent","country","province","city","area","category","q"].forEach(o=>a.delete(o)),e.city?a.set("city",e.city):e.province?a.set("province",e.province):e.country&&a.set("country",e.country),p({search:`?${a.toString()}`},{replace:!1}),S("Applied filters near your location","success")},children:"Near me"}),r.jsx("button",{type:"button",className:"text-[11px] px-2 py-1 rounded border border-cream-border bg-white hover:bg-cream-hover",title:"Set my location",onClick:()=>se(!0),children:"Set my location"}),!N&&r.jsx("span",{className:"hidden md:inline text-[11px] text-brand-brown/60",title:"Smart Search",children:"Tip: try â€œHotels in Durbanâ€, then press Enter"})]}),!N&&Ue.length>0&&r.jsx("div",{className:"mt-2 flex flex-wrap gap-2",role:"group","aria-label":"Quick actions",children:Ue.map((e,a)=>r.jsx("button",{type:"button",className:"text-xs px-2 py-1 rounded border border-cream-border hover:bg-cream-muted focus:outline-none focus:ring-2 focus:ring-brand-brown/30",onClick:()=>{const o=new URLSearchParams(d.search);["continent","country","province","city","area","category","q"].forEach(s=>o.delete(s)),Object.entries(e.params).forEach(([s,n])=>n&&o.set(s,n)),p({search:`?${o.toString()}`},{replace:!1});try{S&&S(`Applied ${e.label.replace(/ \(.*\)$/,"")}`,"success")}catch{}},children:e.label},a))}),!N&&r.jsx("button",{onClick:()=>{const e=new URLSearchParams(d.search);["continent","country","province","city","area","category","priceMin","priceMax","paidOnly","freeOnly","q"].forEach(a=>e.delete(a)),v(""),p({search:""},{replace:!0})},className:"text-xs px-2 py-1 rounded border border-cream-border bg-white hover:bg-cream-hover",title:"Reset filters and search",children:"Reset filters & search"}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsxs("label",{className:"text-[11px] text-brand-brown/70 inline-flex items-center gap-1",children:[r.jsx("span",{className:"hidden sm:inline",children:"Min"}),r.jsx("input",{type:"number",inputMode:"numeric",min:"0",value:t.priceMin,onChange:e=>$("priceMin",e.target.value),className:`w-20 text-[11px] px-2 py-1 border rounded bg-white ${(()=>{const e=Number(t.priceMin||""),a=Number(t.priceMax||""),o=!Number.isNaN(e)&&t.priceMin!=="",s=!Number.isNaN(a)&&t.priceMax!=="";return o&&s&&e>a?"border-red-400":"border-cream-border"})()}`,"aria-label":"Minimum price",placeholder:"Min"})]}),r.jsxs("label",{className:"text-[11px] text-brand-brown/70 inline-flex items-center gap-1",children:[r.jsx("span",{className:"hidden sm:inline",children:"Max"}),r.jsx("input",{type:"number",inputMode:"numeric",min:"0",value:t.priceMax,onChange:e=>$("priceMax",e.target.value),className:`w-20 text-[11px] px-2 py-1 border rounded bg-white ${(()=>{const e=Number(t.priceMin||""),a=Number(t.priceMax||""),o=!Number.isNaN(e)&&t.priceMin!=="",s=!Number.isNaN(a)&&t.priceMax!=="";return o&&s&&e>a?"border-red-400":"border-cream-border"})()}`,"aria-label":"Maximum price",placeholder:"Max"})]}),(()=>{const e=Number(t.priceMin||""),a=Number(t.priceMax||""),o=!Number.isNaN(e)&&t.priceMin!=="",s=!Number.isNaN(a)&&t.priceMax!=="";return o&&s&&e>a?r.jsx("span",{role:"alert",className:"text-[11px] text-red-600",children:"Min is greater than Max"}):null})(),r.jsxs("label",{className:"text-[11px] text-brand-brown/70 inline-flex items-center gap-1",children:[r.jsx("input",{type:"checkbox",checked:!!t.paidOnly,onChange:e=>{const a=e.target.checked;$("paidOnly",a?"1":""),a&&$("freeOnly","")},"aria-label":"Paid items only",disabled:!!t.freeOnly}),r.jsx("span",{children:"Paid only"})]}),r.jsxs("label",{className:"text-[11px] text-brand-brown/70 inline-flex items-center gap-1",children:[r.jsx("input",{type:"checkbox",checked:!!t.freeOnly,onChange:e=>{const a=e.target.checked;$("freeOnly",a?"1":""),a&&$("paidOnly","")},"aria-label":"Free items only",disabled:!!t.paidOnly}),r.jsx("span",{children:"Free only"})]})]}),!N&&r.jsx("button",{onClick:async()=>{try{const e=window.location.href;if(navigator.clipboard&&navigator.clipboard.writeText)await navigator.clipboard.writeText(e);else{const a=document.createElement("textarea");a.value=e,a.setAttribute("readonly",""),a.style.position="absolute",a.style.left="-9999px",document.body.appendChild(a),a.select(),document.execCommand("copy"),document.body.removeChild(a)}V("ok"),S("Link copied","success"),setTimeout(()=>V(""),1500)}catch{V("err"),S("Copy failed","error"),setTimeout(()=>V(""),2e3)}},className:"text-xs px-2 py-1 rounded border border-cream-border bg-white hover:bg-cream-hover",title:"Copy shareable link","aria-label":"Copy shareable link",children:"Copy link"}),r.jsx("span",{"aria-live":"polite",className:"sr-only",children:ge==="ok"?"Link copied":ge==="err"?"Copy failed":""}),!N&&r.jsx("span",{className:"text-xs text-brand-brown/60 hidden sm:inline",children:"Demo set â€¢ Extend via API later"})]}),r.jsxs("div",{"aria-live":"polite",role:"status",className:"sr-only",children:[ne.length," results in catalog"]}),r.jsxs("div",{className:"flex flex-wrap gap-2 sm:gap-2.5 md:gap-3 mb-3",children:[r.jsxs("select",{value:t.continent,onChange:e=>I("continent",e.target.value),className:"text-xs px-2 py-1 border border-cream-border rounded bg-white","aria-label":"Filter by continent",title:"Filter by continent",children:[r.jsx("option",{value:"",children:"All continents"}),sr.map(e=>r.jsxs("option",{value:e,children:[e," ",P.continent[e]?`(${P.continent[e]})`:""]},e))]}),r.jsxs("select",{value:t.country,onChange:e=>I("country",e.target.value),className:"text-xs px-2 py-1 border border-cream-border rounded bg-white","aria-label":"Filter by country",title:"Filter by country",disabled:!ke.length,children:[r.jsx("option",{value:"",children:"All countries"}),ke.map(e=>r.jsxs("option",{value:e,children:[e," ",P.country[e]?`(${P.country[e]})`:""]},e))]}),r.jsxs("select",{value:t.province,onChange:e=>I("province",e.target.value),className:"text-xs px-2 py-1 border border-cream-border rounded bg-white","aria-label":"Filter by province",title:"Filter by province",disabled:!Pe.length,children:[r.jsx("option",{value:"",children:"All provinces"}),Pe.map(e=>r.jsxs("option",{value:e,children:[e," ",P.province[e]?`(${P.province[e]})`:""]},e))]}),r.jsxs("select",{value:t.city,onChange:e=>I("city",e.target.value),className:"text-xs px-2 py-1 border border-cream-border rounded bg-white","aria-label":"Filter by city",title:"Filter by city",disabled:!$e.length,children:[r.jsx("option",{value:"",children:"All cities"}),$e.map(e=>r.jsxs("option",{value:e,children:[e," ",P.city[e]?`(${P.city[e]})`:""]},e))]}),r.jsxs("select",{value:t.area,onChange:e=>I("area",e.target.value),className:"text-xs px-2 py-1 border border-cream-border rounded bg-white","aria-label":"Filter by area",title:"Filter by area",disabled:!Oe.length,children:[r.jsx("option",{value:"",children:"All areas"}),Oe.map(e=>r.jsxs("option",{value:e,children:[e," ",P.area[e]?`(${P.area[e]})`:""]},e))]}),r.jsxs("select",{value:t.category,onChange:e=>$("category",e.target.value),className:"text-xs px-2 py-1 border border-cream-border rounded bg-white","aria-label":"Filter by category",title:"Filter by category",disabled:!Ee.length,children:[r.jsx("option",{value:"",children:"All categories"}),Ee.map(e=>r.jsxs("option",{value:e,children:[e," ",P.category[e]?`(${P.category[e]})`:""]},e))]}),!N&&r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsxs("select",{value:X,onChange:e=>{me(e.target.value),e.target.value&&nr(e.target.value)},className:"text-xs px-2 py-1 border border-cream-border rounded bg-white","aria-label":"Apply preset",title:"Apply preset",children:[r.jsx("option",{value:"",children:"Presetsâ€¦"}),ve.map(e=>r.jsx("option",{value:e.name,children:e.name},e.name))]}),r.jsx("input",{value:je,onChange:e=>Qe(e.target.value),placeholder:"Preset name",className:"text-xs px-2 py-1 border border-cream-border rounded bg-white","aria-label":"Preset name"}),r.jsx("button",{onClick:tr,className:"text-xs px-2 py-1 rounded border border-cream-border bg-white hover:bg-cream-hover",title:"Save current filters as preset",children:"Save"}),r.jsx("button",{disabled:!X,onClick:()=>ar(X),className:"text-xs px-2 py-1 rounded border border-cream-border bg-white hover:bg-cream-hover disabled:opacity-50",title:"Delete selected preset",children:"Delete"})]})]}),r.jsx("span",{"aria-live":"polite",className:"sr-only",children:de==="saved"?"Preset saved":de==="applied"?"Preset applied":de==="deleted"?"Preset deleted":""}),!N&&Ne.length>0&&r.jsxs("div",{className:"flex flex-wrap items-center gap-1.5 sm:gap-2 mb-3",children:[r.jsx("span",{className:"text-[11px] text-brand-brown/60 mr-1",children:"Recent:"}),Ne.map((e,a)=>{const o=e.filters||{},s=["city","province","country","area","category","continent"].map(c=>o[c]).filter(Boolean),n=s.join(" â€¢ ").slice(0,40)+(s.join(" â€¢ ").length>40?"â€¦":"");return r.jsx("button",{onClick:()=>Me(o),className:"text-[11px] px-2 py-1 rounded-full border border-cream-border bg-white hover:bg-cream-hover",title:s.join(" â€¢ "),children:n||"Unnamed"},e.signature||a)}),r.jsx("button",{onClick:()=>{Ce([]);try{localStorage.setItem("planTripRecentFilters:v1","[]")}catch{}S("Recent filters cleared","info")},className:"text-[11px] px-2 py-1 rounded-full border border-cream-border bg-white hover:bg-cream-hover",title:"Clear recent filters",children:"Clear recents"})]}),(t.continent||t.country||t.province||t.city||t.area||t.category||t.priceMin||t.priceMax||t.paidOnly||t.freeOnly)&&r.jsxs("div",{className:"flex flex-wrap items-center gap-1.5 sm:gap-2 mb-4",children:[["continent","country","province","city","area"].map(e=>t[e]?r.jsxs("button",{onClick:()=>I(e,""),className:"text-xs px-2 py-1 rounded-full border border-cream-border bg-cream hover:bg-cream-hover focus:outline-none focus:ring-2 focus:ring-brand-brown/30 active:scale-[0.98] transition",title:`Clear ${e}`,"aria-label":`Clear ${e} filter: ${t[e]}`,children:[e,": ",t[e]," Ã—"]},e):null),t.category?r.jsxs("button",{onClick:()=>$("category",""),className:"text-xs px-2 py-1 rounded-full border border-cream-border bg-cream hover:bg-cream-hover focus:outline-none focus:ring-2 focus:ring-brand-brown/30 active:scale-[0.98] transition",title:"Clear category","aria-label":`Clear category filter: ${t.category}`,children:["category: ",t.category," Ã—"]}):null,t.priceMin?r.jsxs("button",{onClick:()=>$("priceMin",""),className:"text-xs px-2 py-1 rounded-full border border-cream-border bg-cream hover:bg-cream-hover focus:outline-none focus:ring-2 focus:ring-brand-brown/30 active:scale-[0.98] transition",title:"Clear minimum price","aria-label":`Clear minimum price filter: ${t.priceMin}`,children:["min: ",t.priceMin," Ã—"]}):null,t.priceMax?r.jsxs("button",{onClick:()=>$("priceMax",""),className:"text-xs px-2 py-1 rounded-full border border-cream-border bg-cream hover:bg-cream-hover focus:outline-none focus:ring-2 focus:ring-brand-brown/30 active:scale-[0.98] transition",title:"Clear maximum price","aria-label":`Clear maximum price filter: ${t.priceMax}`,children:["max: ",t.priceMax," Ã—"]}):null,t.paidOnly?r.jsx("button",{onClick:()=>$("paidOnly",""),className:"text-xs px-2 py-1 rounded-full border border-cream-border bg-cream hover:bg-cream-hover focus:outline-none focus:ring-2 focus:ring-brand-brown/30 active:scale-[0.98] transition",title:"Clear paid only","aria-label":"Clear paid only filter",children:"paid only Ã—"}):null,t.freeOnly?r.jsx("button",{onClick:()=>$("freeOnly",""),className:"text-xs px-2 py-1 rounded-full border border-cream-border bg-cream hover:bg-cream-hover focus:outline-none focus:ring-2 focus:ring-brand-brown/30 active:scale-[0.98] transition",title:"Clear free only","aria-label":"Clear free only filter",children:"free only Ã—"}):null,r.jsx("button",{onClick:Ae,className:"text-[11px] px-2 py-1 rounded-full border border-cream-border bg-white hover:bg-cream-hover text-brand-brown/80 focus:outline-none focus:ring-2 focus:ring-brand-brown/30 active:scale-[0.98] transition",title:"Clear all location filters","aria-label":"Clear all location filters",children:"Clear filters"})]}),r.jsxs("ul",{className:"space-y-3",children:[ne.map(e=>r.jsxs("li",{className:"p-4 rounded border bg-cream-sand border-cream-border flex flex-col md:flex-row md:items-center gap-3",children:[r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx("div",{className:"font-medium",children:De(e.title)}),r.jsx("div",{className:"text-sm text-brand-brown/70",children:De(e.description)}),r.jsxs("div",{className:"text-[11px] text-brand-brown/50",children:[e.category," â€¢ ",e.price>0?`Price: $${e.price}`:"Included / No charge"]}),r.jsx("div",{className:"text-[11px] text-brand-brown/60 mt-0.5",children:e.province||e.country||e.city?r.jsxs(r.Fragment,{children:[e.province?`${e.province}, `:"",e.city||e.country,e.area?` â€¢ ${e.area}`:""]}):null})]}),r.jsx("button",{onClick:()=>w(e),className:"px-3 py-1.5 text-xs rounded border border-brand-brown hover:bg-cream-hover",children:"Add"})]},e.id)),ne.length===0&&r.jsxs("li",{className:"text-sm text-brand-brown/60 flex items-center gap-2",children:[r.jsx("span",{children:"No results."}),r.jsx("button",{onClick:Ae,className:"text-brand-brown underline hover:no-underline",children:"Clear filters"}),r.jsx("span",{className:"hidden sm:inline",children:"or"}),r.jsx("button",{onClick:()=>{const e=new URLSearchParams(d.search);["continent","country","province","city","area","category","priceMin","priceMax","paidOnly","q"].forEach(a=>e.delete(a)),v(""),p({search:""},{replace:!0})},className:"text-brand-brown underline hover:no-underline",children:"Reset all"})]})]})]}),!N&&O==="events"&&(t.country||t.city||u.trim().length>=3)&&r.jsxs("div",{className:"mt-6",children:[r.jsxs("div",{className:"flex items-baseline justify-between mb-2",children:[r.jsxs("h4",{className:"font-semibold",children:["Events ",t.city?`â€¢ ${t.city}`:t.country?`â€¢ ${t.country}`:""]}),r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsxs("label",{className:"text-[12px] text-brand-brown/70 inline-flex items-center gap-1",children:[r.jsx("input",{type:"checkbox",checked:J,onChange:mr}),r.jsx("span",{children:"Include past"})]}),r.jsxs("label",{className:"text-[12px] text-brand-brown/70 inline-flex items-center gap-1",children:[r.jsx("input",{type:"checkbox",checked:ae,onChange:br}),r.jsx("span",{children:"Group by month"})]}),r.jsxs("label",{className:"text-[12px] text-brand-brown/70 inline-flex items-center gap-1",children:[r.jsx("span",{className:"hidden sm:inline",children:"Sort"}),r.jsxs("select",{"aria-label":"Sort events by date",className:"text-[12px] px-1.5 py-0.5 border border-cream-border rounded bg-white",value:be,onChange:e=>pr(e.target.value),children:[r.jsx("option",{value:"dateAsc",children:"Soonest first"}),r.jsx("option",{value:"dateDesc",children:"Latest first"})]})]}),ue&&r.jsx("span",{className:"text-xs text-brand-brown/60",children:"Loadingâ€¦"})]})]}),pe&&r.jsx("div",{role:"alert",className:"text-xs text-red-600 mb-2",children:pe}),!ue&&re.length===0&&!pe&&r.jsxs("div",{className:"text-sm text-brand-brown/70 bg-cream-sand border border-cream-border rounded p-3",children:[r.jsx("div",{className:"font-medium mb-1",children:"No events found."}),r.jsxs("ul",{className:"list-disc pl-4 space-y-1",children:[r.jsx("li",{children:"Try a broader search term or clear the search box."}),r.jsx("li",{children:"Select just a country (and remove city) to widen results."}),r.jsx("li",{children:"On Settings, enable â€œShow demo eventsâ€ to visualize the experience."})]}),r.jsx("div",{className:"mt-2",children:r.jsx(T,{to:"/settings",className:"inline-block px-2.5 py-1 text-xs rounded border border-cream-border bg-white hover:bg-cream-hover",children:"Open Settings"})})]}),!ae&&r.jsxs("ul",{className:"space-y-2",children:[ue&&re.length===0&&Array.from({length:3}).map((e,a)=>r.jsxs("li",{className:"p-3 rounded border border-cream-border bg-white animate-pulse",children:[r.jsx("div",{className:"h-4 bg-cream-sand/80 rounded w-2/3 mb-2"}),r.jsx("div",{className:"h-3 bg-cream-sand/70 rounded w-1/2"})]},`skeleton_${a}`)),re.map(e=>r.jsxs("li",{className:"p-3 rounded border border-cream-border bg-white flex flex-col md:flex-row md:items-center gap-3",children:[r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsxs("div",{className:"font-medium truncate",children:[e.name," ",e.source==="Demo"&&r.jsx("span",{className:"ml-2 text-[10px] px-1 py-0.5 rounded bg-cream-sand border border-cream-border align-middle",children:"Demo"})]}),r.jsxs("div",{className:"text-[12px] text-brand-brown/70 truncate",children:[[e.venue,e.city,e.country].filter(Boolean).length>0?r.jsxs(r.Fragment,{children:[[e.venue,e.city,e.country].filter(Boolean).join(", ")," ",e.date?`â€¢ ${new Date(e.date).toLocaleDateString()}`:""]}):r.jsx(r.Fragment,{children:e.date?r.jsx("span",{className:"px-1 py-0.5 mr-1 rounded bg-cream-sand border border-cream-border align-middle",children:new Date(e.date).toLocaleDateString()}):null})," ","â€¢ ",r.jsx("span",{className:"px-1 py-0.5 text-[10px] rounded bg-cream-sand border border-cream-border align-middle",children:e.source})]})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[e.url&&r.jsx("a",{href:e.url,target:"_blank",rel:"noopener",className:"px-2 py-1 text-xs rounded border border-cream-border hover:bg-cream-hover",children:"Open"}),r.jsx("button",{onClick:()=>w({id:`ev_${e.source}_${e.id}`,title:e.name,description:[e.venue,e.city,e.country,e.date&&new Date(e.date).toLocaleDateString()].filter(Boolean).join(" â€¢ "),category:"Event",price:0,url:e.url||"",source:e.source}),className:"px-3 py-1.5 text-xs rounded border border-brand-brown hover:bg-cream-hover",children:"Add"})]})]},`ev_${e.source}_${e.id}`))]}),ae&&r.jsx("div",{className:"space-y-4",children:(()=>{const e=new Map;for(const o of re){let s="Unknown date";if(o?.date){const n=new Date(o.date);Number.isNaN(n.valueOf())||(s=n.toLocaleString(void 0,{month:"long",year:"numeric"}))}e.has(s)||e.set(s,[]),e.get(s).push(o)}return Array.from(e.entries()).map(([o,s])=>r.jsxs("section",{children:[r.jsx("h5",{className:"text-sm font-semibold text-brand-brown/80 mb-2",children:o}),r.jsx("ul",{className:"space-y-2",children:s.map(n=>r.jsxs("li",{className:"p-3 rounded border border-cream-border bg-white flex flex-col md:flex-row md:items-center gap-3",children:[r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsxs("div",{className:"font-medium truncate",children:[n.name," ",n.source==="Demo"&&r.jsx("span",{className:"ml-2 text-[10px] px-1 py-0.5 rounded bg-cream-sand border border-cream-border align-middle",children:"Demo"})]}),r.jsxs("div",{className:"text-[12px] text-brand-brown/70 truncate",children:[[n.venue,n.city,n.country].filter(Boolean).length>0?r.jsxs(r.Fragment,{children:[[n.venue,n.city,n.country].filter(Boolean).join(", ")," ",n.date?`â€¢ ${new Date(n.date).toLocaleDateString()}`:""]}):r.jsx(r.Fragment,{children:n.date?r.jsx("span",{className:"px-1 py-0.5 mr-1 rounded bg-cream-sand border border-cream-border align-middle",children:new Date(n.date).toLocaleDateString()}):null})," ","â€¢ ",r.jsx("span",{className:"px-1 py-0.5 text-[10px] rounded bg-cream-sand border border-cream-border align-middle",children:n.source})]})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[n.url&&r.jsx("a",{href:n.url,target:"_blank",rel:"noopener",className:"px-2 py-1 text-xs rounded border border-cream-border hover:bg-cream-hover",children:"Open"}),r.jsx("button",{onClick:()=>w({id:`ev_${n.source}_${n.id}`,title:n.name,description:[n.venue,n.city,n.country,n.date&&new Date(n.date).toLocaleDateString()].filter(Boolean).join(" â€¢ "),category:"Event",price:0,url:n.url||"",source:n.source}),className:"px-3 py-1.5 text-xs rounded border border-brand-brown hover:bg-cream-hover",children:"Add"})]})]},`ev_${n.source}_${n.id}`))})]},o))})()}),cr&&r.jsx("div",{className:"mt-3",children:r.jsx("button",{onClick:async()=>{try{te(!0);const e=u.trim(),a=t.city.trim(),o=t.country.trim(),s=(or||1)+1,{events:n,page:c,hasMore:g}=await Be({q:e||"",city:a,country:o,page:s,limit:8,includePast:J});F(y=>Pr(y,n,be)),W(c||s),H(!!g)}catch{z("Could not load more events.")}finally{te(!1)}},className:"px-3 py-1.5 text-xs rounded border border-cream-border bg-white hover:bg-cream-hover",children:"Load more"})}),Object.keys(Te||{}).length>0&&r.jsxs("div",{className:"mt-3 text-[12px] text-brand-brown/60",children:["Sources: ",Object.entries(Te).map(([e,a])=>r.jsxs("span",{className:"inline-flex items-center gap-1 mr-2",children:[r.jsx("span",{className:"px-1 py-0.5 rounded bg-cream-sand border border-cream-border",children:e}),r.jsx("span",{children:a})]},e))]})]})]}),!N&&r.jsxs("div",{className:"rounded border border-cream-border bg-cream p-4 h-fit sticky [top:calc(var(--sticky-offset)+2rem)]",children:[r.jsxs("div",{className:"flex items-center justify-between mb-3",children:[r.jsxs("h3",{className:"font-semibold",children:["Basket (",m.length,")"]}),!fe&&r.jsx("button",{onClick:()=>ce(!0),className:"text-[11px] px-2 py-1 rounded border border-cream-border bg-white hover:bg-cream-hover",children:"Clear basket"}),fe&&r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx("span",{className:"text-[11px] text-brand-brown/70",children:"Confirm?"}),r.jsx("button",{onClick:()=>{ie(m),Q(),ce(!1),Z("Basket cleared. Undo available for 10 seconds."),A.current&&clearTimeout(A.current),A.current=setTimeout(()=>{Z(""),ie([])},1e4),S("Basket cleared","info")},className:"text-[11px] px-2 py-1 rounded border border-cream-border bg-white hover:bg-cream-hover",children:"Yes"}),r.jsx("button",{onClick:()=>ce(!1),className:"text-[11px] px-2 py-1 rounded border border-cream-border bg-white hover:bg-cream-hover",children:"No"})]})]}),le&&r.jsxs("div",{className:"mb-2 text-[12px] bg-cream-sand border border-cream-border rounded p-2 flex items-center justify-between",children:[r.jsx("span",{children:le}),r.jsx("button",{onClick:()=>{A.current&&(clearTimeout(A.current),A.current=null),(Ke||[]).forEach(a=>w({...a})),Z("Restored basket"),setTimeout(()=>Z(""),1200),ie([]),S("Basket restored","success")},className:"text-[11px] px-2 py-1 rounded border border-cream-border bg-white hover:bg-cream-hover",children:"Undo"})]}),r.jsx("span",{"aria-live":"polite",className:"sr-only",children:le}),Se.length>0&&r.jsx("div",{className:"fixed right-4 bottom-4 z-50 space-y-2",children:Se.map(e=>r.jsx("div",{className:`px-3 py-2 rounded shadow border text-sm ${e.type==="success"?"bg-green-50 border-green-200 text-green-800":e.type==="error"?"bg-red-50 border-red-200 text-red-800":e.type==="warn"?"bg-yellow-50 border-yellow-200 text-yellow-800":"bg-white border-cream-border text-brand-brown"}`,children:e.text},e.id))}),r.jsxs("div",{"aria-live":"polite",role:"status",className:"sr-only",children:["Basket has ",m.length," item",m.length===1?"":"s"]}),m.length===0&&r.jsx("p",{className:"text-sm text-brand-brown/60",children:"No items yet. Add from the catalog."}),r.jsx("ul",{className:"space-y-2 mb-4",children:m.map(e=>r.jsxs("li",{className:"bg-white rounded border border-cream-border p-2 text-sm flex flex-col gap-1",children:[r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsx("span",{className:"font-medium truncate",children:e.title}),r.jsx("button",{onClick:()=>j(e.id),className:"text-[10px] uppercase tracking-wide text-red-600 hover:text-red-500",children:"Remove"})]}),r.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-[11px] text-brand-brown/70",children:[r.jsx("span",{children:e.price>0?oe(e.price,"USD"):"Included"}),r.jsx("span",{children:"â€¢ Qty"}),r.jsx("input",{type:"number",min:1,value:e.quantity,onChange:a=>C(e.id,Number(a.target.value)),className:"w-14 px-1 py-0.5 border border-cream-border rounded"}),r.jsx("span",{children:"â€¢ Day"}),r.jsx("input",{type:"number",min:1,value:e.day||1,onChange:a=>q(e.id,a.target.value),className:"w-14 px-1 py-0.5 border border-cream-border rounded"})]})]},e.id))}),(()=>{const e=M.reduce((a,o)=>a+(Number(o.price)||0)*(Number(o.quantity)||1),0);return r.jsxs("div",{className:"flex items-center justify-between text-xs text-brand-brown/80 mb-3",children:[r.jsx("span",{children:"All items appear in itinerary. Paid items appear in quotes."}),r.jsxs("span",{className:"font-semibold",children:["Paid total: ",oe(e,"USD")]})]})})(),r.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[r.jsx("button",{onClick:async()=>{try{const e=[];e.push("Trip Basket Summary"),e.push(""),m.forEach(s=>{const n=Number(s.quantity)||1,c=Number(s.price)||0,g=c*n,y=[s.city,s.province,s.country].filter(Boolean).join(", ");e.push(`- ${n} x ${s.title}${c>0?` @ ${oe(c,"USD")}`:" (Included)"}${y?` â€¢ ${y}`:""}`)});const a=M.reduce((s,n)=>s+(Number(n.price)||0)*(Number(n.quantity)||1),0);e.push(""),e.push(`Paid total: ${oe(a,"USD")}`);const o=e.join(`
`);if(navigator.clipboard&&navigator.clipboard.writeText)await navigator.clipboard.writeText(o);else{const s=document.createElement("textarea");s.value=o,s.setAttribute("readonly",""),s.style.position="absolute",s.style.left="-9999px",document.body.appendChild(s),s.select(),document.execCommand("copy"),document.body.removeChild(s)}Y("ok"),setTimeout(()=>Y(""),1500)}catch{Y("err"),setTimeout(()=>Y(""),2e3)}},className:"px-2 py-1 text-xs rounded border border-cream-border bg-white hover:bg-cream-hover",title:"Copy basket summary","aria-label":"Copy basket summary",children:"Copy summary"}),r.jsx("span",{"aria-live":"polite",className:"sr-only",children:ye==="ok"?"Basket summary copied":ye==="err"?"Copy failed":""})]}),r.jsxs(T,{to:"/quote/new",state:{fromBasket:!0},className:`block text-center px-3 py-2 rounded text-sm font-medium border ${M.length?"bg-brand-brown text-cream border-brand-brown hover:bg-brand-brown/90":"bg-cream-sand text-brand-brown/50 border-cream-border cursor-not-allowed"}`,children:["Create Quote (",M.length,")"]})]})]}),r.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:[r.jsxs(T,{to:"/bookings",className:"p-4 bg-cream-sand border border-cream-border rounded-md hover:bg-cream-hover transition",children:[r.jsx("div",{className:"font-semibold",children:"Bookings"}),r.jsx("p",{className:"text-sm text-brand-brown/80",children:"See all confirmations and status in one place."})]}),r.jsxs(T,{to:"/terms",className:"p-4 bg-cream-sand border border-cream-border rounded-md hover:bg-cream-hover transition",children:[r.jsx("div",{className:"font-semibold",children:"Travel Safety & Terms"}),r.jsx("p",{className:"text-sm text-brand-brown/80",children:"Know-before-you-go and policies."})]}),r.jsxs(T,{to:"/contact",className:"p-4 bg-cream-sand border border-cream-border rounded-md hover:bg-cream-hover transition",children:[r.jsx("div",{className:"font-semibold",children:"Concierge"}),r.jsx("p",{className:"text-sm text-brand-brown/80",children:"Need help? Our team is here."})]})]}),r.jsx($r,{open:xr,initial:xe,onClose:()=>se(!1),onSave:e=>{vr(e),se(!1),S("Location saved","success")}})]})}export{qr as default};
